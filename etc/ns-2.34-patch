diff -ruN --exclude='*.o' --exclude='autom4*' ns-2.34-pure/Makefile.in ns-2.34/Makefile.in
--- ns-2.34-pure/Makefile.in	2009-06-14 10:35:44.000000000 -0700
+++ ns-2.34/Makefile.in	2010-02-28 09:31:39.000000000 -0800
@@ -59,7 +59,7 @@
 LDFLAGS	= @LDFLAGS@ 
 LDOUT	= -o $(BLANK)
 
-DEFINE	= -DTCP_DELAY_BIND_ALL -DNO_TK @V_DEFINE@ @V_DEFINES@ @DEFS@ -DNS_DIFFUSION -DSMAC_NO_SYNC -DCPP_NAMESPACE=@CPP_NAMESPACE@ -DUSE_SINGLE_ADDRESS_SPACE -Drng_test
+DEFINE	= -DTCP_DELAY_BIND_ALL -DNO_TK @V_DEFINE@ @V_DEFINES@ @DEFS@ -DNS_DIFFUSION -DSMAC_NO_SYNC -DCPP_NAMESPACE=@CPP_NAMESPACE@ -DUSE_SINGLE_ADDRESS_SPACE -Drng_test -DALLOW_RANDOM
 
 INCLUDES = \
 	-I. @V_INCLUDE_X11@ \
@@ -163,7 +163,7 @@
 
 OBJ_CC = \
 	tools/random.o tools/rng.o tools/ranvar.o common/misc.o common/timer-handler.o \
-	common/scheduler.o common/object.o common/packet.o \
+	common/scheduler.o common/object.o common/packet.o common/rawpacket.o \
 	common/ip.o routing/route.o common/connector.o common/ttl.o \
 	trace/trace.o trace/trace-ip.o \
 	classifier/classifier.o classifier/classifier-addr.o \
@@ -175,6 +175,7 @@
 	classifier/classifier-mac.o \
 	classifier/classifier-qs.o \
 	classifier/classifier-port.o src_rtg/classifier-sr.o \
+	classifier/classifier-ext.o classifier/classifier-click.o \
         src_rtg/sragent.o src_rtg/hdr_src.o adc/ump.o \
 	qs/qsagent.o qs/hdr_qs.o \
 	apps/app.o apps/telnet.o tcp/tcplib-telnet.o \
@@ -215,7 +216,7 @@
 	sctp/sctpDebug.o \
 	tools/integrator.o tools/queue-monitor.o \
 	tools/flowmon.o tools/loss-monitor.o \
-	queue/queue.o queue/drop-tail.o \
+	queue/queue.o queue/drop-tail.o queue/clickqueue.o \
 	adc/simple-intserv-sched.o queue/red.o \
 	queue/semantic-packetqueue.o queue/semantic-red.o \
 	tcp/ack-recons.o \
@@ -243,16 +244,17 @@
 	common/pkt-counter.o \
 	common/Decapsulator.o common/Encapsulator.o \
 	common/encap.o \
-	mac/channel.o mac/mac.o mac/ll.o mac/mac-802_11.o \
+	mac/channel.o mac/mac.o mac/ll.o mac/ll-ext.o mac/mac-802_11.o \
 	mac/mac-802_11Ext.o \
 	mac/mac-802_3.o mac/mac-tdma.o mac/smac.o \
 	mobile/mip.o mobile/mip-reg.o mobile/gridkeeper.o \
 	mobile/propagation.o mobile/tworayground.o \
 	mobile/nakagami.o \
-	mobile/antenna.o mobile/omni-antenna.o \
+	mobile/antenna.o mobile/omni-antenna.o mobile/uni-antenna.o \
+	mobile/pattern-antenna.o \
 	mobile/shadowing.o mobile/shadowing-vis.o mobile/dumb-agent.o \
 	common/bi-connector.o common/node.o \
-	common/mobilenode.o \
+	common/mobilenode.o common/clicknode.o \
 	mac/arp.o mobile/god.o mobile/dem.o \
 	mobile/topography.o mobile/modulation.o \
 	queue/priqueue.o queue/dsr-priqueue.o \
@@ -319,6 +321,7 @@
 	pgm/classifier-pgm.o pgm/pgm-agent.o pgm/pgm-sender.o \
 	pgm/pgm-receiver.o mcast/rcvbuf.o \
 	mcast/classifier-lms.o mcast/lms-agent.o mcast/lms-receiver.o \
+	routing/extrouter.o routing/extclickrouter.o \
 	mcast/lms-sender.o \
 	queue/delayer.o \
 	xcp/xcpq.o xcp/xcp.o xcp/xcp-end-sys.o \
@@ -512,6 +515,7 @@
 	tcl/lib/ns-srcrt.tcl \
 	tcl/mcast/ns-lms.tcl \
 	tcl/lib/ns-qsnode.tcl \
+	tcl/lib/ns-clicknode.tcl \
 	@V_NS_TCL_LIB_STL@
 
 $(GEN_DIR)ns_tcl.cc: $(NS_TCL_LIB)
diff -ruN --exclude='*.o' --exclude='autom4*' ns-2.34-pure/apps/udp.cc ns-2.34/apps/udp.cc
--- ns-2.34-pure/apps/udp.cc	2009-06-14 10:35:44.000000000 -0700
+++ ns-2.34/apps/udp.cc	2010-02-28 09:31:39.000000000 -0800
@@ -104,7 +104,8 @@
 		if (flags && (0 ==strcmp(flags, "NEW_BURST")))
 			rh->flags() |= RTP_M;
 		p->setdata(data);
-		target_->recv(p);
+		//target_->recv(p);
+		Agent::send(p,0);
 	}
 	n = nbytes % size_;
 	if (n > 0) {
@@ -119,7 +120,8 @@
 		if (flags && (0 == strcmp(flags, "NEW_BURST")))
 			rh->flags() |= RTP_M;
 		p->setdata(data);
-		target_->recv(p);
+		//target_->recv(p);
+		Agent::send(p,0);
 	}
 	idle();
 }
diff -ruN --exclude='*.o' --exclude='autom4*' ns-2.34-pure/classifier/classifier-click.cc ns-2.34/classifier/classifier-click.cc
--- ns-2.34-pure/classifier/classifier-click.cc	1969-12-31 16:00:00.000000000 -0800
+++ ns-2.34/classifier/classifier-click.cc	2010-02-28 09:31:39.000000000 -0800
@@ -0,0 +1,730 @@
+/*
+ * classifier-click classifier file for nsclick
+ */
+
+/*****************************************************************************
+ *  Copyright 2002, Univerity of Colorado at Boulder.                        *
+ *                                                                           *
+ *                        All Rights Reserved                                *
+ *                                                                           *
+ *  Permission to use, copy, modify, and distribute this software and its    *
+ *  documentation for any purpose other than its incorporation into a        *
+ *  commercial product is hereby granted without fee, provided that the      *
+ *  above copyright notice appear in all copies and that both that           *
+ *  copyright notice and this permission notice appear in supporting         *
+ *  documentation, and that the name of the University not be used in        *
+ *  advertising or publicity pertaining to distribution of the software      *
+ *  without specific, written prior permission.                              *
+ *                                                                           *
+ *  UNIVERSITY OF COLORADO DISCLAIMS ALL WARRANTIES WITH REGARD TO THIS      *
+ *  SOFTWARE, INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY AND        *
+ *  FITNESS FOR ANY PARTICULAR PURPOSE.  IN NO EVENT SHALL THE UNIVERSITY    *
+ *  OF COLORADO BE LIABLE FOR ANY SPECIAL, INDIRECT OR CONSEQUENTIAL         *
+ *  DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM LOSS OF USE, DATA       *
+ *  OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR OTHER        *
+ *  TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR         *
+ *  PERFORMANCE OF THIS SOFTWARE.                                            *
+ *                                                                           *
+ ****************************************************************************/
+/*
+ *	Modified by Nicolas Letor to support wifi elements.
+ * 	Performance Analysis of Telecommunication Systems (PATS) research group,
+ * 	Interdisciplinary Institute for Broadband Technology (IBBT) & Universiteit Antwerpen.
+ */
+#include "config.h"
+#include <stdlib.h>
+#include <ctype.h>
+#include <sys/time.h>
+#include <unistd.h>
+//#include <stl.h>
+//#include <hash_map.h>
+#include <map>
+#include <string>
+#include <stdarg.h>
+
+#include "agent.h"
+#include "packet.h"
+#include "rawpacket.h"
+#include "ip.h"
+#include "extrouter.h"
+#include "classifier.h"
+#include "classifier-ext.h"
+#include "mobilenode.h"
+#include "clicknode.h"
+#include "address.h"
+#include <click/simclick.h>
+#include "scheduler.h"
+#include "classifier-click.h"
+#include "ll-ext.h"
+#include "clickqueue.h"
+
+#include "packet_anno.h"
+
+static class ClickClassifierClass : public TclClass {
+public:
+  ClickClassifierClass() : TclClass("Classifier/Ext/Click") {}
+  TclObject* create(int, const char*const*) {
+    return (new ClickClassifier());
+  }
+} class_click_classifier;
+
+
+void
+ClickEventHandler::handle(Event* event) {
+    // XXX dangerous downcast - should use RTTI
+    // XXX multithreading!
+    ClickEvent* cevent = (ClickEvent*) event;
+    cevent->simnode_->curtime = cevent->when_;
+    //fprintf(stderr,"Should be calling simclick_click_run: %lf\n",event->time_);
+    simclick_click_run(cevent->simnode_);
+    delete cevent;
+}
+
+map<MACAddr,int> ClickClassifier::global_mactonodemap_;
+map<MACAddr,int> ClickClassifier::global_mactonsmacmap_;
+map<u_int32_t,int> ClickClassifier::global_ipmap_;
+
+ClickClassifier::ClickClassifier() {
+  extrouter_ = this;
+  click_initialized_ = false;
+}
+
+int
+ClickClassifier::command(int argc, const char*const* argv)
+{
+  Tcl& tcl = Tcl::instance();
+  if (2 == argc) {
+    if (strcmp(argv[1], "getnodename") == 0) {
+      // getnodename
+      tcl.resultf(nodename_.c_str());
+      return TCL_OK;
+    }
+    if (strcmp(argv[1], "runclick") == 0) {
+      // runclick
+      if (click_initialized_) {
+	  simclick_node_t::curtime = GetSimTime();
+	  simclick_click_run(this);
+      }
+      return TCL_OK;
+    }
+  }
+  else if (3 == argc) {
+    if(strcmp(argv[1], "loadclick") == 0) {
+	simclick_node_t::curtime = GetSimTime();
+	if (simclick_click_create(this, argv[2]) >= 0) {
+	    click_initialized_ = true;
+	    simclick_click_run(this);
+	}
+
+      return TCL_OK;
+    }
+    if (strcmp(argv[1], "getip") == 0) {
+      // getip <ifname>
+      int theif = GetIFID(argv[2]);
+      //fprintf(stderr,"get ipaddr is %s\n",ifipaddrs_[theif].c_str());
+      tcl.resultf(ifipaddrs_[theif].c_str());
+      return TCL_OK;
+    }
+    if (strcmp(argv[1], "getmac") == 0) {
+      // getmac <ifname>
+      int theif = GetIFID(argv[2]);
+      //fprintf(stderr,"get macaddr is %s\n",ifmacaddrs_[theif].c_str());
+      tcl.resultf(ifmacaddrs_[theif].c_str());
+      return TCL_OK;
+    }
+    if (strcmp(argv[1], "setnodename") == 0) {
+      // setnodename <ifname>
+      nodename_ = argv[2];
+      return TCL_OK;
+    }
+    if (strcmp(argv[1], "setnodeaddr") == 0) {
+      // setnodeaddr <nodeaddress>
+      nodeaddr_ =  Address::instance().str2addr(argv[2]);
+      return TCL_OK;
+    }
+    //mvhaen -- meant to set the trace file
+    if (strcmp(argv[1], "tracetarget") == 0) {
+      logtarget_ = ( CMUTrace* ) TclObject::lookup(argv[2]);
+      if (logtarget_ == 0)
+          return TCL_ERROR;
+      return TCL_OK;
+    }
+  }
+  else if (4 == argc) {
+    if(strcmp(argv[1], "setip") == 0) {
+      // setip <ifname> <ipaddr>
+      int theif = GetIFID(argv[2]);
+      ifipaddrs_[theif] = string(argv[3]);
+      //fprintf(stderr,"ipaddr is %s\n",ifipaddrs_[theif].c_str());
+      // Also save the binary form of this IP address in a static
+      // (i.e. simulator global) hash map of IP addresses to ns-2
+      // addresses. This lets us track map IP to ns-2 address when
+      // we might need it.
+      global_ipmap_[inet_addr(argv[3])] = nodeaddr_;
+      return TCL_OK;
+    }
+    else if(strcmp(argv[1], "setmac") == 0) {
+      // setmac <ifname> <macaddr>
+      int theif = GetIFID(argv[2]);
+      ifmacaddrs_[theif] = string(argv[3]);
+
+      //fprintf(stderr,"macaddr is %s\n",ifmacaddrs_[theif].c_str());
+
+      // Also save the binary form of this MAC address in a static
+      // (i.e. simulator global) hash map of MAC addresses to ns-2
+      // addresses. This lets us set the destination address in the
+      // ns-2 packet header.
+      MACAddr thismacaddr = MACAddr(string(argv[3]));
+      global_mactonodemap_[thismacaddr] = nodeaddr_;
+      LL* mylink = (LL*) slot_[theif];
+      global_mactonsmacmap_[thismacaddr] = mylink->macDA();
+      return TCL_OK;
+    }
+    else if (strcmp(argv[1], "readhandler") == 0) {
+      char* readreturn = 0;
+      simclick_node_t::curtime = GetSimTime();
+      readreturn = simclick_click_read_handler(this,argv[2],argv[3],0,0);
+      //fprintf(stderr, "readhandler: %s\n",clickretc);
+      if (readreturn) {
+	tcl.resultf("%s", readreturn);
+	free(readreturn);
+	readreturn = 0;
+      }
+      else {
+	tcl.resultf("");
+      }
+      return TCL_OK;
+    }
+  } else if (argc == 5) {
+    if (strcmp(argv[1], "writehandler") == 0) {
+      int clickret;
+      simclick_node_t::curtime = GetSimTime();
+      clickret = simclick_click_write_handler(this, argv[2], argv[3], argv[4]);
+      //fprintf(stderr, "writehandler: %i\n",clickret);
+      tcl.resultf("%i", clickret);
+      return TCL_OK;
+    }
+  }
+
+  return ExtClassifier::command(argc, argv);
+}
+
+
+ClickClassifier::~ClickClassifier() {
+}
+
+int
+ClickClassifier::route(Packet* p) {
+  int result = 0;
+  if (click_initialized_) {
+    unsigned char* data = NULL;
+    int len = ((PacketData*)(p->userdata()))->size();
+    simclick_simpacketinfo simpinfo;
+    hdr_cmn* chdr = HDR_CMN(p);
+    int ifid = chdr->iface_;
+    hdr_ip* iphdr = hdr_ip::access(p);
+    simpinfo.id = chdr->uid();
+    simpinfo.fid = iphdr->flowid();
+    hdr_raw* rhdr = hdr_raw::access(p);
+    int nssubtype = rhdr->subtype;
+    int clicktype = GetClickPacketType(nssubtype);
+    simpinfo.simtype = rhdr->ns_type;
+    unsigned char* pdat = p->accessdata();
+    data = new unsigned char[len];
+	memcpy(data,pdat,len);
+	
+    /*
+     * XXX Destroy packet for now. This may change if we wind
+     * up having to track and reuse ns packets after they've gone through
+     * click.
+     */
+    Packet::free(p);
+    p = NULL;
+
+    simclick_node_t::curtime = GetSimTime();
+    //fprintf(stderr,"Sending packet up to click...\n");
+    simclick_click_send(this,ifid,clicktype,data,len,&simpinfo);
+    delete[] data;
+    data = 0;
+  }
+  else {
+    fprintf(stderr,"No click upcall set!\n");
+  }
+  return result;
+}
+
+string
+ClickClassifier::GetIPAddr(int ifid) {
+  return ifipaddrs_[ifid];
+}
+
+string
+ClickClassifier::GetMACAddr(int ifid) {
+  return ifmacaddrs_[ifid];
+}
+
+string
+ClickClassifier::GetNodeName() {
+  return nodename_;
+}
+
+int
+ClickClassifier::GetNodeAddr()
+{
+  return nodeaddr_;
+}
+
+int
+ClickClassifier::GetIFID(const char *ifname) const
+{
+    int r = -1;
+
+    /*
+     * Provide a mapping between a textual interface name
+     * and the id numbers used. This is mostly for the
+     * benefit of click scripts, i.e. you can still refer to
+     * an interface as, say, /dev/eth0.
+     */
+    if (strstr(ifname, "tap") || strstr(ifname, "tun")) {
+	/*
+	 * A tapX or tunX interface goes to and from the kernel -
+	 * always IFID_KERNELTAP
+	 */
+	r = ExtRouter::IFID_KERNELTAP;
+    } else if (const char *devname = strstr(ifname, "eth")) {
+	/*
+	 * Anything with an "eth" followed by a number is
+	 * a regular interface. Add the number to IFID_FIRSTIF
+	 * to get the handle.
+	 */
+	while (*devname && !isdigit((unsigned char) *devname))
+	    devname++;
+	if (*devname)
+	    r = atoi(devname) + ExtRouter::IFID_FIRSTIF;
+    } else if (const char *devname = strstr(ifname, "drop")) {
+	/*
+	 * Anything with an "drop" followed by a number is
+	 * a special interface on which we place packets that
+	 * get dropped due to MAC layer feedback. Add the number to
+	 * IFID_FIRSTIFDROP to get the handle.
+	 */
+	while (*devname && !isdigit((unsigned char) *devname))
+	    devname++;
+	if (*devname)
+	    r = atoi(devname) + ExtRouter::IFID_FIRSTIFDROP;
+    }
+
+    return r;
+}
+
+/*
+ * Click service methods
+ */
+extern "C" {
+
+static int simstrlcpy(char *buf, int len, const string &s) {
+    if (len) {
+	len--;
+	if ((unsigned) len > s.length())
+	    len = s.length();
+	s.copy(buf, len);
+	buf[len] = '\0';
+    }
+    return 0;
+}
+
+int simclick_sim_command(simclick_node_t *simnode, int cmd, ...)
+{
+    ClickClassifier *cc = static_cast<ClickClassifier *>(simnode);
+    Tcl &tcl = Tcl::instance();
+    va_list val;
+    va_start(val, cmd);
+    int r;
+
+    switch (cmd) {
+	
+      case SIMCLICK_VERSION:
+	r = 0;
+	break;
+
+      case SIMCLICK_SUPPORTS: {
+	  int othercmd = va_arg(val, int);
+	  r = othercmd >= 0 && othercmd <= SIMCLICK_CHANGE_CHANNEL;
+	  break;
+      }
+
+      case SIMCLICK_IFID_FROM_NAME: {
+	  const char *ifname = va_arg(val, const char *);
+	  r = cc->GetIFID(ifname);
+	  break;
+      }
+
+      case SIMCLICK_IPADDR_FROM_NAME: {
+	  const char *ifname = va_arg(val, const char *);
+	  char *buf = va_arg(val, char *);
+	  int len = va_arg(val, int);
+	  int ifid = cc->GetIFID(ifname);
+	  r = simstrlcpy(buf, len, cc->GetIPAddr(ifid));
+	  break;
+      }
+
+      case SIMCLICK_MACADDR_FROM_NAME: {
+	  const char *ifname = va_arg(val, const char *);
+	  char *buf = va_arg(val, char *);
+	  int len = va_arg(val, int);
+	  int ifid = cc->GetIFID(ifname);
+	  r = simstrlcpy(buf, len, cc->GetMACAddr(ifid));
+	  break;
+      }
+
+      case SIMCLICK_SCHEDULE: {
+	  const struct timeval *when = va_arg(val, const struct timeval *);
+	  double simtime = when->tv_sec + (when->tv_usec / 1.0e6);
+	  double simdelay = simtime - Scheduler::instance().clock();
+	  ClickEvent *ev = new ClickEvent;
+	  ev->simnode_ = simnode;
+	  ev->when_ = *when;
+	  Scheduler::instance().schedule(&cc->cevhandler_, ev, simdelay);
+	  r = 0;
+	  break;
+      }
+
+      case SIMCLICK_GET_NODE_NAME: {
+	  char *buf = va_arg(val, char *);
+	  int len = va_arg(val, int);
+	  r = simstrlcpy(buf, len, cc->GetNodeName());
+	  break;
+      }
+
+      case SIMCLICK_IF_READY: {
+	  int ifid = va_arg(val, int);
+	  r = cc->IFReady(ifid);
+	  break;
+      }
+
+      case SIMCLICK_TRACE: {
+	  const char *event = va_arg(val, const char *);
+	  cc->trace("%s", event);
+	  r = 1;
+	  break;
+      }
+
+      case SIMCLICK_GET_NODE_ID:
+	r = cc->GetNodeAddr();
+	break;
+
+      case SIMCLICK_GET_NEXT_PKT_ID:
+	r = cc->GetNextPktID();
+	break;
+
+      case SIMCLICK_CHANGE_CHANNEL: {
+	  int ifid = va_arg(val, int);
+	  int channelid = va_arg(val, int);
+	  char work[128];
+	  sprintf(work, "SwitchChannel %i %i %i", cc->GetNodeAddr(), ifid, channelid);
+	  tcl.eval(work);
+	  r = 0;
+	  break;
+      }
+
+      default:
+	r = -1;
+	break;
+	
+    }
+    
+    va_end(val);
+    return r;
+}
+
+int
+simclick_sim_send(simclick_node_t *simnode,
+		  int ifid,int type, const unsigned char* data,int len,
+		  simclick_simpacketinfo* pinfo) {
+
+  if (NULL == simnode) {
+    return -1;
+  }
+
+  /*
+   * Bail out if we get a bad ifid
+   */
+  if (ExtRouter::IFID_LASTIF < ifid) {
+    return -1;
+  }
+  /*
+   * XXX should probably use RTTI typesafe casts if they are now
+   * reliably implemented across the compilers/platforms we want
+   * to run on.
+   */
+  ClickClassifier* theclassifier = static_cast<ClickClassifier*>(simnode);
+
+  return theclassifier->send_to_if(ifid,type,data,len,pinfo);
+}
+
+}
+
+int
+ClickClassifier::send_to_if(int ifid,int type,const unsigned char* data,
+			 int len,simclick_simpacketinfo* pinfo) {
+  int result = 0;
+
+  /*
+   * Package raw data into an ns-2 format raw packet, then send
+   * it on down the line.
+   */
+
+  Packet* pkt = MakeRawPacket(type,ifid,data,len,pinfo);
+  //fprintf(stderr,"simclickid == %d\n",simclickid);
+  recv(pkt,0);
+
+  return result;
+}
+
+int
+ClickClassifier::IFReady(int ifid) {
+  NsObject* target = NULL;
+  int ready = 0;
+
+  // XXX assumes direct ifid->slot mapping
+  if (ExtRouter::IFID_KERNELTAP == ifid) {
+    return 1;
+  }
+
+  target = slot_[ifid];
+  if (target) {
+    LLExt* llext = (LLExt*) target;
+    ready = llext->ready();
+  }
+  else {
+    ready = 0;
+    fprintf(stderr,"ERROR: network interface does not exist\n");
+  }
+
+  return ready;
+}
+
+int
+ClickClassifier::GetNSSubtype(int type) {
+  switch (type) {
+  case SIMCLICK_PTYPE_ETHER:
+    return hdr_raw::ETHERNET;
+
+  case SIMCLICK_PTYPE_IP:
+    return hdr_raw::IP;
+
+  default:
+    return hdr_raw::NONE;
+  }
+
+  return hdr_raw::NONE;
+}
+
+int
+ClickClassifier::GetClickPacketType(int nssubtype) {
+  switch (nssubtype) {
+  case hdr_raw::ETHERNET:
+    return SIMCLICK_PTYPE_ETHER;
+
+  case hdr_raw::IP:
+    return SIMCLICK_PTYPE_IP;
+
+  case hdr_raw::MADWIFI:
+    return SIMCLICK_PTYPE_ETHER;
+  
+  default:
+    return SIMCLICK_PTYPE_UNKNOWN;
+  }
+
+  return SIMCLICK_PTYPE_UNKNOWN;
+}
+
+// XXX 
+// Normally I'd bitterly complain about code like this. However,
+// I don't really want to worry about annoying differences
+// between IP header files across different platforms, and I
+// want to get this code up and running ASAP. So... I'm defining
+// a few things here to handle the minimal packet cracking I
+// need to do to create raw packets. If more complicated
+// packet munging is called for, something better should be created.
+#define NS_ETHER_OFFSET_DADDR 0
+#define NS_ETHER_OFFSET_SADDR 6
+#define NS_ETHER_HEADER_SIZE 14
+#define NS_80211_OFFSET_DADDR 4
+#define NS_80211_OFFSET_SADDR 10
+
+void
+ClickClassifier::LinkLayerFailedCallback(Packet* p, void* arg) {
+  // Hit the callback and then free the packet
+  ((ClickClassifier*)arg)->LinkLayerFailed(p);
+  Packet::free(p);
+}
+
+void
+ClickClassifier::LinkLayerFailed(Packet* p) {
+  //fprintf(stderr,"XXX Lost a packet!!!\n");
+  if (click_initialized_) {
+    unsigned char* data = NULL;
+    int len = ((PacketData*)(p->userdata()))->size();
+    simclick_simpacketinfo simpinfo;
+    hdr_cmn* chdr = HDR_CMN(p);
+    int ifid = chdr->iface_ + IFID_LASTIF;
+    hdr_ip* iphdr = hdr_ip::access(p);
+    simpinfo.id = chdr->uid();
+    simpinfo.fid = iphdr->flowid();
+    hdr_raw* rhdr = hdr_raw::access(p);
+    int nssubtype = rhdr->subtype;
+    int clicktype = GetClickPacketType(nssubtype);
+    unsigned char* pdat = p->accessdata();
+    data = new unsigned char[len];
+    memcpy(data,pdat,len);
+    simclick_node_t::curtime = GetSimTime();
+    //fprintf(stderr,"Sending packet up to click...\n");
+    simclick_click_send(this,ifid,clicktype,data,len,&simpinfo);
+    delete[] data;
+    data = 0;
+  }
+  else {
+    fprintf(stderr,"No click upcall set!\n");
+  }
+}
+
+Packet*
+ClickClassifier::MakeRawPacket(int type,int ifid,const unsigned char* data,
+			       int len,simclick_simpacketinfo* pinfo){
+  Packet* pkt = Packet::alloc(len);
+  /*
+   * Shovel raw data into packet
+   */
+  hdr_raw* rhdr = hdr_raw::access(pkt);
+  // nletor -- check if it is a wireless packet and threat it accordingly
+  click_wifi_extra *ceh = (click_wifi_extra *) data;
+  if (ceh->magic == WIFI_EXTRA_MAGIC) {
+	rhdr->subtype = hdr_raw::MADWIFI;  
+  } else {
+  rhdr->subtype = GetNSSubtype(type);
+  }
+  unsigned char* pdat = pkt->accessdata();
+  memcpy(pdat,data,len);
+
+  /*
+   * Set some of the packet header stuff ns-2 wants
+   */
+  struct hdr_cmn* chdr = HDR_CMN(pkt);
+  chdr->iface() = ifid;
+  chdr->ptype() = PT_RAW;
+  chdr->size() = len;
+  if (pinfo->id >= 0) {
+    chdr->uid() = pinfo->id;
+  }
+  else {
+    chdr->uid() = Agent::getnextuid();
+  }
+  rhdr->ns_type = (-1 == pinfo->simtype) ? PT_RAW : pinfo->simtype;
+  chdr->xmit_failure_ = LinkLayerFailedCallback;
+  chdr->xmit_failure_data_ = (void*)this;
+
+  hdr_ip* iphdr = hdr_ip::access(pkt);
+  iphdr->flowid() = 0;
+  if (pinfo->fid >= 0) {
+    iphdr->flowid() = pinfo->fid;
+  }
+
+  /*
+   * A packet coming in from click on the kernel tap device is
+   * considered to be going up into the node, on any other device
+   * going down out of it.
+   */
+  if (ExtRouter::IFID_KERNELTAP == ifid) {
+    chdr->direction() = hdr_cmn::UP;
+  }
+  else {
+    chdr->direction() = hdr_cmn::DOWN;
+    // Going out to a network adapter, and we're already 
+    // ethernet encapsulated. The ns-2 interface code will
+    // tack on ethernet header overhead as well, so we subtract
+    // it out of our simulated size here to avoid actual packet
+    // size inflation
+    if (hdr_raw::ETHERNET == rhdr->subtype) {
+      chdr->size() -= NS_ETHER_HEADER_SIZE;
+    } else if (hdr_raw::MADWIFI == rhdr->subtype) {	
+	  // nsmadwifi
+		chdr->size() -= sizeof(click_wifi_extra);
+		chdr->size() -= sizeof(click_wifi);
+    }
+  }
+
+  // If we've got ethernet encapsulation, translate mac address
+  // to ns address. Otherwise we're SOL.
+  struct hdr_mac* mhdr = HDR_MAC(pkt);
+  if (hdr_raw::ETHERNET == rhdr->subtype) {
+    MACAddr dmac(data + NS_ETHER_OFFSET_DADDR);
+    MACAddr smac(data + NS_ETHER_OFFSET_SADDR);
+    if (dmac.is_broadcast()) {
+      mhdr->macDA_ = MAC_BROADCAST;
+    }
+    else {
+      mhdr->macDA_ = global_mactonsmacmap_[dmac];
+      //fprintf(stderr,"XXX using real MAC: %s -> %d\n",dmac.to_string().c_str(),mhdr->macDA_);
+    }
+    mhdr->macSA_ = global_mactonsmacmap_[smac];
+    chdr->next_hop_ = global_mactonodemap_[dmac];
+    chdr->prev_hop_ = global_mactonodemap_[smac];
+  } else if (hdr_raw::MADWIFI == rhdr->subtype) {
+  	//TODO
+	MACAddr dmac(data + NS_ETHER_OFFSET_DADDR + sizeof(click_wifi_extra) + 4); // destination address (STA,AP whatever)
+    MACAddr smac(data + NS_ETHER_OFFSET_SADDR + sizeof(click_wifi_extra) + 4); // source address (STA,AP whatever)
+	if (dmac.is_broadcast()) {
+      mhdr->macDA_ = MAC_BROADCAST;
+    } else {
+      mhdr->macDA_ = global_mactonsmacmap_[dmac];
+    }
+    mhdr->macSA_ = global_mactonsmacmap_[smac];
+    chdr->next_hop_ = global_mactonodemap_[dmac];
+    chdr->prev_hop_ = global_mactonodemap_[smac];
+	  
+  } else {
+    //fprintf(stderr,"XXX using broadcast mac XXX\n");
+    mhdr->macDA_ = MAC_BROADCAST;
+  }
+
+  // Got an IP packet? Must have come from click, and therefore
+  // the next hop is us.
+  if ((ExtRouter::IFID_KERNELTAP == ifid) && (hdr_raw::IP == rhdr->subtype)) {
+    chdr->next_hop() = nodeaddr_;
+  }
+
+  return pkt;
+}
+
+struct timeval
+ClickClassifier::GetSimTime() {
+  struct timeval curtime;
+  double ns2time = Scheduler::instance().clock();
+  double fracp,intp;
+  fracp = modf(ns2time,&intp);
+  curtime.tv_sec = (long) intp;
+  curtime.tv_usec = (long) (fracp * 1.0e6 + 0.5); 
+  return curtime;
+}
+
+void
+ClickClassifier::trace(char* fmt, ...)
+{
+	va_list ap;
+
+	if ( !logtarget_ ) {
+		printf( "ClickClassifier: need to configure tracetarget\n" );
+		return ;
+	}
+	va_start( ap, fmt );
+	vsprintf( logtarget_->pt_->buffer(), fmt, ap );
+	logtarget_->pt_->dump();
+	va_end( ap );
+}
+
+int
+ClickClassifier::GetNextPktID()
+{
+	return Agent::getnextuid();
+}
diff -ruN --exclude='*.o' --exclude='autom4*' ns-2.34-pure/classifier/classifier-click.h ns-2.34/classifier/classifier-click.h
--- ns-2.34-pure/classifier/classifier-click.h	1969-12-31 16:00:00.000000000 -0800
+++ ns-2.34/classifier/classifier-click.h	2010-02-28 09:31:39.000000000 -0800
@@ -0,0 +1,169 @@
+/*
+ *
+ * This might not seem like a regular classifier, and it isn't.
+ * It essentially has a fixed interface ID which it sends along
+ * with its packet to the ClickNode it lives on, the idea being
+ * that the Click subsystem will be the thing which actually
+ * does the classifying, not the classifier.
+ */
+
+/*****************************************************************************
+ *  Copyright 2002, Univerity of Colorado at Boulder.                        *
+ *                                                                           *
+ *                        All Rights Reserved                                *
+ *                                                                           *
+ *  Permission to use, copy, modify, and distribute this software and its    *
+ *  documentation for any purpose other than its incorporation into a        *
+ *  commercial product is hereby granted without fee, provided that the      *
+ *  above copyright notice appear in all copies and that both that           *
+ *  copyright notice and this permission notice appear in supporting         *
+ *  documentation, and that the name of the University not be used in        *
+ *  advertising or publicity pertaining to distribution of the software      *
+ *  without specific, written prior permission.                              *
+ *                                                                           *
+ *  UNIVERSITY OF COLORADO DISCLAIMS ALL WARRANTIES WITH REGARD TO THIS      *
+ *  SOFTWARE, INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY AND        *
+ *  FITNESS FOR ANY PARTICULAR PURPOSE.  IN NO EVENT SHALL THE UNIVERSITY    *
+ *  OF COLORADO BE LIABLE FOR ANY SPECIAL, INDIRECT OR CONSEQUENTIAL         *
+ *  DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM LOSS OF USE, DATA       *
+ *  OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR OTHER        *
+ *  TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR         *
+ *  PERFORMANCE OF THIS SOFTWARE.                                            *
+ *                                                                           *
+ ****************************************************************************/
+
+#ifndef ns_classifier_click_h
+#define ns_classifier_click_h
+
+#include "object.h"
+#include "cmu-trace.h"
+
+class Packet;
+
+
+class ClickEvent : public Event {
+ public:
+  simclick_node_t *simnode_;
+  // Store an extra copy of the call time in sec/usec format.
+  // This is to sidestep some roundoff errors which occured
+  // when going back and forth between sec/usec and doubles.
+  struct timeval when_;
+};
+
+class ClickEventHandler : public Handler {
+ public:
+  virtual void handle(Event* event);
+};
+
+class MACAddr {
+ public:
+  MACAddr() {
+    memset(macaddr_,0,6);
+  }
+  explicit MACAddr(const string straddr) {
+      unsigned crap[6];
+      sscanf(straddr.c_str(), "%02X:%02X:%02X:%02X:%02X:%02X", &crap[0],
+	     &crap[1], &crap[2], &crap[3], &crap[4], &crap[5]);
+      for (int i = 0; i < 6; i++)
+	  macaddr_[i] = crap[i];
+  }  
+  explicit MACAddr(const unsigned char* rawaddr) {
+    memcpy(macaddr_,rawaddr,6);
+  }
+  bool operator==(const MACAddr& rhs) const {
+    return(0 == memcmp(macaddr_,rhs.macaddr_,6));
+  }
+
+  bool is_broadcast() {
+    for (int i=0;i<6;i++) {
+      if (macaddr_[i] != 0xff) {
+	return false;
+      }
+    }
+    return true;
+  }
+
+  string to_string() {
+    char tmp[64];
+    sprintf(tmp, "%02X:%02X:%02X:%02X:%02X:%02X", macaddr_[0],
+	   macaddr_[1], macaddr_[2], macaddr_[3], macaddr_[4],
+	   macaddr_[5]);
+
+    return string(tmp);
+  }
+  unsigned char macaddr_[6];
+};
+
+namespace std {
+template<>
+struct less<MACAddr> {
+  bool operator()(const MACAddr& l, const MACAddr& r) const {
+    // Treat MAC as a big old integer...
+    uint32_t leftu = *((uint32_t*)(l.macaddr_));
+    uint32_t rightu = *((uint32_t*)(r.macaddr_));
+    uint16_t leftl = *((uint16_t*)(l.macaddr_+4));
+    uint16_t rightl = *((uint16_t*)(r.macaddr_+4));
+    
+    // Check the upper bytes first, if those are equal check lower
+    if (leftu < rightu) {
+      return true;
+    }
+    else if (leftu == rightu) {
+      return (leftl < rightl);
+    }
+    return false;
+  }
+};
+}
+
+class ClickClassifier : public ExtClassifier, public ExtRouter,
+    public simclick_node_t {
+ public:
+  ClickClassifier();
+  virtual ~ClickClassifier();
+  virtual int command(int argc, const char*const* argv);
+  
+  /*
+   * Stuff to handle click requests
+   */
+ public:
+  virtual int send_to_if(int ifid,int type,const unsigned char* data,
+			 int len,simclick_simpacketinfo* pinfo);
+  ClickEventHandler cevhandler_;
+
+  // ExtRouter method
+  virtual int route(Packet* p);
+
+  string GetIPAddr(int ifid);
+  string GetMACAddr(int ifid);
+  string GetNodeName();
+  int GetNodeAddr(); /// ToNSTrace
+  int IFReady(int ifid);
+  static void LinkLayerFailedCallback(Packet* p, void* arg);
+  void LinkLayerFailed(Packet* p);
+  void trace(char* fmt, ...); /// ToNSTrace
+  int GetNextPktID(); /// ToNSTrace
+  int GetIFID(const char *) const;
+ protected:
+  int GetNSSubtype(int clicktype);
+  int GetClickPacketType(int nssubtype);
+  struct timeval GetSimTime();
+  Packet* MakeRawPacket(int type,int ifid,const unsigned char* data,int len,
+			simclick_simpacketinfo* pinfo);
+  typedef map<int,string> STRmap;
+  map<int,string> ifipaddrs_;
+  map<int,string> ifmacaddrs_;
+  static map<MACAddr,int> global_mactonodemap_;
+  static map<MACAddr,int> global_mactonsmacmap_;
+  static map<u_int32_t,int> global_ipmap_;
+  string nodename_;
+  int nodeaddr_;
+  bool click_initialized_;
+
+
+
+  //mvhaen -- meant to allow a click router to add to an ns2 trace file.
+  Trace *logtarget_;
+};
+
+#endif
diff -ruN --exclude='*.o' --exclude='autom4*' ns-2.34-pure/classifier/classifier-ext.cc ns-2.34/classifier/classifier-ext.cc
--- ns-2.34-pure/classifier/classifier-ext.cc	1969-12-31 16:00:00.000000000 -0800
+++ ns-2.34/classifier/classifier-ext.cc	2010-02-28 09:31:39.000000000 -0800
@@ -0,0 +1,160 @@
+/*
+ * classifier-ext.cc
+ * Base external router classifier
+ */
+
+/*****************************************************************************
+ *  Copyright 2002, Univerity of Colorado at Boulder.                        *
+ *                                                                           *
+ *                        All Rights Reserved                                *
+ *                                                                           *
+ *  Permission to use, copy, modify, and distribute this software and its    *
+ *  documentation for any purpose other than its incorporation into a        *
+ *  commercial product is hereby granted without fee, provided that the      *
+ *  above copyright notice appear in all copies and that both that           *
+ *  copyright notice and this permission notice appear in supporting         *
+ *  documentation, and that the name of the University not be used in        *
+ *  advertising or publicity pertaining to distribution of the software      *
+ *  without specific, written prior permission.                              *
+ *                                                                           *
+ *  UNIVERSITY OF COLORADO DISCLAIMS ALL WARRANTIES WITH REGARD TO THIS      *
+ *  SOFTWARE, INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY AND        *
+ *  FITNESS FOR ANY PARTICULAR PURPOSE.  IN NO EVENT SHALL THE UNIVERSITY    *
+ *  OF COLORADO BE LIABLE FOR ANY SPECIAL, INDIRECT OR CONSEQUENTIAL         *
+ *  DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM LOSS OF USE, DATA       *
+ *  OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR OTHER        *
+ *  TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR         *
+ *  PERFORMANCE OF THIS SOFTWARE.                                            *
+ *                                                                           *
+ ****************************************************************************/
+
+#include <stdlib.h>
+#include "config.h"
+#include "packet.h"
+#include "ip.h"
+#include "extrouter.h"
+#include "classifier.h"
+#include "classifier-hash.h"
+#include "classifier-ext.h"
+
+
+static class ExtClassifierClass : public TclClass {
+public:
+  ExtClassifierClass() : TclClass("Classifier/Ext") {}
+  TclObject* create(int, const char*const*) {
+    return (new ExtClassifier());
+  }
+} class_ext_classifier;
+
+
+ExtClassifier::ExtClassifier() {
+  extrouter_ = NULL;
+}
+
+ExtClassifier::~ExtClassifier() {
+}
+
+int ExtClassifier::command(int argc, const char*const* argv) {
+  int result = TCL_OK;
+  //Tcl& tcl = Tcl::instance();
+
+  result = Classifier::command(argc,argv);
+  return result;
+}
+
+void ExtClassifier::recv(Packet* p, Handler* h) {
+  /*
+   * Use the interface and direction to decide what to do. If the
+   * packet is going down and came from an agent, it needs to
+   * go to the external router for processing. If coming up
+   * from the external router it needs to be sent to the appropriate
+   * local agent for processing. Otherwise, it just goes either down
+   * to the ns network interface or up to the external router.
+   */
+  struct hdr_cmn* hdr = HDR_CMN(p);
+  int extid = hdr->iface();
+  if (hdr_cmn::DOWN == hdr->direction()) {
+    if (ExtRouter::IFID_KERNELTAP == extid) {
+      /*
+       * Packet came from an agent - needs to go to the external router
+       */
+      //fprintf(stderr,"To external router\n");
+      if (NULL != extrouter_) {
+	extrouter_->route(p);
+      }
+      else {
+	fprintf(stderr,"No external router set!\n");
+      }
+    }
+    else {
+      /*
+       * Packet came from the external router - needs to go to the net
+       */
+      int cl = classify(p);
+      if ((cl >= 0) && (cl <= maxslot_)) {
+	NsObject* target = NULL;
+	target = slot_[cl];
+	if (NULL == target) {
+	  /*
+	   * "Drop" the packet
+	   */
+	  //puts("Dropping the packet");
+	  Packet::free(p);
+	}
+	else {
+	  //puts("Sending packet out!!!");
+	  target->recv(p,h);
+	}
+      }
+      else {
+	fprintf(stderr,"Invalid slot: %d maxslot is %d\n",cl,maxslot_);
+      }
+    }
+  }
+  else if (hdr_cmn::UP == hdr->direction()) {
+    if (ExtRouter::IFID_KERNELTAP == extid) {
+      /*
+       * Packet came from the external router - needs to go to an agent.
+       */
+      NsObject* target = NULL;
+      target = slot_[0];
+      if (NULL == target) {
+	/*
+	 * "Drop" the packet
+	 */
+	//fprintf(stderr,"Dropping the packet\n");
+	Packet::free(p);
+      }
+      else {
+	//fprintf(stderr,"Packet going to agent\n");
+	target->recv(p,h);
+      }
+
+      //fprintf(stderr,"Hey! Send packets to agents!\n");
+    }
+    else {
+      /*
+       * Packet came from the net - needs to go to the external router
+       */
+      if (NULL != extrouter_) {
+	extrouter_->route(p);
+      }
+    }
+  }
+  else {
+    fprintf(stderr,"No packet direction set...");
+  }
+}
+
+int
+ExtClassifier::classify(Packet* p) {
+  struct hdr_cmn* hdr = HDR_CMN(p);
+  int extid = hdr->iface();
+
+  /*
+   * Simple  mapping between extid and slot number.
+   * No real reason to make things more complicated right now.
+   */
+  int slot = extid;
+  return slot;
+}
diff -ruN --exclude='*.o' --exclude='autom4*' ns-2.34-pure/classifier/classifier-ext.h ns-2.34/classifier/classifier-ext.h
--- ns-2.34-pure/classifier/classifier-ext.h	1969-12-31 16:00:00.000000000 -0800
+++ ns-2.34/classifier/classifier-ext.h	2010-02-28 09:31:39.000000000 -0800
@@ -0,0 +1,57 @@
+/*
+ *
+ * This classifier is intended for use with external routers bolted
+ * on to ns-2, e.g. Click. It uses a combination of the packet direction
+ * and interface ID to decide where to send stuff.
+ */
+
+/*****************************************************************************
+ *  Copyright 2002, Univerity of Colorado at Boulder.                        *
+ *                                                                           *
+ *                        All Rights Reserved                                *
+ *                                                                           *
+ *  Permission to use, copy, modify, and distribute this software and its    *
+ *  documentation for any purpose other than its incorporation into a        *
+ *  commercial product is hereby granted without fee, provided that the      *
+ *  above copyright notice appear in all copies and that both that           *
+ *  copyright notice and this permission notice appear in supporting         *
+ *  documentation, and that the name of the University not be used in        *
+ *  advertising or publicity pertaining to distribution of the software      *
+ *  without specific, written prior permission.                              *
+ *                                                                           *
+ *  UNIVERSITY OF COLORADO DISCLAIMS ALL WARRANTIES WITH REGARD TO THIS      *
+ *  SOFTWARE, INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY AND        *
+ *  FITNESS FOR ANY PARTICULAR PURPOSE.  IN NO EVENT SHALL THE UNIVERSITY    *
+ *  OF COLORADO BE LIABLE FOR ANY SPECIAL, INDIRECT OR CONSEQUENTIAL         *
+ *  DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM LOSS OF USE, DATA       *
+ *  OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR OTHER        *
+ *  TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR         *
+ *  PERFORMANCE OF THIS SOFTWARE.                                            *
+ *                                                                           *
+ ****************************************************************************/
+
+#ifndef ns_classifier_ext_h
+#define ns_classifier_ext_h
+
+#include "object.h"
+
+class Packet;
+
+class ExtClassifier : public Classifier {
+ public:
+	ExtClassifier();
+	virtual ~ExtClassifier();
+	
+	virtual void recv(Packet* p, Handler* h);
+
+	void setExtRouter(ExtRouter* ext) {extrouter_ = ext;}
+	ExtRouter* getExtRouter() {return extrouter_;}
+
+	virtual int classify(Packet*);
+
+ protected:
+	virtual int command(int argc, const char*const* argv);
+	ExtRouter* extrouter_;
+};
+
+#endif
diff -ruN --exclude='*.o' --exclude='autom4*' ns-2.34-pure/classifier/packet_anno.h ns-2.34/classifier/packet_anno.h
--- ns-2.34-pure/classifier/packet_anno.h	1969-12-31 16:00:00.000000000 -0800
+++ ns-2.34/classifier/packet_anno.h	2010-02-28 09:31:39.000000000 -0800
@@ -0,0 +1,17 @@
+#ifndef PACKET_ANNO_H
+#define PACKET_ANNO_H
+
+/* Define macros for declaring packed structures. */
+#ifdef __GNUC__
+#define CLICK_PACKED_STRUCTURE(open, close) open close __attribute__((packed))
+#define CLICK_SIZE_PACKED_STRUCTURE(open, close) open close __attribute__((packed))
+#define CLICK_SIZE_PACKED_ATTRIBUTE __attribute__((packed))
+#else
+#define CLICK_PACKED_STRUCTURE(open, close) _Cannot_pack_structure__Use_GCC
+#define CLICK_SIZE_PACKED_STRUCTURE(open, close) open close
+#define CLICK_SIZE_PACKED_ATTRIBUTE
+#endif
+
+#include <clicknet/wifi.h>
+
+#endif /* PACKET_ANNO_H */
diff -ruN --exclude='*.o' --exclude='autom4*' ns-2.34-pure/common/agent.cc ns-2.34/common/agent.cc
--- ns-2.34-pure/common/agent.cc	2009-06-14 10:35:45.000000000 -0700
+++ ns-2.34/common/agent.cc	2010-02-28 09:31:39.000000000 -0800
@@ -43,6 +43,7 @@
 #include "config.h"
 #include "agent.h"
 #include "ip.h"
+#include "tcp.h"
 #include "flags.h"
 #include "address.h"
 #include "app.h"
@@ -51,7 +52,14 @@
 #include "nix/nixnode.h"
 #endif //HAVE_STL
 
+#include "rawpacket.h"
+#include "extrouter.h"
 
+#include <click/config.h>
+#include <click/confparse.hh>
+#include <clicknet/ip.h>
+#include <clicknet/tcp.h>
+#include <clicknet/udp.h>
 
 #ifndef min
 #define min(a, b) (((a) < (b)) ? (a) : (b))
@@ -70,7 +78,7 @@
 Agent::Agent(packet_t pkttype) : 
 	size_(0), type_(pkttype), 
 	channel_(0), traceName_(NULL),
-	oldValueList_(NULL), app_(0), et_(0)
+	oldValueList_(NULL), app_(0), rawcvt_(false), et_(0)
 {
 }
 
@@ -170,6 +178,24 @@
 		} else if (strcmp(argv[1], "set_pkttype") == 0) {
 			set_pkttype(packet_t(atoi(argv[2])));
 			return (TCL_OK);
+		} else if (strcmp(argv[1], "set-srcip") == 0) {
+			if (!Click::cp_ip_address(Click::String(argv[2]), (unsigned char *) &srcip_))
+				return TCL_ERROR;
+			return (TCL_OK);
+		} else if (strcmp(argv[1], "set-srcport") == 0) {
+			srcport_ = atoi(argv[2]);
+			return (TCL_OK);
+		}
+		else if (strcmp(argv[1], "set-destip") == 0) {
+			if (!Click::cp_ip_address(Click::String(argv[2]), (unsigned char *) &destip_))
+				return TCL_ERROR;
+			return (TCL_OK);
+		} else if (strcmp(argv[1], "set-destport") == 0) {
+			destport_ = atoi(argv[2]);
+			return (TCL_OK);
+		} else if (strcmp(argv[1],"rawconvert") == 0) {
+			rawcvt_ = atoi(argv[2]);
+			return(TCL_OK);
 		}
 	}
 	else if (argc == 4) {	
@@ -438,10 +464,140 @@
 {
 }
 
+bool
+Agent::toraw(Packet* p) {
+	// XXX What about AppData and other such junk? Need to
+	// figure out if anyone actually sends payloads.
+	// XXX What about TCP option headers? Won't work with SACK right now
+	bool result = false;
+	struct hdr_tcp* htcp = HDR_TCP(p);
+	struct hdr_ip* hip = HDR_IP(p);
+	struct hdr_cmn* hcmn = HDR_CMN(p);
+	struct hdr_raw* hraw = hdr_raw::access(p);
+	int packetlen = sizeof(click_ip) + hcmn->size_;
+	int paylen = hcmn->size_;
+	unsigned char* pdat = 0;
+
+	// build packet length
+	if (hcmn->ptype_ == PT_ACK || hcmn->ptype_ == PT_TCP)
+		packetlen += sizeof(click_tcp);
+	else if (hcmn->ptype_ == PT_CBR)
+		packetlen += sizeof(click_udp);
+	else
+		return false;
+
+	// build packet
+	p->allocdata(packetlen);
+	pdat = p->accessdata();
+	memset(pdat, 0, packetlen);
+
+	// build IP header
+	click_ip *ip = (click_ip *) pdat;
+	ip->ip_v = 4;
+	ip->ip_hl = sizeof(click_ip) >> 2;
+	ip->ip_len = htons(packetlen);
+	ip->ip_id = htons(ipseq_);
+	ip->ip_p = (hcmn->ptype_ == PT_CBR ? IP_PROTO_UDP : IP_PROTO_TCP);
+	ip->ip_src.s_addr = srcip_;
+	ip->ip_dst.s_addr = destip_;
+	ip->ip_tos = 0;
+	ip->ip_off = 0;
+	ip->ip_ttl = hip->ttl_;
+	ip->ip_sum = 0;
+#if HAVE_FAST_CHECKSUM
+	ip->ip_sum = ip_fast_csum((unsigned char *)ip, sizeof(click_ip) >> 2);
+#else
+	ip->ip_sum = click_in_cksum((unsigned char *)ip, sizeof(click_ip));
+#endif
+
+	// build TCP/UDP header and payload
+	if (paylen > 0)
+		memset(pdat + (packetlen - paylen), 'A', paylen);
+	
+	if (hcmn->ptype_ == PT_CBR) {
+		click_udp *udp = (click_udp *) (ip + 1);
+		udp->uh_sport = htons(srcport_);
+		udp->uh_dport = htons(destport_);
+		uint16_t len = packetlen - sizeof(click_ip);
+		udp->uh_ulen = htons(len); 
+		udp->uh_sum = 0;
+		unsigned csum = click_in_cksum((unsigned char *)udp, len);
+		udp->uh_sum = click_in_cksum_pseudohdr(csum, ip, len);
+	} else {
+		click_tcp *tcp = (click_tcp *) (ip + 1);
+		tcp->th_sport = htons(srcport_);
+		tcp->th_dport = htons(destport_);
+		tcp->th_seq = htonl(htcp->seqno_);
+		tcp->th_ack = htonl(htcp->ackno_);
+		tcp->th_flags2 = 0;
+		tcp->th_off = sizeof(click_tcp) >> 2;
+		tcp->th_flags = htcp->tcp_flags_;
+		if (hcmn->ptype_ == PT_ACK)
+			tcp->th_flags |= TH_ACK;
+		tcp->th_win = 0; /* XXX */
+		tcp->th_urp = 0;
+		tcp->th_sum = 0;
+		uint16_t len = packetlen - sizeof(click_ip);
+		unsigned csum = click_in_cksum((unsigned char *)tcp, len);
+		tcp->th_sum = click_in_cksum_pseudohdr(csum, ip, len);
+	}
+
+	hcmn->direction() = hdr_cmn::DOWN;
+	hcmn->iface() = ExtRouter::IFID_KERNELTAP;
+	hraw->subtype = hdr_raw::IP;
+	hraw->ns_type = hcmn->ptype();
+	hcmn->ptype() = PT_RAW;
+	hcmn->size() = packetlen;
+	ipseq_++;
+
+	return result;
+}
+
+bool
+Agent::fromraw(Packet* p) {
+	struct hdr_tcp* htcp = HDR_TCP(p);
+	//struct hdr_ip* hip = HDR_IP(p);
+	struct hdr_cmn* hcmn = HDR_CMN(p);
+	//struct hdr_flags* hflg = hdr_flags::access(p);
+	struct click_ip* ip = 0;
+	struct click_tcp* tcp = 0;
+	//struct click_udp* udp = 0;
+	unsigned char* pdat = 0;
+	bool result = false;
+
+	if (PT_RAW != hcmn->ptype()) return false;
+
+	pdat = p->accessdata();
+	ip = (click_ip*)pdat;
+
+	switch (ip->ip_p) {
+	case IPPROTO_TCP:
+		tcp = (click_tcp*)(pdat + (ip->ip_hl << 2));
+		htcp->seqno_ = ntohl(tcp->th_seq);
+		htcp->ackno_ = ntohl(tcp->th_ack);
+		htcp->tcp_flags_ = tcp->th_flags;
+		htcp->hlen_ = (ip->ip_hl << 2) + (tcp->th_off << 2);
+		hcmn->ptype_ = (tcp->th_flags & TH_ACK) ? PT_ACK : PT_TCP;
+		result = true;
+		break;
+	case IPPROTO_UDP:
+		hcmn->ptype_ = PT_CBR;
+		result = true;
+		break;
+	default:
+		result = false;
+		break;
+	}
+
+	return result;
+}
+
 void Agent::recv(Packet* p, Handler*)
 {
-	if (app_)
+	if (app_) {
+		if (rawcvt_) fromraw(p);
 		app_->recv(hdr_cmn::access(p)->size());
+	}
 	/*
 	 * didn't expect packet (or we're a null agent?)
 	 */
diff -ruN --exclude='*.o' --exclude='autom4*' ns-2.34-pure/common/agent.h ns-2.34/common/agent.h
--- ns-2.34-pure/common/agent.h	2009-06-14 10:35:45.000000000 -0700
+++ ns-2.34/common/agent.h	2010-02-28 09:31:39.000000000 -0800
@@ -43,6 +43,7 @@
 #include "ns-process.h"
 #include "app.h"
 //#include "basetrace.h"
+
 #define TIME_FORMAT "%.15g"
 // TIME_FORMAT is in basetrace.h, but including that header leads to problems
 
@@ -77,7 +78,14 @@
 	//added for edrop tracing - ratul
 	void recvOnly(Packet *) {};
 
-	void send(Packet* p, Handler* h) { target_->recv(p, h); }
+	void send(Packet* p, Handler* h) { 
+	  if (rawcvt_) toraw(p);
+	  target_->recv(p, h);
+	}
+
+        bool toraw(Packet* p);
+	bool fromraw(Packet* p);
+
 	virtual void timeout(int tno);
 
 	virtual void sendmsg(int sz, AppData*, const char* flags = 0);
@@ -102,6 +110,7 @@
 	inline nsaddr_t& dport() { return dst_.port_; }
 	void set_pkttype(packet_t pkttype) { type_ = pkttype; }
 	inline packet_t get_pkttype() { return type_; }
+	static int getnextuid() { return uidcnt_++; }
 
  protected:
 	int command(int argc, const char*const* argv);
@@ -135,6 +144,18 @@
 	OldValue *oldValueList_; 
 
 	Application *app_;		// ptr to application for callback
+	
+	// If this is set to "true" convert packets to and from
+	// raw format as they go to and from attached applications.
+	bool rawcvt_;
+	
+	// We also need to keep src and dest ip and port addresses
+	// around if we're going to use raw packets.
+	u_int16_t ipseq_;
+	u_long srcip_;
+	u_short srcport_;
+	u_long destip_;
+	u_short destport_;
 
 	virtual void trace(TracedVar *v);
 	void deleteAgentTrace();
diff -ruN --exclude='*.o' --exclude='autom4*' ns-2.34-pure/common/clicknode.cc ns-2.34/common/clicknode.cc
--- ns-2.34-pure/common/clicknode.cc	1969-12-31 16:00:00.000000000 -0800
+++ ns-2.34/common/clicknode.cc	2010-02-28 09:31:39.000000000 -0800
@@ -0,0 +1,132 @@
+/*
+ * clicknode.cc 
+ * Base class for nsclick nodes.
+ *
+ * XXX Should probably move a bunch of the functionality in this
+ * class to a superclass, i.e. something called ExtNode, since a lot
+ * of this should work with most Ext routing stuff, not just click.
+ *
+ */
+
+/*****************************************************************************
+ *  Copyright 2002, Univerity of Colorado at Boulder.                        *
+ *                                                                           *
+ *                        All Rights Reserved                                *
+ *                                                                           *
+ *  Permission to use, copy, modify, and distribute this software and its    *
+ *  documentation for any purpose other than its incorporation into a        *
+ *  commercial product is hereby granted without fee, provided that the      *
+ *  above copyright notice appear in all copies and that both that           *
+ *  copyright notice and this permission notice appear in supporting         *
+ *  documentation, and that the name of the University not be used in        *
+ *  advertising or publicity pertaining to distribution of the software      *
+ *  without specific, written prior permission.                              *
+ *                                                                           *
+ *  UNIVERSITY OF COLORADO DISCLAIMS ALL WARRANTIES WITH REGARD TO THIS      *
+ *  SOFTWARE, INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY AND        *
+ *  FITNESS FOR ANY PARTICULAR PURPOSE.  IN NO EVENT SHALL THE UNIVERSITY    *
+ *  OF COLORADO BE LIABLE FOR ANY SPECIAL, INDIRECT OR CONSEQUENTIAL         *
+ *  DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM LOSS OF USE, DATA       *
+ *  OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR OTHER        *
+ *  TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR         *
+ *  PERFORMANCE OF THIS SOFTWARE.                                            *
+ *                                                                           *
+ ****************************************************************************/
+
+#include <math.h>
+#include <stdlib.h>
+#include <string.h>
+#include <ctype.h>
+
+#include "connector.h"
+#include "delay.h"
+#include "packet.h"
+#include "agent.h"
+#include "rawpacket.h"
+#include "random.h"
+#include "trace.h"
+#include "address.h"
+
+#include "arp.h"
+#include "topography.h"
+#include "ll.h"
+#include "mac.h"
+#include "propagation.h"
+#include "mobilenode.h"
+#include "phy.h"
+#include "wired-phy.h"
+#include "god.h"
+#include "extrouter.h"
+#include "extclickrouter.h"
+#include <sys/time.h>
+#include <click/simclick.h>
+#include "clicknode.h"
+
+
+static class ClickNodeClass : public TclClass {
+public:
+  ClickNodeClass() : TclClass("Node/MobileNode/ClickNode") {}
+  TclObject* create(int, const char*const*) {
+    ClickNode* thenode = new ClickNode;
+    if (!thenode) {
+      return NULL;
+    }
+
+    /*
+     * Do post-constructor initialization.
+     */
+    int result = thenode->cinit();
+    if (0 > result) {
+      delete thenode;
+      thenode = NULL;
+    }
+
+    return thenode;
+  }
+} class_clicknode;
+
+
+ClickNode::ClickNode(void) {
+}
+
+int
+ClickNode::cinit() {
+  int result = 0;
+  return result;
+}
+
+int
+ClickNode::command(int argc, const char*const* argv)
+{
+  //Tcl& tcl = Tcl::instance();
+  if (2 == argc) {
+  }
+  else if (3 == argc) {
+    if(strcmp(argv[1], "addif") == 0) {
+      Phy* phyp = (Phy*)TclObject::lookup(argv[2]);
+      if(phyp == 0) {
+	return TCL_ERROR;
+      }
+      phyp->insertnode(&ifhead_);
+      phyp->setnode(this);
+      return TCL_OK;
+    }
+  }
+  else if (4 == argc) {
+  }
+  else if (5 == argc) {
+  }
+
+  return MobileNode::command(argc, argv);
+}
+
+
+/* ======================================================================
+   Other class functions
+   ====================================================================== */
+void
+ClickNode::dump(void) {
+  printf("Dumping a clicknode...\n");
+}
+
+
diff -ruN --exclude='*.o' --exclude='autom4*' ns-2.34-pure/common/clicknode.h ns-2.34/common/clicknode.h
--- ns-2.34-pure/common/clicknode.h	1969-12-31 16:00:00.000000000 -0800
+++ ns-2.34/common/clicknode.h	2010-02-28 09:31:39.000000000 -0800
@@ -0,0 +1,64 @@
+/*
+ * clicknode.h
+ *
+ */
+
+/*****************************************************************************
+ *  Copyright 2002, Univerity of Colorado at Boulder.                        *
+ *                                                                           *
+ *                        All Rights Reserved                                *
+ *                                                                           *
+ *  Permission to use, copy, modify, and distribute this software and its    *
+ *  documentation for any purpose other than its incorporation into a        *
+ *  commercial product is hereby granted without fee, provided that the      *
+ *  above copyright notice appear in all copies and that both that           *
+ *  copyright notice and this permission notice appear in supporting         *
+ *  documentation, and that the name of the University not be used in        *
+ *  advertising or publicity pertaining to distribution of the software      *
+ *  without specific, written prior permission.                              *
+ *                                                                           *
+ *  UNIVERSITY OF COLORADO DISCLAIMS ALL WARRANTIES WITH REGARD TO THIS      *
+ *  SOFTWARE, INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY AND        *
+ *  FITNESS FOR ANY PARTICULAR PURPOSE.  IN NO EVENT SHALL THE UNIVERSITY    *
+ *  OF COLORADO BE LIABLE FOR ANY SPECIAL, INDIRECT OR CONSEQUENTIAL         *
+ *  DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM LOSS OF USE, DATA       *
+ *  OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR OTHER        *
+ *  TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR         *
+ *  PERFORMANCE OF THIS SOFTWARE.                                            *
+ *                                                                           *
+ ****************************************************************************/
+
+#ifndef __ns_clicknode_h__
+#define __ns_clicknode_h__
+
+#include "object.h"
+#include "trace.h"
+#include "lib/bsd-list.h"
+#include "node.h"
+
+class ClickNode : public MobileNode
+{
+
+public:
+  ClickNode();
+  virtual int cinit();
+  virtual int command(int argc, const char*const* argv);
+  inline ClickNode* nextnode() { return link_.le_next; }
+  
+  void dump(void);
+  
+private:
+
+  /*
+   * A global list of click nodes
+   */
+  LIST_ENTRY(ClickNode) link_;
+  
+  /*
+   * Trace Target
+   */
+  Trace* log_target_;
+
+};
+
+#endif
diff -ruN --exclude='*.o' --exclude='autom4*' ns-2.34-pure/common/packet-stamp.h ns-2.34/common/packet-stamp.h
--- ns-2.34-pure/common/packet-stamp.h	2009-06-14 10:35:44.000000000 -0700
+++ ns-2.34/common/packet-stamp.h	2010-02-28 09:31:39.000000000 -0800
@@ -22,7 +22,8 @@
 class PacketStamp {
 public:
 
-  PacketStamp() : ant(0), node(0), Pr(-1), lambda(-1) { }
+  PacketStamp() : ant(0), node(0), Pr(-1), lambda(-1),PrLevel(-1),rate(0) { }
+  void clear() { ant = 0; node = 0; Pr = -1; lambda = -1; PrLevel = -1; rate = 0;}
 
   void init(const PacketStamp *s) {
 	  Antenna* ant;
@@ -33,6 +34,8 @@
 	  
 	  //Antenna *ant = (s->ant) ? s->ant->copy(): 0;
 	  stamp(s->node, ant, s->Pr, s->lambda);
+	  PrLevel = s->PrLevel;
+	  rate = s->rate;
   }
 
   void stamp(MobileNode *n, Antenna *a, double xmitPr, double lam) {
@@ -45,7 +48,11 @@
   inline Antenna * getAntenna() {return ant;}
   inline MobileNode * getNode() {return node;}
   inline double getTxPr() {return Pr;}
+  inline void setPrLevel(int p){PrLevel = p;}
+  inline int getPrLevel(){return PrLevel;}
   inline double getLambda() {return lambda;}
+  inline void setRate(double r){rate =r;}
+  inline double getRate(){return rate;}
 
   /* WILD HACK: The following two variables are a wild hack.
      They will go away in the next release...
@@ -60,6 +67,8 @@
   MobileNode	*node;
   double        Pr;		// power pkt sent with
   double        lambda;         // wavelength of signal
+  int 			PrLevel;	// nletor -- madwifi powerlevel set by TxPower element
+  double		rate;	// nletor -- transmission rate of packet
 };
 
 #endif /* !_cmu_packetstamp_h_ */
diff -ruN --exclude='*.o' --exclude='autom4*' ns-2.34-pure/common/packet.h ns-2.34/common/packet.h
--- ns-2.34-pure/common/packet.h	2009-06-14 10:35:44.000000000 -0700
+++ ns-2.34/common/packet.h	2010-02-28 09:31:39.000000000 -0800
@@ -182,8 +182,11 @@
 	// AOMDV packet
 static const packet_t PT_AOMDV = 61;
 
+	// nsclick RAW packet
+	static const packet_t PT_RAW = 62;
+
         // insert new packet types here
-static packet_t       PT_NTYPE = 62; // This MUST be the LAST one
+static packet_t       PT_NTYPE = 63; // This MUST be the LAST one
 
 enum packetClass
 {
@@ -286,6 +289,7 @@
 		nPkt_ = PT_NTYPE+1;
 		
 
+		name_[PT_RAW] = "raw";
 		name_[PT_TCP]= "tcp";
 		name_[PT_UDP]= "udp";
 		name_[PT_CBR]= "cbr";
@@ -656,6 +660,7 @@
 inline void Packet::init(Packet* p)
 {
 	bzero(p->bits_, hdrlen_);
+	p->txinfo_.clear();
 }
 
 inline Packet* Packet::alloc()
diff -ruN --exclude='*.o' --exclude='autom4*' ns-2.34-pure/common/rawpacket.cc ns-2.34/common/rawpacket.cc
--- ns-2.34-pure/common/rawpacket.cc	1969-12-31 16:00:00.000000000 -0800
+++ ns-2.34/common/rawpacket.cc	2010-02-28 09:31:39.000000000 -0800
@@ -0,0 +1,205 @@
+/*
+ * rawpacket.cc
+ * Main file for the raw packet type
+ *
+ */
+
+/*****************************************************************************
+ *  Copyright 2002, Univerity of Colorado at Boulder.                        *
+ *                                                                           *
+ *                        All Rights Reserved                                *
+ *                                                                           *
+ *  Permission to use, copy, modify, and distribute this software and its    *
+ *  documentation for any purpose other than its incorporation into a        *
+ *  commercial product is hereby granted without fee, provided that the      *
+ *  above copyright notice appear in all copies and that both that           *
+ *  copyright notice and this permission notice appear in supporting         *
+ *  documentation, and that the name of the University not be used in        *
+ *  advertising or publicity pertaining to distribution of the software      *
+ *  without specific, written prior permission.                              *
+ *                                                                           *
+ *  UNIVERSITY OF COLORADO DISCLAIMS ALL WARRANTIES WITH REGARD TO THIS      *
+ *  SOFTWARE, INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY AND        *
+ *  FITNESS FOR ANY PARTICULAR PURPOSE.  IN NO EVENT SHALL THE UNIVERSITY    *
+ *  OF COLORADO BE LIABLE FOR ANY SPECIAL, INDIRECT OR CONSEQUENTIAL         *
+ *  DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM LOSS OF USE, DATA       *
+ *  OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR OTHER        *
+ *  TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR         *
+ *  PERFORMANCE OF THIS SOFTWARE.                                            *
+ *                                                                           *
+ ****************************************************************************/
+
+#include <stdio.h>
+#include "agent.h"
+#include "packet.h"
+#include "rawpacket.h"
+#include "extrouter.h"
+
+#include <click/config.h>
+#include <click/confparse.hh>
+#include <clicknet/ip.h>
+#include <clicknet/udp.h>
+
+int hdr_raw::offset_;
+
+/*
+ * RawHeaderClass based on the ping example in the ns-2 tutorial.
+ */
+static class RawHeaderClass : public PacketHeaderClass {
+public:
+  RawHeaderClass() : PacketHeaderClass("PacketHeader/Raw",sizeof(hdr_raw)){
+    bind_offset(&hdr_raw::offset_);
+  }
+} class_rawhdr;
+
+static class RawClass : public TclClass {
+public:
+  RawClass() : TclClass("Agent/Raw") {}
+  TclObject* create(int,const char*const*) {
+    return (new RawAgent());
+  }
+} class_raw;
+  
+
+RawAgent::RawAgent() : Agent(PT_RAW) {
+  ipseq_ = 0;
+}
+
+int RawAgent::command(int argc,const char*const* argv) {
+  if (argc == 2) {
+    if (strcmp(argv[1], "send") == 0) {
+      char* testmsg = "Howdy Howdy Howdy\n";
+      send_udp_str(srcip_,srcport_,destip_,destport_,testmsg);
+      return (TCL_OK);
+    }
+  }
+  else if (argc == 3) {
+    if (strcmp(argv[1], "send") == 0) {
+      const char* testmsg = argv[2];
+      send_udp_str(srcip_,srcport_,destip_,destport_,testmsg);
+      return (TCL_OK);
+    }
+    if (strcmp(argv[1], "set-srcip") == 0) {
+	if (!Click::cp_ip_address(Click::String(argv[2]), (unsigned char *) &srcip_))
+	    return TCL_ERROR;
+	return (TCL_OK);
+    }
+    if (strcmp(argv[1], "set-srcport") == 0) {
+      srcport_ = atoi(argv[2]);
+      return (TCL_OK);
+    }
+    if (strcmp(argv[1], "set-destip") == 0) {
+	if (!Click::cp_ip_address(Click::String(argv[2]), (unsigned char *) &destip_))
+	    return TCL_ERROR;
+	return (TCL_OK);
+    }
+    if (strcmp(argv[1], "set-destport") == 0) {
+      destport_ = atoi(argv[2]);
+      return (TCL_OK);
+    }
+  }
+  else if (argc == 7) {
+    if (strcmp(argv[1],"send-udp") == 0) {
+      // saddr,sport,daddr,dport,payload
+      // For right now only text strings can be sent
+      // as payload.
+	u_long saddr, daddr;
+	if (!Click::cp_ip_address(Click::String(argv[2]), (unsigned char *) &saddr)
+	    || !Click::cp_ip_address(Click::String(argv[4]), (unsigned char *) &daddr))
+	    return TCL_ERROR;
+      u_short sport = atoi(argv[3]);
+      u_short dport = atoi(argv[5]);
+      send_udp_str(saddr,sport,daddr,dport,argv[6]);
+      // return TCL_OK, so the calling function knows that the
+      // command has been processed
+      return (TCL_OK);
+    }
+  }
+
+  // If the command hasn't been processed by RawAgent()::command,
+  // call the command() function for the base class
+  return (Agent::command(argc, argv));
+}
+
+void
+RawAgent::sendmsg(int nbytes, const char *flags) {
+  // Make a string full of 'A's and use it for the payload
+  char* stuff = new char[nbytes];
+  memset(stuff,'A',nbytes);
+  send_udp(srcip_,srcport_,destip_,destport_,stuff,nbytes);
+  delete[] stuff;
+  stuff = 0;
+}
+
+void
+RawAgent::send_udp_str(u_long saddr,u_short sport,u_long daddr,u_short dport,
+		       const char* payload) {
+  send_udp(saddr,sport,daddr,dport,payload,strlen(payload));
+}
+
+void
+RawAgent::send_udp(u_long saddr,u_short sport,u_long daddr,u_short dport,
+		   const char* payload,int paylen) {
+    int packetlen = paylen + sizeof(click_ip) + sizeof(click_udp);
+    Packet* pkt = allocpkt(packetlen);
+    hdr_cmn* hcmn = HDR_CMN(pkt);
+    hcmn->direction() = hdr_cmn::DOWN;
+    hcmn->iface() = ExtRouter::IFID_KERNELTAP;
+    hcmn->ptype() = PT_RAW;
+    hcmn->size() = packetlen;
+    // Access the raw header for the new packet:
+    hdr_raw* hdr = hdr_raw::access(pkt);
+    hdr->subtype = hdr_raw::IP;
+    hdr->ns_type = PT_RAW;
+    unsigned char* pdat = pkt->accessdata();
+    memset(pdat,0,packetlen);
+
+    click_ip *ip = reinterpret_cast<click_ip *>(pdat);
+    click_udp *udp = reinterpret_cast<click_udp *>(ip + 1);
+
+    // set up IP header
+    ip->ip_v = 4;
+    ip->ip_hl = sizeof(click_ip) >> 2;
+    ip->ip_len = htons(packetlen);
+    ip->ip_id = htons(ipseq_);
+    ip->ip_p = IP_PROTO_UDP;
+    ip->ip_src.s_addr = saddr;
+    ip->ip_dst.s_addr = daddr;
+    ip->ip_tos = 0;
+    ip->ip_off = 0;
+    ip->ip_ttl = 255;
+
+    ip->ip_sum = 0;
+#if HAVE_FAST_CHECKSUM
+    ip->ip_sum = ip_fast_csum((unsigned char *)ip, sizeof(click_ip) >> 2);
+#else
+    ip->ip_sum = click_in_cksum((unsigned char *)ip, sizeof(click_ip));
+#endif
+    
+    // set up UDP header
+    udp->uh_sport = htons(sport);
+    udp->uh_dport = htons(dport);
+    uint16_t len = packetlen - sizeof(click_ip);
+    udp->uh_ulen = htons(len);
+    udp->uh_sum = 0;
+    unsigned csum = click_in_cksum((unsigned char *)udp, len);
+    udp->uh_sum = click_in_cksum_pseudohdr(csum, ip, len);
+  
+    // Send the packet
+    send(pkt, 0);
+    ipseq_++;
+}
+
+void RawAgent::recv(Packet* pkt, Handler*)
+{
+  // Access the raw header for the received packet
+  hdr_raw* hdr = hdr_raw::access(pkt);
+
+  if (hdr_raw::PSTRING == hdr->subtype) {
+    unsigned char* pdat = pkt->accessdata();
+    unsigned int len = pdat[0];
+
+    // Shovel the string to the screen...
+    fwrite(pdat+1,sizeof(char),len,stdout);
+  }
+}
diff -ruN --exclude='*.o' --exclude='autom4*' ns-2.34-pure/common/rawpacket.h ns-2.34/common/rawpacket.h
--- ns-2.34-pure/common/rawpacket.h	1969-12-31 16:00:00.000000000 -0800
+++ ns-2.34/common/rawpacket.h	2010-02-28 09:31:39.000000000 -0800
@@ -0,0 +1,91 @@
+/*
+ * rawpacket.h
+ *
+ */
+
+/*****************************************************************************
+ *  Copyright 2002, Univerity of Colorado at Boulder.                        *
+ *                                                                           *
+ *                        All Rights Reserved                                *
+ *                                                                           *
+ *  Permission to use, copy, modify, and distribute this software and its    *
+ *  documentation for any purpose other than its incorporation into a        *
+ *  commercial product is hereby granted without fee, provided that the      *
+ *  above copyright notice appear in all copies and that both that           *
+ *  copyright notice and this permission notice appear in supporting         *
+ *  documentation, and that the name of the University not be used in        *
+ *  advertising or publicity pertaining to distribution of the software      *
+ *  without specific, written prior permission.                              *
+ *                                                                           *
+ *  UNIVERSITY OF COLORADO DISCLAIMS ALL WARRANTIES WITH REGARD TO THIS      *
+ *  SOFTWARE, INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY AND        *
+ *  FITNESS FOR ANY PARTICULAR PURPOSE.  IN NO EVENT SHALL THE UNIVERSITY    *
+ *  OF COLORADO BE LIABLE FOR ANY SPECIAL, INDIRECT OR CONSEQUENTIAL         *
+ *  DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM LOSS OF USE, DATA       *
+ *  OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR OTHER        *
+ *  TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR         *
+ *  PERFORMANCE OF THIS SOFTWARE.                                            *
+ *                                                                           *
+ ****************************************************************************/
+
+/*
+ * Raw packet type. 
+ */
+struct hdr_raw {
+  /*
+   * This indicates the actual type of the stuff in the
+   * packet. The actual packet stuff is pointed to by 
+   * the data thing.
+   */
+  int subtype;
+
+  /*
+   * Not many raw subtypes defined so far.
+   */
+  enum {
+    NONE,
+    PSTRING,
+    IP,
+    ETHERNET,
+    MADWIFI
+  };
+
+  /*
+   * This is the equivalent packet type in ns-2. Sometimes we
+   * want to maintain the raw packet data _and_ the ns-2 headers
+   * for that particular type in parallel, e.g. so we can use
+   * the existing ns-2 trace printing routines. However, we
+   * still want to keep the packet type as PT_RAW, so we store
+   * the ns-2 type in this field.
+   */
+  int ns_type;
+ 
+  /* Packet header access functions */
+  static int offset_;
+  inline static int& offset() { return offset_; }
+  inline static hdr_raw* access(const Packet* p) {
+    return (hdr_raw*) p->access(offset_);
+  }
+};
+
+/*
+ * The base RawAgent class
+ */
+class RawAgent : public Agent {
+ public:
+  RawAgent();
+  int command(int argc,const char*const* argv);
+  void recv(Packet*, Handler*);
+  virtual void sendmsg(int nbytes, const char *flags = 0);
+ protected:
+  void send_udp_str(u_long saddr,u_short sport,u_long daddr,u_short dport,
+		    const char* payload);
+  void send_udp(u_long saddr,u_short sport,u_long daddr,u_short dport,
+		const char* payload,int paylen);
+
+  u_int16_t ipseq_;
+  u_long srcip_;
+  u_short srcport_;
+  u_long destip_;
+  u_short destport_;
+};
diff -ruN --exclude='*.o' --exclude='autom4*' ns-2.34-pure/conf/configure.in.click ns-2.34/conf/configure.in.click
--- ns-2.34-pure/conf/configure.in.click	1969-12-31 16:00:00.000000000 -0800
+++ ns-2.34/conf/configure.in.click	2010-02-28 09:31:39.000000000 -0800
@@ -0,0 +1,29 @@
+dnl autoconf rules to find click - copied from dmalloc example
+
+AC_ARG_WITH(click,	--with-click=path specify a pathname for the click modular router, d="$withval", d="")
+
+CLICK_VERS=1.3
+
+CLICK_PATH="$PWD/../click \
+	$PWD/../../click \
+	$PWD/../click-$CLICK_VERS \
+	$PWD/../../click-$CLICK_VERS \
+	$PWD/../click/include \
+	$PWD/../../click/include \
+	$PWD/../click-$CLICK_VERS/include \
+	$PWD/../../click-$CLICK_VERS/include \
+	$PWD/../click/ns \
+	$PWD/../../click/ns \
+	$PWD/../click-$CLICK_VERS/ns \
+	$PWD/../../click-$CLICK_VERS/ns \
+	"
+CLICK_PATH_D="$d \
+	$d/lib \
+	$d/include \
+	"
+
+NS_BEGIN_PACKAGE(click)
+NS_CHECK_HEADER_PATH(click/simclick.h,$CLICK_PATH,$d,$CLICK_PATH_D,V_HEADER_CLICK,click)
+NS_CHECK_LIB_PATH(nsclick,$CLICK_PATH,$d,$CLICK_PATH_D,V_LIB_CLICK,click)
+V_DEFINES="-DCLICK_NS $V_DEFINES"
+NS_END_PACKAGE(click,yes)
diff -ruN --exclude='*.o' --exclude='autom4*' ns-2.34-pure/conf/configure.in.tcl ns-2.34/conf/configure.in.tcl
--- ns-2.34-pure/conf/configure.in.tcl	2009-06-14 10:35:45.000000000 -0700
+++ ns-2.34/conf/configure.in.tcl	2010-02-28 11:47:43.000000000 -0800
@@ -58,6 +58,9 @@
 		/usr/share/tcl$TCL_VERS \
 		/usr/share/tcl$TCL_HI_VERS \
 		/usr/share/tcl$TCL_ALT_VERS \
+		/usr/share/tcltk/tcl$TCL_VERS \
+		/usr/share/tcltk/tcl$TCL_HI_VERS \
+		/usr/share/tcltk/tcl$TCL_ALT_VERS \
 		/usr/local/src/tcl$TCL_VERS \
 		/usr/local/src/tcl$TCL_HI_VERS \
 		/usr/local/src/tcl$TCL_ALT_VERS \
diff -ruN --exclude='*.o' --exclude='autom4*' ns-2.34-pure/conf/configure.in.tk ns-2.34/conf/configure.in.tk
--- ns-2.34-pure/conf/configure.in.tk	2009-06-14 10:35:45.000000000 -0700
+++ ns-2.34/conf/configure.in.tk	2010-02-28 11:47:18.000000000 -0800
@@ -68,6 +68,9 @@
                 /usr/share/tk$TK_VERS \
                 /usr/share/tk$TK_ALT_VERS \
                 /usr/share/tk$TK_HI_VERS \
+                /usr/share/tcltk/tk$TK_VERS \
+                /usr/share/tcltk/tk$TK_ALT_VERS \
+                /usr/share/tcltk/tk$TK_HI_VERS \
                 /usr/share/tk \
 		../tk$TK_OLD_VERS/library \
                 ../tk$TK_OLD_ALT_VERS/library \
diff -ruN --exclude='*.o' --exclude='autom4*' ns-2.34-pure/configure ns-2.34/configure
--- ns-2.34-pure/configure	2009-06-14 10:35:07.000000000 -0700
+++ ns-2.34/configure	2010-02-28 11:47:56.000000000 -0800
@@ -1,18 +1,20 @@
 #! /bin/sh
 # Guess values for system-dependent variables and create Makefiles.
-# Generated by GNU Autoconf 2.63.
+# Generated by GNU Autoconf 2.64.
 #
 # Copyright (C) 1992, 1993, 1994, 1995, 1996, 1998, 1999, 2000, 2001,
-# 2002, 2003, 2004, 2005, 2006, 2007, 2008 Free Software Foundation, Inc.
+# 2002, 2003, 2004, 2005, 2006, 2007, 2008, 2009 Free Software
+# Foundation, Inc.
+#
 # This configure script is free software; the Free Software Foundation
 # gives unlimited permission to copy, distribute and modify it.
-## --------------------- ##
-## M4sh Initialization.  ##
-## --------------------- ##
+## -------------------- ##
+## M4sh Initialization. ##
+## -------------------- ##
 
 # Be more Bourne compatible
 DUALCASE=1; export DUALCASE # for MKS sh
-if test -n "${ZSH_VERSION+set}" && (emulate sh) >/dev/null 2>&1; then
+if test -n "${ZSH_VERSION+set}" && (emulate sh) >/dev/null 2>&1; then :
   emulate sh
   NULLCMD=:
   # Pre-4.2 versions of Zsh do word splitting on ${1+"$@"}, which
@@ -20,23 +22,15 @@
   alias -g '${1+"$@"}'='"$@"'
   setopt NO_GLOB_SUBST
 else
-  case `(set -o) 2>/dev/null` in
-  *posix*) set -o posix ;;
+  case `(set -o) 2>/dev/null` in #(
+  *posix*) :
+    set -o posix ;; #(
+  *) :
+     ;;
 esac
-
 fi
 
 
-
-
-# PATH needs CR
-# Avoid depending upon Character Ranges.
-as_cr_letters='abcdefghijklmnopqrstuvwxyz'
-as_cr_LETTERS='ABCDEFGHIJKLMNOPQRSTUVWXYZ'
-as_cr_Letters=$as_cr_letters$as_cr_LETTERS
-as_cr_digits='0123456789'
-as_cr_alnum=$as_cr_Letters$as_cr_digits
-
 as_nl='
 '
 export as_nl
@@ -44,7 +38,13 @@
 as_echo='\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\'
 as_echo=$as_echo$as_echo$as_echo$as_echo$as_echo
 as_echo=$as_echo$as_echo$as_echo$as_echo$as_echo$as_echo
-if (test "X`printf %s $as_echo`" = "X$as_echo") 2>/dev/null; then
+# Prefer a ksh shell builtin over an external printf program on Solaris,
+# but without wasting forks for bash or zsh.
+if test -z "$BASH_VERSION$ZSH_VERSION" \
+    && (test "X`print -r -- $as_echo`" = "X$as_echo") 2>/dev/null; then
+  as_echo='print -r --'
+  as_echo_n='print -rn --'
+elif (test "X`printf %s $as_echo`" = "X$as_echo") 2>/dev/null; then
   as_echo='printf %s\n'
   as_echo_n='printf %s'
 else
@@ -55,7 +55,7 @@
     as_echo_body='eval expr "X$1" : "X\\(.*\\)"'
     as_echo_n_body='eval
       arg=$1;
-      case $arg in
+      case $arg in #(
       *"$as_nl"*)
 	expr "X$arg" : "X\\(.*\\)$as_nl";
 	arg=`expr "X$arg" : ".*$as_nl\\(.*\\)"`;;
@@ -78,13 +78,6 @@
   }
 fi
 
-# Support unset when possible.
-if ( (MAIL=60; unset MAIL) || exit) >/dev/null 2>&1; then
-  as_unset=unset
-else
-  as_unset=false
-fi
-
 
 # IFS
 # We need space, tab and new line, in precisely that order.  Quoting is
@@ -94,15 +87,15 @@
 IFS=" ""	$as_nl"
 
 # Find who we are.  Look in the path if we contain no directory separator.
-case $0 in
+case $0 in #((
   *[\\/]* ) as_myself=$0 ;;
   *) as_save_IFS=$IFS; IFS=$PATH_SEPARATOR
 for as_dir in $PATH
 do
   IFS=$as_save_IFS
   test -z "$as_dir" && as_dir=.
-  test -r "$as_dir/$0" && as_myself=$as_dir/$0 && break
-done
+    test -r "$as_dir/$0" && as_myself=$as_dir/$0 && break
+  done
 IFS=$as_save_IFS
 
      ;;
@@ -114,12 +107,16 @@
 fi
 if test ! -f "$as_myself"; then
   $as_echo "$as_myself: error: cannot find myself; rerun with an absolute file name" >&2
-  { (exit 1); exit 1; }
+  exit 1
 fi
 
-# Work around bugs in pre-3.0 UWIN ksh.
-for as_var in ENV MAIL MAILPATH
-do ($as_unset $as_var) >/dev/null 2>&1 && $as_unset $as_var
+# Unset variables that we do not need and which cause bugs (e.g. in
+# pre-3.0 UWIN ksh).  But do not cause bugs in bash 2.01; the "|| exit 1"
+# suppresses any "Segmentation fault" message there.  '((' could
+# trigger a bug in pdksh 5.2.14.
+for as_var in BASH_ENV ENV MAIL MAILPATH
+do eval test x\${$as_var+set} = xset \
+  && ( (unset $as_var) || exit 1) >/dev/null 2>&1 && unset $as_var || :
 done
 PS1='$ '
 PS2='> '
@@ -131,330 +128,299 @@
 LANGUAGE=C
 export LANGUAGE
 
-# Required to use basename.
-if expr a : '\(a\)' >/dev/null 2>&1 &&
-   test "X`expr 00001 : '.*\(...\)'`" = X001; then
-  as_expr=expr
-else
-  as_expr=false
-fi
-
-if (basename -- /) >/dev/null 2>&1 && test "X`basename -- / 2>&1`" = "X/"; then
-  as_basename=basename
-else
-  as_basename=false
-fi
-
-
-# Name of the executable.
-as_me=`$as_basename -- "$0" ||
-$as_expr X/"$0" : '.*/\([^/][^/]*\)/*$' \| \
-	 X"$0" : 'X\(//\)$' \| \
-	 X"$0" : 'X\(/\)' \| . 2>/dev/null ||
-$as_echo X/"$0" |
-    sed '/^.*\/\([^/][^/]*\)\/*$/{
-	    s//\1/
-	    q
-	  }
-	  /^X\/\(\/\/\)$/{
-	    s//\1/
-	    q
-	  }
-	  /^X\/\(\/\).*/{
-	    s//\1/
-	    q
-	  }
-	  s/.*/./; q'`
-
 # CDPATH.
-$as_unset CDPATH
-
+(unset CDPATH) >/dev/null 2>&1 && unset CDPATH
 
 if test "x$CONFIG_SHELL" = x; then
-  if (eval ":") 2>/dev/null; then
-  as_have_required=yes
+  as_bourne_compatible="if test -n \"\${ZSH_VERSION+set}\" && (emulate sh) >/dev/null 2>&1; then :
+  emulate sh
+  NULLCMD=:
+  # Pre-4.2 versions of Zsh do word splitting on \${1+\"\$@\"}, which
+  # is contrary to our usage.  Disable this feature.
+  alias -g '\${1+\"\$@\"}'='\"\$@\"'
+  setopt NO_GLOB_SUBST
 else
-  as_have_required=no
+  case \`(set -o) 2>/dev/null\` in #(
+  *posix*) :
+    set -o posix ;; #(
+  *) :
+     ;;
+esac
 fi
-
-  if test $as_have_required = yes &&	 (eval ":
-(as_func_return () {
-  (exit \$1)
-}
-as_func_success () {
-  as_func_return 0
-}
-as_func_failure () {
-  as_func_return 1
-}
-as_func_ret_success () {
-  return 0
-}
-as_func_ret_failure () {
-  return 1
-}
+"
+  as_required="as_fn_return () { (exit \$1); }
+as_fn_success () { as_fn_return 0; }
+as_fn_failure () { as_fn_return 1; }
+as_fn_ret_success () { return 0; }
+as_fn_ret_failure () { return 1; }
 
 exitcode=0
-if as_func_success; then
-  :
-else
-  exitcode=1
-  echo as_func_success failed.
-fi
-
-if as_func_failure; then
-  exitcode=1
-  echo as_func_failure succeeded.
-fi
-
-if as_func_ret_success; then
-  :
-else
-  exitcode=1
-  echo as_func_ret_success failed.
-fi
-
-if as_func_ret_failure; then
-  exitcode=1
-  echo as_func_ret_failure succeeded.
-fi
-
-if ( set x; as_func_ret_success y && test x = \"\$1\" ); then
-  :
+as_fn_success || { exitcode=1; echo as_fn_success failed.; }
+as_fn_failure && { exitcode=1; echo as_fn_failure succeeded.; }
+as_fn_ret_success || { exitcode=1; echo as_fn_ret_success failed.; }
+as_fn_ret_failure && { exitcode=1; echo as_fn_ret_failure succeeded.; }
+if ( set x; as_fn_ret_success y && test x = \"\$1\" ); then :
+
+else
+  exitcode=1; echo positional parameters were not saved.
+fi
+test x\$exitcode = x0 || exit 1"
+  as_suggested="  as_lineno_1=";as_suggested=$as_suggested$LINENO;as_suggested=$as_suggested" as_lineno_1a=\$LINENO
+  as_lineno_2=";as_suggested=$as_suggested$LINENO;as_suggested=$as_suggested" as_lineno_2a=\$LINENO
+  eval 'test \"x\$as_lineno_1'\$as_run'\" != \"x\$as_lineno_2'\$as_run'\" &&
+  test \"x\`expr \$as_lineno_1'\$as_run' + 1\`\" = \"x\$as_lineno_2'\$as_run'\"' || exit 1
+test \$(( 1 + 1 )) = 2 || exit 1"
+  if (eval "$as_required") 2>/dev/null; then :
+  as_have_required=yes
 else
-  exitcode=1
-  echo positional parameters were not saved.
+  as_have_required=no
 fi
+  if test x$as_have_required = xyes && (eval "$as_suggested") 2>/dev/null; then :
 
-test \$exitcode = 0) || { (exit 1); exit 1; }
-
-(
-  as_lineno_1=\$LINENO
-  as_lineno_2=\$LINENO
-  test \"x\$as_lineno_1\" != \"x\$as_lineno_2\" &&
-  test \"x\`expr \$as_lineno_1 + 1\`\" = \"x\$as_lineno_2\") || { (exit 1); exit 1; }
-") 2> /dev/null; then
-  :
 else
-  as_candidate_shells=
-    as_save_IFS=$IFS; IFS=$PATH_SEPARATOR
+  as_save_IFS=$IFS; IFS=$PATH_SEPARATOR
+as_found=false
 for as_dir in /bin$PATH_SEPARATOR/usr/bin$PATH_SEPARATOR$PATH
 do
   IFS=$as_save_IFS
   test -z "$as_dir" && as_dir=.
-  case $as_dir in
+  as_found=:
+  case $as_dir in #(
 	 /*)
 	   for as_base in sh bash ksh sh5; do
-	     as_candidate_shells="$as_candidate_shells $as_dir/$as_base"
+	     # Try only shells that exist, to save several forks.
+	     as_shell=$as_dir/$as_base
+	     if { test -f "$as_shell" || test -f "$as_shell.exe"; } &&
+		    { $as_echo "$as_bourne_compatible""$as_required" | as_run=a "$as_shell"; } 2>/dev/null; then :
+  CONFIG_SHELL=$as_shell as_have_required=yes
+		   if { $as_echo "$as_bourne_compatible""$as_suggested" | as_run=a "$as_shell"; } 2>/dev/null; then :
+  break 2
+fi
+fi
 	   done;;
        esac
+  as_found=false
 done
+$as_found || { if { test -f "$SHELL" || test -f "$SHELL.exe"; } &&
+	      { $as_echo "$as_bourne_compatible""$as_required" | as_run=a "$SHELL"; } 2>/dev/null; then :
+  CONFIG_SHELL=$SHELL as_have_required=yes
+fi; }
 IFS=$as_save_IFS
 
 
-      for as_shell in $as_candidate_shells $SHELL; do
-	 # Try only shells that exist, to save several forks.
-	 if { test -f "$as_shell" || test -f "$as_shell.exe"; } &&
-		{ ("$as_shell") 2> /dev/null <<\_ASEOF
-if test -n "${ZSH_VERSION+set}" && (emulate sh) >/dev/null 2>&1; then
-  emulate sh
-  NULLCMD=:
-  # Pre-4.2 versions of Zsh do word splitting on ${1+"$@"}, which
-  # is contrary to our usage.  Disable this feature.
-  alias -g '${1+"$@"}'='"$@"'
-  setopt NO_GLOB_SUBST
-else
-  case `(set -o) 2>/dev/null` in
-  *posix*) set -o posix ;;
-esac
-
-fi
-
-
-:
-_ASEOF
-}; then
-  CONFIG_SHELL=$as_shell
-	       as_have_required=yes
-	       if { "$as_shell" 2> /dev/null <<\_ASEOF
-if test -n "${ZSH_VERSION+set}" && (emulate sh) >/dev/null 2>&1; then
-  emulate sh
-  NULLCMD=:
-  # Pre-4.2 versions of Zsh do word splitting on ${1+"$@"}, which
-  # is contrary to our usage.  Disable this feature.
-  alias -g '${1+"$@"}'='"$@"'
-  setopt NO_GLOB_SUBST
-else
-  case `(set -o) 2>/dev/null` in
-  *posix*) set -o posix ;;
-esac
-
-fi
-
-
-:
-(as_func_return () {
-  (exit $1)
-}
-as_func_success () {
-  as_func_return 0
-}
-as_func_failure () {
-  as_func_return 1
-}
-as_func_ret_success () {
-  return 0
-}
-as_func_ret_failure () {
-  return 1
-}
-
-exitcode=0
-if as_func_success; then
-  :
-else
-  exitcode=1
-  echo as_func_success failed.
-fi
-
-if as_func_failure; then
-  exitcode=1
-  echo as_func_failure succeeded.
-fi
-
-if as_func_ret_success; then
-  :
-else
-  exitcode=1
-  echo as_func_ret_success failed.
-fi
-
-if as_func_ret_failure; then
-  exitcode=1
-  echo as_func_ret_failure succeeded.
-fi
-
-if ( set x; as_func_ret_success y && test x = "$1" ); then
-  :
-else
-  exitcode=1
-  echo positional parameters were not saved.
-fi
-
-test $exitcode = 0) || { (exit 1); exit 1; }
-
-(
-  as_lineno_1=$LINENO
-  as_lineno_2=$LINENO
-  test "x$as_lineno_1" != "x$as_lineno_2" &&
-  test "x`expr $as_lineno_1 + 1`" = "x$as_lineno_2") || { (exit 1); exit 1; }
-
-_ASEOF
-}; then
-  break
-fi
-
-fi
-
-      done
-
-      if test "x$CONFIG_SHELL" != x; then
-  for as_var in BASH_ENV ENV
-	do ($as_unset $as_var) >/dev/null 2>&1 && $as_unset $as_var
-	done
+      if test "x$CONFIG_SHELL" != x; then :
+  # We cannot yet assume a decent shell, so we have to provide a
+	# neutralization value for shells without unset; and this also
+	# works around shells that cannot unset nonexistent variables.
+	BASH_ENV=/dev/null
+	ENV=/dev/null
+	(unset BASH_ENV) >/dev/null 2>&1 && unset BASH_ENV ENV
 	export CONFIG_SHELL
 	exec "$CONFIG_SHELL" "$as_myself" ${1+"$@"}
 fi
 
-
-    if test $as_have_required = no; then
-  echo This script requires a shell more modern than all the
-      echo shells that I found on your system.  Please install a
-      echo modern shell, or manually run the script under such a
-      echo shell if you do have one.
-      { (exit 1); exit 1; }
+    if test x$as_have_required = xno; then :
+  $as_echo "$0: This script requires a shell more modern than all"
+  $as_echo "$0: the shells that I found on your system."
+  if test x${ZSH_VERSION+set} = xset ; then
+    $as_echo "$0: In particular, zsh $ZSH_VERSION has bugs and should"
+    $as_echo "$0: be upgraded to zsh 4.3.4 or later."
+  else
+    $as_echo "$0: Please tell bug-autoconf@gnu.org about your system,
+$0: including any error possibly output before this
+$0: message. Then install a modern shell, or manually run
+$0: the script under such a shell if you do have one."
+  fi
+  exit 1
 fi
-
-
 fi
-
 fi
+SHELL=${CONFIG_SHELL-/bin/sh}
+export SHELL
+# Unset more variables known to interfere with behavior of common tools.
+CLICOLOR_FORCE= GREP_OPTIONS=
+unset CLICOLOR_FORCE GREP_OPTIONS
+
+## --------------------- ##
+## M4sh Shell Functions. ##
+## --------------------- ##
+# as_fn_unset VAR
+# ---------------
+# Portably unset VAR.
+as_fn_unset ()
+{
+  { eval $1=; unset $1;}
+}
+as_unset=as_fn_unset
+
+# as_fn_set_status STATUS
+# -----------------------
+# Set $? to STATUS, without forking.
+as_fn_set_status ()
+{
+  return $1
+} # as_fn_set_status
+
+# as_fn_exit STATUS
+# -----------------
+# Exit the shell with STATUS, even in a "trap 0" or "set -e" context.
+as_fn_exit ()
+{
+  set +e
+  as_fn_set_status $1
+  exit $1
+} # as_fn_exit
+
+# as_fn_mkdir_p
+# -------------
+# Create "$as_dir" as a directory, including parents if necessary.
+as_fn_mkdir_p ()
+{
 
+  case $as_dir in #(
+  -*) as_dir=./$as_dir;;
+  esac
+  test -d "$as_dir" || eval $as_mkdir_p || {
+    as_dirs=
+    while :; do
+      case $as_dir in #(
+      *\'*) as_qdir=`$as_echo "$as_dir" | sed "s/'/'\\\\\\\\''/g"`;; #'(
+      *) as_qdir=$as_dir;;
+      esac
+      as_dirs="'$as_qdir' $as_dirs"
+      as_dir=`$as_dirname -- "$as_dir" ||
+$as_expr X"$as_dir" : 'X\(.*[^/]\)//*[^/][^/]*/*$' \| \
+	 X"$as_dir" : 'X\(//\)[^/]' \| \
+	 X"$as_dir" : 'X\(//\)$' \| \
+	 X"$as_dir" : 'X\(/\)' \| . 2>/dev/null ||
+$as_echo X"$as_dir" |
+    sed '/^X\(.*[^/]\)\/\/*[^/][^/]*\/*$/{
+	    s//\1/
+	    q
+	  }
+	  /^X\(\/\/\)[^/].*/{
+	    s//\1/
+	    q
+	  }
+	  /^X\(\/\/\)$/{
+	    s//\1/
+	    q
+	  }
+	  /^X\(\/\).*/{
+	    s//\1/
+	    q
+	  }
+	  s/.*/./; q'`
+      test -d "$as_dir" && break
+    done
+    test -z "$as_dirs" || eval "mkdir $as_dirs"
+  } || test -d "$as_dir" || as_fn_error "cannot create directory $as_dir"
 
 
-(eval "as_func_return () {
-  (exit \$1)
-}
-as_func_success () {
-  as_func_return 0
-}
-as_func_failure () {
-  as_func_return 1
-}
-as_func_ret_success () {
-  return 0
-}
-as_func_ret_failure () {
-  return 1
-}
+} # as_fn_mkdir_p
+# as_fn_append VAR VALUE
+# ----------------------
+# Append the text in VALUE to the end of the definition contained in VAR. Take
+# advantage of any shell optimizations that allow amortized linear growth over
+# repeated appends, instead of the typical quadratic growth present in naive
+# implementations.
+if (eval "as_var=1; as_var+=2; test x\$as_var = x12") 2>/dev/null; then :
+  eval 'as_fn_append ()
+  {
+    eval $1+=\$2
+  }'
+else
+  as_fn_append ()
+  {
+    eval $1=\$$1\$2
+  }
+fi # as_fn_append
 
-exitcode=0
-if as_func_success; then
-  :
+# as_fn_arith ARG...
+# ------------------
+# Perform arithmetic evaluation on the ARGs, and store the result in the
+# global $as_val. Take advantage of shells that can avoid forks. The arguments
+# must be portable across $(()) and expr.
+if (eval "test \$(( 1 + 1 )) = 2") 2>/dev/null; then :
+  eval 'as_fn_arith ()
+  {
+    as_val=$(( $* ))
+  }'
 else
-  exitcode=1
-  echo as_func_success failed.
-fi
+  as_fn_arith ()
+  {
+    as_val=`expr "$@" || test $? -eq 1`
+  }
+fi # as_fn_arith
 
-if as_func_failure; then
-  exitcode=1
-  echo as_func_failure succeeded.
-fi
 
-if as_func_ret_success; then
-  :
+# as_fn_error ERROR [LINENO LOG_FD]
+# ---------------------------------
+# Output "`basename $0`: error: ERROR" to stderr. If LINENO and LOG_FD are
+# provided, also output the error to LOG_FD, referencing LINENO. Then exit the
+# script with status $?, using 1 if that was 0.
+as_fn_error ()
+{
+  as_status=$?; test $as_status -eq 0 && as_status=1
+  if test "$3"; then
+    as_lineno=${as_lineno-"$2"} as_lineno_stack=as_lineno_stack=$as_lineno_stack
+    $as_echo "$as_me:${as_lineno-$LINENO}: error: $1" >&$3
+  fi
+  $as_echo "$as_me: error: $1" >&2
+  as_fn_exit $as_status
+} # as_fn_error
+
+if expr a : '\(a\)' >/dev/null 2>&1 &&
+   test "X`expr 00001 : '.*\(...\)'`" = X001; then
+  as_expr=expr
 else
-  exitcode=1
-  echo as_func_ret_success failed.
+  as_expr=false
 fi
 
-if as_func_ret_failure; then
-  exitcode=1
-  echo as_func_ret_failure succeeded.
+if (basename -- /) >/dev/null 2>&1 && test "X`basename -- / 2>&1`" = "X/"; then
+  as_basename=basename
+else
+  as_basename=false
 fi
 
-if ( set x; as_func_ret_success y && test x = \"\$1\" ); then
-  :
+if (as_dir=`dirname -- /` && test "X$as_dir" = X/) >/dev/null 2>&1; then
+  as_dirname=dirname
 else
-  exitcode=1
-  echo positional parameters were not saved.
+  as_dirname=false
 fi
 
-test \$exitcode = 0") || {
-  echo No shell found that supports shell functions.
-  echo Please tell bug-autoconf@gnu.org about your system,
-  echo including any error possibly output before this message.
-  echo This can help us improve future autoconf versions.
-  echo Configuration will now proceed without shell functions.
-}
+as_me=`$as_basename -- "$0" ||
+$as_expr X/"$0" : '.*/\([^/][^/]*\)/*$' \| \
+	 X"$0" : 'X\(//\)$' \| \
+	 X"$0" : 'X\(/\)' \| . 2>/dev/null ||
+$as_echo X/"$0" |
+    sed '/^.*\/\([^/][^/]*\)\/*$/{
+	    s//\1/
+	    q
+	  }
+	  /^X\/\(\/\/\)$/{
+	    s//\1/
+	    q
+	  }
+	  /^X\/\(\/\).*/{
+	    s//\1/
+	    q
+	  }
+	  s/.*/./; q'`
 
+# Avoid depending upon Character Ranges.
+as_cr_letters='abcdefghijklmnopqrstuvwxyz'
+as_cr_LETTERS='ABCDEFGHIJKLMNOPQRSTUVWXYZ'
+as_cr_Letters=$as_cr_letters$as_cr_LETTERS
+as_cr_digits='0123456789'
+as_cr_alnum=$as_cr_Letters$as_cr_digits
 
 
-  as_lineno_1=$LINENO
-  as_lineno_2=$LINENO
-  test "x$as_lineno_1" != "x$as_lineno_2" &&
-  test "x`expr $as_lineno_1 + 1`" = "x$as_lineno_2" || {
-
-  # Create $as_me.lineno as a copy of $as_myself, but with $LINENO
-  # uniformly replaced by the line number.  The first 'sed' inserts a
-  # line-number line after each line using $LINENO; the second 'sed'
-  # does the real work.  The second script uses 'N' to pair each
-  # line-number line with the line containing $LINENO, and appends
-  # trailing '-' during substitution so that $LINENO is not a special
-  # case at line end.
-  # (Raja R Harinath suggested sed '=', and Paul Eggert wrote the
-  # scripts with optimization help from Paolo Bonzini.  Blame Lee
-  # E. McMahon (1931-1989) for sed's syntax.  :-)
+  as_lineno_1=$LINENO as_lineno_1a=$LINENO
+  as_lineno_2=$LINENO as_lineno_2a=$LINENO
+  eval 'test "x$as_lineno_1'$as_run'" != "x$as_lineno_2'$as_run'" &&
+  test "x`expr $as_lineno_1'$as_run' + 1`" = "x$as_lineno_2'$as_run'"' || {
+  # Blame Lee E. McMahon (1931-1989) for sed's syntax.  :-)
   sed -n '
     p
     /[$]LINENO/=
@@ -471,8 +437,7 @@
       s/-\n.*//
     ' >$as_me.lineno &&
   chmod +x "$as_me.lineno" ||
-    { $as_echo "$as_me: error: cannot create $as_me.lineno; rerun with a POSIX shell" >&2
-   { (exit 1); exit 1; }; }
+    { $as_echo "$as_me: error: cannot create $as_me.lineno; rerun with a POSIX shell" >&2; as_fn_exit 1; }
 
   # Don't try to exec as it changes $[0], causing all sort of problems
   # (the dirname of $[0] is not the place where we might find the
@@ -482,29 +447,18 @@
   exit
 }
 
-
-if (as_dir=`dirname -- /` && test "X$as_dir" = X/) >/dev/null 2>&1; then
-  as_dirname=dirname
-else
-  as_dirname=false
-fi
-
 ECHO_C= ECHO_N= ECHO_T=
-case `echo -n x` in
+case `echo -n x` in #(((((
 -n*)
-  case `echo 'x\c'` in
+  case `echo 'xy\c'` in
   *c*) ECHO_T='	';;	# ECHO_T is single tab character.
-  *)   ECHO_C='\c';;
+  xy)  ECHO_C='\c';;
+  *)   echo `echo ksh88 bug on AIX 6.1` > /dev/null
+       ECHO_T='	';;
   esac;;
 *)
   ECHO_N='-n';;
 esac
-if expr a : '\(a\)' >/dev/null 2>&1 &&
-   test "X`expr 00001 : '.*\(...\)'`" = X001; then
-  as_expr=expr
-else
-  as_expr=false
-fi
 
 rm -f conf$$ conf$$.exe conf$$.file
 if test -d conf$$.dir; then
@@ -534,7 +488,7 @@
 rmdir conf$$.dir 2>/dev/null
 
 if mkdir -p . 2>/dev/null; then
-  as_mkdir_p=:
+  as_mkdir_p='mkdir -p "$as_dir"'
 else
   test -d ./-p && rmdir ./-p
   as_mkdir_p=false
@@ -553,10 +507,10 @@
       if test -d "$1"; then
 	test -d "$1/.";
       else
-	case $1 in
+	case $1 in #(
 	-*)set "./$1";;
 	esac;
-	case `ls -ld'$as_ls_L_option' "$1" 2>/dev/null` in
+	case `ls -ld'$as_ls_L_option' "$1" 2>/dev/null` in #((
 	???[sx]*):;;*)false;;esac;fi
     '\'' sh
   '
@@ -570,7 +524,6 @@
 as_tr_sh="eval sed 'y%*+%pp%;s%[^_$as_cr_alnum]%_%g'"
 
 
-
 exec 7<&0 </dev/null 6>&1
 
 # Name of the host.
@@ -589,7 +542,6 @@
 subdirs=
 MFLAGS=
 MAKEFLAGS=
-SHELL=${CONFIG_SHELL-/bin/sh}
 
 # Identity of this package.
 PACKAGE_NAME=
@@ -597,6 +549,7 @@
 PACKAGE_VERSION=
 PACKAGE_STRING=
 PACKAGE_BUGREPORT=
+PACKAGE_URL=
 
 ac_unique_file="ns_tclsh.cc"
 # Factoring default headers for most tests.
@@ -742,6 +695,7 @@
 program_transform_name
 prefix
 exec_prefix
+PACKAGE_URL
 PACKAGE_BUGREPORT
 PACKAGE_STRING
 PACKAGE_VERSION
@@ -767,6 +721,7 @@
 with_tclcl
 with_tcldebug
 with_dmalloc
+with_click
 enable_tclcl_classinstvar
 with_perl
 enable_shlib
@@ -891,8 +846,7 @@
     ac_useropt=`expr "x$ac_option" : 'x-*disable-\(.*\)'`
     # Reject names that are not valid shell variable names.
     expr "x$ac_useropt" : ".*[^-+._$as_cr_alnum]" >/dev/null &&
-      { $as_echo "$as_me: error: invalid feature name: $ac_useropt" >&2
-   { (exit 1); exit 1; }; }
+      as_fn_error "invalid feature name: $ac_useropt"
     ac_useropt_orig=$ac_useropt
     ac_useropt=`$as_echo "$ac_useropt" | sed 's/[-+.]/_/g'`
     case $ac_user_opts in
@@ -918,8 +872,7 @@
     ac_useropt=`expr "x$ac_option" : 'x-*enable-\([^=]*\)'`
     # Reject names that are not valid shell variable names.
     expr "x$ac_useropt" : ".*[^-+._$as_cr_alnum]" >/dev/null &&
-      { $as_echo "$as_me: error: invalid feature name: $ac_useropt" >&2
-   { (exit 1); exit 1; }; }
+      as_fn_error "invalid feature name: $ac_useropt"
     ac_useropt_orig=$ac_useropt
     ac_useropt=`$as_echo "$ac_useropt" | sed 's/[-+.]/_/g'`
     case $ac_user_opts in
@@ -1123,8 +1076,7 @@
     ac_useropt=`expr "x$ac_option" : 'x-*with-\([^=]*\)'`
     # Reject names that are not valid shell variable names.
     expr "x$ac_useropt" : ".*[^-+._$as_cr_alnum]" >/dev/null &&
-      { $as_echo "$as_me: error: invalid package name: $ac_useropt" >&2
-   { (exit 1); exit 1; }; }
+      as_fn_error "invalid package name: $ac_useropt"
     ac_useropt_orig=$ac_useropt
     ac_useropt=`$as_echo "$ac_useropt" | sed 's/[-+.]/_/g'`
     case $ac_user_opts in
@@ -1140,8 +1092,7 @@
     ac_useropt=`expr "x$ac_option" : 'x-*without-\(.*\)'`
     # Reject names that are not valid shell variable names.
     expr "x$ac_useropt" : ".*[^-+._$as_cr_alnum]" >/dev/null &&
-      { $as_echo "$as_me: error: invalid package name: $ac_useropt" >&2
-   { (exit 1); exit 1; }; }
+      as_fn_error "invalid package name: $ac_useropt"
     ac_useropt_orig=$ac_useropt
     ac_useropt=`$as_echo "$ac_useropt" | sed 's/[-+.]/_/g'`
     case $ac_user_opts in
@@ -1171,17 +1122,17 @@
   | --x-librar=* | --x-libra=* | --x-libr=* | --x-lib=* | --x-li=* | --x-l=*)
     x_libraries=$ac_optarg ;;
 
-  -*) { $as_echo "$as_me: error: unrecognized option: $ac_option
-Try \`$0 --help' for more information." >&2
-   { (exit 1); exit 1; }; }
+  -*) as_fn_error "unrecognized option: \`$ac_option'
+Try \`$0 --help' for more information."
     ;;
 
   *=*)
     ac_envvar=`expr "x$ac_option" : 'x\([^=]*\)='`
     # Reject names that are not valid shell variable names.
-    expr "x$ac_envvar" : ".*[^_$as_cr_alnum]" >/dev/null &&
-      { $as_echo "$as_me: error: invalid variable name: $ac_envvar" >&2
-   { (exit 1); exit 1; }; }
+    case $ac_envvar in #(
+      '' | [0-9]* | *[!_$as_cr_alnum]* )
+      as_fn_error "invalid variable name: \`$ac_envvar'" ;;
+    esac
     eval $ac_envvar=\$ac_optarg
     export $ac_envvar ;;
 
@@ -1198,15 +1149,13 @@
 
 if test -n "$ac_prev"; then
   ac_option=--`echo $ac_prev | sed 's/_/-/g'`
-  { $as_echo "$as_me: error: missing argument to $ac_option" >&2
-   { (exit 1); exit 1; }; }
+  as_fn_error "missing argument to $ac_option"
 fi
 
 if test -n "$ac_unrecognized_opts"; then
   case $enable_option_checking in
     no) ;;
-    fatal) { $as_echo "$as_me: error: unrecognized options: $ac_unrecognized_opts" >&2
-   { (exit 1); exit 1; }; } ;;
+    fatal) as_fn_error "unrecognized options: $ac_unrecognized_opts" ;;
     *)     $as_echo "$as_me: WARNING: unrecognized options: $ac_unrecognized_opts" >&2 ;;
   esac
 fi
@@ -1229,8 +1178,7 @@
     [\\/$]* | ?:[\\/]* )  continue;;
     NONE | '' ) case $ac_var in *prefix ) continue;; esac;;
   esac
-  { $as_echo "$as_me: error: expected an absolute directory name for --$ac_var: $ac_val" >&2
-   { (exit 1); exit 1; }; }
+  as_fn_error "expected an absolute directory name for --$ac_var: $ac_val"
 done
 
 # There might be people who depend on the old broken behavior: `$host'
@@ -1260,11 +1208,9 @@
 ac_pwd=`pwd` && test -n "$ac_pwd" &&
 ac_ls_di=`ls -di .` &&
 ac_pwd_ls_di=`cd "$ac_pwd" && ls -di .` ||
-  { $as_echo "$as_me: error: working directory cannot be determined" >&2
-   { (exit 1); exit 1; }; }
+  as_fn_error "working directory cannot be determined"
 test "X$ac_ls_di" = "X$ac_pwd_ls_di" ||
-  { $as_echo "$as_me: error: pwd does not report name of working directory" >&2
-   { (exit 1); exit 1; }; }
+  as_fn_error "pwd does not report name of working directory"
 
 
 # Find the source files, if location was not specified.
@@ -1303,13 +1249,11 @@
 fi
 if test ! -r "$srcdir/$ac_unique_file"; then
   test "$ac_srcdir_defaulted" = yes && srcdir="$ac_confdir or .."
-  { $as_echo "$as_me: error: cannot find sources ($ac_unique_file) in $srcdir" >&2
-   { (exit 1); exit 1; }; }
+  as_fn_error "cannot find sources ($ac_unique_file) in $srcdir"
 fi
 ac_msg="sources are in $srcdir, but \`cd $srcdir' does not work"
 ac_abs_confdir=`(
-	cd "$srcdir" && test -r "./$ac_unique_file" || { $as_echo "$as_me: error: $ac_msg" >&2
-   { (exit 1); exit 1; }; }
+	cd "$srcdir" && test -r "./$ac_unique_file" || as_fn_error "$ac_msg"
 	pwd)`
 # When building in place, set srcdir=.
 if test "$ac_abs_confdir" = "$ac_pwd"; then
@@ -1428,6 +1372,7 @@
 --with-tclcl=path	specify a pathname for TclCL (the ex-libTcl)
 --with-tcldebug=path specify a pathname for the tcl debugger (path=no disables the debugger)
 --with-dmalloc=path specify a pathname for the dmalloc debugger (path=no disables the dmalloc)
+--with-click=path specify a pathname for the click modular router
 --with-perl=path specify a pathname for perl
 
 Some influential environment variables:
@@ -1445,6 +1390,7 @@
 Use these variables to override the choices made by `configure' or to help
 it to find libraries and programs with nonstandard names/locations.
 
+Report bugs to the package provider.
 _ACEOF
 ac_status=$?
 fi
@@ -1508,1308 +1454,1750 @@
 if $ac_init_version; then
   cat <<\_ACEOF
 configure
-generated by GNU Autoconf 2.63
+generated by GNU Autoconf 2.64
 
-Copyright (C) 1992, 1993, 1994, 1995, 1996, 1998, 1999, 2000, 2001,
-2002, 2003, 2004, 2005, 2006, 2007, 2008 Free Software Foundation, Inc.
+Copyright (C) 2009 Free Software Foundation, Inc.
 This configure script is free software; the Free Software Foundation
 gives unlimited permission to copy, distribute and modify it.
 _ACEOF
   exit
 fi
-cat >config.log <<_ACEOF
-This file contains any messages produced by compilers while
-running configure, to aid debugging if configure makes a mistake.
 
-It was created by $as_me, which was
-generated by GNU Autoconf 2.63.  Invocation command line was
+## ------------------------ ##
+## Autoconf initialization. ##
+## ------------------------ ##
+
+# ac_fn_c_try_compile LINENO
+# --------------------------
+# Try to compile conftest.$ac_ext, and return whether this succeeded.
+ac_fn_c_try_compile ()
+{
+  as_lineno=${as_lineno-"$1"} as_lineno_stack=as_lineno_stack=$as_lineno_stack
+  rm -f conftest.$ac_objext
+  if { { ac_try="$ac_compile"
+case "(($ac_try" in
+  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
+  *) ac_try_echo=$ac_try;;
+esac
+eval ac_try_echo="\"\$as_me:${as_lineno-$LINENO}: $ac_try_echo\""
+$as_echo "$ac_try_echo"; } >&5
+  (eval "$ac_compile") 2>conftest.err
+  ac_status=$?
+  if test -s conftest.err; then
+    grep -v '^ *+' conftest.err >conftest.er1
+    cat conftest.er1 >&5
+    mv -f conftest.er1 conftest.err
+  fi
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; } && {
+	 test -z "$ac_c_werror_flag" ||
+	 test ! -s conftest.err
+       } && test -s conftest.$ac_objext; then :
+  ac_retval=0
+else
+  $as_echo "$as_me: failed program was:" >&5
+sed 's/^/| /' conftest.$ac_ext >&5
 
-  $ $0 $@
+	ac_retval=1
+fi
+  eval $as_lineno_stack; test "x$as_lineno_stack" = x && { as_lineno=; unset as_lineno;}
+  return $ac_retval
 
-_ACEOF
-exec 5>>config.log
+} # ac_fn_c_try_compile
+
+# ac_fn_c_try_cpp LINENO
+# ----------------------
+# Try to preprocess conftest.$ac_ext, and return whether this succeeded.
+ac_fn_c_try_cpp ()
 {
-cat <<_ASUNAME
-## --------- ##
-## Platform. ##
-## --------- ##
+  as_lineno=${as_lineno-"$1"} as_lineno_stack=as_lineno_stack=$as_lineno_stack
+  if { { ac_try="$ac_cpp conftest.$ac_ext"
+case "(($ac_try" in
+  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
+  *) ac_try_echo=$ac_try;;
+esac
+eval ac_try_echo="\"\$as_me:${as_lineno-$LINENO}: $ac_try_echo\""
+$as_echo "$ac_try_echo"; } >&5
+  (eval "$ac_cpp conftest.$ac_ext") 2>conftest.err
+  ac_status=$?
+  if test -s conftest.err; then
+    grep -v '^ *+' conftest.err >conftest.er1
+    cat conftest.er1 >&5
+    mv -f conftest.er1 conftest.err
+  fi
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; } >/dev/null && {
+	 test -z "$ac_c_preproc_warn_flag$ac_c_werror_flag" ||
+	 test ! -s conftest.err
+       }; then :
+  ac_retval=0
+else
+  $as_echo "$as_me: failed program was:" >&5
+sed 's/^/| /' conftest.$ac_ext >&5
 
-hostname = `(hostname || uname -n) 2>/dev/null | sed 1q`
-uname -m = `(uname -m) 2>/dev/null || echo unknown`
-uname -r = `(uname -r) 2>/dev/null || echo unknown`
-uname -s = `(uname -s) 2>/dev/null || echo unknown`
-uname -v = `(uname -v) 2>/dev/null || echo unknown`
+    ac_retval=1
+fi
+  eval $as_lineno_stack; test "x$as_lineno_stack" = x && { as_lineno=; unset as_lineno;}
+  return $ac_retval
 
-/usr/bin/uname -p = `(/usr/bin/uname -p) 2>/dev/null || echo unknown`
-/bin/uname -X     = `(/bin/uname -X) 2>/dev/null     || echo unknown`
+} # ac_fn_c_try_cpp
 
-/bin/arch              = `(/bin/arch) 2>/dev/null              || echo unknown`
-/usr/bin/arch -k       = `(/usr/bin/arch -k) 2>/dev/null       || echo unknown`
-/usr/convex/getsysinfo = `(/usr/convex/getsysinfo) 2>/dev/null || echo unknown`
-/usr/bin/hostinfo      = `(/usr/bin/hostinfo) 2>/dev/null      || echo unknown`
-/bin/machine           = `(/bin/machine) 2>/dev/null           || echo unknown`
-/usr/bin/oslevel       = `(/usr/bin/oslevel) 2>/dev/null       || echo unknown`
-/bin/universe          = `(/bin/universe) 2>/dev/null          || echo unknown`
+# ac_fn_c_check_header_mongrel LINENO HEADER VAR INCLUDES
+# -------------------------------------------------------
+# Tests whether HEADER exists, giving a warning if it cannot be compiled using
+# the include files in INCLUDES and setting the cache variable VAR
+# accordingly.
+ac_fn_c_check_header_mongrel ()
+{
+  as_lineno=${as_lineno-"$1"} as_lineno_stack=as_lineno_stack=$as_lineno_stack
+  if { as_var=$3; eval "test \"\${$as_var+set}\" = set"; }; then :
+  { $as_echo "$as_me:${as_lineno-$LINENO}: checking for $2" >&5
+$as_echo_n "checking for $2... " >&6; }
+if { as_var=$3; eval "test \"\${$as_var+set}\" = set"; }; then :
+  $as_echo_n "(cached) " >&6
+fi
+eval ac_res=\$$3
+	       { $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_res" >&5
+$as_echo "$ac_res" >&6; }
+else
+  # Is the header compilable?
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking $2 usability" >&5
+$as_echo_n "checking $2 usability... " >&6; }
+cat confdefs.h - <<_ACEOF >conftest.$ac_ext
+/* end confdefs.h.  */
+$4
+#include <$2>
+_ACEOF
+if ac_fn_c_try_compile "$LINENO"; then :
+  ac_header_compiler=yes
+else
+  ac_header_compiler=no
+fi
+rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_header_compiler" >&5
+$as_echo "$ac_header_compiler" >&6; }
 
-_ASUNAME
+# Is the header present?
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking $2 presence" >&5
+$as_echo_n "checking $2 presence... " >&6; }
+cat confdefs.h - <<_ACEOF >conftest.$ac_ext
+/* end confdefs.h.  */
+#include <$2>
+_ACEOF
+if ac_fn_c_try_cpp "$LINENO"; then :
+  ac_header_preproc=yes
+else
+  ac_header_preproc=no
+fi
+rm -f conftest.err conftest.$ac_ext
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_header_preproc" >&5
+$as_echo "$ac_header_preproc" >&6; }
 
-as_save_IFS=$IFS; IFS=$PATH_SEPARATOR
-for as_dir in $PATH
-do
-  IFS=$as_save_IFS
-  test -z "$as_dir" && as_dir=.
-  $as_echo "PATH: $as_dir"
-done
-IFS=$as_save_IFS
+# So?  What about this header?
+case $ac_header_compiler:$ac_header_preproc:$ac_c_preproc_warn_flag in #((
+  yes:no: )
+    { $as_echo "$as_me:${as_lineno-$LINENO}: WARNING: $2: accepted by the compiler, rejected by the preprocessor!" >&5
+$as_echo "$as_me: WARNING: $2: accepted by the compiler, rejected by the preprocessor!" >&2;}
+    { $as_echo "$as_me:${as_lineno-$LINENO}: WARNING: $2: proceeding with the compiler's result" >&5
+$as_echo "$as_me: WARNING: $2: proceeding with the compiler's result" >&2;}
+    ;;
+  no:yes:* )
+    { $as_echo "$as_me:${as_lineno-$LINENO}: WARNING: $2: present but cannot be compiled" >&5
+$as_echo "$as_me: WARNING: $2: present but cannot be compiled" >&2;}
+    { $as_echo "$as_me:${as_lineno-$LINENO}: WARNING: $2:     check for missing prerequisite headers?" >&5
+$as_echo "$as_me: WARNING: $2:     check for missing prerequisite headers?" >&2;}
+    { $as_echo "$as_me:${as_lineno-$LINENO}: WARNING: $2: see the Autoconf documentation" >&5
+$as_echo "$as_me: WARNING: $2: see the Autoconf documentation" >&2;}
+    { $as_echo "$as_me:${as_lineno-$LINENO}: WARNING: $2:     section \"Present But Cannot Be Compiled\"" >&5
+$as_echo "$as_me: WARNING: $2:     section \"Present But Cannot Be Compiled\"" >&2;}
+    { $as_echo "$as_me:${as_lineno-$LINENO}: WARNING: $2: proceeding with the compiler's result" >&5
+$as_echo "$as_me: WARNING: $2: proceeding with the compiler's result" >&2;}
+    ;;
+esac
+  { $as_echo "$as_me:${as_lineno-$LINENO}: checking for $2" >&5
+$as_echo_n "checking for $2... " >&6; }
+if { as_var=$3; eval "test \"\${$as_var+set}\" = set"; }; then :
+  $as_echo_n "(cached) " >&6
+else
+  eval "$3=\$ac_header_compiler"
+fi
+eval ac_res=\$$3
+	       { $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_res" >&5
+$as_echo "$ac_res" >&6; }
+fi
+  eval $as_lineno_stack; test "x$as_lineno_stack" = x && { as_lineno=; unset as_lineno;}
 
-} >&5
+} # ac_fn_c_check_header_mongrel
 
-cat >&5 <<_ACEOF
+# ac_fn_c_try_run LINENO
+# ----------------------
+# Try to link conftest.$ac_ext, and return whether this succeeded. Assumes
+# that executables *can* be run.
+ac_fn_c_try_run ()
+{
+  as_lineno=${as_lineno-"$1"} as_lineno_stack=as_lineno_stack=$as_lineno_stack
+  if { { ac_try="$ac_link"
+case "(($ac_try" in
+  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
+  *) ac_try_echo=$ac_try;;
+esac
+eval ac_try_echo="\"\$as_me:${as_lineno-$LINENO}: $ac_try_echo\""
+$as_echo "$ac_try_echo"; } >&5
+  (eval "$ac_link") 2>&5
+  ac_status=$?
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; } && { ac_try='./conftest$ac_exeext'
+  { { case "(($ac_try" in
+  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
+  *) ac_try_echo=$ac_try;;
+esac
+eval ac_try_echo="\"\$as_me:${as_lineno-$LINENO}: $ac_try_echo\""
+$as_echo "$ac_try_echo"; } >&5
+  (eval "$ac_try") 2>&5
+  ac_status=$?
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }; }; then :
+  ac_retval=0
+else
+  $as_echo "$as_me: program exited with status $ac_status" >&5
+       $as_echo "$as_me: failed program was:" >&5
+sed 's/^/| /' conftest.$ac_ext >&5
 
+       ac_retval=$ac_status
+fi
+  rm -rf conftest.dSYM conftest_ipa8_conftest.oo
+  eval $as_lineno_stack; test "x$as_lineno_stack" = x && { as_lineno=; unset as_lineno;}
+  return $ac_retval
 
-## ----------- ##
-## Core tests. ##
-## ----------- ##
+} # ac_fn_c_try_run
 
+# ac_fn_c_check_header_compile LINENO HEADER VAR INCLUDES
+# -------------------------------------------------------
+# Tests whether HEADER exists and can be compiled using the include files in
+# INCLUDES, setting the cache variable VAR accordingly.
+ac_fn_c_check_header_compile ()
+{
+  as_lineno=${as_lineno-"$1"} as_lineno_stack=as_lineno_stack=$as_lineno_stack
+  { $as_echo "$as_me:${as_lineno-$LINENO}: checking for $2" >&5
+$as_echo_n "checking for $2... " >&6; }
+if { as_var=$3; eval "test \"\${$as_var+set}\" = set"; }; then :
+  $as_echo_n "(cached) " >&6
+else
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
+/* end confdefs.h.  */
+$4
+#include <$2>
 _ACEOF
+if ac_fn_c_try_compile "$LINENO"; then :
+  eval "$3=yes"
+else
+  eval "$3=no"
+fi
+rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
+fi
+eval ac_res=\$$3
+	       { $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_res" >&5
+$as_echo "$ac_res" >&6; }
+  eval $as_lineno_stack; test "x$as_lineno_stack" = x && { as_lineno=; unset as_lineno;}
 
+} # ac_fn_c_check_header_compile
 
-# Keep a trace of the command line.
-# Strip out --no-create and --no-recursion so they do not pile up.
-# Strip out --silent because we don't want to record it for future runs.
-# Also quote any args containing shell meta-characters.
-# Make two passes to allow for proper duplicate-argument suppression.
-ac_configure_args=
-ac_configure_args0=
-ac_configure_args1=
-ac_must_keep_next=false
-for ac_pass in 1 2
-do
-  for ac_arg
-  do
-    case $ac_arg in
-    -no-create | --no-c* | -n | -no-recursion | --no-r*) continue ;;
-    -q | -quiet | --quiet | --quie | --qui | --qu | --q \
-    | -silent | --silent | --silen | --sile | --sil)
-      continue ;;
-    *\'*)
-      ac_arg=`$as_echo "$ac_arg" | sed "s/'/'\\\\\\\\''/g"` ;;
-    esac
-    case $ac_pass in
-    1) ac_configure_args0="$ac_configure_args0 '$ac_arg'" ;;
-    2)
-      ac_configure_args1="$ac_configure_args1 '$ac_arg'"
-      if test $ac_must_keep_next = true; then
-	ac_must_keep_next=false # Got value, back to normal.
-      else
-	case $ac_arg in
-	  *=* | --config-cache | -C | -disable-* | --disable-* \
-	  | -enable-* | --enable-* | -gas | --g* | -nfp | --nf* \
-	  | -q | -quiet | --q* | -silent | --sil* | -v | -verb* \
-	  | -with-* | --with-* | -without-* | --without-* | --x)
-	    case "$ac_configure_args0 " in
-	      "$ac_configure_args1"*" '$ac_arg' "* ) continue ;;
-	    esac
-	    ;;
-	  -* ) ac_must_keep_next=true ;;
-	esac
-      fi
-      ac_configure_args="$ac_configure_args '$ac_arg'"
-      ;;
-    esac
-  done
-done
-$as_unset ac_configure_args0 || test "${ac_configure_args0+set}" != set || { ac_configure_args0=; export ac_configure_args0; }
-$as_unset ac_configure_args1 || test "${ac_configure_args1+set}" != set || { ac_configure_args1=; export ac_configure_args1; }
-
-# When interrupted or exit'd, cleanup temporary files, and complete
-# config.log.  We remove comments because anyway the quotes in there
-# would cause problems or look ugly.
-# WARNING: Use '\'' to represent an apostrophe within the trap.
-# WARNING: Do not start the trap code with a newline, due to a FreeBSD 4.0 bug.
-trap 'exit_status=$?
-  # Save into config.log some information that might help in debugging.
-  {
-    echo
+# ac_fn_cxx_try_compile LINENO
+# ----------------------------
+# Try to compile conftest.$ac_ext, and return whether this succeeded.
+ac_fn_cxx_try_compile ()
+{
+  as_lineno=${as_lineno-"$1"} as_lineno_stack=as_lineno_stack=$as_lineno_stack
+  rm -f conftest.$ac_objext
+  if { { ac_try="$ac_compile"
+case "(($ac_try" in
+  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
+  *) ac_try_echo=$ac_try;;
+esac
+eval ac_try_echo="\"\$as_me:${as_lineno-$LINENO}: $ac_try_echo\""
+$as_echo "$ac_try_echo"; } >&5
+  (eval "$ac_compile") 2>conftest.err
+  ac_status=$?
+  if test -s conftest.err; then
+    grep -v '^ *+' conftest.err >conftest.er1
+    cat conftest.er1 >&5
+    mv -f conftest.er1 conftest.err
+  fi
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; } && {
+	 test -z "$ac_cxx_werror_flag" ||
+	 test ! -s conftest.err
+       } && test -s conftest.$ac_objext; then :
+  ac_retval=0
+else
+  $as_echo "$as_me: failed program was:" >&5
+sed 's/^/| /' conftest.$ac_ext >&5
 
-    cat <<\_ASBOX
-## ---------------- ##
-## Cache variables. ##
-## ---------------- ##
-_ASBOX
-    echo
-    # The following way of writing the cache mishandles newlines in values,
-(
-  for ac_var in `(set) 2>&1 | sed -n '\''s/^\([a-zA-Z_][a-zA-Z0-9_]*\)=.*/\1/p'\''`; do
-    eval ac_val=\$$ac_var
-    case $ac_val in #(
-    *${as_nl}*)
-      case $ac_var in #(
-      *_cv_*) { $as_echo "$as_me:$LINENO: WARNING: cache variable $ac_var contains a newline" >&5
-$as_echo "$as_me: WARNING: cache variable $ac_var contains a newline" >&2;} ;;
-      esac
-      case $ac_var in #(
-      _ | IFS | as_nl) ;; #(
-      BASH_ARGV | BASH_SOURCE) eval $ac_var= ;; #(
-      *) $as_unset $ac_var ;;
-      esac ;;
-    esac
-  done
-  (set) 2>&1 |
-    case $as_nl`(ac_space='\'' '\''; set) 2>&1` in #(
-    *${as_nl}ac_space=\ *)
-      sed -n \
-	"s/'\''/'\''\\\\'\'''\''/g;
-	  s/^\\([_$as_cr_alnum]*_cv_[_$as_cr_alnum]*\\)=\\(.*\\)/\\1='\''\\2'\''/p"
-      ;; #(
-    *)
-      sed -n "/^[_$as_cr_alnum]*_cv_[_$as_cr_alnum]*=/p"
-      ;;
-    esac |
-    sort
-)
-    echo
+	ac_retval=1
+fi
+  eval $as_lineno_stack; test "x$as_lineno_stack" = x && { as_lineno=; unset as_lineno;}
+  return $ac_retval
 
-    cat <<\_ASBOX
-## ----------------- ##
-## Output variables. ##
-## ----------------- ##
-_ASBOX
-    echo
-    for ac_var in $ac_subst_vars
-    do
-      eval ac_val=\$$ac_var
-      case $ac_val in
-      *\'\''*) ac_val=`$as_echo "$ac_val" | sed "s/'\''/'\''\\\\\\\\'\'''\''/g"`;;
-      esac
-      $as_echo "$ac_var='\''$ac_val'\''"
-    done | sort
-    echo
+} # ac_fn_cxx_try_compile
 
-    if test -n "$ac_subst_files"; then
-      cat <<\_ASBOX
-## ------------------- ##
-## File substitutions. ##
-## ------------------- ##
-_ASBOX
-      echo
-      for ac_var in $ac_subst_files
-      do
-	eval ac_val=\$$ac_var
-	case $ac_val in
-	*\'\''*) ac_val=`$as_echo "$ac_val" | sed "s/'\''/'\''\\\\\\\\'\'''\''/g"`;;
-	esac
-	$as_echo "$ac_var='\''$ac_val'\''"
-      done | sort
-      echo
-    fi
+# ac_fn_c_try_link LINENO
+# -----------------------
+# Try to link conftest.$ac_ext, and return whether this succeeded.
+ac_fn_c_try_link ()
+{
+  as_lineno=${as_lineno-"$1"} as_lineno_stack=as_lineno_stack=$as_lineno_stack
+  rm -f conftest.$ac_objext conftest$ac_exeext
+  if { { ac_try="$ac_link"
+case "(($ac_try" in
+  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
+  *) ac_try_echo=$ac_try;;
+esac
+eval ac_try_echo="\"\$as_me:${as_lineno-$LINENO}: $ac_try_echo\""
+$as_echo "$ac_try_echo"; } >&5
+  (eval "$ac_link") 2>conftest.err
+  ac_status=$?
+  if test -s conftest.err; then
+    grep -v '^ *+' conftest.err >conftest.er1
+    cat conftest.er1 >&5
+    mv -f conftest.er1 conftest.err
+  fi
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; } && {
+	 test -z "$ac_c_werror_flag" ||
+	 test ! -s conftest.err
+       } && test -s conftest$ac_exeext && {
+	 test "$cross_compiling" = yes ||
+	 $as_test_x conftest$ac_exeext
+       }; then :
+  ac_retval=0
+else
+  $as_echo "$as_me: failed program was:" >&5
+sed 's/^/| /' conftest.$ac_ext >&5
 
-    if test -s confdefs.h; then
-      cat <<\_ASBOX
-## ----------- ##
-## confdefs.h. ##
-## ----------- ##
-_ASBOX
-      echo
-      cat confdefs.h
-      echo
-    fi
-    test "$ac_signal" != 0 &&
-      $as_echo "$as_me: caught signal $ac_signal"
-    $as_echo "$as_me: exit $exit_status"
-  } >&5
-  rm -f core *.core core.conftest.* &&
-    rm -f -r conftest* confdefs* conf$$* $ac_clean_files &&
-    exit $exit_status
-' 0
-for ac_signal in 1 2 13 15; do
-  trap 'ac_signal='$ac_signal'; { (exit 1); exit 1; }' $ac_signal
-done
-ac_signal=0
+	ac_retval=1
+fi
+  # Delete the IPA/IPO (Inter Procedural Analysis/Optimization) information
+  # created by the PGI compiler (conftest_ipa8_conftest.oo), as it would
+  # interfere with the next link command; also delete a directory that is
+  # left behind by Apple's compiler.  We do this before executing the actions.
+  rm -rf conftest.dSYM conftest_ipa8_conftest.oo
+  eval $as_lineno_stack; test "x$as_lineno_stack" = x && { as_lineno=; unset as_lineno;}
+  return $ac_retval
 
-# confdefs.h avoids OS command line length limits that DEFS can exceed.
-rm -f -r conftest* confdefs.h
+} # ac_fn_c_try_link
 
-# Predefined preprocessor variables.
+# ac_fn_c_check_func LINENO FUNC VAR
+# ----------------------------------
+# Tests whether FUNC exists, setting the cache variable VAR accordingly
+ac_fn_c_check_func ()
+{
+  as_lineno=${as_lineno-"$1"} as_lineno_stack=as_lineno_stack=$as_lineno_stack
+  { $as_echo "$as_me:${as_lineno-$LINENO}: checking for $2" >&5
+$as_echo_n "checking for $2... " >&6; }
+if { as_var=$3; eval "test \"\${$as_var+set}\" = set"; }; then :
+  $as_echo_n "(cached) " >&6
+else
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
+/* end confdefs.h.  */
+/* Define $2 to an innocuous variant, in case <limits.h> declares $2.
+   For example, HP-UX 11i <limits.h> declares gettimeofday.  */
+#define $2 innocuous_$2
 
-cat >>confdefs.h <<_ACEOF
-#define PACKAGE_NAME "$PACKAGE_NAME"
-_ACEOF
+/* System header to define __stub macros and hopefully few prototypes,
+    which can conflict with char $2 (); below.
+    Prefer <limits.h> to <assert.h> if __STDC__ is defined, since
+    <limits.h> exists even on freestanding compilers.  */
 
+#ifdef __STDC__
+# include <limits.h>
+#else
+# include <assert.h>
+#endif
 
-cat >>confdefs.h <<_ACEOF
-#define PACKAGE_TARNAME "$PACKAGE_TARNAME"
-_ACEOF
+#undef $2
 
+/* Override any GCC internal prototype to avoid an error.
+   Use char because int might match the return type of a GCC
+   builtin and then its argument prototype would still apply.  */
+#ifdef __cplusplus
+extern "C"
+#endif
+char $2 ();
+/* The GNU C library defines this for functions which it implements
+    to always fail with ENOSYS.  Some functions are actually named
+    something starting with __ and the normal name is an alias.  */
+#if defined __stub_$2 || defined __stub___$2
+choke me
+#endif
 
-cat >>confdefs.h <<_ACEOF
-#define PACKAGE_VERSION "$PACKAGE_VERSION"
+int
+main ()
+{
+return $2 ();
+  ;
+  return 0;
+}
 _ACEOF
+if ac_fn_c_try_link "$LINENO"; then :
+  eval "$3=yes"
+else
+  eval "$3=no"
+fi
+rm -f core conftest.err conftest.$ac_objext \
+    conftest$ac_exeext conftest.$ac_ext
+fi
+eval ac_res=\$$3
+	       { $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_res" >&5
+$as_echo "$ac_res" >&6; }
+  eval $as_lineno_stack; test "x$as_lineno_stack" = x && { as_lineno=; unset as_lineno;}
 
+} # ac_fn_c_check_func
 
-cat >>confdefs.h <<_ACEOF
-#define PACKAGE_STRING "$PACKAGE_STRING"
+# ac_fn_c_check_type LINENO TYPE VAR INCLUDES
+# -------------------------------------------
+# Tests whether TYPE exists after having included INCLUDES, setting cache
+# variable VAR accordingly.
+ac_fn_c_check_type ()
+{
+  as_lineno=${as_lineno-"$1"} as_lineno_stack=as_lineno_stack=$as_lineno_stack
+  { $as_echo "$as_me:${as_lineno-$LINENO}: checking for $2" >&5
+$as_echo_n "checking for $2... " >&6; }
+if { as_var=$3; eval "test \"\${$as_var+set}\" = set"; }; then :
+  $as_echo_n "(cached) " >&6
+else
+  eval "$3=no"
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
+/* end confdefs.h.  */
+$4
+int
+main ()
+{
+if (sizeof ($2))
+	 return 0;
+  ;
+  return 0;
+}
 _ACEOF
-
-
-cat >>confdefs.h <<_ACEOF
-#define PACKAGE_BUGREPORT "$PACKAGE_BUGREPORT"
+if ac_fn_c_try_compile "$LINENO"; then :
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
+/* end confdefs.h.  */
+$4
+int
+main ()
+{
+if (sizeof (($2)))
+	    return 0;
+  ;
+  return 0;
+}
 _ACEOF
+if ac_fn_c_try_compile "$LINENO"; then :
 
-
-# Let the site file select an alternate cache file if it wants to.
-# Prefer an explicitly selected file to automatically selected ones.
-ac_site_file1=NONE
-ac_site_file2=NONE
-if test -n "$CONFIG_SITE"; then
-  ac_site_file1=$CONFIG_SITE
-elif test "x$prefix" != xNONE; then
-  ac_site_file1=$prefix/share/config.site
-  ac_site_file2=$prefix/etc/config.site
 else
-  ac_site_file1=$ac_default_prefix/share/config.site
-  ac_site_file2=$ac_default_prefix/etc/config.site
+  eval "$3=yes"
 fi
-for ac_site_file in "$ac_site_file1" "$ac_site_file2"
-do
-  test "x$ac_site_file" = xNONE && continue
-  if test -r "$ac_site_file"; then
-    { $as_echo "$as_me:$LINENO: loading site script $ac_site_file" >&5
-$as_echo "$as_me: loading site script $ac_site_file" >&6;}
-    sed 's/^/| /' "$ac_site_file" >&5
-    . "$ac_site_file"
-  fi
-done
-
-if test -r "$cache_file"; then
-  # Some versions of bash will fail to source /dev/null (special
-  # files actually), so we avoid doing that.
-  if test -f "$cache_file"; then
-    { $as_echo "$as_me:$LINENO: loading cache $cache_file" >&5
-$as_echo "$as_me: loading cache $cache_file" >&6;}
-    case $cache_file in
-      [\\/]* | ?:[\\/]* ) . "$cache_file";;
-      *)                      . "./$cache_file";;
-    esac
-  fi
-else
-  { $as_echo "$as_me:$LINENO: creating cache $cache_file" >&5
-$as_echo "$as_me: creating cache $cache_file" >&6;}
-  >$cache_file
+rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
 fi
-
-# Check that the precious variables saved in the cache have kept the same
-# value.
-ac_cache_corrupted=false
-for ac_var in $ac_precious_vars; do
-  eval ac_old_set=\$ac_cv_env_${ac_var}_set
-  eval ac_new_set=\$ac_env_${ac_var}_set
-  eval ac_old_val=\$ac_cv_env_${ac_var}_value
-  eval ac_new_val=\$ac_env_${ac_var}_value
-  case $ac_old_set,$ac_new_set in
-    set,)
-      { $as_echo "$as_me:$LINENO: error: \`$ac_var' was set to \`$ac_old_val' in the previous run" >&5
-$as_echo "$as_me: error: \`$ac_var' was set to \`$ac_old_val' in the previous run" >&2;}
-      ac_cache_corrupted=: ;;
-    ,set)
-      { $as_echo "$as_me:$LINENO: error: \`$ac_var' was not set in the previous run" >&5
-$as_echo "$as_me: error: \`$ac_var' was not set in the previous run" >&2;}
-      ac_cache_corrupted=: ;;
-    ,);;
-    *)
-      if test "x$ac_old_val" != "x$ac_new_val"; then
-	# differences in whitespace do not lead to failure.
-	ac_old_val_w=`echo x $ac_old_val`
-	ac_new_val_w=`echo x $ac_new_val`
-	if test "$ac_old_val_w" != "$ac_new_val_w"; then
-	  { $as_echo "$as_me:$LINENO: error: \`$ac_var' has changed since the previous run:" >&5
-$as_echo "$as_me: error: \`$ac_var' has changed since the previous run:" >&2;}
-	  ac_cache_corrupted=:
-	else
-	  { $as_echo "$as_me:$LINENO: warning: ignoring whitespace changes in \`$ac_var' since the previous run:" >&5
-$as_echo "$as_me: warning: ignoring whitespace changes in \`$ac_var' since the previous run:" >&2;}
-	  eval $ac_var=\$ac_old_val
-	fi
-	{ $as_echo "$as_me:$LINENO:   former value:  \`$ac_old_val'" >&5
-$as_echo "$as_me:   former value:  \`$ac_old_val'" >&2;}
-	{ $as_echo "$as_me:$LINENO:   current value: \`$ac_new_val'" >&5
-$as_echo "$as_me:   current value: \`$ac_new_val'" >&2;}
-      fi;;
-  esac
-  # Pass precious variables to config.status.
-  if test "$ac_new_set" = set; then
-    case $ac_new_val in
-    *\'*) ac_arg=$ac_var=`$as_echo "$ac_new_val" | sed "s/'/'\\\\\\\\''/g"` ;;
-    *) ac_arg=$ac_var=$ac_new_val ;;
-    esac
-    case " $ac_configure_args " in
-      *" '$ac_arg' "*) ;; # Avoid dups.  Use of quotes ensures accuracy.
-      *) ac_configure_args="$ac_configure_args '$ac_arg'" ;;
-    esac
-  fi
-done
-if $ac_cache_corrupted; then
-  { $as_echo "$as_me:$LINENO: error: in \`$ac_pwd':" >&5
-$as_echo "$as_me: error: in \`$ac_pwd':" >&2;}
-  { $as_echo "$as_me:$LINENO: error: changes in the environment can compromise the build" >&5
-$as_echo "$as_me: error: changes in the environment can compromise the build" >&2;}
-  { { $as_echo "$as_me:$LINENO: error: run \`make distclean' and/or \`rm $cache_file' and start over" >&5
-$as_echo "$as_me: error: run \`make distclean' and/or \`rm $cache_file' and start over" >&2;}
-   { (exit 1); exit 1; }; }
+rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
 fi
+eval ac_res=\$$3
+	       { $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_res" >&5
+$as_echo "$ac_res" >&6; }
+  eval $as_lineno_stack; test "x$as_lineno_stack" = x && { as_lineno=; unset as_lineno;}
 
+} # ac_fn_c_check_type
 
+# ac_fn_c_compute_int LINENO EXPR VAR INCLUDES
+# --------------------------------------------
+# Tries to find the compile-time value of EXPR in a program that includes
+# INCLUDES, setting VAR accordingly. Returns whether the value could be
+# computed
+ac_fn_c_compute_int ()
+{
+  as_lineno=${as_lineno-"$1"} as_lineno_stack=as_lineno_stack=$as_lineno_stack
+  if test "$cross_compiling" = yes; then
+    # Depending upon the size, compute the lo and hi bounds.
+cat confdefs.h - <<_ACEOF >conftest.$ac_ext
+/* end confdefs.h.  */
+$4
+int
+main ()
+{
+static int test_array [1 - 2 * !(($2) >= 0)];
+test_array [0] = 0
 
+  ;
+  return 0;
+}
+_ACEOF
+if ac_fn_c_try_compile "$LINENO"; then :
+  ac_lo=0 ac_mid=0
+  while :; do
+    cat confdefs.h - <<_ACEOF >conftest.$ac_ext
+/* end confdefs.h.  */
+$4
+int
+main ()
+{
+static int test_array [1 - 2 * !(($2) <= $ac_mid)];
+test_array [0] = 0
 
+  ;
+  return 0;
+}
+_ACEOF
+if ac_fn_c_try_compile "$LINENO"; then :
+  ac_hi=$ac_mid; break
+else
+  as_fn_arith $ac_mid + 1 && ac_lo=$as_val
+			if test $ac_lo -le $ac_mid; then
+			  ac_lo= ac_hi=
+			  break
+			fi
+			as_fn_arith 2 '*' $ac_mid + 1 && ac_mid=$as_val
+fi
+rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
+  done
+else
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
+/* end confdefs.h.  */
+$4
+int
+main ()
+{
+static int test_array [1 - 2 * !(($2) < 0)];
+test_array [0] = 0
 
+  ;
+  return 0;
+}
+_ACEOF
+if ac_fn_c_try_compile "$LINENO"; then :
+  ac_hi=-1 ac_mid=-1
+  while :; do
+    cat confdefs.h - <<_ACEOF >conftest.$ac_ext
+/* end confdefs.h.  */
+$4
+int
+main ()
+{
+static int test_array [1 - 2 * !(($2) >= $ac_mid)];
+test_array [0] = 0
 
-
-
-
-
-
-
-
-
-
-
-
-ac_ext=c
-ac_cpp='$CPP $CPPFLAGS'
-ac_compile='$CC -c $CFLAGS $CPPFLAGS conftest.$ac_ext >&5'
-ac_link='$CC -o conftest$ac_exeext $CFLAGS $CPPFLAGS $LDFLAGS conftest.$ac_ext $LIBS >&5'
-ac_compiler_gnu=$ac_cv_c_compiler_gnu
-
-
-
-ac_ext=c
-ac_cpp='$CPP $CPPFLAGS'
-ac_compile='$CC -c $CFLAGS $CPPFLAGS conftest.$ac_ext >&5'
-ac_link='$CC -o conftest$ac_exeext $CFLAGS $CPPFLAGS $LDFLAGS conftest.$ac_ext $LIBS >&5'
-ac_compiler_gnu=$ac_cv_c_compiler_gnu
-if test -n "$ac_tool_prefix"; then
-  # Extract the first word of "${ac_tool_prefix}gcc", so it can be a program name with args.
-set dummy ${ac_tool_prefix}gcc; ac_word=$2
-{ $as_echo "$as_me:$LINENO: checking for $ac_word" >&5
-$as_echo_n "checking for $ac_word... " >&6; }
-if test "${ac_cv_prog_CC+set}" = set; then
-  $as_echo_n "(cached) " >&6
-else
-  if test -n "$CC"; then
-  ac_cv_prog_CC="$CC" # Let the user override the test.
+  ;
+  return 0;
+}
+_ACEOF
+if ac_fn_c_try_compile "$LINENO"; then :
+  ac_lo=$ac_mid; break
 else
-as_save_IFS=$IFS; IFS=$PATH_SEPARATOR
-for as_dir in $PATH
-do
-  IFS=$as_save_IFS
-  test -z "$as_dir" && as_dir=.
-  for ac_exec_ext in '' $ac_executable_extensions; do
-  if { test -f "$as_dir/$ac_word$ac_exec_ext" && $as_test_x "$as_dir/$ac_word$ac_exec_ext"; }; then
-    ac_cv_prog_CC="${ac_tool_prefix}gcc"
-    $as_echo "$as_me:$LINENO: found $as_dir/$ac_word$ac_exec_ext" >&5
-    break 2
-  fi
-done
-done
-IFS=$as_save_IFS
-
-fi
+  as_fn_arith '(' $ac_mid ')' - 1 && ac_hi=$as_val
+			if test $ac_mid -le $ac_hi; then
+			  ac_lo= ac_hi=
+			  break
+			fi
+			as_fn_arith 2 '*' $ac_mid && ac_mid=$as_val
 fi
-CC=$ac_cv_prog_CC
-if test -n "$CC"; then
-  { $as_echo "$as_me:$LINENO: result: $CC" >&5
-$as_echo "$CC" >&6; }
+rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
+  done
 else
-  { $as_echo "$as_me:$LINENO: result: no" >&5
-$as_echo "no" >&6; }
+  ac_lo= ac_hi=
 fi
-
-
+rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
 fi
-if test -z "$ac_cv_prog_CC"; then
-  ac_ct_CC=$CC
-  # Extract the first word of "gcc", so it can be a program name with args.
-set dummy gcc; ac_word=$2
-{ $as_echo "$as_me:$LINENO: checking for $ac_word" >&5
-$as_echo_n "checking for $ac_word... " >&6; }
-if test "${ac_cv_prog_ac_ct_CC+set}" = set; then
-  $as_echo_n "(cached) " >&6
-else
-  if test -n "$ac_ct_CC"; then
-  ac_cv_prog_ac_ct_CC="$ac_ct_CC" # Let the user override the test.
-else
-as_save_IFS=$IFS; IFS=$PATH_SEPARATOR
-for as_dir in $PATH
-do
-  IFS=$as_save_IFS
-  test -z "$as_dir" && as_dir=.
-  for ac_exec_ext in '' $ac_executable_extensions; do
-  if { test -f "$as_dir/$ac_word$ac_exec_ext" && $as_test_x "$as_dir/$ac_word$ac_exec_ext"; }; then
-    ac_cv_prog_ac_ct_CC="gcc"
-    $as_echo "$as_me:$LINENO: found $as_dir/$ac_word$ac_exec_ext" >&5
-    break 2
-  fi
-done
-done
-IFS=$as_save_IFS
+rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
+# Binary search between lo and hi bounds.
+while test "x$ac_lo" != "x$ac_hi"; do
+  as_fn_arith '(' $ac_hi - $ac_lo ')' / 2 + $ac_lo && ac_mid=$as_val
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
+/* end confdefs.h.  */
+$4
+int
+main ()
+{
+static int test_array [1 - 2 * !(($2) <= $ac_mid)];
+test_array [0] = 0
 
-fi
-fi
-ac_ct_CC=$ac_cv_prog_ac_ct_CC
-if test -n "$ac_ct_CC"; then
-  { $as_echo "$as_me:$LINENO: result: $ac_ct_CC" >&5
-$as_echo "$ac_ct_CC" >&6; }
+  ;
+  return 0;
+}
+_ACEOF
+if ac_fn_c_try_compile "$LINENO"; then :
+  ac_hi=$ac_mid
 else
-  { $as_echo "$as_me:$LINENO: result: no" >&5
-$as_echo "no" >&6; }
+  as_fn_arith '(' $ac_mid ')' + 1 && ac_lo=$as_val
 fi
+rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
+done
+case $ac_lo in #((
+?*) eval "$3=\$ac_lo"; ac_retval=0 ;;
+'') ac_retval=1 ;;
+esac
+  else
+    cat confdefs.h - <<_ACEOF >conftest.$ac_ext
+/* end confdefs.h.  */
+$4
+static long int longval () { return $2; }
+static unsigned long int ulongval () { return $2; }
+#include <stdio.h>
+#include <stdlib.h>
+int
+main ()
+{
 
-  if test "x$ac_ct_CC" = x; then
-    CC=""
+  FILE *f = fopen ("conftest.val", "w");
+  if (! f)
+    return 1;
+  if (($2) < 0)
+    {
+      long int i = longval ();
+      if (i != ($2))
+	return 1;
+      fprintf (f, "%ld", i);
+    }
   else
-    case $cross_compiling:$ac_tool_warned in
-yes:)
-{ $as_echo "$as_me:$LINENO: WARNING: using cross tools not prefixed with host triplet" >&5
-$as_echo "$as_me: WARNING: using cross tools not prefixed with host triplet" >&2;}
-ac_tool_warned=yes ;;
-esac
-    CC=$ac_ct_CC
-  fi
+    {
+      unsigned long int i = ulongval ();
+      if (i != ($2))
+	return 1;
+      fprintf (f, "%lu", i);
+    }
+  /* Do not output a trailing newline, as this causes \r\n confusion
+     on some platforms.  */
+  return ferror (f) || fclose (f) != 0;
+
+  ;
+  return 0;
+}
+_ACEOF
+if ac_fn_c_try_run "$LINENO"; then :
+  echo >>conftest.val; read $3 <conftest.val; ac_retval=0
 else
-  CC="$ac_cv_prog_CC"
+  ac_retval=1
 fi
+rm -f core *.core core.conftest.* gmon.out bb.out conftest$ac_exeext \
+  conftest.$ac_objext conftest.beam conftest.$ac_ext
+rm -f conftest.val
 
-if test -z "$CC"; then
-          if test -n "$ac_tool_prefix"; then
-    # Extract the first word of "${ac_tool_prefix}cc", so it can be a program name with args.
-set dummy ${ac_tool_prefix}cc; ac_word=$2
-{ $as_echo "$as_me:$LINENO: checking for $ac_word" >&5
-$as_echo_n "checking for $ac_word... " >&6; }
-if test "${ac_cv_prog_CC+set}" = set; then
-  $as_echo_n "(cached) " >&6
-else
-  if test -n "$CC"; then
-  ac_cv_prog_CC="$CC" # Let the user override the test.
-else
-as_save_IFS=$IFS; IFS=$PATH_SEPARATOR
-for as_dir in $PATH
-do
-  IFS=$as_save_IFS
-  test -z "$as_dir" && as_dir=.
-  for ac_exec_ext in '' $ac_executable_extensions; do
-  if { test -f "$as_dir/$ac_word$ac_exec_ext" && $as_test_x "$as_dir/$ac_word$ac_exec_ext"; }; then
-    ac_cv_prog_CC="${ac_tool_prefix}cc"
-    $as_echo "$as_me:$LINENO: found $as_dir/$ac_word$ac_exec_ext" >&5
-    break 2
   fi
-done
-done
-IFS=$as_save_IFS
+  eval $as_lineno_stack; test "x$as_lineno_stack" = x && { as_lineno=; unset as_lineno;}
+  return $ac_retval
 
-fi
-fi
-CC=$ac_cv_prog_CC
-if test -n "$CC"; then
-  { $as_echo "$as_me:$LINENO: result: $CC" >&5
-$as_echo "$CC" >&6; }
-else
-  { $as_echo "$as_me:$LINENO: result: no" >&5
-$as_echo "no" >&6; }
-fi
+} # ac_fn_c_compute_int
+cat >config.log <<_ACEOF
+This file contains any messages produced by compilers while
+running configure, to aid debugging if configure makes a mistake.
 
+It was created by $as_me, which was
+generated by GNU Autoconf 2.64.  Invocation command line was
+
+  $ $0 $@
+
+_ACEOF
+exec 5>>config.log
+{
+cat <<_ASUNAME
+## --------- ##
+## Platform. ##
+## --------- ##
+
+hostname = `(hostname || uname -n) 2>/dev/null | sed 1q`
+uname -m = `(uname -m) 2>/dev/null || echo unknown`
+uname -r = `(uname -r) 2>/dev/null || echo unknown`
+uname -s = `(uname -s) 2>/dev/null || echo unknown`
+uname -v = `(uname -v) 2>/dev/null || echo unknown`
+
+/usr/bin/uname -p = `(/usr/bin/uname -p) 2>/dev/null || echo unknown`
+/bin/uname -X     = `(/bin/uname -X) 2>/dev/null     || echo unknown`
+
+/bin/arch              = `(/bin/arch) 2>/dev/null              || echo unknown`
+/usr/bin/arch -k       = `(/usr/bin/arch -k) 2>/dev/null       || echo unknown`
+/usr/convex/getsysinfo = `(/usr/convex/getsysinfo) 2>/dev/null || echo unknown`
+/usr/bin/hostinfo      = `(/usr/bin/hostinfo) 2>/dev/null      || echo unknown`
+/bin/machine           = `(/bin/machine) 2>/dev/null           || echo unknown`
+/usr/bin/oslevel       = `(/usr/bin/oslevel) 2>/dev/null       || echo unknown`
+/bin/universe          = `(/bin/universe) 2>/dev/null          || echo unknown`
+
+_ASUNAME
 
-  fi
-fi
-if test -z "$CC"; then
-  # Extract the first word of "cc", so it can be a program name with args.
-set dummy cc; ac_word=$2
-{ $as_echo "$as_me:$LINENO: checking for $ac_word" >&5
-$as_echo_n "checking for $ac_word... " >&6; }
-if test "${ac_cv_prog_CC+set}" = set; then
-  $as_echo_n "(cached) " >&6
-else
-  if test -n "$CC"; then
-  ac_cv_prog_CC="$CC" # Let the user override the test.
-else
-  ac_prog_rejected=no
 as_save_IFS=$IFS; IFS=$PATH_SEPARATOR
 for as_dir in $PATH
 do
   IFS=$as_save_IFS
   test -z "$as_dir" && as_dir=.
-  for ac_exec_ext in '' $ac_executable_extensions; do
-  if { test -f "$as_dir/$ac_word$ac_exec_ext" && $as_test_x "$as_dir/$ac_word$ac_exec_ext"; }; then
-    if test "$as_dir/$ac_word$ac_exec_ext" = "/usr/ucb/cc"; then
-       ac_prog_rejected=yes
-       continue
-     fi
-    ac_cv_prog_CC="cc"
-    $as_echo "$as_me:$LINENO: found $as_dir/$ac_word$ac_exec_ext" >&5
-    break 2
-  fi
-done
-done
+    $as_echo "PATH: $as_dir"
+  done
 IFS=$as_save_IFS
 
-if test $ac_prog_rejected = yes; then
-  # We found a bogon in the path, so make sure we never use it.
-  set dummy $ac_cv_prog_CC
-  shift
-  if test $# != 0; then
-    # We chose a different compiler from the bogus one.
-    # However, it has the same basename, so the bogon will be chosen
-    # first if we set CC to just the basename; use the full file name.
-    shift
-    ac_cv_prog_CC="$as_dir/$ac_word${1+' '}$@"
-  fi
-fi
-fi
-fi
-CC=$ac_cv_prog_CC
-if test -n "$CC"; then
-  { $as_echo "$as_me:$LINENO: result: $CC" >&5
-$as_echo "$CC" >&6; }
-else
-  { $as_echo "$as_me:$LINENO: result: no" >&5
-$as_echo "no" >&6; }
-fi
+} >&5
 
+cat >&5 <<_ACEOF
 
-fi
-if test -z "$CC"; then
-  if test -n "$ac_tool_prefix"; then
-  for ac_prog in cl.exe
-  do
-    # Extract the first word of "$ac_tool_prefix$ac_prog", so it can be a program name with args.
-set dummy $ac_tool_prefix$ac_prog; ac_word=$2
-{ $as_echo "$as_me:$LINENO: checking for $ac_word" >&5
-$as_echo_n "checking for $ac_word... " >&6; }
-if test "${ac_cv_prog_CC+set}" = set; then
-  $as_echo_n "(cached) " >&6
-else
-  if test -n "$CC"; then
-  ac_cv_prog_CC="$CC" # Let the user override the test.
-else
-as_save_IFS=$IFS; IFS=$PATH_SEPARATOR
-for as_dir in $PATH
-do
-  IFS=$as_save_IFS
-  test -z "$as_dir" && as_dir=.
-  for ac_exec_ext in '' $ac_executable_extensions; do
-  if { test -f "$as_dir/$ac_word$ac_exec_ext" && $as_test_x "$as_dir/$ac_word$ac_exec_ext"; }; then
-    ac_cv_prog_CC="$ac_tool_prefix$ac_prog"
-    $as_echo "$as_me:$LINENO: found $as_dir/$ac_word$ac_exec_ext" >&5
-    break 2
-  fi
-done
-done
-IFS=$as_save_IFS
 
-fi
-fi
-CC=$ac_cv_prog_CC
-if test -n "$CC"; then
-  { $as_echo "$as_me:$LINENO: result: $CC" >&5
-$as_echo "$CC" >&6; }
-else
-  { $as_echo "$as_me:$LINENO: result: no" >&5
-$as_echo "no" >&6; }
-fi
+## ----------- ##
+## Core tests. ##
+## ----------- ##
 
+_ACEOF
 
-    test -n "$CC" && break
-  done
-fi
-if test -z "$CC"; then
-  ac_ct_CC=$CC
-  for ac_prog in cl.exe
-do
-  # Extract the first word of "$ac_prog", so it can be a program name with args.
-set dummy $ac_prog; ac_word=$2
-{ $as_echo "$as_me:$LINENO: checking for $ac_word" >&5
-$as_echo_n "checking for $ac_word... " >&6; }
-if test "${ac_cv_prog_ac_ct_CC+set}" = set; then
-  $as_echo_n "(cached) " >&6
-else
-  if test -n "$ac_ct_CC"; then
-  ac_cv_prog_ac_ct_CC="$ac_ct_CC" # Let the user override the test.
-else
-as_save_IFS=$IFS; IFS=$PATH_SEPARATOR
-for as_dir in $PATH
+
+# Keep a trace of the command line.
+# Strip out --no-create and --no-recursion so they do not pile up.
+# Strip out --silent because we don't want to record it for future runs.
+# Also quote any args containing shell meta-characters.
+# Make two passes to allow for proper duplicate-argument suppression.
+ac_configure_args=
+ac_configure_args0=
+ac_configure_args1=
+ac_must_keep_next=false
+for ac_pass in 1 2
 do
-  IFS=$as_save_IFS
-  test -z "$as_dir" && as_dir=.
-  for ac_exec_ext in '' $ac_executable_extensions; do
-  if { test -f "$as_dir/$ac_word$ac_exec_ext" && $as_test_x "$as_dir/$ac_word$ac_exec_ext"; }; then
-    ac_cv_prog_ac_ct_CC="$ac_prog"
-    $as_echo "$as_me:$LINENO: found $as_dir/$ac_word$ac_exec_ext" >&5
-    break 2
-  fi
-done
+  for ac_arg
+  do
+    case $ac_arg in
+    -no-create | --no-c* | -n | -no-recursion | --no-r*) continue ;;
+    -q | -quiet | --quiet | --quie | --qui | --qu | --q \
+    | -silent | --silent | --silen | --sile | --sil)
+      continue ;;
+    *\'*)
+      ac_arg=`$as_echo "$ac_arg" | sed "s/'/'\\\\\\\\''/g"` ;;
+    esac
+    case $ac_pass in
+    1) as_fn_append ac_configure_args0 " '$ac_arg'" ;;
+    2)
+      as_fn_append ac_configure_args1 " '$ac_arg'"
+      if test $ac_must_keep_next = true; then
+	ac_must_keep_next=false # Got value, back to normal.
+      else
+	case $ac_arg in
+	  *=* | --config-cache | -C | -disable-* | --disable-* \
+	  | -enable-* | --enable-* | -gas | --g* | -nfp | --nf* \
+	  | -q | -quiet | --q* | -silent | --sil* | -v | -verb* \
+	  | -with-* | --with-* | -without-* | --without-* | --x)
+	    case "$ac_configure_args0 " in
+	      "$ac_configure_args1"*" '$ac_arg' "* ) continue ;;
+	    esac
+	    ;;
+	  -* ) ac_must_keep_next=true ;;
+	esac
+      fi
+      as_fn_append ac_configure_args " '$ac_arg'"
+      ;;
+    esac
+  done
 done
-IFS=$as_save_IFS
+{ ac_configure_args0=; unset ac_configure_args0;}
+{ ac_configure_args1=; unset ac_configure_args1;}
 
-fi
-fi
-ac_ct_CC=$ac_cv_prog_ac_ct_CC
-if test -n "$ac_ct_CC"; then
-  { $as_echo "$as_me:$LINENO: result: $ac_ct_CC" >&5
-$as_echo "$ac_ct_CC" >&6; }
-else
-  { $as_echo "$as_me:$LINENO: result: no" >&5
-$as_echo "no" >&6; }
-fi
+# When interrupted or exit'd, cleanup temporary files, and complete
+# config.log.  We remove comments because anyway the quotes in there
+# would cause problems or look ugly.
+# WARNING: Use '\'' to represent an apostrophe within the trap.
+# WARNING: Do not start the trap code with a newline, due to a FreeBSD 4.0 bug.
+trap 'exit_status=$?
+  # Save into config.log some information that might help in debugging.
+  {
+    echo
 
+    cat <<\_ASBOX
+## ---------------- ##
+## Cache variables. ##
+## ---------------- ##
+_ASBOX
+    echo
+    # The following way of writing the cache mishandles newlines in values,
+(
+  for ac_var in `(set) 2>&1 | sed -n '\''s/^\([a-zA-Z_][a-zA-Z0-9_]*\)=.*/\1/p'\''`; do
+    eval ac_val=\$$ac_var
+    case $ac_val in #(
+    *${as_nl}*)
+      case $ac_var in #(
+      *_cv_*) { $as_echo "$as_me:${as_lineno-$LINENO}: WARNING: cache variable $ac_var contains a newline" >&5
+$as_echo "$as_me: WARNING: cache variable $ac_var contains a newline" >&2;} ;;
+      esac
+      case $ac_var in #(
+      _ | IFS | as_nl) ;; #(
+      BASH_ARGV | BASH_SOURCE) eval $ac_var= ;; #(
+      *) { eval $ac_var=; unset $ac_var;} ;;
+      esac ;;
+    esac
+  done
+  (set) 2>&1 |
+    case $as_nl`(ac_space='\'' '\''; set) 2>&1` in #(
+    *${as_nl}ac_space=\ *)
+      sed -n \
+	"s/'\''/'\''\\\\'\'''\''/g;
+	  s/^\\([_$as_cr_alnum]*_cv_[_$as_cr_alnum]*\\)=\\(.*\\)/\\1='\''\\2'\''/p"
+      ;; #(
+    *)
+      sed -n "/^[_$as_cr_alnum]*_cv_[_$as_cr_alnum]*=/p"
+      ;;
+    esac |
+    sort
+)
+    echo
 
-  test -n "$ac_ct_CC" && break
-done
+    cat <<\_ASBOX
+## ----------------- ##
+## Output variables. ##
+## ----------------- ##
+_ASBOX
+    echo
+    for ac_var in $ac_subst_vars
+    do
+      eval ac_val=\$$ac_var
+      case $ac_val in
+      *\'\''*) ac_val=`$as_echo "$ac_val" | sed "s/'\''/'\''\\\\\\\\'\'''\''/g"`;;
+      esac
+      $as_echo "$ac_var='\''$ac_val'\''"
+    done | sort
+    echo
 
-  if test "x$ac_ct_CC" = x; then
-    CC=""
-  else
-    case $cross_compiling:$ac_tool_warned in
-yes:)
-{ $as_echo "$as_me:$LINENO: WARNING: using cross tools not prefixed with host triplet" >&5
-$as_echo "$as_me: WARNING: using cross tools not prefixed with host triplet" >&2;}
-ac_tool_warned=yes ;;
-esac
-    CC=$ac_ct_CC
-  fi
-fi
+    if test -n "$ac_subst_files"; then
+      cat <<\_ASBOX
+## ------------------- ##
+## File substitutions. ##
+## ------------------- ##
+_ASBOX
+      echo
+      for ac_var in $ac_subst_files
+      do
+	eval ac_val=\$$ac_var
+	case $ac_val in
+	*\'\''*) ac_val=`$as_echo "$ac_val" | sed "s/'\''/'\''\\\\\\\\'\'''\''/g"`;;
+	esac
+	$as_echo "$ac_var='\''$ac_val'\''"
+      done | sort
+      echo
+    fi
 
-fi
+    if test -s confdefs.h; then
+      cat <<\_ASBOX
+## ----------- ##
+## confdefs.h. ##
+## ----------- ##
+_ASBOX
+      echo
+      cat confdefs.h
+      echo
+    fi
+    test "$ac_signal" != 0 &&
+      $as_echo "$as_me: caught signal $ac_signal"
+    $as_echo "$as_me: exit $exit_status"
+  } >&5
+  rm -f core *.core core.conftest.* &&
+    rm -f -r conftest* confdefs* conf$$* $ac_clean_files &&
+    exit $exit_status
+' 0
+for ac_signal in 1 2 13 15; do
+  trap 'ac_signal='$ac_signal'; as_fn_exit 1' $ac_signal
+done
+ac_signal=0
 
+# confdefs.h avoids OS command line length limits that DEFS can exceed.
+rm -f -r conftest* confdefs.h
 
-test -z "$CC" && { { $as_echo "$as_me:$LINENO: error: in \`$ac_pwd':" >&5
-$as_echo "$as_me: error: in \`$ac_pwd':" >&2;}
-{ { $as_echo "$as_me:$LINENO: error: no acceptable C compiler found in \$PATH
-See \`config.log' for more details." >&5
-$as_echo "$as_me: error: no acceptable C compiler found in \$PATH
-See \`config.log' for more details." >&2;}
-   { (exit 1); exit 1; }; }; }
+$as_echo "/* confdefs.h */" > confdefs.h
 
-# Provide some information about the compiler.
-$as_echo "$as_me:$LINENO: checking for C compiler version" >&5
-set X $ac_compile
-ac_compiler=$2
-{ (ac_try="$ac_compiler --version >&5"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compiler --version >&5") 2>&5
-  ac_status=$?
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); }
-{ (ac_try="$ac_compiler -v >&5"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compiler -v >&5") 2>&5
-  ac_status=$?
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); }
-{ (ac_try="$ac_compiler -V >&5"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compiler -V >&5") 2>&5
-  ac_status=$?
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); }
+# Predefined preprocessor variables.
 
-cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
+cat >>confdefs.h <<_ACEOF
+#define PACKAGE_NAME "$PACKAGE_NAME"
 _ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
-/* end confdefs.h.  */
 
-int
-main ()
-{
+cat >>confdefs.h <<_ACEOF
+#define PACKAGE_TARNAME "$PACKAGE_TARNAME"
+_ACEOF
 
-  ;
-  return 0;
-}
+cat >>confdefs.h <<_ACEOF
+#define PACKAGE_VERSION "$PACKAGE_VERSION"
 _ACEOF
-ac_clean_files_save=$ac_clean_files
-ac_clean_files="$ac_clean_files a.out a.out.dSYM a.exe b.out"
-# Try to create an executable without -o first, disregard a.out.
-# It will help us diagnose broken compilers, and finding out an intuition
-# of exeext.
-{ $as_echo "$as_me:$LINENO: checking for C compiler default output file name" >&5
-$as_echo_n "checking for C compiler default output file name... " >&6; }
-ac_link_default=`$as_echo "$ac_link" | sed 's/ -o *conftest[^ ]*//'`
 
-# The possible output files:
-ac_files="a.out conftest.exe conftest a.exe a_out.exe b.out conftest.*"
+cat >>confdefs.h <<_ACEOF
+#define PACKAGE_STRING "$PACKAGE_STRING"
+_ACEOF
 
-ac_rmfiles=
-for ac_file in $ac_files
-do
-  case $ac_file in
-    *.$ac_ext | *.xcoff | *.tds | *.d | *.pdb | *.xSYM | *.bb | *.bbg | *.map | *.inf | *.dSYM | *.o | *.obj ) ;;
-    * ) ac_rmfiles="$ac_rmfiles $ac_file";;
-  esac
-done
-rm -f $ac_rmfiles
+cat >>confdefs.h <<_ACEOF
+#define PACKAGE_BUGREPORT "$PACKAGE_BUGREPORT"
+_ACEOF
 
-if { (ac_try="$ac_link_default"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_link_default") 2>&5
-  ac_status=$?
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); }; then
-  # Autoconf-2.13 could set the ac_cv_exeext variable to `no'.
-# So ignore a value of `no', otherwise this would lead to `EXEEXT = no'
-# in a Makefile.  We should not override ac_cv_exeext if it was cached,
-# so that the user can short-circuit this test for compilers unknown to
-# Autoconf.
-for ac_file in $ac_files ''
+cat >>confdefs.h <<_ACEOF
+#define PACKAGE_URL "$PACKAGE_URL"
+_ACEOF
+
+
+# Let the site file select an alternate cache file if it wants to.
+# Prefer an explicitly selected file to automatically selected ones.
+ac_site_file1=NONE
+ac_site_file2=NONE
+if test -n "$CONFIG_SITE"; then
+  ac_site_file1=$CONFIG_SITE
+elif test "x$prefix" != xNONE; then
+  ac_site_file1=$prefix/share/config.site
+  ac_site_file2=$prefix/etc/config.site
+else
+  ac_site_file1=$ac_default_prefix/share/config.site
+  ac_site_file2=$ac_default_prefix/etc/config.site
+fi
+for ac_site_file in "$ac_site_file1" "$ac_site_file2"
 do
-  test -f "$ac_file" || continue
-  case $ac_file in
-    *.$ac_ext | *.xcoff | *.tds | *.d | *.pdb | *.xSYM | *.bb | *.bbg | *.map | *.inf | *.dSYM | *.o | *.obj )
-	;;
-    [ab].out )
-	# We found the default executable, but exeext='' is most
-	# certainly right.
-	break;;
-    *.* )
-        if test "${ac_cv_exeext+set}" = set && test "$ac_cv_exeext" != no;
-	then :; else
-	   ac_cv_exeext=`expr "$ac_file" : '[^.]*\(\..*\)'`
-	fi
-	# We set ac_cv_exeext here because the later test for it is not
-	# safe: cross compilers may not add the suffix if given an `-o'
-	# argument, so we may need to know it at that point already.
-	# Even if this section looks crufty: it has the advantage of
-	# actually working.
-	break;;
-    * )
-	break;;
-  esac
+  test "x$ac_site_file" = xNONE && continue
+  if test -r "$ac_site_file"; then
+    { $as_echo "$as_me:${as_lineno-$LINENO}: loading site script $ac_site_file" >&5
+$as_echo "$as_me: loading site script $ac_site_file" >&6;}
+    sed 's/^/| /' "$ac_site_file" >&5
+    . "$ac_site_file"
+  fi
 done
-test "$ac_cv_exeext" = no && ac_cv_exeext=
 
+if test -r "$cache_file"; then
+  # Some versions of bash will fail to source /dev/null (special
+  # files actually), so we avoid doing that.
+  if test -f "$cache_file"; then
+    { $as_echo "$as_me:${as_lineno-$LINENO}: loading cache $cache_file" >&5
+$as_echo "$as_me: loading cache $cache_file" >&6;}
+    case $cache_file in
+      [\\/]* | ?:[\\/]* ) . "$cache_file";;
+      *)                      . "./$cache_file";;
+    esac
+  fi
 else
-  ac_file=''
+  { $as_echo "$as_me:${as_lineno-$LINENO}: creating cache $cache_file" >&5
+$as_echo "$as_me: creating cache $cache_file" >&6;}
+  >$cache_file
 fi
 
-{ $as_echo "$as_me:$LINENO: result: $ac_file" >&5
-$as_echo "$ac_file" >&6; }
-if test -z "$ac_file"; then
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-{ { $as_echo "$as_me:$LINENO: error: in \`$ac_pwd':" >&5
+# Check that the precious variables saved in the cache have kept the same
+# value.
+ac_cache_corrupted=false
+for ac_var in $ac_precious_vars; do
+  eval ac_old_set=\$ac_cv_env_${ac_var}_set
+  eval ac_new_set=\$ac_env_${ac_var}_set
+  eval ac_old_val=\$ac_cv_env_${ac_var}_value
+  eval ac_new_val=\$ac_env_${ac_var}_value
+  case $ac_old_set,$ac_new_set in
+    set,)
+      { $as_echo "$as_me:${as_lineno-$LINENO}: error: \`$ac_var' was set to \`$ac_old_val' in the previous run" >&5
+$as_echo "$as_me: error: \`$ac_var' was set to \`$ac_old_val' in the previous run" >&2;}
+      ac_cache_corrupted=: ;;
+    ,set)
+      { $as_echo "$as_me:${as_lineno-$LINENO}: error: \`$ac_var' was not set in the previous run" >&5
+$as_echo "$as_me: error: \`$ac_var' was not set in the previous run" >&2;}
+      ac_cache_corrupted=: ;;
+    ,);;
+    *)
+      if test "x$ac_old_val" != "x$ac_new_val"; then
+	# differences in whitespace do not lead to failure.
+	ac_old_val_w=`echo x $ac_old_val`
+	ac_new_val_w=`echo x $ac_new_val`
+	if test "$ac_old_val_w" != "$ac_new_val_w"; then
+	  { $as_echo "$as_me:${as_lineno-$LINENO}: error: \`$ac_var' has changed since the previous run:" >&5
+$as_echo "$as_me: error: \`$ac_var' has changed since the previous run:" >&2;}
+	  ac_cache_corrupted=:
+	else
+	  { $as_echo "$as_me:${as_lineno-$LINENO}: warning: ignoring whitespace changes in \`$ac_var' since the previous run:" >&5
+$as_echo "$as_me: warning: ignoring whitespace changes in \`$ac_var' since the previous run:" >&2;}
+	  eval $ac_var=\$ac_old_val
+	fi
+	{ $as_echo "$as_me:${as_lineno-$LINENO}:   former value:  \`$ac_old_val'" >&5
+$as_echo "$as_me:   former value:  \`$ac_old_val'" >&2;}
+	{ $as_echo "$as_me:${as_lineno-$LINENO}:   current value: \`$ac_new_val'" >&5
+$as_echo "$as_me:   current value: \`$ac_new_val'" >&2;}
+      fi;;
+  esac
+  # Pass precious variables to config.status.
+  if test "$ac_new_set" = set; then
+    case $ac_new_val in
+    *\'*) ac_arg=$ac_var=`$as_echo "$ac_new_val" | sed "s/'/'\\\\\\\\''/g"` ;;
+    *) ac_arg=$ac_var=$ac_new_val ;;
+    esac
+    case " $ac_configure_args " in
+      *" '$ac_arg' "*) ;; # Avoid dups.  Use of quotes ensures accuracy.
+      *) as_fn_append ac_configure_args " '$ac_arg'" ;;
+    esac
+  fi
+done
+if $ac_cache_corrupted; then
+  { $as_echo "$as_me:${as_lineno-$LINENO}: error: in \`$ac_pwd':" >&5
 $as_echo "$as_me: error: in \`$ac_pwd':" >&2;}
-{ { $as_echo "$as_me:$LINENO: error: C compiler cannot create executables
-See \`config.log' for more details." >&5
-$as_echo "$as_me: error: C compiler cannot create executables
-See \`config.log' for more details." >&2;}
-   { (exit 77); exit 77; }; }; }
+  { $as_echo "$as_me:${as_lineno-$LINENO}: error: changes in the environment can compromise the build" >&5
+$as_echo "$as_me: error: changes in the environment can compromise the build" >&2;}
+  as_fn_error "run \`make distclean' and/or \`rm $cache_file' and start over" "$LINENO" 5
 fi
+## -------------------- ##
+## Main body of script. ##
+## -------------------- ##
 
-ac_exeext=$ac_cv_exeext
+ac_ext=c
+ac_cpp='$CPP $CPPFLAGS'
+ac_compile='$CC -c $CFLAGS $CPPFLAGS conftest.$ac_ext >&5'
+ac_link='$CC -o conftest$ac_exeext $CFLAGS $CPPFLAGS $LDFLAGS conftest.$ac_ext $LIBS >&5'
+ac_compiler_gnu=$ac_cv_c_compiler_gnu
 
-# Check that the compiler produces executables we can run.  If not, either
-# the compiler is broken, or we cross compile.
-{ $as_echo "$as_me:$LINENO: checking whether the C compiler works" >&5
-$as_echo_n "checking whether the C compiler works... " >&6; }
-# FIXME: These cross compiler hacks should be removed for Autoconf 3.0
-# If not cross compiling, check that we can run a simple program.
-if test "$cross_compiling" != yes; then
-  if { ac_try='./$ac_file'
-  { (case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_try") 2>&5
-  ac_status=$?
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); }; }; then
-    cross_compiling=no
-  else
-    if test "$cross_compiling" = maybe; then
-	cross_compiling=yes
-    else
-	{ { $as_echo "$as_me:$LINENO: error: in \`$ac_pwd':" >&5
-$as_echo "$as_me: error: in \`$ac_pwd':" >&2;}
-{ { $as_echo "$as_me:$LINENO: error: cannot run C compiled programs.
-If you meant to cross compile, use \`--host'.
-See \`config.log' for more details." >&5
-$as_echo "$as_me: error: cannot run C compiled programs.
-If you meant to cross compile, use \`--host'.
-See \`config.log' for more details." >&2;}
-   { (exit 1); exit 1; }; }; }
-    fi
-  fi
-fi
-{ $as_echo "$as_me:$LINENO: result: yes" >&5
-$as_echo "yes" >&6; }
 
-rm -f -r a.out a.out.dSYM a.exe conftest$ac_cv_exeext b.out
-ac_clean_files=$ac_clean_files_save
-# Check that the compiler produces executables we can run.  If not, either
-# the compiler is broken, or we cross compile.
-{ $as_echo "$as_me:$LINENO: checking whether we are cross compiling" >&5
-$as_echo_n "checking whether we are cross compiling... " >&6; }
-{ $as_echo "$as_me:$LINENO: result: $cross_compiling" >&5
-$as_echo "$cross_compiling" >&6; }
 
-{ $as_echo "$as_me:$LINENO: checking for suffix of executables" >&5
-$as_echo_n "checking for suffix of executables... " >&6; }
-if { (ac_try="$ac_link"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_link") 2>&5
-  ac_status=$?
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); }; then
-  # If both `conftest.exe' and `conftest' are `present' (well, observable)
-# catch `conftest.exe'.  For instance with Cygwin, `ls conftest' will
-# work properly (i.e., refer to `conftest.exe'), while it won't with
-# `rm'.
-for ac_file in conftest.exe conftest conftest.*; do
-  test -f "$ac_file" || continue
-  case $ac_file in
-    *.$ac_ext | *.xcoff | *.tds | *.d | *.pdb | *.xSYM | *.bb | *.bbg | *.map | *.inf | *.dSYM | *.o | *.obj ) ;;
-    *.* ) ac_cv_exeext=`expr "$ac_file" : '[^.]*\(\..*\)'`
-	  break;;
-    * ) break;;
-  esac
+ac_ext=c
+ac_cpp='$CPP $CPPFLAGS'
+ac_compile='$CC -c $CFLAGS $CPPFLAGS conftest.$ac_ext >&5'
+ac_link='$CC -o conftest$ac_exeext $CFLAGS $CPPFLAGS $LDFLAGS conftest.$ac_ext $LIBS >&5'
+ac_compiler_gnu=$ac_cv_c_compiler_gnu
+if test -n "$ac_tool_prefix"; then
+  # Extract the first word of "${ac_tool_prefix}gcc", so it can be a program name with args.
+set dummy ${ac_tool_prefix}gcc; ac_word=$2
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for $ac_word" >&5
+$as_echo_n "checking for $ac_word... " >&6; }
+if test "${ac_cv_prog_CC+set}" = set; then :
+  $as_echo_n "(cached) " >&6
+else
+  if test -n "$CC"; then
+  ac_cv_prog_CC="$CC" # Let the user override the test.
+else
+as_save_IFS=$IFS; IFS=$PATH_SEPARATOR
+for as_dir in $PATH
+do
+  IFS=$as_save_IFS
+  test -z "$as_dir" && as_dir=.
+    for ac_exec_ext in '' $ac_executable_extensions; do
+  if { test -f "$as_dir/$ac_word$ac_exec_ext" && $as_test_x "$as_dir/$ac_word$ac_exec_ext"; }; then
+    ac_cv_prog_CC="${ac_tool_prefix}gcc"
+    $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
+    break 2
+  fi
 done
+  done
+IFS=$as_save_IFS
+
+fi
+fi
+CC=$ac_cv_prog_CC
+if test -n "$CC"; then
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $CC" >&5
+$as_echo "$CC" >&6; }
 else
-  { { $as_echo "$as_me:$LINENO: error: in \`$ac_pwd':" >&5
-$as_echo "$as_me: error: in \`$ac_pwd':" >&2;}
-{ { $as_echo "$as_me:$LINENO: error: cannot compute suffix of executables: cannot compile and link
-See \`config.log' for more details." >&5
-$as_echo "$as_me: error: cannot compute suffix of executables: cannot compile and link
-See \`config.log' for more details." >&2;}
-   { (exit 1); exit 1; }; }; }
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
 fi
 
-rm -f conftest$ac_cv_exeext
-{ $as_echo "$as_me:$LINENO: result: $ac_cv_exeext" >&5
-$as_echo "$ac_cv_exeext" >&6; }
 
-rm -f conftest.$ac_ext
-EXEEXT=$ac_cv_exeext
-ac_exeext=$EXEEXT
-{ $as_echo "$as_me:$LINENO: checking for suffix of object files" >&5
-$as_echo_n "checking for suffix of object files... " >&6; }
-if test "${ac_cv_objext+set}" = set; then
+fi
+if test -z "$ac_cv_prog_CC"; then
+  ac_ct_CC=$CC
+  # Extract the first word of "gcc", so it can be a program name with args.
+set dummy gcc; ac_word=$2
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for $ac_word" >&5
+$as_echo_n "checking for $ac_word... " >&6; }
+if test "${ac_cv_prog_ac_ct_CC+set}" = set; then :
   $as_echo_n "(cached) " >&6
 else
-  cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
-/* end confdefs.h.  */
+  if test -n "$ac_ct_CC"; then
+  ac_cv_prog_ac_ct_CC="$ac_ct_CC" # Let the user override the test.
+else
+as_save_IFS=$IFS; IFS=$PATH_SEPARATOR
+for as_dir in $PATH
+do
+  IFS=$as_save_IFS
+  test -z "$as_dir" && as_dir=.
+    for ac_exec_ext in '' $ac_executable_extensions; do
+  if { test -f "$as_dir/$ac_word$ac_exec_ext" && $as_test_x "$as_dir/$ac_word$ac_exec_ext"; }; then
+    ac_cv_prog_ac_ct_CC="gcc"
+    $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
+    break 2
+  fi
+done
+  done
+IFS=$as_save_IFS
 
-int
-main ()
-{
+fi
+fi
+ac_ct_CC=$ac_cv_prog_ac_ct_CC
+if test -n "$ac_ct_CC"; then
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_ct_CC" >&5
+$as_echo "$ac_ct_CC" >&6; }
+else
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
+fi
 
-  ;
-  return 0;
-}
-_ACEOF
-rm -f conftest.o conftest.obj
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
+  if test "x$ac_ct_CC" = x; then
+    CC=""
+  else
+    case $cross_compiling:$ac_tool_warned in
+yes:)
+{ $as_echo "$as_me:${as_lineno-$LINENO}: WARNING: using cross tools not prefixed with host triplet" >&5
+$as_echo "$as_me: WARNING: using cross tools not prefixed with host triplet" >&2;}
+ac_tool_warned=yes ;;
 esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>&5
-  ac_status=$?
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); }; then
-  for ac_file in conftest.o conftest.obj conftest.*; do
-  test -f "$ac_file" || continue;
-  case $ac_file in
-    *.$ac_ext | *.xcoff | *.tds | *.d | *.pdb | *.xSYM | *.bb | *.bbg | *.map | *.inf | *.dSYM ) ;;
-    *) ac_cv_objext=`expr "$ac_file" : '.*\.\(.*\)'`
-       break;;
-  esac
-done
+    CC=$ac_ct_CC
+  fi
 else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-{ { $as_echo "$as_me:$LINENO: error: in \`$ac_pwd':" >&5
-$as_echo "$as_me: error: in \`$ac_pwd':" >&2;}
-{ { $as_echo "$as_me:$LINENO: error: cannot compute suffix of object files: cannot compile
-See \`config.log' for more details." >&5
-$as_echo "$as_me: error: cannot compute suffix of object files: cannot compile
-See \`config.log' for more details." >&2;}
-   { (exit 1); exit 1; }; }; }
+  CC="$ac_cv_prog_CC"
 fi
 
-rm -f conftest.$ac_cv_objext conftest.$ac_ext
-fi
-{ $as_echo "$as_me:$LINENO: result: $ac_cv_objext" >&5
-$as_echo "$ac_cv_objext" >&6; }
-OBJEXT=$ac_cv_objext
-ac_objext=$OBJEXT
-{ $as_echo "$as_me:$LINENO: checking whether we are using the GNU C compiler" >&5
-$as_echo_n "checking whether we are using the GNU C compiler... " >&6; }
-if test "${ac_cv_c_compiler_gnu+set}" = set; then
+if test -z "$CC"; then
+          if test -n "$ac_tool_prefix"; then
+    # Extract the first word of "${ac_tool_prefix}cc", so it can be a program name with args.
+set dummy ${ac_tool_prefix}cc; ac_word=$2
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for $ac_word" >&5
+$as_echo_n "checking for $ac_word... " >&6; }
+if test "${ac_cv_prog_CC+set}" = set; then :
   $as_echo_n "(cached) " >&6
 else
-  cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
-/* end confdefs.h.  */
-
-int
-main ()
-{
-#ifndef __GNUC__
-       choke me
-#endif
-
-  ;
-  return 0;
-}
-_ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
-  ac_compiler_gnu=yes
+  if test -n "$CC"; then
+  ac_cv_prog_CC="$CC" # Let the user override the test.
 else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
+as_save_IFS=$IFS; IFS=$PATH_SEPARATOR
+for as_dir in $PATH
+do
+  IFS=$as_save_IFS
+  test -z "$as_dir" && as_dir=.
+    for ac_exec_ext in '' $ac_executable_extensions; do
+  if { test -f "$as_dir/$ac_word$ac_exec_ext" && $as_test_x "$as_dir/$ac_word$ac_exec_ext"; }; then
+    ac_cv_prog_CC="${ac_tool_prefix}cc"
+    $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
+    break 2
+  fi
+done
+  done
+IFS=$as_save_IFS
 
-	ac_compiler_gnu=no
 fi
-
-rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
-ac_cv_c_compiler_gnu=$ac_compiler_gnu
-
 fi
-{ $as_echo "$as_me:$LINENO: result: $ac_cv_c_compiler_gnu" >&5
-$as_echo "$ac_cv_c_compiler_gnu" >&6; }
-if test $ac_compiler_gnu = yes; then
-  GCC=yes
+CC=$ac_cv_prog_CC
+if test -n "$CC"; then
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $CC" >&5
+$as_echo "$CC" >&6; }
 else
-  GCC=
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
 fi
-ac_test_CFLAGS=${CFLAGS+set}
-ac_save_CFLAGS=$CFLAGS
-{ $as_echo "$as_me:$LINENO: checking whether $CC accepts -g" >&5
-$as_echo_n "checking whether $CC accepts -g... " >&6; }
-if test "${ac_cv_prog_cc_g+set}" = set; then
-  $as_echo_n "(cached) " >&6
-else
-  ac_save_c_werror_flag=$ac_c_werror_flag
-   ac_c_werror_flag=yes
-   ac_cv_prog_cc_g=no
-   CFLAGS="-g"
-   cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
-/* end confdefs.h.  */
 
-int
-main ()
-{
 
-  ;
-  return 0;
-}
-_ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
-  ac_cv_prog_cc_g=yes
+  fi
+fi
+if test -z "$CC"; then
+  # Extract the first word of "cc", so it can be a program name with args.
+set dummy cc; ac_word=$2
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for $ac_word" >&5
+$as_echo_n "checking for $ac_word... " >&6; }
+if test "${ac_cv_prog_CC+set}" = set; then :
+  $as_echo_n "(cached) " >&6
 else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-	CFLAGS=""
-      cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
-/* end confdefs.h.  */
-
-int
-main ()
-{
-
-  ;
-  return 0;
-}
-_ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
-  :
+  if test -n "$CC"; then
+  ac_cv_prog_CC="$CC" # Let the user override the test.
 else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-	ac_c_werror_flag=$ac_save_c_werror_flag
-	 CFLAGS="-g"
-	 cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
-/* end confdefs.h.  */
-
-int
-main ()
-{
+  ac_prog_rejected=no
+as_save_IFS=$IFS; IFS=$PATH_SEPARATOR
+for as_dir in $PATH
+do
+  IFS=$as_save_IFS
+  test -z "$as_dir" && as_dir=.
+    for ac_exec_ext in '' $ac_executable_extensions; do
+  if { test -f "$as_dir/$ac_word$ac_exec_ext" && $as_test_x "$as_dir/$ac_word$ac_exec_ext"; }; then
+    if test "$as_dir/$ac_word$ac_exec_ext" = "/usr/ucb/cc"; then
+       ac_prog_rejected=yes
+       continue
+     fi
+    ac_cv_prog_CC="cc"
+    $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
+    break 2
+  fi
+done
+  done
+IFS=$as_save_IFS
 
-  ;
-  return 0;
-}
-_ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
-  ac_cv_prog_cc_g=yes
+if test $ac_prog_rejected = yes; then
+  # We found a bogon in the path, so make sure we never use it.
+  set dummy $ac_cv_prog_CC
+  shift
+  if test $# != 0; then
+    # We chose a different compiler from the bogus one.
+    # However, it has the same basename, so the bogon will be chosen
+    # first if we set CC to just the basename; use the full file name.
+    shift
+    ac_cv_prog_CC="$as_dir/$ac_word${1+' '}$@"
+  fi
+fi
+fi
+fi
+CC=$ac_cv_prog_CC
+if test -n "$CC"; then
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $CC" >&5
+$as_echo "$CC" >&6; }
 else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
+fi
 
 
 fi
+if test -z "$CC"; then
+  if test -n "$ac_tool_prefix"; then
+  for ac_prog in cl.exe
+  do
+    # Extract the first word of "$ac_tool_prefix$ac_prog", so it can be a program name with args.
+set dummy $ac_tool_prefix$ac_prog; ac_word=$2
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for $ac_word" >&5
+$as_echo_n "checking for $ac_word... " >&6; }
+if test "${ac_cv_prog_CC+set}" = set; then :
+  $as_echo_n "(cached) " >&6
+else
+  if test -n "$CC"; then
+  ac_cv_prog_CC="$CC" # Let the user override the test.
+else
+as_save_IFS=$IFS; IFS=$PATH_SEPARATOR
+for as_dir in $PATH
+do
+  IFS=$as_save_IFS
+  test -z "$as_dir" && as_dir=.
+    for ac_exec_ext in '' $ac_executable_extensions; do
+  if { test -f "$as_dir/$ac_word$ac_exec_ext" && $as_test_x "$as_dir/$ac_word$ac_exec_ext"; }; then
+    ac_cv_prog_CC="$ac_tool_prefix$ac_prog"
+    $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
+    break 2
+  fi
+done
+  done
+IFS=$as_save_IFS
 
-rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
 fi
-
-rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
+fi
+CC=$ac_cv_prog_CC
+if test -n "$CC"; then
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $CC" >&5
+$as_echo "$CC" >&6; }
+else
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
 fi
 
-rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
-   ac_c_werror_flag=$ac_save_c_werror_flag
+
+    test -n "$CC" && break
+  done
 fi
-{ $as_echo "$as_me:$LINENO: result: $ac_cv_prog_cc_g" >&5
-$as_echo "$ac_cv_prog_cc_g" >&6; }
-if test "$ac_test_CFLAGS" = set; then
-  CFLAGS=$ac_save_CFLAGS
-elif test $ac_cv_prog_cc_g = yes; then
-  if test "$GCC" = yes; then
-    CFLAGS="-g -O2"
-  else
-    CFLAGS="-g"
+if test -z "$CC"; then
+  ac_ct_CC=$CC
+  for ac_prog in cl.exe
+do
+  # Extract the first word of "$ac_prog", so it can be a program name with args.
+set dummy $ac_prog; ac_word=$2
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for $ac_word" >&5
+$as_echo_n "checking for $ac_word... " >&6; }
+if test "${ac_cv_prog_ac_ct_CC+set}" = set; then :
+  $as_echo_n "(cached) " >&6
+else
+  if test -n "$ac_ct_CC"; then
+  ac_cv_prog_ac_ct_CC="$ac_ct_CC" # Let the user override the test.
+else
+as_save_IFS=$IFS; IFS=$PATH_SEPARATOR
+for as_dir in $PATH
+do
+  IFS=$as_save_IFS
+  test -z "$as_dir" && as_dir=.
+    for ac_exec_ext in '' $ac_executable_extensions; do
+  if { test -f "$as_dir/$ac_word$ac_exec_ext" && $as_test_x "$as_dir/$ac_word$ac_exec_ext"; }; then
+    ac_cv_prog_ac_ct_CC="$ac_prog"
+    $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
+    break 2
   fi
+done
+  done
+IFS=$as_save_IFS
+
+fi
+fi
+ac_ct_CC=$ac_cv_prog_ac_ct_CC
+if test -n "$ac_ct_CC"; then
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_ct_CC" >&5
+$as_echo "$ac_ct_CC" >&6; }
 else
-  if test "$GCC" = yes; then
-    CFLAGS="-O2"
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
+fi
+
+
+  test -n "$ac_ct_CC" && break
+done
+
+  if test "x$ac_ct_CC" = x; then
+    CC=""
   else
-    CFLAGS=
+    case $cross_compiling:$ac_tool_warned in
+yes:)
+{ $as_echo "$as_me:${as_lineno-$LINENO}: WARNING: using cross tools not prefixed with host triplet" >&5
+$as_echo "$as_me: WARNING: using cross tools not prefixed with host triplet" >&2;}
+ac_tool_warned=yes ;;
+esac
+    CC=$ac_ct_CC
   fi
 fi
-{ $as_echo "$as_me:$LINENO: checking for $CC option to accept ISO C89" >&5
-$as_echo_n "checking for $CC option to accept ISO C89... " >&6; }
-if test "${ac_cv_prog_cc_c89+set}" = set; then
-  $as_echo_n "(cached) " >&6
-else
-  ac_cv_prog_cc_c89=no
-ac_save_CC=$CC
-cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
-/* end confdefs.h.  */
-#include <stdarg.h>
-#include <stdio.h>
-#include <sys/types.h>
-#include <sys/stat.h>
-/* Most of the following tests are stolen from RCS 5.7's src/conf.sh.  */
-struct buf { int x; };
-FILE * (*rcsopen) (struct buf *, struct stat *, int);
-static char *e (p, i)
-     char **p;
-     int i;
-{
-  return p[i];
-}
-static char *f (char * (*g) (char **, int), char **p, ...)
-{
-  char *s;
-  va_list v;
-  va_start (v,p);
-  s = g (p, va_arg (v,int));
-  va_end (v);
-  return s;
-}
 
-/* OSF 4.0 Compaq cc is some sort of almost-ANSI by default.  It has
-   function prototypes and stuff, but not '\xHH' hex character constants.
-   These don't provoke an error unfortunately, instead are silently treated
-   as 'x'.  The following induces an error, until -std is added to get
-   proper ANSI mode.  Curiously '\x00'!='x' always comes out true, for an
-   array size at least.  It's necessary to write '\x00'==0 to get something
-   that's true only with -std.  */
-int osf4_cc_array ['\x00' == 0 ? 1 : -1];
+fi
 
-/* IBM C 6 for AIX is almost-ANSI by default, but it replaces macro parameters
-   inside strings and character constants.  */
-#define FOO(x) 'x'
-int xlc6_cc_array[FOO(a) == 'x' ? 1 : -1];
 
-int test (int i, double x);
-struct s1 {int (*f) (int a);};
-struct s2 {int (*f) (double a);};
-int pairnames (int, char **, FILE *(*)(struct buf *, struct stat *, int), int, int);
-int argc;
-char **argv;
+test -z "$CC" && { { $as_echo "$as_me:${as_lineno-$LINENO}: error: in \`$ac_pwd':" >&5
+$as_echo "$as_me: error: in \`$ac_pwd':" >&2;}
+as_fn_error "no acceptable C compiler found in \$PATH
+See \`config.log' for more details." "$LINENO" 5; }
+
+# Provide some information about the compiler.
+$as_echo "$as_me:${as_lineno-$LINENO}: checking for C compiler version" >&5
+set X $ac_compile
+ac_compiler=$2
+for ac_option in --version -v -V -qversion; do
+  { { ac_try="$ac_compiler $ac_option >&5"
+case "(($ac_try" in
+  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
+  *) ac_try_echo=$ac_try;;
+esac
+eval ac_try_echo="\"\$as_me:${as_lineno-$LINENO}: $ac_try_echo\""
+$as_echo "$ac_try_echo"; } >&5
+  (eval "$ac_compiler $ac_option >&5") 2>conftest.err
+  ac_status=$?
+  if test -s conftest.err; then
+    sed '10a\
+... rest of stderr output deleted ...
+         10q' conftest.err >conftest.er1
+    cat conftest.er1 >&5
+    rm -f conftest.er1 conftest.err
+  fi
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }
+done
+
+cat confdefs.h - <<_ACEOF >conftest.$ac_ext
+/* end confdefs.h.  */
+#include <stdio.h>
 int
 main ()
 {
-return f (e, argv, 0) != argv[0]  ||  f (e, argv, 1) != argv[1];
+FILE *f = fopen ("conftest.out", "w");
+ return ferror (f) || fclose (f) != 0;
+
   ;
   return 0;
 }
 _ACEOF
-for ac_arg in '' -qlanglvl=extc89 -qlanglvl=ansi -std \
-	-Ae "-Aa -D_HPUX_SOURCE" "-Xc -D__EXTENSIONS__"
+ac_clean_files_save=$ac_clean_files
+ac_clean_files="$ac_clean_files a.out a.out.dSYM a.exe b.out conftest.out"
+# Try to create an executable without -o first, disregard a.out.
+# It will help us diagnose broken compilers, and finding out an intuition
+# of exeext.
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for C compiler default output file name" >&5
+$as_echo_n "checking for C compiler default output file name... " >&6; }
+ac_link_default=`$as_echo "$ac_link" | sed 's/ -o *conftest[^ ]*//'`
+
+# The possible output files:
+ac_files="a.out conftest.exe conftest a.exe a_out.exe b.out conftest.*"
+
+ac_rmfiles=
+for ac_file in $ac_files
 do
-  CC="$ac_save_CC $ac_arg"
-  rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
+  case $ac_file in
+    *.$ac_ext | *.xcoff | *.tds | *.d | *.pdb | *.xSYM | *.bb | *.bbg | *.map | *.inf | *.dSYM | *.o | *.obj ) ;;
+    * ) ac_rmfiles="$ac_rmfiles $ac_file";;
+  esac
+done
+rm -f $ac_rmfiles
+
+if { { ac_try="$ac_link_default"
 case "(($ac_try" in
   *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
   *) ac_try_echo=$ac_try;;
 esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
+eval ac_try_echo="\"\$as_me:${as_lineno-$LINENO}: $ac_try_echo\""
+$as_echo "$ac_try_echo"; } >&5
+  (eval "$ac_link_default") 2>&5
   ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
-  ac_cv_prog_cc_c89=$ac_arg
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }; then :
+  # Autoconf-2.13 could set the ac_cv_exeext variable to `no'.
+# So ignore a value of `no', otherwise this would lead to `EXEEXT = no'
+# in a Makefile.  We should not override ac_cv_exeext if it was cached,
+# so that the user can short-circuit this test for compilers unknown to
+# Autoconf.
+for ac_file in $ac_files ''
+do
+  test -f "$ac_file" || continue
+  case $ac_file in
+    *.$ac_ext | *.xcoff | *.tds | *.d | *.pdb | *.xSYM | *.bb | *.bbg | *.map | *.inf | *.dSYM | *.o | *.obj )
+	;;
+    [ab].out )
+	# We found the default executable, but exeext='' is most
+	# certainly right.
+	break;;
+    *.* )
+	if test "${ac_cv_exeext+set}" = set && test "$ac_cv_exeext" != no;
+	then :; else
+	   ac_cv_exeext=`expr "$ac_file" : '[^.]*\(\..*\)'`
+	fi
+	# We set ac_cv_exeext here because the later test for it is not
+	# safe: cross compilers may not add the suffix if given an `-o'
+	# argument, so we may need to know it at that point already.
+	# Even if this section looks crufty: it has the advantage of
+	# actually working.
+	break;;
+    * )
+	break;;
+  esac
+done
+test "$ac_cv_exeext" = no && ac_cv_exeext=
+
 else
+  ac_file=''
+fi
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_file" >&5
+$as_echo "$ac_file" >&6; }
+if test -z "$ac_file"; then :
   $as_echo "$as_me: failed program was:" >&5
 sed 's/^/| /' conftest.$ac_ext >&5
 
+{ { $as_echo "$as_me:${as_lineno-$LINENO}: error: in \`$ac_pwd':" >&5
+$as_echo "$as_me: error: in \`$ac_pwd':" >&2;}
+{ as_fn_set_status 77
+as_fn_error "C compiler cannot create executables
+See \`config.log' for more details." "$LINENO" 5; }; }
+fi
+ac_exeext=$ac_cv_exeext
 
+# Check that the compiler produces executables we can run.  If not, either
+# the compiler is broken, or we cross compile.
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking whether the C compiler works" >&5
+$as_echo_n "checking whether the C compiler works... " >&6; }
+# If not cross compiling, check that we can run a simple program.
+if test "$cross_compiling" != yes; then
+  if { ac_try='./$ac_file'
+  { { case "(($ac_try" in
+  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
+  *) ac_try_echo=$ac_try;;
+esac
+eval ac_try_echo="\"\$as_me:${as_lineno-$LINENO}: $ac_try_echo\""
+$as_echo "$ac_try_echo"; } >&5
+  (eval "$ac_try") 2>&5
+  ac_status=$?
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }; }; then
+    cross_compiling=no
+  else
+    if test "$cross_compiling" = maybe; then
+	cross_compiling=yes
+    else
+	{ { $as_echo "$as_me:${as_lineno-$LINENO}: error: in \`$ac_pwd':" >&5
+$as_echo "$as_me: error: in \`$ac_pwd':" >&2;}
+as_fn_error "cannot run C compiled programs.
+If you meant to cross compile, use \`--host'.
+See \`config.log' for more details." "$LINENO" 5; }
+    fi
+  fi
 fi
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: yes" >&5
+$as_echo "yes" >&6; }
 
-rm -f core conftest.err conftest.$ac_objext
-  test "x$ac_cv_prog_cc_c89" != "xno" && break
-done
-rm -f conftest.$ac_ext
-CC=$ac_save_CC
+rm -f -r a.out a.out.dSYM a.exe conftest$ac_cv_exeext b.out conftest.out
+ac_clean_files=$ac_clean_files_save
+# Check that the compiler produces executables we can run.  If not, either
+# the compiler is broken, or we cross compile.
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking whether we are cross compiling" >&5
+$as_echo_n "checking whether we are cross compiling... " >&6; }
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $cross_compiling" >&5
+$as_echo "$cross_compiling" >&6; }
 
-fi
-# AC_CACHE_VAL
-case "x$ac_cv_prog_cc_c89" in
-  x)
-    { $as_echo "$as_me:$LINENO: result: none needed" >&5
-$as_echo "none needed" >&6; } ;;
-  xno)
-    { $as_echo "$as_me:$LINENO: result: unsupported" >&5
-$as_echo "unsupported" >&6; } ;;
-  *)
-    CC="$CC $ac_cv_prog_cc_c89"
-    { $as_echo "$as_me:$LINENO: result: $ac_cv_prog_cc_c89" >&5
-$as_echo "$ac_cv_prog_cc_c89" >&6; } ;;
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for suffix of executables" >&5
+$as_echo_n "checking for suffix of executables... " >&6; }
+if { { ac_try="$ac_link"
+case "(($ac_try" in
+  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
+  *) ac_try_echo=$ac_try;;
 esac
+eval ac_try_echo="\"\$as_me:${as_lineno-$LINENO}: $ac_try_echo\""
+$as_echo "$ac_try_echo"; } >&5
+  (eval "$ac_link") 2>&5
+  ac_status=$?
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }; then :
+  # If both `conftest.exe' and `conftest' are `present' (well, observable)
+# catch `conftest.exe'.  For instance with Cygwin, `ls conftest' will
+# work properly (i.e., refer to `conftest.exe'), while it won't with
+# `rm'.
+for ac_file in conftest.exe conftest conftest.*; do
+  test -f "$ac_file" || continue
+  case $ac_file in
+    *.$ac_ext | *.xcoff | *.tds | *.d | *.pdb | *.xSYM | *.bb | *.bbg | *.map | *.inf | *.dSYM | *.o | *.obj ) ;;
+    *.* ) ac_cv_exeext=`expr "$ac_file" : '[^.]*\(\..*\)'`
+	  break;;
+    * ) break;;
+  esac
+done
+else
+  { { $as_echo "$as_me:${as_lineno-$LINENO}: error: in \`$ac_pwd':" >&5
+$as_echo "$as_me: error: in \`$ac_pwd':" >&2;}
+as_fn_error "cannot compute suffix of executables: cannot compile and link
+See \`config.log' for more details." "$LINENO" 5; }
+fi
+rm -f conftest$ac_cv_exeext
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_exeext" >&5
+$as_echo "$ac_cv_exeext" >&6; }
 
-
-ac_ext=c
+rm -f conftest.$ac_ext
+EXEEXT=$ac_cv_exeext
+ac_exeext=$EXEEXT
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for suffix of object files" >&5
+$as_echo_n "checking for suffix of object files... " >&6; }
+if test "${ac_cv_objext+set}" = set; then :
+  $as_echo_n "(cached) " >&6
+else
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
+/* end confdefs.h.  */
+
+int
+main ()
+{
+
+  ;
+  return 0;
+}
+_ACEOF
+rm -f conftest.o conftest.obj
+if { { ac_try="$ac_compile"
+case "(($ac_try" in
+  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
+  *) ac_try_echo=$ac_try;;
+esac
+eval ac_try_echo="\"\$as_me:${as_lineno-$LINENO}: $ac_try_echo\""
+$as_echo "$ac_try_echo"; } >&5
+  (eval "$ac_compile") 2>&5
+  ac_status=$?
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }; then :
+  for ac_file in conftest.o conftest.obj conftest.*; do
+  test -f "$ac_file" || continue;
+  case $ac_file in
+    *.$ac_ext | *.xcoff | *.tds | *.d | *.pdb | *.xSYM | *.bb | *.bbg | *.map | *.inf | *.dSYM ) ;;
+    *) ac_cv_objext=`expr "$ac_file" : '.*\.\(.*\)'`
+       break;;
+  esac
+done
+else
+  $as_echo "$as_me: failed program was:" >&5
+sed 's/^/| /' conftest.$ac_ext >&5
+
+{ { $as_echo "$as_me:${as_lineno-$LINENO}: error: in \`$ac_pwd':" >&5
+$as_echo "$as_me: error: in \`$ac_pwd':" >&2;}
+as_fn_error "cannot compute suffix of object files: cannot compile
+See \`config.log' for more details." "$LINENO" 5; }
+fi
+rm -f conftest.$ac_cv_objext conftest.$ac_ext
+fi
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_objext" >&5
+$as_echo "$ac_cv_objext" >&6; }
+OBJEXT=$ac_cv_objext
+ac_objext=$OBJEXT
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking whether we are using the GNU C compiler" >&5
+$as_echo_n "checking whether we are using the GNU C compiler... " >&6; }
+if test "${ac_cv_c_compiler_gnu+set}" = set; then :
+  $as_echo_n "(cached) " >&6
+else
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
+/* end confdefs.h.  */
+
+int
+main ()
+{
+#ifndef __GNUC__
+       choke me
+#endif
+
+  ;
+  return 0;
+}
+_ACEOF
+if ac_fn_c_try_compile "$LINENO"; then :
+  ac_compiler_gnu=yes
+else
+  ac_compiler_gnu=no
+fi
+rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
+ac_cv_c_compiler_gnu=$ac_compiler_gnu
+
+fi
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_c_compiler_gnu" >&5
+$as_echo "$ac_cv_c_compiler_gnu" >&6; }
+if test $ac_compiler_gnu = yes; then
+  GCC=yes
+else
+  GCC=
+fi
+ac_test_CFLAGS=${CFLAGS+set}
+ac_save_CFLAGS=$CFLAGS
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking whether $CC accepts -g" >&5
+$as_echo_n "checking whether $CC accepts -g... " >&6; }
+if test "${ac_cv_prog_cc_g+set}" = set; then :
+  $as_echo_n "(cached) " >&6
+else
+  ac_save_c_werror_flag=$ac_c_werror_flag
+   ac_c_werror_flag=yes
+   ac_cv_prog_cc_g=no
+   CFLAGS="-g"
+   cat confdefs.h - <<_ACEOF >conftest.$ac_ext
+/* end confdefs.h.  */
+
+int
+main ()
+{
+
+  ;
+  return 0;
+}
+_ACEOF
+if ac_fn_c_try_compile "$LINENO"; then :
+  ac_cv_prog_cc_g=yes
+else
+  CFLAGS=""
+      cat confdefs.h - <<_ACEOF >conftest.$ac_ext
+/* end confdefs.h.  */
+
+int
+main ()
+{
+
+  ;
+  return 0;
+}
+_ACEOF
+if ac_fn_c_try_compile "$LINENO"; then :
+
+else
+  ac_c_werror_flag=$ac_save_c_werror_flag
+	 CFLAGS="-g"
+	 cat confdefs.h - <<_ACEOF >conftest.$ac_ext
+/* end confdefs.h.  */
+
+int
+main ()
+{
+
+  ;
+  return 0;
+}
+_ACEOF
+if ac_fn_c_try_compile "$LINENO"; then :
+  ac_cv_prog_cc_g=yes
+fi
+rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
+fi
+rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
+fi
+rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
+   ac_c_werror_flag=$ac_save_c_werror_flag
+fi
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_prog_cc_g" >&5
+$as_echo "$ac_cv_prog_cc_g" >&6; }
+if test "$ac_test_CFLAGS" = set; then
+  CFLAGS=$ac_save_CFLAGS
+elif test $ac_cv_prog_cc_g = yes; then
+  if test "$GCC" = yes; then
+    CFLAGS="-g -O2"
+  else
+    CFLAGS="-g"
+  fi
+else
+  if test "$GCC" = yes; then
+    CFLAGS="-O2"
+  else
+    CFLAGS=
+  fi
+fi
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for $CC option to accept ISO C89" >&5
+$as_echo_n "checking for $CC option to accept ISO C89... " >&6; }
+if test "${ac_cv_prog_cc_c89+set}" = set; then :
+  $as_echo_n "(cached) " >&6
+else
+  ac_cv_prog_cc_c89=no
+ac_save_CC=$CC
+cat confdefs.h - <<_ACEOF >conftest.$ac_ext
+/* end confdefs.h.  */
+#include <stdarg.h>
+#include <stdio.h>
+#include <sys/types.h>
+#include <sys/stat.h>
+/* Most of the following tests are stolen from RCS 5.7's src/conf.sh.  */
+struct buf { int x; };
+FILE * (*rcsopen) (struct buf *, struct stat *, int);
+static char *e (p, i)
+     char **p;
+     int i;
+{
+  return p[i];
+}
+static char *f (char * (*g) (char **, int), char **p, ...)
+{
+  char *s;
+  va_list v;
+  va_start (v,p);
+  s = g (p, va_arg (v,int));
+  va_end (v);
+  return s;
+}
+
+/* OSF 4.0 Compaq cc is some sort of almost-ANSI by default.  It has
+   function prototypes and stuff, but not '\xHH' hex character constants.
+   These don't provoke an error unfortunately, instead are silently treated
+   as 'x'.  The following induces an error, until -std is added to get
+   proper ANSI mode.  Curiously '\x00'!='x' always comes out true, for an
+   array size at least.  It's necessary to write '\x00'==0 to get something
+   that's true only with -std.  */
+int osf4_cc_array ['\x00' == 0 ? 1 : -1];
+
+/* IBM C 6 for AIX is almost-ANSI by default, but it replaces macro parameters
+   inside strings and character constants.  */
+#define FOO(x) 'x'
+int xlc6_cc_array[FOO(a) == 'x' ? 1 : -1];
+
+int test (int i, double x);
+struct s1 {int (*f) (int a);};
+struct s2 {int (*f) (double a);};
+int pairnames (int, char **, FILE *(*)(struct buf *, struct stat *, int), int, int);
+int argc;
+char **argv;
+int
+main ()
+{
+return f (e, argv, 0) != argv[0]  ||  f (e, argv, 1) != argv[1];
+  ;
+  return 0;
+}
+_ACEOF
+for ac_arg in '' -qlanglvl=extc89 -qlanglvl=ansi -std \
+	-Ae "-Aa -D_HPUX_SOURCE" "-Xc -D__EXTENSIONS__"
+do
+  CC="$ac_save_CC $ac_arg"
+  if ac_fn_c_try_compile "$LINENO"; then :
+  ac_cv_prog_cc_c89=$ac_arg
+fi
+rm -f core conftest.err conftest.$ac_objext
+  test "x$ac_cv_prog_cc_c89" != "xno" && break
+done
+rm -f conftest.$ac_ext
+CC=$ac_save_CC
+
+fi
+# AC_CACHE_VAL
+case "x$ac_cv_prog_cc_c89" in
+  x)
+    { $as_echo "$as_me:${as_lineno-$LINENO}: result: none needed" >&5
+$as_echo "none needed" >&6; } ;;
+  xno)
+    { $as_echo "$as_me:${as_lineno-$LINENO}: result: unsupported" >&5
+$as_echo "unsupported" >&6; } ;;
+  *)
+    CC="$CC $ac_cv_prog_cc_c89"
+    { $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_prog_cc_c89" >&5
+$as_echo "$ac_cv_prog_cc_c89" >&6; } ;;
+esac
+if test "x$ac_cv_prog_cc_c89" != xno; then :
+
+fi
+
+ac_ext=c
 ac_cpp='$CPP $CPPFLAGS'
 ac_compile='$CC -c $CFLAGS $CPPFLAGS conftest.$ac_ext >&5'
 ac_link='$CC -o conftest$ac_exeext $CFLAGS $CPPFLAGS $LDFLAGS conftest.$ac_ext $LIBS >&5'
@@ -2821,14 +3209,14 @@
 ac_compile='$CC -c $CFLAGS $CPPFLAGS conftest.$ac_ext >&5'
 ac_link='$CC -o conftest$ac_exeext $CFLAGS $CPPFLAGS $LDFLAGS conftest.$ac_ext $LIBS >&5'
 ac_compiler_gnu=$ac_cv_c_compiler_gnu
-{ $as_echo "$as_me:$LINENO: checking how to run the C preprocessor" >&5
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking how to run the C preprocessor" >&5
 $as_echo_n "checking how to run the C preprocessor... " >&6; }
 # On Suns, sometimes $CPP names a directory.
 if test -n "$CPP" && test -d "$CPP"; then
   CPP=
 fi
 if test -z "$CPP"; then
-  if test "${ac_cv_prog_CPP+set}" = set; then
+  if test "${ac_cv_prog_CPP+set}" = set; then :
   $as_echo_n "(cached) " >&6
 else
       # Double quotes because CPP needs to be expanded
@@ -2843,11 +3231,7 @@
   # <limits.h> exists even on freestanding compilers.
   # On the NeXT, cc -E runs the code through the compiler's parser,
   # not just through cpp. "Syntax error" is here to catch this case.
-  cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
 #ifdef __STDC__
 # include <limits.h>
@@ -2856,78 +3240,34 @@
 #endif
 		     Syntax error
 _ACEOF
-if { (ac_try="$ac_cpp conftest.$ac_ext"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_cpp conftest.$ac_ext") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } >/dev/null && {
-	 test -z "$ac_c_preproc_warn_flag$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       }; then
-  :
-else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
+if ac_fn_c_try_cpp "$LINENO"; then :
 
+else
   # Broken: fails on valid input.
 continue
 fi
-
 rm -f conftest.err conftest.$ac_ext
 
   # OK, works on sane cases.  Now check whether nonexistent headers
   # can be detected and how.
-  cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
 #include <ac_nonexistent.h>
 _ACEOF
-if { (ac_try="$ac_cpp conftest.$ac_ext"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_cpp conftest.$ac_ext") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } >/dev/null && {
-	 test -z "$ac_c_preproc_warn_flag$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       }; then
+if ac_fn_c_try_cpp "$LINENO"; then :
   # Broken: success on invalid input.
 continue
 else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
   # Passes both tests.
 ac_preproc_ok=:
 break
 fi
-
 rm -f conftest.err conftest.$ac_ext
 
 done
 # Because of `break', _AC_PREPROC_IFELSE's cleaning code was skipped.
 rm -f conftest.err conftest.$ac_ext
-if $ac_preproc_ok; then
+if $ac_preproc_ok; then :
   break
 fi
 
@@ -2939,7 +3279,7 @@
 else
   ac_cv_prog_CPP=$CPP
 fi
-{ $as_echo "$as_me:$LINENO: result: $CPP" >&5
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $CPP" >&5
 $as_echo "$CPP" >&6; }
 ac_preproc_ok=false
 for ac_c_preproc_warn_flag in '' yes
@@ -2950,11 +3290,7 @@
   # <limits.h> exists even on freestanding compilers.
   # On the NeXT, cc -E runs the code through the compiler's parser,
   # not just through cpp. "Syntax error" is here to catch this case.
-  cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
 #ifdef __STDC__
 # include <limits.h>
@@ -2963,87 +3299,40 @@
 #endif
 		     Syntax error
 _ACEOF
-if { (ac_try="$ac_cpp conftest.$ac_ext"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_cpp conftest.$ac_ext") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } >/dev/null && {
-	 test -z "$ac_c_preproc_warn_flag$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       }; then
-  :
-else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
+if ac_fn_c_try_cpp "$LINENO"; then :
 
+else
   # Broken: fails on valid input.
 continue
 fi
-
 rm -f conftest.err conftest.$ac_ext
 
   # OK, works on sane cases.  Now check whether nonexistent headers
   # can be detected and how.
-  cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
 #include <ac_nonexistent.h>
 _ACEOF
-if { (ac_try="$ac_cpp conftest.$ac_ext"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_cpp conftest.$ac_ext") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } >/dev/null && {
-	 test -z "$ac_c_preproc_warn_flag$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       }; then
+if ac_fn_c_try_cpp "$LINENO"; then :
   # Broken: success on invalid input.
 continue
 else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
   # Passes both tests.
 ac_preproc_ok=:
 break
 fi
-
 rm -f conftest.err conftest.$ac_ext
 
 done
 # Because of `break', _AC_PREPROC_IFELSE's cleaning code was skipped.
 rm -f conftest.err conftest.$ac_ext
-if $ac_preproc_ok; then
-  :
+if $ac_preproc_ok; then :
+
 else
-  { { $as_echo "$as_me:$LINENO: error: in \`$ac_pwd':" >&5
+  { { $as_echo "$as_me:${as_lineno-$LINENO}: error: in \`$ac_pwd':" >&5
 $as_echo "$as_me: error: in \`$ac_pwd':" >&2;}
-{ { $as_echo "$as_me:$LINENO: error: C preprocessor \"$CPP\" fails sanity check
-See \`config.log' for more details." >&5
-$as_echo "$as_me: error: C preprocessor \"$CPP\" fails sanity check
-See \`config.log' for more details." >&2;}
-   { (exit 1); exit 1; }; }; }
+as_fn_error "C preprocessor \"$CPP\" fails sanity check
+See \`config.log' for more details." "$LINENO" 5; }
 fi
 
 ac_ext=c
@@ -3053,9 +3342,9 @@
 ac_compiler_gnu=$ac_cv_c_compiler_gnu
 
 
-{ $as_echo "$as_me:$LINENO: checking for grep that handles long lines and -e" >&5
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for grep that handles long lines and -e" >&5
 $as_echo_n "checking for grep that handles long lines and -e... " >&6; }
-if test "${ac_cv_path_GREP+set}" = set; then
+if test "${ac_cv_path_GREP+set}" = set; then :
   $as_echo_n "(cached) " >&6
 else
   if test -z "$GREP"; then
@@ -3066,7 +3355,7 @@
 do
   IFS=$as_save_IFS
   test -z "$as_dir" && as_dir=.
-  for ac_prog in grep ggrep; do
+    for ac_prog in grep ggrep; do
     for ac_exec_ext in '' $ac_executable_extensions; do
       ac_path_GREP="$as_dir/$ac_prog$ac_exec_ext"
       { test -f "$ac_path_GREP" && $as_test_x "$ac_path_GREP"; } || continue
@@ -3086,7 +3375,7 @@
     $as_echo 'GREP' >> "conftest.nl"
     "$ac_path_GREP" -e 'GREP$' -e '-(cannot match)-' < "conftest.nl" >"conftest.out" 2>/dev/null || break
     diff "conftest.out" "conftest.nl" >/dev/null 2>&1 || break
-    ac_count=`expr $ac_count + 1`
+    as_fn_arith $ac_count + 1 && ac_count=$as_val
     if test $ac_count -gt ${ac_path_GREP_max-0}; then
       # Best one so far, save it but keep looking for a better one
       ac_cv_path_GREP="$ac_path_GREP"
@@ -3101,26 +3390,24 @@
       $ac_path_GREP_found && break 3
     done
   done
-done
+  done
 IFS=$as_save_IFS
   if test -z "$ac_cv_path_GREP"; then
-    { { $as_echo "$as_me:$LINENO: error: no acceptable grep could be found in $PATH$PATH_SEPARATOR/usr/xpg4/bin" >&5
-$as_echo "$as_me: error: no acceptable grep could be found in $PATH$PATH_SEPARATOR/usr/xpg4/bin" >&2;}
-   { (exit 1); exit 1; }; }
+    as_fn_error "no acceptable grep could be found in $PATH$PATH_SEPARATOR/usr/xpg4/bin" "$LINENO" 5
   fi
 else
   ac_cv_path_GREP=$GREP
 fi
 
 fi
-{ $as_echo "$as_me:$LINENO: result: $ac_cv_path_GREP" >&5
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_path_GREP" >&5
 $as_echo "$ac_cv_path_GREP" >&6; }
  GREP="$ac_cv_path_GREP"
 
 
-{ $as_echo "$as_me:$LINENO: checking for egrep" >&5
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for egrep" >&5
 $as_echo_n "checking for egrep... " >&6; }
-if test "${ac_cv_path_EGREP+set}" = set; then
+if test "${ac_cv_path_EGREP+set}" = set; then :
   $as_echo_n "(cached) " >&6
 else
   if echo a | $GREP -E '(a|b)' >/dev/null 2>&1
@@ -3134,7 +3421,7 @@
 do
   IFS=$as_save_IFS
   test -z "$as_dir" && as_dir=.
-  for ac_prog in egrep; do
+    for ac_prog in egrep; do
     for ac_exec_ext in '' $ac_executable_extensions; do
       ac_path_EGREP="$as_dir/$ac_prog$ac_exec_ext"
       { test -f "$ac_path_EGREP" && $as_test_x "$ac_path_EGREP"; } || continue
@@ -3154,7 +3441,7 @@
     $as_echo 'EGREP' >> "conftest.nl"
     "$ac_path_EGREP" 'EGREP$' < "conftest.nl" >"conftest.out" 2>/dev/null || break
     diff "conftest.out" "conftest.nl" >/dev/null 2>&1 || break
-    ac_count=`expr $ac_count + 1`
+    as_fn_arith $ac_count + 1 && ac_count=$as_val
     if test $ac_count -gt ${ac_path_EGREP_max-0}; then
       # Best one so far, save it but keep looking for a better one
       ac_cv_path_EGREP="$ac_path_EGREP"
@@ -3169,12 +3456,10 @@
       $ac_path_EGREP_found && break 3
     done
   done
-done
+  done
 IFS=$as_save_IFS
   if test -z "$ac_cv_path_EGREP"; then
-    { { $as_echo "$as_me:$LINENO: error: no acceptable egrep could be found in $PATH$PATH_SEPARATOR/usr/xpg4/bin" >&5
-$as_echo "$as_me: error: no acceptable egrep could be found in $PATH$PATH_SEPARATOR/usr/xpg4/bin" >&2;}
-   { (exit 1); exit 1; }; }
+    as_fn_error "no acceptable egrep could be found in $PATH$PATH_SEPARATOR/usr/xpg4/bin" "$LINENO" 5
   fi
 else
   ac_cv_path_EGREP=$EGREP
@@ -3182,21 +3467,17 @@
 
    fi
 fi
-{ $as_echo "$as_me:$LINENO: result: $ac_cv_path_EGREP" >&5
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_path_EGREP" >&5
 $as_echo "$ac_cv_path_EGREP" >&6; }
  EGREP="$ac_cv_path_EGREP"
 
 
-{ $as_echo "$as_me:$LINENO: checking for ANSI C header files" >&5
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for ANSI C header files" >&5
 $as_echo_n "checking for ANSI C header files... " >&6; }
-if test "${ac_cv_header_stdc+set}" = set; then
+if test "${ac_cv_header_stdc+set}" = set; then :
   $as_echo_n "(cached) " >&6
 else
-  cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
 #include <stdlib.h>
 #include <stdarg.h>
@@ -3211,48 +3492,23 @@
   return 0;
 }
 _ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
+if ac_fn_c_try_compile "$LINENO"; then :
   ac_cv_header_stdc=yes
 else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-	ac_cv_header_stdc=no
+  ac_cv_header_stdc=no
 fi
-
 rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
 
 if test $ac_cv_header_stdc = yes; then
   # SunOS 4.x string.h does not declare mem*, contrary to ANSI.
-  cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
 #include <string.h>
 
 _ACEOF
 if (eval "$ac_cpp conftest.$ac_ext") 2>&5 |
-  $EGREP "memchr" >/dev/null 2>&1; then
-  :
+  $EGREP "memchr" >/dev/null 2>&1; then :
+
 else
   ac_cv_header_stdc=no
 fi
@@ -3262,18 +3518,14 @@
 
 if test $ac_cv_header_stdc = yes; then
   # ISC 2.0.2 stdlib.h does not declare free, contrary to ANSI.
-  cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
 #include <stdlib.h>
 
 _ACEOF
 if (eval "$ac_cpp conftest.$ac_ext") 2>&5 |
-  $EGREP "free" >/dev/null 2>&1; then
-  :
+  $EGREP "free" >/dev/null 2>&1; then :
+
 else
   ac_cv_header_stdc=no
 fi
@@ -3283,14 +3535,10 @@
 
 if test $ac_cv_header_stdc = yes; then
   # /bin/cc in Irix-4.0.5 gets non-ANSI ctype macros unless using -ansi.
-  if test "$cross_compiling" = yes; then
+  if test "$cross_compiling" = yes; then :
   :
 else
-  cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
 #include <ctype.h>
 #include <stdlib.h>
@@ -3317,118 +3565,34 @@
   return 0;
 }
 _ACEOF
-rm -f conftest$ac_exeext
-if { (ac_try="$ac_link"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_link") 2>&5
-  ac_status=$?
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && { ac_try='./conftest$ac_exeext'
-  { (case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_try") 2>&5
-  ac_status=$?
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); }; }; then
-  :
-else
-  $as_echo "$as_me: program exited with status $ac_status" >&5
-$as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
+if ac_fn_c_try_run "$LINENO"; then :
 
-( exit $ac_status )
-ac_cv_header_stdc=no
+else
+  ac_cv_header_stdc=no
 fi
-rm -rf conftest.dSYM
-rm -f core *.core core.conftest.* gmon.out bb.out conftest$ac_exeext conftest.$ac_objext conftest.$ac_ext
+rm -f core *.core core.conftest.* gmon.out bb.out conftest$ac_exeext \
+  conftest.$ac_objext conftest.beam conftest.$ac_ext
 fi
 
-
 fi
 fi
-{ $as_echo "$as_me:$LINENO: result: $ac_cv_header_stdc" >&5
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_header_stdc" >&5
 $as_echo "$ac_cv_header_stdc" >&6; }
 if test $ac_cv_header_stdc = yes; then
 
-cat >>confdefs.h <<\_ACEOF
-#define STDC_HEADERS 1
-_ACEOF
+$as_echo "#define STDC_HEADERS 1" >>confdefs.h
 
 fi
 
 # On IRIX 5.3, sys/types and inttypes.h are conflicting.
-
-
-
-
-
-
-
-
-
 for ac_header in sys/types.h sys/stat.h stdlib.h string.h memory.h strings.h \
 		  inttypes.h stdint.h unistd.h
-do
-as_ac_Header=`$as_echo "ac_cv_header_$ac_header" | $as_tr_sh`
-{ $as_echo "$as_me:$LINENO: checking for $ac_header" >&5
-$as_echo_n "checking for $ac_header... " >&6; }
-if { as_var=$as_ac_Header; eval "test \"\${$as_var+set}\" = set"; }; then
-  $as_echo_n "(cached) " >&6
-else
-  cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
-/* end confdefs.h.  */
-$ac_includes_default
-
-#include <$ac_header>
-_ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
-  eval "$as_ac_Header=yes"
-else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-	eval "$as_ac_Header=no"
-fi
-
-rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
-fi
-ac_res=`eval 'as_val=${'$as_ac_Header'}
-		 $as_echo "$as_val"'`
-	       { $as_echo "$as_me:$LINENO: result: $ac_res" >&5
-$as_echo "$ac_res" >&6; }
-as_val=`eval 'as_val=${'$as_ac_Header'}
-		 $as_echo "$as_val"'`
-   if test "x$as_val" = x""yes; then
+do :
+  as_ac_Header=`$as_echo "ac_cv_header_$ac_header" | $as_tr_sh`
+ac_fn_c_check_header_compile "$LINENO" "$ac_header" "$as_ac_Header" "$ac_includes_default
+"
+eval as_val=\$$as_ac_Header
+   if test "x$as_val" = x""yes; then :
   cat >>confdefs.h <<_ACEOF
 #define `$as_echo "HAVE_$ac_header" | $as_tr_cpp` 1
 _ACEOF
@@ -3439,134 +3603,8 @@
 
 
 
-  if test "${ac_cv_header_minix_config_h+set}" = set; then
-  { $as_echo "$as_me:$LINENO: checking for minix/config.h" >&5
-$as_echo_n "checking for minix/config.h... " >&6; }
-if test "${ac_cv_header_minix_config_h+set}" = set; then
-  $as_echo_n "(cached) " >&6
-fi
-{ $as_echo "$as_me:$LINENO: result: $ac_cv_header_minix_config_h" >&5
-$as_echo "$ac_cv_header_minix_config_h" >&6; }
-else
-  # Is the header compilable?
-{ $as_echo "$as_me:$LINENO: checking minix/config.h usability" >&5
-$as_echo_n "checking minix/config.h usability... " >&6; }
-cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
-/* end confdefs.h.  */
-$ac_includes_default
-#include <minix/config.h>
-_ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
-  ac_header_compiler=yes
-else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-	ac_header_compiler=no
-fi
-
-rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
-{ $as_echo "$as_me:$LINENO: result: $ac_header_compiler" >&5
-$as_echo "$ac_header_compiler" >&6; }
-
-# Is the header present?
-{ $as_echo "$as_me:$LINENO: checking minix/config.h presence" >&5
-$as_echo_n "checking minix/config.h presence... " >&6; }
-cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
-/* end confdefs.h.  */
-#include <minix/config.h>
-_ACEOF
-if { (ac_try="$ac_cpp conftest.$ac_ext"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_cpp conftest.$ac_ext") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } >/dev/null && {
-	 test -z "$ac_c_preproc_warn_flag$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       }; then
-  ac_header_preproc=yes
-else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-  ac_header_preproc=no
-fi
-
-rm -f conftest.err conftest.$ac_ext
-{ $as_echo "$as_me:$LINENO: result: $ac_header_preproc" >&5
-$as_echo "$ac_header_preproc" >&6; }
-
-# So?  What about this header?
-case $ac_header_compiler:$ac_header_preproc:$ac_c_preproc_warn_flag in
-  yes:no: )
-    { $as_echo "$as_me:$LINENO: WARNING: minix/config.h: accepted by the compiler, rejected by the preprocessor!" >&5
-$as_echo "$as_me: WARNING: minix/config.h: accepted by the compiler, rejected by the preprocessor!" >&2;}
-    { $as_echo "$as_me:$LINENO: WARNING: minix/config.h: proceeding with the compiler's result" >&5
-$as_echo "$as_me: WARNING: minix/config.h: proceeding with the compiler's result" >&2;}
-    ac_header_preproc=yes
-    ;;
-  no:yes:* )
-    { $as_echo "$as_me:$LINENO: WARNING: minix/config.h: present but cannot be compiled" >&5
-$as_echo "$as_me: WARNING: minix/config.h: present but cannot be compiled" >&2;}
-    { $as_echo "$as_me:$LINENO: WARNING: minix/config.h:     check for missing prerequisite headers?" >&5
-$as_echo "$as_me: WARNING: minix/config.h:     check for missing prerequisite headers?" >&2;}
-    { $as_echo "$as_me:$LINENO: WARNING: minix/config.h: see the Autoconf documentation" >&5
-$as_echo "$as_me: WARNING: minix/config.h: see the Autoconf documentation" >&2;}
-    { $as_echo "$as_me:$LINENO: WARNING: minix/config.h:     section \"Present But Cannot Be Compiled\"" >&5
-$as_echo "$as_me: WARNING: minix/config.h:     section \"Present But Cannot Be Compiled\"" >&2;}
-    { $as_echo "$as_me:$LINENO: WARNING: minix/config.h: proceeding with the preprocessor's result" >&5
-$as_echo "$as_me: WARNING: minix/config.h: proceeding with the preprocessor's result" >&2;}
-    { $as_echo "$as_me:$LINENO: WARNING: minix/config.h: in the future, the compiler will take precedence" >&5
-$as_echo "$as_me: WARNING: minix/config.h: in the future, the compiler will take precedence" >&2;}
-
-    ;;
-esac
-{ $as_echo "$as_me:$LINENO: checking for minix/config.h" >&5
-$as_echo_n "checking for minix/config.h... " >&6; }
-if test "${ac_cv_header_minix_config_h+set}" = set; then
-  $as_echo_n "(cached) " >&6
-else
-  ac_cv_header_minix_config_h=$ac_header_preproc
-fi
-{ $as_echo "$as_me:$LINENO: result: $ac_cv_header_minix_config_h" >&5
-$as_echo "$ac_cv_header_minix_config_h" >&6; }
-
-fi
-if test "x$ac_cv_header_minix_config_h" = x""yes; then
+  ac_fn_c_check_header_mongrel "$LINENO" "minix/config.h" "ac_cv_header_minix_config_h" "$ac_includes_default"
+if test "x$ac_cv_header_minix_config_h" = x""yes; then :
   MINIX=yes
 else
   MINIX=
@@ -3575,34 +3613,23 @@
 
   if test "$MINIX" = yes; then
 
-cat >>confdefs.h <<\_ACEOF
-#define _POSIX_SOURCE 1
-_ACEOF
+$as_echo "#define _POSIX_SOURCE 1" >>confdefs.h
 
 
-cat >>confdefs.h <<\_ACEOF
-#define _POSIX_1_SOURCE 2
-_ACEOF
+$as_echo "#define _POSIX_1_SOURCE 2" >>confdefs.h
 
 
-cat >>confdefs.h <<\_ACEOF
-#define _MINIX 1
-_ACEOF
+$as_echo "#define _MINIX 1" >>confdefs.h
 
   fi
 
 
-
-  { $as_echo "$as_me:$LINENO: checking whether it is safe to define __EXTENSIONS__" >&5
+  { $as_echo "$as_me:${as_lineno-$LINENO}: checking whether it is safe to define __EXTENSIONS__" >&5
 $as_echo_n "checking whether it is safe to define __EXTENSIONS__... " >&6; }
-if test "${ac_cv_safe_to_define___extensions__+set}" = set; then
+if test "${ac_cv_safe_to_define___extensions__+set}" = set; then :
   $as_echo_n "(cached) " >&6
 else
-  cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
 
 #	  define __EXTENSIONS__ 1
@@ -3615,56 +3642,26 @@
   return 0;
 }
 _ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
+if ac_fn_c_try_compile "$LINENO"; then :
   ac_cv_safe_to_define___extensions__=yes
 else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-	ac_cv_safe_to_define___extensions__=no
+  ac_cv_safe_to_define___extensions__=no
 fi
-
 rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
 fi
-{ $as_echo "$as_me:$LINENO: result: $ac_cv_safe_to_define___extensions__" >&5
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_safe_to_define___extensions__" >&5
 $as_echo "$ac_cv_safe_to_define___extensions__" >&6; }
   test $ac_cv_safe_to_define___extensions__ = yes &&
-    cat >>confdefs.h <<\_ACEOF
-#define __EXTENSIONS__ 1
-_ACEOF
+    $as_echo "#define __EXTENSIONS__ 1" >>confdefs.h
 
-  cat >>confdefs.h <<\_ACEOF
-#define _ALL_SOURCE 1
-_ACEOF
+  $as_echo "#define _ALL_SOURCE 1" >>confdefs.h
 
-  cat >>confdefs.h <<\_ACEOF
-#define _GNU_SOURCE 1
-_ACEOF
+  $as_echo "#define _GNU_SOURCE 1" >>confdefs.h
 
-  cat >>confdefs.h <<\_ACEOF
-#define _POSIX_PTHREAD_SEMANTICS 1
-_ACEOF
+  $as_echo "#define _POSIX_PTHREAD_SEMANTICS 1" >>confdefs.h
+
+  $as_echo "#define _TANDEM_SOURCE 1" >>confdefs.h
 
-  cat >>confdefs.h <<\_ACEOF
-#define _TANDEM_SOURCE 1
-_ACEOF
 
 
 
@@ -3710,7 +3707,7 @@
 
 
 # Check whether --with-defaultoptions was given.
-if test "${with_defaultoptions+set}" = set; then
+if test "${with_defaultoptions+set}" = set; then :
   withval=$with_defaultoptions;
 else
   with_defaultoptions=".configure"
@@ -3747,24 +3744,16 @@
 
 ac_aux_dir=
 for ac_dir in "$srcdir" "$srcdir/.." "$srcdir/../.."; do
-  if test -f "$ac_dir/install-sh"; then
-    ac_aux_dir=$ac_dir
-    ac_install_sh="$ac_aux_dir/install-sh -c"
-    break
-  elif test -f "$ac_dir/install.sh"; then
-    ac_aux_dir=$ac_dir
-    ac_install_sh="$ac_aux_dir/install.sh -c"
-    break
-  elif test -f "$ac_dir/shtool"; then
-    ac_aux_dir=$ac_dir
-    ac_install_sh="$ac_aux_dir/shtool install -c"
-    break
-  fi
+  for ac_t in install-sh install.sh shtool; do
+    if test -f "$ac_dir/$ac_t"; then
+      ac_aux_dir=$ac_dir
+      ac_install_sh="$ac_aux_dir/$ac_t -c"
+      break 2
+    fi
+  done
 done
 if test -z "$ac_aux_dir"; then
-  { { $as_echo "$as_me:$LINENO: error: cannot find install-sh or install.sh in \"$srcdir\" \"$srcdir/..\" \"$srcdir/../..\"" >&5
-$as_echo "$as_me: error: cannot find install-sh or install.sh in \"$srcdir\" \"$srcdir/..\" \"$srcdir/../..\"" >&2;}
-   { (exit 1); exit 1; }; }
+  as_fn_error "cannot find install-sh, install.sh, or shtool in \"$srcdir\" \"$srcdir/..\" \"$srcdir/../..\"" "$LINENO" 5
 fi
 
 # These three variables are undocumented and unsupported,
@@ -3778,35 +3767,27 @@
 
 # Make sure we can run config.sub.
 $SHELL "$ac_aux_dir/config.sub" sun4 >/dev/null 2>&1 ||
-  { { $as_echo "$as_me:$LINENO: error: cannot run $SHELL $ac_aux_dir/config.sub" >&5
-$as_echo "$as_me: error: cannot run $SHELL $ac_aux_dir/config.sub" >&2;}
-   { (exit 1); exit 1; }; }
+  as_fn_error "cannot run $SHELL $ac_aux_dir/config.sub" "$LINENO" 5
 
-{ $as_echo "$as_me:$LINENO: checking build system type" >&5
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking build system type" >&5
 $as_echo_n "checking build system type... " >&6; }
-if test "${ac_cv_build+set}" = set; then
+if test "${ac_cv_build+set}" = set; then :
   $as_echo_n "(cached) " >&6
 else
   ac_build_alias=$build_alias
 test "x$ac_build_alias" = x &&
   ac_build_alias=`$SHELL "$ac_aux_dir/config.guess"`
 test "x$ac_build_alias" = x &&
-  { { $as_echo "$as_me:$LINENO: error: cannot guess build type; you must specify one" >&5
-$as_echo "$as_me: error: cannot guess build type; you must specify one" >&2;}
-   { (exit 1); exit 1; }; }
+  as_fn_error "cannot guess build type; you must specify one" "$LINENO" 5
 ac_cv_build=`$SHELL "$ac_aux_dir/config.sub" $ac_build_alias` ||
-  { { $as_echo "$as_me:$LINENO: error: $SHELL $ac_aux_dir/config.sub $ac_build_alias failed" >&5
-$as_echo "$as_me: error: $SHELL $ac_aux_dir/config.sub $ac_build_alias failed" >&2;}
-   { (exit 1); exit 1; }; }
+  as_fn_error "$SHELL $ac_aux_dir/config.sub $ac_build_alias failed" "$LINENO" 5
 
 fi
-{ $as_echo "$as_me:$LINENO: result: $ac_cv_build" >&5
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_build" >&5
 $as_echo "$ac_cv_build" >&6; }
 case $ac_cv_build in
 *-*-*) ;;
-*) { { $as_echo "$as_me:$LINENO: error: invalid value of canonical build" >&5
-$as_echo "$as_me: error: invalid value of canonical build" >&2;}
-   { (exit 1); exit 1; }; };;
+*) as_fn_error "invalid value of canonical build" "$LINENO" 5;;
 esac
 build=$ac_cv_build
 ac_save_IFS=$IFS; IFS='-'
@@ -3822,28 +3803,24 @@
 case $build_os in *\ *) build_os=`echo "$build_os" | sed 's/ /-/g'`;; esac
 
 
-{ $as_echo "$as_me:$LINENO: checking host system type" >&5
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking host system type" >&5
 $as_echo_n "checking host system type... " >&6; }
-if test "${ac_cv_host+set}" = set; then
+if test "${ac_cv_host+set}" = set; then :
   $as_echo_n "(cached) " >&6
 else
   if test "x$host_alias" = x; then
   ac_cv_host=$ac_cv_build
 else
   ac_cv_host=`$SHELL "$ac_aux_dir/config.sub" $host_alias` ||
-    { { $as_echo "$as_me:$LINENO: error: $SHELL $ac_aux_dir/config.sub $host_alias failed" >&5
-$as_echo "$as_me: error: $SHELL $ac_aux_dir/config.sub $host_alias failed" >&2;}
-   { (exit 1); exit 1; }; }
+    as_fn_error "$SHELL $ac_aux_dir/config.sub $host_alias failed" "$LINENO" 5
 fi
 
 fi
-{ $as_echo "$as_me:$LINENO: result: $ac_cv_host" >&5
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_host" >&5
 $as_echo "$ac_cv_host" >&6; }
 case $ac_cv_host in
 *-*-*) ;;
-*) { { $as_echo "$as_me:$LINENO: error: invalid value of canonical host" >&5
-$as_echo "$as_me: error: invalid value of canonical host" >&2;}
-   { (exit 1); exit 1; }; };;
+*) as_fn_error "invalid value of canonical host" "$LINENO" 5;;
 esac
 host=$ac_cv_host
 ac_save_IFS=$IFS; IFS='-'
@@ -3859,28 +3836,24 @@
 case $host_os in *\ *) host_os=`echo "$host_os" | sed 's/ /-/g'`;; esac
 
 
-{ $as_echo "$as_me:$LINENO: checking target system type" >&5
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking target system type" >&5
 $as_echo_n "checking target system type... " >&6; }
-if test "${ac_cv_target+set}" = set; then
+if test "${ac_cv_target+set}" = set; then :
   $as_echo_n "(cached) " >&6
 else
   if test "x$target_alias" = x; then
   ac_cv_target=$ac_cv_host
 else
   ac_cv_target=`$SHELL "$ac_aux_dir/config.sub" $target_alias` ||
-    { { $as_echo "$as_me:$LINENO: error: $SHELL $ac_aux_dir/config.sub $target_alias failed" >&5
-$as_echo "$as_me: error: $SHELL $ac_aux_dir/config.sub $target_alias failed" >&2;}
-   { (exit 1); exit 1; }; }
+    as_fn_error "$SHELL $ac_aux_dir/config.sub $target_alias failed" "$LINENO" 5
 fi
 
 fi
-{ $as_echo "$as_me:$LINENO: result: $ac_cv_target" >&5
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_target" >&5
 $as_echo "$ac_cv_target" >&6; }
 case $ac_cv_target in
 *-*-*) ;;
-*) { { $as_echo "$as_me:$LINENO: error: invalid value of canonical target" >&5
-$as_echo "$as_me: error: invalid value of canonical target" >&2;}
-   { (exit 1); exit 1; }; };;
+*) as_fn_error "invalid value of canonical target" "$LINENO" 5;;
 esac
 target=$ac_cv_target
 ac_save_IFS=$IFS; IFS='-'
@@ -3903,6 +3876,7 @@
     NONENONEs,x,x, &&
   program_prefix=${target_alias}-
 
+
 ac_ext=c
 ac_cpp='$CPP $CPPFLAGS'
 ac_compile='$CC -c $CFLAGS $CPPFLAGS conftest.$ac_ext >&5'
@@ -3911,9 +3885,9 @@
 if test -n "$ac_tool_prefix"; then
   # Extract the first word of "${ac_tool_prefix}gcc", so it can be a program name with args.
 set dummy ${ac_tool_prefix}gcc; ac_word=$2
-{ $as_echo "$as_me:$LINENO: checking for $ac_word" >&5
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for $ac_word" >&5
 $as_echo_n "checking for $ac_word... " >&6; }
-if test "${ac_cv_prog_CC+set}" = set; then
+if test "${ac_cv_prog_CC+set}" = set; then :
   $as_echo_n "(cached) " >&6
 else
   if test -n "$CC"; then
@@ -3924,24 +3898,24 @@
 do
   IFS=$as_save_IFS
   test -z "$as_dir" && as_dir=.
-  for ac_exec_ext in '' $ac_executable_extensions; do
+    for ac_exec_ext in '' $ac_executable_extensions; do
   if { test -f "$as_dir/$ac_word$ac_exec_ext" && $as_test_x "$as_dir/$ac_word$ac_exec_ext"; }; then
     ac_cv_prog_CC="${ac_tool_prefix}gcc"
-    $as_echo "$as_me:$LINENO: found $as_dir/$ac_word$ac_exec_ext" >&5
+    $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
     break 2
   fi
 done
-done
+  done
 IFS=$as_save_IFS
 
 fi
 fi
 CC=$ac_cv_prog_CC
 if test -n "$CC"; then
-  { $as_echo "$as_me:$LINENO: result: $CC" >&5
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $CC" >&5
 $as_echo "$CC" >&6; }
 else
-  { $as_echo "$as_me:$LINENO: result: no" >&5
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
 $as_echo "no" >&6; }
 fi
 
@@ -3951,9 +3925,9 @@
   ac_ct_CC=$CC
   # Extract the first word of "gcc", so it can be a program name with args.
 set dummy gcc; ac_word=$2
-{ $as_echo "$as_me:$LINENO: checking for $ac_word" >&5
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for $ac_word" >&5
 $as_echo_n "checking for $ac_word... " >&6; }
-if test "${ac_cv_prog_ac_ct_CC+set}" = set; then
+if test "${ac_cv_prog_ac_ct_CC+set}" = set; then :
   $as_echo_n "(cached) " >&6
 else
   if test -n "$ac_ct_CC"; then
@@ -3964,24 +3938,24 @@
 do
   IFS=$as_save_IFS
   test -z "$as_dir" && as_dir=.
-  for ac_exec_ext in '' $ac_executable_extensions; do
+    for ac_exec_ext in '' $ac_executable_extensions; do
   if { test -f "$as_dir/$ac_word$ac_exec_ext" && $as_test_x "$as_dir/$ac_word$ac_exec_ext"; }; then
     ac_cv_prog_ac_ct_CC="gcc"
-    $as_echo "$as_me:$LINENO: found $as_dir/$ac_word$ac_exec_ext" >&5
+    $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
     break 2
   fi
 done
-done
+  done
 IFS=$as_save_IFS
 
 fi
 fi
 ac_ct_CC=$ac_cv_prog_ac_ct_CC
 if test -n "$ac_ct_CC"; then
-  { $as_echo "$as_me:$LINENO: result: $ac_ct_CC" >&5
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_ct_CC" >&5
 $as_echo "$ac_ct_CC" >&6; }
 else
-  { $as_echo "$as_me:$LINENO: result: no" >&5
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
 $as_echo "no" >&6; }
 fi
 
@@ -3990,7 +3964,7 @@
   else
     case $cross_compiling:$ac_tool_warned in
 yes:)
-{ $as_echo "$as_me:$LINENO: WARNING: using cross tools not prefixed with host triplet" >&5
+{ $as_echo "$as_me:${as_lineno-$LINENO}: WARNING: using cross tools not prefixed with host triplet" >&5
 $as_echo "$as_me: WARNING: using cross tools not prefixed with host triplet" >&2;}
 ac_tool_warned=yes ;;
 esac
@@ -4004,9 +3978,9 @@
           if test -n "$ac_tool_prefix"; then
     # Extract the first word of "${ac_tool_prefix}cc", so it can be a program name with args.
 set dummy ${ac_tool_prefix}cc; ac_word=$2
-{ $as_echo "$as_me:$LINENO: checking for $ac_word" >&5
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for $ac_word" >&5
 $as_echo_n "checking for $ac_word... " >&6; }
-if test "${ac_cv_prog_CC+set}" = set; then
+if test "${ac_cv_prog_CC+set}" = set; then :
   $as_echo_n "(cached) " >&6
 else
   if test -n "$CC"; then
@@ -4017,24 +3991,24 @@
 do
   IFS=$as_save_IFS
   test -z "$as_dir" && as_dir=.
-  for ac_exec_ext in '' $ac_executable_extensions; do
+    for ac_exec_ext in '' $ac_executable_extensions; do
   if { test -f "$as_dir/$ac_word$ac_exec_ext" && $as_test_x "$as_dir/$ac_word$ac_exec_ext"; }; then
     ac_cv_prog_CC="${ac_tool_prefix}cc"
-    $as_echo "$as_me:$LINENO: found $as_dir/$ac_word$ac_exec_ext" >&5
+    $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
     break 2
   fi
 done
-done
+  done
 IFS=$as_save_IFS
 
 fi
 fi
 CC=$ac_cv_prog_CC
 if test -n "$CC"; then
-  { $as_echo "$as_me:$LINENO: result: $CC" >&5
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $CC" >&5
 $as_echo "$CC" >&6; }
 else
-  { $as_echo "$as_me:$LINENO: result: no" >&5
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
 $as_echo "no" >&6; }
 fi
 
@@ -4044,9 +4018,9 @@
 if test -z "$CC"; then
   # Extract the first word of "cc", so it can be a program name with args.
 set dummy cc; ac_word=$2
-{ $as_echo "$as_me:$LINENO: checking for $ac_word" >&5
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for $ac_word" >&5
 $as_echo_n "checking for $ac_word... " >&6; }
-if test "${ac_cv_prog_CC+set}" = set; then
+if test "${ac_cv_prog_CC+set}" = set; then :
   $as_echo_n "(cached) " >&6
 else
   if test -n "$CC"; then
@@ -4058,18 +4032,18 @@
 do
   IFS=$as_save_IFS
   test -z "$as_dir" && as_dir=.
-  for ac_exec_ext in '' $ac_executable_extensions; do
+    for ac_exec_ext in '' $ac_executable_extensions; do
   if { test -f "$as_dir/$ac_word$ac_exec_ext" && $as_test_x "$as_dir/$ac_word$ac_exec_ext"; }; then
     if test "$as_dir/$ac_word$ac_exec_ext" = "/usr/ucb/cc"; then
        ac_prog_rejected=yes
        continue
      fi
     ac_cv_prog_CC="cc"
-    $as_echo "$as_me:$LINENO: found $as_dir/$ac_word$ac_exec_ext" >&5
+    $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
     break 2
   fi
 done
-done
+  done
 IFS=$as_save_IFS
 
 if test $ac_prog_rejected = yes; then
@@ -4088,10 +4062,10 @@
 fi
 CC=$ac_cv_prog_CC
 if test -n "$CC"; then
-  { $as_echo "$as_me:$LINENO: result: $CC" >&5
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $CC" >&5
 $as_echo "$CC" >&6; }
 else
-  { $as_echo "$as_me:$LINENO: result: no" >&5
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
 $as_echo "no" >&6; }
 fi
 
@@ -4103,9 +4077,9 @@
   do
     # Extract the first word of "$ac_tool_prefix$ac_prog", so it can be a program name with args.
 set dummy $ac_tool_prefix$ac_prog; ac_word=$2
-{ $as_echo "$as_me:$LINENO: checking for $ac_word" >&5
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for $ac_word" >&5
 $as_echo_n "checking for $ac_word... " >&6; }
-if test "${ac_cv_prog_CC+set}" = set; then
+if test "${ac_cv_prog_CC+set}" = set; then :
   $as_echo_n "(cached) " >&6
 else
   if test -n "$CC"; then
@@ -4116,24 +4090,24 @@
 do
   IFS=$as_save_IFS
   test -z "$as_dir" && as_dir=.
-  for ac_exec_ext in '' $ac_executable_extensions; do
+    for ac_exec_ext in '' $ac_executable_extensions; do
   if { test -f "$as_dir/$ac_word$ac_exec_ext" && $as_test_x "$as_dir/$ac_word$ac_exec_ext"; }; then
     ac_cv_prog_CC="$ac_tool_prefix$ac_prog"
-    $as_echo "$as_me:$LINENO: found $as_dir/$ac_word$ac_exec_ext" >&5
+    $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
     break 2
   fi
 done
-done
+  done
 IFS=$as_save_IFS
 
 fi
 fi
 CC=$ac_cv_prog_CC
 if test -n "$CC"; then
-  { $as_echo "$as_me:$LINENO: result: $CC" >&5
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $CC" >&5
 $as_echo "$CC" >&6; }
 else
-  { $as_echo "$as_me:$LINENO: result: no" >&5
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
 $as_echo "no" >&6; }
 fi
 
@@ -4147,9 +4121,9 @@
 do
   # Extract the first word of "$ac_prog", so it can be a program name with args.
 set dummy $ac_prog; ac_word=$2
-{ $as_echo "$as_me:$LINENO: checking for $ac_word" >&5
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for $ac_word" >&5
 $as_echo_n "checking for $ac_word... " >&6; }
-if test "${ac_cv_prog_ac_ct_CC+set}" = set; then
+if test "${ac_cv_prog_ac_ct_CC+set}" = set; then :
   $as_echo_n "(cached) " >&6
 else
   if test -n "$ac_ct_CC"; then
@@ -4160,24 +4134,24 @@
 do
   IFS=$as_save_IFS
   test -z "$as_dir" && as_dir=.
-  for ac_exec_ext in '' $ac_executable_extensions; do
+    for ac_exec_ext in '' $ac_executable_extensions; do
   if { test -f "$as_dir/$ac_word$ac_exec_ext" && $as_test_x "$as_dir/$ac_word$ac_exec_ext"; }; then
     ac_cv_prog_ac_ct_CC="$ac_prog"
-    $as_echo "$as_me:$LINENO: found $as_dir/$ac_word$ac_exec_ext" >&5
+    $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
     break 2
   fi
 done
-done
+  done
 IFS=$as_save_IFS
 
 fi
 fi
 ac_ct_CC=$ac_cv_prog_ac_ct_CC
 if test -n "$ac_ct_CC"; then
-  { $as_echo "$as_me:$LINENO: result: $ac_ct_CC" >&5
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_ct_CC" >&5
 $as_echo "$ac_ct_CC" >&6; }
 else
-  { $as_echo "$as_me:$LINENO: result: no" >&5
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
 $as_echo "no" >&6; }
 fi
 
@@ -4190,7 +4164,7 @@
   else
     case $cross_compiling:$ac_tool_warned in
 yes:)
-{ $as_echo "$as_me:$LINENO: WARNING: using cross tools not prefixed with host triplet" >&5
+{ $as_echo "$as_me:${as_lineno-$LINENO}: WARNING: using cross tools not prefixed with host triplet" >&5
 $as_echo "$as_me: WARNING: using cross tools not prefixed with host triplet" >&2;}
 ac_tool_warned=yes ;;
 esac
@@ -4201,62 +4175,42 @@
 fi
 
 
-test -z "$CC" && { { $as_echo "$as_me:$LINENO: error: in \`$ac_pwd':" >&5
+test -z "$CC" && { { $as_echo "$as_me:${as_lineno-$LINENO}: error: in \`$ac_pwd':" >&5
 $as_echo "$as_me: error: in \`$ac_pwd':" >&2;}
-{ { $as_echo "$as_me:$LINENO: error: no acceptable C compiler found in \$PATH
-See \`config.log' for more details." >&5
-$as_echo "$as_me: error: no acceptable C compiler found in \$PATH
-See \`config.log' for more details." >&2;}
-   { (exit 1); exit 1; }; }; }
+as_fn_error "no acceptable C compiler found in \$PATH
+See \`config.log' for more details." "$LINENO" 5; }
 
 # Provide some information about the compiler.
-$as_echo "$as_me:$LINENO: checking for C compiler version" >&5
+$as_echo "$as_me:${as_lineno-$LINENO}: checking for C compiler version" >&5
 set X $ac_compile
 ac_compiler=$2
-{ (ac_try="$ac_compiler --version >&5"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compiler --version >&5") 2>&5
-  ac_status=$?
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); }
-{ (ac_try="$ac_compiler -v >&5"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compiler -v >&5") 2>&5
-  ac_status=$?
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); }
-{ (ac_try="$ac_compiler -V >&5"
+for ac_option in --version -v -V -qversion; do
+  { { ac_try="$ac_compiler $ac_option >&5"
 case "(($ac_try" in
   *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
   *) ac_try_echo=$ac_try;;
 esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compiler -V >&5") 2>&5
+eval ac_try_echo="\"\$as_me:${as_lineno-$LINENO}: $ac_try_echo\""
+$as_echo "$ac_try_echo"; } >&5
+  (eval "$ac_compiler $ac_option >&5") 2>conftest.err
   ac_status=$?
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); }
+  if test -s conftest.err; then
+    sed '10a\
+... rest of stderr output deleted ...
+         10q' conftest.err >conftest.er1
+    cat conftest.er1 >&5
+    rm -f conftest.er1 conftest.err
+  fi
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }
+done
 
-{ $as_echo "$as_me:$LINENO: checking whether we are using the GNU C compiler" >&5
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking whether we are using the GNU C compiler" >&5
 $as_echo_n "checking whether we are using the GNU C compiler... " >&6; }
-if test "${ac_cv_c_compiler_gnu+set}" = set; then
+if test "${ac_cv_c_compiler_gnu+set}" = set; then :
   $as_echo_n "(cached) " >&6
 else
-  cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
 
 int
@@ -4270,37 +4224,16 @@
   return 0;
 }
 _ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
+if ac_fn_c_try_compile "$LINENO"; then :
   ac_compiler_gnu=yes
 else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-	ac_compiler_gnu=no
+  ac_compiler_gnu=no
 fi
-
 rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
 ac_cv_c_compiler_gnu=$ac_compiler_gnu
 
 fi
-{ $as_echo "$as_me:$LINENO: result: $ac_cv_c_compiler_gnu" >&5
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_c_compiler_gnu" >&5
 $as_echo "$ac_cv_c_compiler_gnu" >&6; }
 if test $ac_compiler_gnu = yes; then
   GCC=yes
@@ -4309,20 +4242,16 @@
 fi
 ac_test_CFLAGS=${CFLAGS+set}
 ac_save_CFLAGS=$CFLAGS
-{ $as_echo "$as_me:$LINENO: checking whether $CC accepts -g" >&5
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking whether $CC accepts -g" >&5
 $as_echo_n "checking whether $CC accepts -g... " >&6; }
-if test "${ac_cv_prog_cc_g+set}" = set; then
+if test "${ac_cv_prog_cc_g+set}" = set; then :
   $as_echo_n "(cached) " >&6
 else
   ac_save_c_werror_flag=$ac_c_werror_flag
    ac_c_werror_flag=yes
    ac_cv_prog_cc_g=no
    CFLAGS="-g"
-   cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+   cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
 
 int
@@ -4333,35 +4262,11 @@
   return 0;
 }
 _ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
+if ac_fn_c_try_compile "$LINENO"; then :
   ac_cv_prog_cc_g=yes
 else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-	CFLAGS=""
-      cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+  CFLAGS=""
+      cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
 
 int
@@ -4372,36 +4277,12 @@
   return 0;
 }
 _ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
-  :
-else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
+if ac_fn_c_try_compile "$LINENO"; then :
 
-	ac_c_werror_flag=$ac_save_c_werror_flag
+else
+  ac_c_werror_flag=$ac_save_c_werror_flag
 	 CFLAGS="-g"
-	 cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+	 cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
 
 int
@@ -4412,42 +4293,17 @@
   return 0;
 }
 _ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
+if ac_fn_c_try_compile "$LINENO"; then :
   ac_cv_prog_cc_g=yes
-else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-
 fi
-
 rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
 fi
-
 rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
 fi
-
 rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
    ac_c_werror_flag=$ac_save_c_werror_flag
 fi
-{ $as_echo "$as_me:$LINENO: result: $ac_cv_prog_cc_g" >&5
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_prog_cc_g" >&5
 $as_echo "$ac_cv_prog_cc_g" >&6; }
 if test "$ac_test_CFLAGS" = set; then
   CFLAGS=$ac_save_CFLAGS
@@ -4464,18 +4320,14 @@
     CFLAGS=
   fi
 fi
-{ $as_echo "$as_me:$LINENO: checking for $CC option to accept ISO C89" >&5
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for $CC option to accept ISO C89" >&5
 $as_echo_n "checking for $CC option to accept ISO C89... " >&6; }
-if test "${ac_cv_prog_cc_c89+set}" = set; then
+if test "${ac_cv_prog_cc_c89+set}" = set; then :
   $as_echo_n "(cached) " >&6
 else
   ac_cv_prog_cc_c89=no
 ac_save_CC=$CC
-cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
 #include <stdarg.h>
 #include <stdio.h>
@@ -4532,32 +4384,9 @@
 	-Ae "-Aa -D_HPUX_SOURCE" "-Xc -D__EXTENSIONS__"
 do
   CC="$ac_save_CC $ac_arg"
-  rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
+  if ac_fn_c_try_compile "$LINENO"; then :
   ac_cv_prog_cc_c89=$ac_arg
-else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-
 fi
-
 rm -f core conftest.err conftest.$ac_objext
   test "x$ac_cv_prog_cc_c89" != "xno" && break
 done
@@ -4568,17 +4397,19 @@
 # AC_CACHE_VAL
 case "x$ac_cv_prog_cc_c89" in
   x)
-    { $as_echo "$as_me:$LINENO: result: none needed" >&5
+    { $as_echo "$as_me:${as_lineno-$LINENO}: result: none needed" >&5
 $as_echo "none needed" >&6; } ;;
   xno)
-    { $as_echo "$as_me:$LINENO: result: unsupported" >&5
+    { $as_echo "$as_me:${as_lineno-$LINENO}: result: unsupported" >&5
 $as_echo "unsupported" >&6; } ;;
   *)
     CC="$CC $ac_cv_prog_cc_c89"
-    { $as_echo "$as_me:$LINENO: result: $ac_cv_prog_cc_c89" >&5
+    { $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_prog_cc_c89" >&5
 $as_echo "$ac_cv_prog_cc_c89" >&6; } ;;
 esac
+if test "x$ac_cv_prog_cc_c89" != xno; then :
 
+fi
 
 ac_ext=c
 ac_cpp='$CPP $CPPFLAGS'
@@ -4600,9 +4431,9 @@
   do
     # Extract the first word of "$ac_tool_prefix$ac_prog", so it can be a program name with args.
 set dummy $ac_tool_prefix$ac_prog; ac_word=$2
-{ $as_echo "$as_me:$LINENO: checking for $ac_word" >&5
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for $ac_word" >&5
 $as_echo_n "checking for $ac_word... " >&6; }
-if test "${ac_cv_prog_CXX+set}" = set; then
+if test "${ac_cv_prog_CXX+set}" = set; then :
   $as_echo_n "(cached) " >&6
 else
   if test -n "$CXX"; then
@@ -4613,24 +4444,24 @@
 do
   IFS=$as_save_IFS
   test -z "$as_dir" && as_dir=.
-  for ac_exec_ext in '' $ac_executable_extensions; do
+    for ac_exec_ext in '' $ac_executable_extensions; do
   if { test -f "$as_dir/$ac_word$ac_exec_ext" && $as_test_x "$as_dir/$ac_word$ac_exec_ext"; }; then
     ac_cv_prog_CXX="$ac_tool_prefix$ac_prog"
-    $as_echo "$as_me:$LINENO: found $as_dir/$ac_word$ac_exec_ext" >&5
+    $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
     break 2
   fi
 done
-done
+  done
 IFS=$as_save_IFS
 
 fi
 fi
 CXX=$ac_cv_prog_CXX
 if test -n "$CXX"; then
-  { $as_echo "$as_me:$LINENO: result: $CXX" >&5
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $CXX" >&5
 $as_echo "$CXX" >&6; }
 else
-  { $as_echo "$as_me:$LINENO: result: no" >&5
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
 $as_echo "no" >&6; }
 fi
 
@@ -4644,9 +4475,9 @@
 do
   # Extract the first word of "$ac_prog", so it can be a program name with args.
 set dummy $ac_prog; ac_word=$2
-{ $as_echo "$as_me:$LINENO: checking for $ac_word" >&5
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for $ac_word" >&5
 $as_echo_n "checking for $ac_word... " >&6; }
-if test "${ac_cv_prog_ac_ct_CXX+set}" = set; then
+if test "${ac_cv_prog_ac_ct_CXX+set}" = set; then :
   $as_echo_n "(cached) " >&6
 else
   if test -n "$ac_ct_CXX"; then
@@ -4657,24 +4488,24 @@
 do
   IFS=$as_save_IFS
   test -z "$as_dir" && as_dir=.
-  for ac_exec_ext in '' $ac_executable_extensions; do
+    for ac_exec_ext in '' $ac_executable_extensions; do
   if { test -f "$as_dir/$ac_word$ac_exec_ext" && $as_test_x "$as_dir/$ac_word$ac_exec_ext"; }; then
     ac_cv_prog_ac_ct_CXX="$ac_prog"
-    $as_echo "$as_me:$LINENO: found $as_dir/$ac_word$ac_exec_ext" >&5
+    $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
     break 2
   fi
 done
-done
+  done
 IFS=$as_save_IFS
 
 fi
 fi
 ac_ct_CXX=$ac_cv_prog_ac_ct_CXX
 if test -n "$ac_ct_CXX"; then
-  { $as_echo "$as_me:$LINENO: result: $ac_ct_CXX" >&5
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_ct_CXX" >&5
 $as_echo "$ac_ct_CXX" >&6; }
 else
-  { $as_echo "$as_me:$LINENO: result: no" >&5
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
 $as_echo "no" >&6; }
 fi
 
@@ -4687,7 +4518,7 @@
   else
     case $cross_compiling:$ac_tool_warned in
 yes:)
-{ $as_echo "$as_me:$LINENO: WARNING: using cross tools not prefixed with host triplet" >&5
+{ $as_echo "$as_me:${as_lineno-$LINENO}: WARNING: using cross tools not prefixed with host triplet" >&5
 $as_echo "$as_me: WARNING: using cross tools not prefixed with host triplet" >&2;}
 ac_tool_warned=yes ;;
 esac
@@ -4698,53 +4529,36 @@
   fi
 fi
 # Provide some information about the compiler.
-$as_echo "$as_me:$LINENO: checking for C++ compiler version" >&5
+$as_echo "$as_me:${as_lineno-$LINENO}: checking for C++ compiler version" >&5
 set X $ac_compile
 ac_compiler=$2
-{ (ac_try="$ac_compiler --version >&5"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compiler --version >&5") 2>&5
-  ac_status=$?
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); }
-{ (ac_try="$ac_compiler -v >&5"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compiler -v >&5") 2>&5
-  ac_status=$?
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); }
-{ (ac_try="$ac_compiler -V >&5"
+for ac_option in --version -v -V -qversion; do
+  { { ac_try="$ac_compiler $ac_option >&5"
 case "(($ac_try" in
   *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
   *) ac_try_echo=$ac_try;;
 esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compiler -V >&5") 2>&5
+eval ac_try_echo="\"\$as_me:${as_lineno-$LINENO}: $ac_try_echo\""
+$as_echo "$ac_try_echo"; } >&5
+  (eval "$ac_compiler $ac_option >&5") 2>conftest.err
   ac_status=$?
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); }
+  if test -s conftest.err; then
+    sed '10a\
+... rest of stderr output deleted ...
+         10q' conftest.err >conftest.er1
+    cat conftest.er1 >&5
+    rm -f conftest.er1 conftest.err
+  fi
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }
+done
 
-{ $as_echo "$as_me:$LINENO: checking whether we are using the GNU C++ compiler" >&5
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking whether we are using the GNU C++ compiler" >&5
 $as_echo_n "checking whether we are using the GNU C++ compiler... " >&6; }
-if test "${ac_cv_cxx_compiler_gnu+set}" = set; then
+if test "${ac_cv_cxx_compiler_gnu+set}" = set; then :
   $as_echo_n "(cached) " >&6
 else
-  cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
 
 int
@@ -4758,37 +4572,16 @@
   return 0;
 }
 _ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_cxx_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
+if ac_fn_cxx_try_compile "$LINENO"; then :
   ac_compiler_gnu=yes
 else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-	ac_compiler_gnu=no
+  ac_compiler_gnu=no
 fi
-
 rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
 ac_cv_cxx_compiler_gnu=$ac_compiler_gnu
 
 fi
-{ $as_echo "$as_me:$LINENO: result: $ac_cv_cxx_compiler_gnu" >&5
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_cxx_compiler_gnu" >&5
 $as_echo "$ac_cv_cxx_compiler_gnu" >&6; }
 if test $ac_compiler_gnu = yes; then
   GXX=yes
@@ -4797,20 +4590,16 @@
 fi
 ac_test_CXXFLAGS=${CXXFLAGS+set}
 ac_save_CXXFLAGS=$CXXFLAGS
-{ $as_echo "$as_me:$LINENO: checking whether $CXX accepts -g" >&5
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking whether $CXX accepts -g" >&5
 $as_echo_n "checking whether $CXX accepts -g... " >&6; }
-if test "${ac_cv_prog_cxx_g+set}" = set; then
+if test "${ac_cv_prog_cxx_g+set}" = set; then :
   $as_echo_n "(cached) " >&6
 else
   ac_save_cxx_werror_flag=$ac_cxx_werror_flag
    ac_cxx_werror_flag=yes
    ac_cv_prog_cxx_g=no
    CXXFLAGS="-g"
-   cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+   cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
 
 int
@@ -4821,35 +4610,11 @@
   return 0;
 }
 _ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_cxx_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
+if ac_fn_cxx_try_compile "$LINENO"; then :
   ac_cv_prog_cxx_g=yes
 else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-	CXXFLAGS=""
-      cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+  CXXFLAGS=""
+      cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
 
 int
@@ -4860,36 +4625,12 @@
   return 0;
 }
 _ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_cxx_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
-  :
-else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
+if ac_fn_cxx_try_compile "$LINENO"; then :
 
-	ac_cxx_werror_flag=$ac_save_cxx_werror_flag
+else
+  ac_cxx_werror_flag=$ac_save_cxx_werror_flag
 	 CXXFLAGS="-g"
-	 cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+	 cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
 
 int
@@ -4900,42 +4641,17 @@
   return 0;
 }
 _ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_cxx_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
+if ac_fn_cxx_try_compile "$LINENO"; then :
   ac_cv_prog_cxx_g=yes
-else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-
 fi
-
 rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
 fi
-
 rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
 fi
-
 rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
    ac_cxx_werror_flag=$ac_save_cxx_werror_flag
 fi
-{ $as_echo "$as_me:$LINENO: result: $ac_cv_prog_cxx_g" >&5
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_prog_cxx_g" >&5
 $as_echo "$ac_cv_prog_cxx_g" >&6; }
 if test "$ac_test_CXXFLAGS" = set; then
   CXXFLAGS=$ac_save_CXXFLAGS
@@ -4958,16 +4674,12 @@
 ac_link='$CC -o conftest$ac_exeext $CFLAGS $CPPFLAGS $LDFLAGS conftest.$ac_ext $LIBS >&5'
 ac_compiler_gnu=$ac_cv_c_compiler_gnu
 
-{ $as_echo "$as_me:$LINENO: checking for ANSI C header files" >&5
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for ANSI C header files" >&5
 $as_echo_n "checking for ANSI C header files... " >&6; }
-if test "${ac_cv_header_stdc+set}" = set; then
+if test "${ac_cv_header_stdc+set}" = set; then :
   $as_echo_n "(cached) " >&6
 else
-  cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
 #include <stdlib.h>
 #include <stdarg.h>
@@ -4982,48 +4694,23 @@
   return 0;
 }
 _ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
+if ac_fn_c_try_compile "$LINENO"; then :
   ac_cv_header_stdc=yes
 else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-	ac_cv_header_stdc=no
+  ac_cv_header_stdc=no
 fi
-
 rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
 
 if test $ac_cv_header_stdc = yes; then
   # SunOS 4.x string.h does not declare mem*, contrary to ANSI.
-  cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
 #include <string.h>
 
 _ACEOF
 if (eval "$ac_cpp conftest.$ac_ext") 2>&5 |
-  $EGREP "memchr" >/dev/null 2>&1; then
-  :
+  $EGREP "memchr" >/dev/null 2>&1; then :
+
 else
   ac_cv_header_stdc=no
 fi
@@ -5033,18 +4720,14 @@
 
 if test $ac_cv_header_stdc = yes; then
   # ISC 2.0.2 stdlib.h does not declare free, contrary to ANSI.
-  cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
 #include <stdlib.h>
 
 _ACEOF
 if (eval "$ac_cpp conftest.$ac_ext") 2>&5 |
-  $EGREP "free" >/dev/null 2>&1; then
-  :
+  $EGREP "free" >/dev/null 2>&1; then :
+
 else
   ac_cv_header_stdc=no
 fi
@@ -5054,14 +4737,10 @@
 
 if test $ac_cv_header_stdc = yes; then
   # /bin/cc in Irix-4.0.5 gets non-ANSI ctype macros unless using -ansi.
-  if test "$cross_compiling" = yes; then
+  if test "$cross_compiling" = yes; then :
   :
 else
-  cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
 #include <ctype.h>
 #include <stdlib.h>
@@ -5088,194 +4767,31 @@
   return 0;
 }
 _ACEOF
-rm -f conftest$ac_exeext
-if { (ac_try="$ac_link"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_link") 2>&5
-  ac_status=$?
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && { ac_try='./conftest$ac_exeext'
-  { (case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_try") 2>&5
-  ac_status=$?
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); }; }; then
-  :
-else
-  $as_echo "$as_me: program exited with status $ac_status" >&5
-$as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
+if ac_fn_c_try_run "$LINENO"; then :
 
-( exit $ac_status )
-ac_cv_header_stdc=no
+else
+  ac_cv_header_stdc=no
 fi
-rm -rf conftest.dSYM
-rm -f core *.core core.conftest.* gmon.out bb.out conftest$ac_exeext conftest.$ac_objext conftest.$ac_ext
+rm -f core *.core core.conftest.* gmon.out bb.out conftest$ac_exeext \
+  conftest.$ac_objext conftest.beam conftest.$ac_ext
 fi
 
-
 fi
 fi
-{ $as_echo "$as_me:$LINENO: result: $ac_cv_header_stdc" >&5
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_header_stdc" >&5
 $as_echo "$ac_cv_header_stdc" >&6; }
 if test $ac_cv_header_stdc = yes; then
 
-cat >>confdefs.h <<\_ACEOF
-#define STDC_HEADERS 1
-_ACEOF
+$as_echo "#define STDC_HEADERS 1" >>confdefs.h
 
 fi
 
-
 for ac_header in string.h
-do
-as_ac_Header=`$as_echo "ac_cv_header_$ac_header" | $as_tr_sh`
-if { as_var=$as_ac_Header; eval "test \"\${$as_var+set}\" = set"; }; then
-  { $as_echo "$as_me:$LINENO: checking for $ac_header" >&5
-$as_echo_n "checking for $ac_header... " >&6; }
-if { as_var=$as_ac_Header; eval "test \"\${$as_var+set}\" = set"; }; then
-  $as_echo_n "(cached) " >&6
-fi
-ac_res=`eval 'as_val=${'$as_ac_Header'}
-		 $as_echo "$as_val"'`
-	       { $as_echo "$as_me:$LINENO: result: $ac_res" >&5
-$as_echo "$ac_res" >&6; }
-else
-  # Is the header compilable?
-{ $as_echo "$as_me:$LINENO: checking $ac_header usability" >&5
-$as_echo_n "checking $ac_header usability... " >&6; }
-cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
-/* end confdefs.h.  */
-$ac_includes_default
-#include <$ac_header>
-_ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
-  ac_header_compiler=yes
-else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-	ac_header_compiler=no
-fi
-
-rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
-{ $as_echo "$as_me:$LINENO: result: $ac_header_compiler" >&5
-$as_echo "$ac_header_compiler" >&6; }
-
-# Is the header present?
-{ $as_echo "$as_me:$LINENO: checking $ac_header presence" >&5
-$as_echo_n "checking $ac_header presence... " >&6; }
-cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
-/* end confdefs.h.  */
-#include <$ac_header>
-_ACEOF
-if { (ac_try="$ac_cpp conftest.$ac_ext"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_cpp conftest.$ac_ext") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } >/dev/null && {
-	 test -z "$ac_c_preproc_warn_flag$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       }; then
-  ac_header_preproc=yes
-else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-  ac_header_preproc=no
-fi
-
-rm -f conftest.err conftest.$ac_ext
-{ $as_echo "$as_me:$LINENO: result: $ac_header_preproc" >&5
-$as_echo "$ac_header_preproc" >&6; }
-
-# So?  What about this header?
-case $ac_header_compiler:$ac_header_preproc:$ac_c_preproc_warn_flag in
-  yes:no: )
-    { $as_echo "$as_me:$LINENO: WARNING: $ac_header: accepted by the compiler, rejected by the preprocessor!" >&5
-$as_echo "$as_me: WARNING: $ac_header: accepted by the compiler, rejected by the preprocessor!" >&2;}
-    { $as_echo "$as_me:$LINENO: WARNING: $ac_header: proceeding with the compiler's result" >&5
-$as_echo "$as_me: WARNING: $ac_header: proceeding with the compiler's result" >&2;}
-    ac_header_preproc=yes
-    ;;
-  no:yes:* )
-    { $as_echo "$as_me:$LINENO: WARNING: $ac_header: present but cannot be compiled" >&5
-$as_echo "$as_me: WARNING: $ac_header: present but cannot be compiled" >&2;}
-    { $as_echo "$as_me:$LINENO: WARNING: $ac_header:     check for missing prerequisite headers?" >&5
-$as_echo "$as_me: WARNING: $ac_header:     check for missing prerequisite headers?" >&2;}
-    { $as_echo "$as_me:$LINENO: WARNING: $ac_header: see the Autoconf documentation" >&5
-$as_echo "$as_me: WARNING: $ac_header: see the Autoconf documentation" >&2;}
-    { $as_echo "$as_me:$LINENO: WARNING: $ac_header:     section \"Present But Cannot Be Compiled\"" >&5
-$as_echo "$as_me: WARNING: $ac_header:     section \"Present But Cannot Be Compiled\"" >&2;}
-    { $as_echo "$as_me:$LINENO: WARNING: $ac_header: proceeding with the preprocessor's result" >&5
-$as_echo "$as_me: WARNING: $ac_header: proceeding with the preprocessor's result" >&2;}
-    { $as_echo "$as_me:$LINENO: WARNING: $ac_header: in the future, the compiler will take precedence" >&5
-$as_echo "$as_me: WARNING: $ac_header: in the future, the compiler will take precedence" >&2;}
-
-    ;;
-esac
-{ $as_echo "$as_me:$LINENO: checking for $ac_header" >&5
-$as_echo_n "checking for $ac_header... " >&6; }
-if { as_var=$as_ac_Header; eval "test \"\${$as_var+set}\" = set"; }; then
-  $as_echo_n "(cached) " >&6
-else
-  eval "$as_ac_Header=\$ac_header_preproc"
-fi
-ac_res=`eval 'as_val=${'$as_ac_Header'}
-		 $as_echo "$as_val"'`
-	       { $as_echo "$as_me:$LINENO: result: $ac_res" >&5
-$as_echo "$ac_res" >&6; }
-
-fi
-as_val=`eval 'as_val=${'$as_ac_Header'}
-		 $as_echo "$as_val"'`
-   if test "x$as_val" = x""yes; then
+do :
+  ac_fn_c_check_header_mongrel "$LINENO" "string.h" "ac_cv_header_string_h" "$ac_includes_default"
+if test "x$ac_cv_header_string_h" = x""yes; then :
   cat >>confdefs.h <<_ACEOF
-#define `$as_echo "HAVE_$ac_header" | $as_tr_cpp` 1
+#define HAVE_STRING_H 1
 _ACEOF
 
 fi
@@ -5292,18 +4808,14 @@
 V_TARCMD="tar cfh"
 V_SIGRET="void"
 
-{ $as_echo "$as_me:$LINENO: checking for main in -lXbsd" >&5
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for main in -lXbsd" >&5
 $as_echo_n "checking for main in -lXbsd... " >&6; }
-if test "${ac_cv_lib_Xbsd_main+set}" = set; then
+if test "${ac_cv_lib_Xbsd_main+set}" = set; then :
   $as_echo_n "(cached) " >&6
 else
   ac_check_lib_save_LIBS=$LIBS
 LIBS="-lXbsd  $LIBS"
-cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
 
 
@@ -5315,58 +4827,29 @@
   return 0;
 }
 _ACEOF
-rm -f conftest.$ac_objext conftest$ac_exeext
-if { (ac_try="$ac_link"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_link") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest$ac_exeext && {
-	 test "$cross_compiling" = yes ||
-	 $as_test_x conftest$ac_exeext
-       }; then
+if ac_fn_c_try_link "$LINENO"; then :
   ac_cv_lib_Xbsd_main=yes
 else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-	ac_cv_lib_Xbsd_main=no
+  ac_cv_lib_Xbsd_main=no
 fi
-
-rm -rf conftest.dSYM
-rm -f core conftest.err conftest.$ac_objext conftest_ipa8_conftest.oo \
-      conftest$ac_exeext conftest.$ac_ext
+rm -f core conftest.err conftest.$ac_objext \
+    conftest$ac_exeext conftest.$ac_ext
 LIBS=$ac_check_lib_save_LIBS
 fi
-{ $as_echo "$as_me:$LINENO: result: $ac_cv_lib_Xbsd_main" >&5
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_lib_Xbsd_main" >&5
 $as_echo "$ac_cv_lib_Xbsd_main" >&6; }
-if test "x$ac_cv_lib_Xbsd_main" = x""yes; then
+if test "x$ac_cv_lib_Xbsd_main" = x""yes; then :
   V_LIB="$V_LIB -lXbsd"
 fi
 
-{ $as_echo "$as_me:$LINENO: checking for socket in -lsocket" >&5
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for socket in -lsocket" >&5
 $as_echo_n "checking for socket in -lsocket... " >&6; }
-if test "${ac_cv_lib_socket_socket+set}" = set; then
+if test "${ac_cv_lib_socket_socket+set}" = set; then :
   $as_echo_n "(cached) " >&6
 else
   ac_check_lib_save_LIBS=$LIBS
 LIBS="-lsocket  $LIBS"
-cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
 
 /* Override any GCC internal prototype to avoid an error.
@@ -5384,58 +4867,29 @@
   return 0;
 }
 _ACEOF
-rm -f conftest.$ac_objext conftest$ac_exeext
-if { (ac_try="$ac_link"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_link") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest$ac_exeext && {
-	 test "$cross_compiling" = yes ||
-	 $as_test_x conftest$ac_exeext
-       }; then
+if ac_fn_c_try_link "$LINENO"; then :
   ac_cv_lib_socket_socket=yes
 else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-	ac_cv_lib_socket_socket=no
+  ac_cv_lib_socket_socket=no
 fi
-
-rm -rf conftest.dSYM
-rm -f core conftest.err conftest.$ac_objext conftest_ipa8_conftest.oo \
-      conftest$ac_exeext conftest.$ac_ext
+rm -f core conftest.err conftest.$ac_objext \
+    conftest$ac_exeext conftest.$ac_ext
 LIBS=$ac_check_lib_save_LIBS
 fi
-{ $as_echo "$as_me:$LINENO: result: $ac_cv_lib_socket_socket" >&5
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_lib_socket_socket" >&5
 $as_echo "$ac_cv_lib_socket_socket" >&6; }
-if test "x$ac_cv_lib_socket_socket" = x""yes; then
+if test "x$ac_cv_lib_socket_socket" = x""yes; then :
   V_LIB="$V_LIB -lsocket"
 fi
 
-{ $as_echo "$as_me:$LINENO: checking for gethostbyname in -lnsl" >&5
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for gethostbyname in -lnsl" >&5
 $as_echo_n "checking for gethostbyname in -lnsl... " >&6; }
-if test "${ac_cv_lib_nsl_gethostbyname+set}" = set; then
+if test "${ac_cv_lib_nsl_gethostbyname+set}" = set; then :
   $as_echo_n "(cached) " >&6
 else
   ac_check_lib_save_LIBS=$LIBS
 LIBS="-lnsl  $LIBS"
-cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
 
 /* Override any GCC internal prototype to avoid an error.
@@ -5453,58 +4907,29 @@
   return 0;
 }
 _ACEOF
-rm -f conftest.$ac_objext conftest$ac_exeext
-if { (ac_try="$ac_link"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_link") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest$ac_exeext && {
-	 test "$cross_compiling" = yes ||
-	 $as_test_x conftest$ac_exeext
-       }; then
+if ac_fn_c_try_link "$LINENO"; then :
   ac_cv_lib_nsl_gethostbyname=yes
 else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-	ac_cv_lib_nsl_gethostbyname=no
+  ac_cv_lib_nsl_gethostbyname=no
 fi
-
-rm -rf conftest.dSYM
-rm -f core conftest.err conftest.$ac_objext conftest_ipa8_conftest.oo \
-      conftest$ac_exeext conftest.$ac_ext
+rm -f core conftest.err conftest.$ac_objext \
+    conftest$ac_exeext conftest.$ac_ext
 LIBS=$ac_check_lib_save_LIBS
 fi
-{ $as_echo "$as_me:$LINENO: result: $ac_cv_lib_nsl_gethostbyname" >&5
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_lib_nsl_gethostbyname" >&5
 $as_echo "$ac_cv_lib_nsl_gethostbyname" >&6; }
-if test "x$ac_cv_lib_nsl_gethostbyname" = x""yes; then
+if test "x$ac_cv_lib_nsl_gethostbyname" = x""yes; then :
   V_LIB="$V_LIB -lnsl"
 fi
 
-{ $as_echo "$as_me:$LINENO: checking for dcgettext in -lintl" >&5
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for dcgettext in -lintl" >&5
 $as_echo_n "checking for dcgettext in -lintl... " >&6; }
-if test "${ac_cv_lib_intl_dcgettext+set}" = set; then
+if test "${ac_cv_lib_intl_dcgettext+set}" = set; then :
   $as_echo_n "(cached) " >&6
 else
   ac_check_lib_save_LIBS=$LIBS
 LIBS="-lintl  $LIBS"
-cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
 
 /* Override any GCC internal prototype to avoid an error.
@@ -5522,58 +4947,29 @@
   return 0;
 }
 _ACEOF
-rm -f conftest.$ac_objext conftest$ac_exeext
-if { (ac_try="$ac_link"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_link") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest$ac_exeext && {
-	 test "$cross_compiling" = yes ||
-	 $as_test_x conftest$ac_exeext
-       }; then
+if ac_fn_c_try_link "$LINENO"; then :
   ac_cv_lib_intl_dcgettext=yes
 else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-	ac_cv_lib_intl_dcgettext=no
+  ac_cv_lib_intl_dcgettext=no
 fi
-
-rm -rf conftest.dSYM
-rm -f core conftest.err conftest.$ac_objext conftest_ipa8_conftest.oo \
-      conftest$ac_exeext conftest.$ac_ext
+rm -f core conftest.err conftest.$ac_objext \
+    conftest$ac_exeext conftest.$ac_ext
 LIBS=$ac_check_lib_save_LIBS
 fi
-{ $as_echo "$as_me:$LINENO: result: $ac_cv_lib_intl_dcgettext" >&5
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_lib_intl_dcgettext" >&5
 $as_echo "$ac_cv_lib_intl_dcgettext" >&6; }
-if test "x$ac_cv_lib_intl_dcgettext" = x""yes; then
+if test "x$ac_cv_lib_intl_dcgettext" = x""yes; then :
   V_LIB="$V_LIB -lintl"
 fi
 
-{ $as_echo "$as_me:$LINENO: checking for getnodebyname in -ldnet_stub" >&5
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for getnodebyname in -ldnet_stub" >&5
 $as_echo_n "checking for getnodebyname in -ldnet_stub... " >&6; }
-if test "${ac_cv_lib_dnet_stub_getnodebyname+set}" = set; then
+if test "${ac_cv_lib_dnet_stub_getnodebyname+set}" = set; then :
   $as_echo_n "(cached) " >&6
 else
   ac_check_lib_save_LIBS=$LIBS
 LIBS="-ldnet_stub  $LIBS"
-cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
 
 /* Override any GCC internal prototype to avoid an error.
@@ -5591,43 +4987,18 @@
   return 0;
 }
 _ACEOF
-rm -f conftest.$ac_objext conftest$ac_exeext
-if { (ac_try="$ac_link"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_link") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest$ac_exeext && {
-	 test "$cross_compiling" = yes ||
-	 $as_test_x conftest$ac_exeext
-       }; then
+if ac_fn_c_try_link "$LINENO"; then :
   ac_cv_lib_dnet_stub_getnodebyname=yes
 else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-	ac_cv_lib_dnet_stub_getnodebyname=no
+  ac_cv_lib_dnet_stub_getnodebyname=no
 fi
-
-rm -rf conftest.dSYM
-rm -f core conftest.err conftest.$ac_objext conftest_ipa8_conftest.oo \
-      conftest$ac_exeext conftest.$ac_ext
+rm -f core conftest.err conftest.$ac_objext \
+    conftest$ac_exeext conftest.$ac_ext
 LIBS=$ac_check_lib_save_LIBS
 fi
-{ $as_echo "$as_me:$LINENO: result: $ac_cv_lib_dnet_stub_getnodebyname" >&5
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_lib_dnet_stub_getnodebyname" >&5
 $as_echo "$ac_cv_lib_dnet_stub_getnodebyname" >&6; }
-if test "x$ac_cv_lib_dnet_stub_getnodebyname" = x""yes; then
+if test "x$ac_cv_lib_dnet_stub_getnodebyname" = x""yes; then :
   V_LIB="$V_LIB -ldnet_stub"
 fi
 
@@ -5642,21 +5013,21 @@
 V_SHM="-DUSE_SHM"
 
 # Check whether --enable-release was given.
-if test "${enable_release+set}" = set; then
+if test "${enable_release+set}" = set; then :
   enableval=$enable_release;
 else
   enable_release="no"
 fi
 
 # Check whether --enable-debug was given.
-if test "${enable_debug+set}" = set; then
+if test "${enable_debug+set}" = set; then :
   enableval=$enable_debug;
 else
   enable_debug="no"
 fi
 
 # Check whether --enable-devel was given.
-if test "${enable_devel+set}" = set; then
+if test "${enable_devel+set}" = set; then :
   enableval=$enable_devel;
 else
   enable_devel="no"
@@ -5671,13 +5042,9 @@
 	OonS=""
 else
     if test "$CC" = gcc ; then
-	    { $as_echo "$as_me:$LINENO: checking that $CXX can handle -O2" >&5
+	    { $as_echo "$as_me:${as_lineno-$LINENO}: checking that $CXX can handle -O2" >&5
 $as_echo_n "checking that $CXX can handle -O2... " >&6; }
-	    cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+	    cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
 
 int
@@ -5696,36 +5063,15 @@
   return 0;
 }
 _ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
-  { $as_echo "$as_me:$LINENO: result: yes" >&5
+if ac_fn_c_try_compile "$LINENO"; then :
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: yes" >&5
 $as_echo "yes" >&6; }
 	    OonS="-O2"
 else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-	# Optimize on Steroids
-	    { $as_echo "$as_me:$LINENO: result: no" >&5
+  # Optimize on Steroids
+	    { $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
 $as_echo "no" >&6; }
 fi
-
 rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
     fi
 fi
@@ -5778,7 +5124,7 @@
 # the linux release build
 #
 # Check whether --enable-static was given.
-if test "${enable_static+set}" = set; then
+if test "${enable_static+set}" = set; then :
   enableval=$enable_static;
 else
   enable_static=""
@@ -5838,14 +5184,10 @@
 
 if test x$cpp_namespace = xno
 then
-	{ $as_echo "$as_me:$LINENO: checking if C++ libraries work without any namespace" >&5
+	{ $as_echo "$as_me:${as_lineno-$LINENO}: checking if C++ libraries work without any namespace" >&5
 $as_echo_n "checking if C++ libraries work without any namespace... " >&6; }
 
-cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
 #include <iostream>
 
@@ -5858,48 +5200,23 @@
   return 0;
 }
 _ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_cxx_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
-  { $as_echo "$as_me:$LINENO: result: yes" >&5
+if ac_fn_cxx_try_compile "$LINENO"; then :
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: yes" >&5
 $as_echo "yes" >&6; }
 		cpp_namespace="none"
 
 else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-	{ $as_echo "$as_me:$LINENO: result: no" >&5
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
 $as_echo "no" >&6; }
 
 fi
-
 rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
 fi
 if test x$cpp_namespace = xno
 then
-	{ $as_echo "$as_me:$LINENO: checking if C++ libraries work with namespace std" >&5
+	{ $as_echo "$as_me:${as_lineno-$LINENO}: checking if C++ libraries work with namespace std" >&5
 $as_echo_n "checking if C++ libraries work with namespace std... " >&6; }
-	cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+	cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
 #include <iostream>
 	using namespace std;
@@ -5913,49 +5230,24 @@
   return 0;
 }
 _ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_cxx_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
-  { $as_echo "$as_me:$LINENO: result: yes" >&5
+if ac_fn_cxx_try_compile "$LINENO"; then :
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: yes" >&5
 $as_echo "yes" >&6; }
 		cpp_namespace=std
 
 else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-	{ $as_echo "$as_me:$LINENO: result: no" >&5
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
 $as_echo "no" >&6; }
 
 fi
-
 rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
 fi
 
 if test x$stl_namespace = xno
 then
-	{ $as_echo "$as_me:$LINENO: checking if STL works without any namespace" >&5
+	{ $as_echo "$as_me:${as_lineno-$LINENO}: checking if STL works without any namespace" >&5
 $as_echo_n "checking if STL works without any namespace... " >&6; }
-	cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+	cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
 #include <list>
 
@@ -5968,48 +5260,23 @@
   return 0;
 }
 _ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_cxx_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
-  { $as_echo "$as_me:$LINENO: result: yes" >&5
+if ac_fn_cxx_try_compile "$LINENO"; then :
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: yes" >&5
 $as_echo "yes" >&6; }
 		stl_namespace="none"
 
 else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-	{ $as_echo "$as_me:$LINENO: result: no" >&5
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
 $as_echo "no" >&6; }
 
 fi
-
 rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
 fi
 if test x$stl_namespace = xno
 then
-	{ $as_echo "$as_me:$LINENO: checking if STL works with namespace std" >&5
+	{ $as_echo "$as_me:${as_lineno-$LINENO}: checking if STL works with namespace std" >&5
 $as_echo_n "checking if STL works with namespace std... " >&6; }
-	cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+	cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
 #include <list>
 	using namespace std;
@@ -6023,48 +5290,23 @@
   return 0;
 }
 _ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_cxx_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
-  { $as_echo "$as_me:$LINENO: result: yes" >&5
+if ac_fn_cxx_try_compile "$LINENO"; then :
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: yes" >&5
 $as_echo "yes" >&6; }
 		stl_namespace=std
 
 else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-	{ $as_echo "$as_me:$LINENO: result: no" >&5
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
 $as_echo "no" >&6; }
 
 fi
-
 rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
 fi
 if test x$stl_namespace = xno
 then
-	{ $as_echo "$as_me:$LINENO: checking if STL works with namespace stl" >&5
+	{ $as_echo "$as_me:${as_lineno-$LINENO}: checking if STL works with namespace stl" >&5
 $as_echo_n "checking if STL works with namespace stl... " >&6; }
-	cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+	cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
 #include <list>
 	using namespace stl;
@@ -6078,37 +5320,16 @@
   return 0;
 }
 _ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_cxx_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
-  { $as_echo "$as_me:$LINENO: result: yes" >&5
+if ac_fn_cxx_try_compile "$LINENO"; then :
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: yes" >&5
 $as_echo "yes" >&6; }
 		stl_namespace=stl
 
 else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-	{ $as_echo "$as_me:$LINENO: result: no" >&5
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
 $as_echo "no" >&6; }
 
 fi
-
 rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
 fi
 
@@ -6120,13 +5341,13 @@
 ac_compiler_gnu=$ac_cv_c_compiler_gnu
 
 
-{ $as_echo "$as_me:$LINENO: checking should use STL" >&5
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking should use STL" >&5
 $as_echo_n "checking should use STL... " >&6; }
 # Check whether --enable-stl was given.
-if test "${enable_stl+set}" = set; then
+if test "${enable_stl+set}" = set; then :
   enableval=$enable_stl;
 	enable_stl=$enableval
-	{ $as_echo "$as_me:$LINENO: result: user specified $enable_stl" >&5
+	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: user specified $enable_stl" >&5
 $as_echo "user specified $enable_stl" >&6; }
 
 else
@@ -6134,17 +5355,17 @@
 if test x$stl_namespace = xno
 then
 	enable_stl=no
-	{ $as_echo "$as_me:$LINENO: result: no, couldn't find STL" >&5
+	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no, couldn't find STL" >&5
 $as_echo "no, couldn't find STL" >&6; }
 else
 	if test x$stl_namespace != x$cpp_namespace
 	then
 						enable_stl=no
-		{ $as_echo "$as_me:$LINENO: result: std/STL namespaces are too hard for your system, abandoning STL" >&5
+		{ $as_echo "$as_me:${as_lineno-$LINENO}: result: std/STL namespaces are too hard for your system, abandoning STL" >&5
 $as_echo "std/STL namespaces are too hard for your system, abandoning STL" >&6; }
 	else
 		enable_stl=yes
-		{ $as_echo "$as_me:$LINENO: result: yes" >&5
+		{ $as_echo "$as_me:${as_lineno-$LINENO}: result: yes" >&5
 $as_echo "yes" >&6; }
 	fi
 fi
@@ -6160,16 +5381,12 @@
 else
 	V_STLOBJ='$(OBJ_STL)'
 	V_NS_TCL_LIB_STL='$(NS_TCL_LIB_STL)'
-	cat >>confdefs.h <<\_ACEOF
-#define HAVE_STL 1
-_ACEOF
+	$as_echo "#define HAVE_STL 1" >>confdefs.h
 
 fi
 if test x$cpp_namespace != xnone
 then
-	cat >>confdefs.h <<\_ACEOF
-#define CPP_REQUIRES_NAMESPACE 1
-_ACEOF
+	$as_echo "#define CPP_REQUIRES_NAMESPACE 1" >>confdefs.h
 
 fi
 CPP_NAMESPACE=$cpp_namespace
@@ -6182,7 +5399,7 @@
 
 
 # Check whether --with-tcl was given.
-if test "${with_tcl+set}" = set; then
+if test "${with_tcl+set}" = set; then :
   withval=$with_tcl; d=$withval
 else
   d=""
@@ -6191,7 +5408,7 @@
 
 
 # Check whether --with-tcl-ver was given.
-if test "${with_tcl_ver+set}" = set; then
+if test "${with_tcl_ver+set}" = set; then :
   withval=$with_tcl_ver; TCL_VERS=$withval
 else
   TCL_VERS=8.4.18
@@ -6247,6 +5464,9 @@
 		/usr/share/tcl$TCL_VERS \
 		/usr/share/tcl$TCL_HI_VERS \
 		/usr/share/tcl$TCL_ALT_VERS \
+		/usr/share/tcltk/tcl$TCL_VERS \
+		/usr/share/tcltk/tcl$TCL_HI_VERS \
+		/usr/share/tcltk/tcl$TCL_ALT_VERS \
 		/usr/local/src/tcl$TCL_VERS \
 		/usr/local/src/tcl$TCL_HI_VERS \
 		/usr/local/src/tcl$TCL_ALT_VERS \
@@ -6391,7 +5611,7 @@
 NS_PACKAGE_tcl_COMPLETE=true
 
 
-{ $as_echo "$as_me:$LINENO: checking for tcl.h" >&5
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for tcl.h" >&5
 $as_echo_n "checking for tcl.h... " >&6; }
 if test "x$d" = "xno"; then
 	: disable header
@@ -6399,16 +5619,14 @@
 
 NS_PACKAGE_tcl_COMPLETE=false
 
-	{ $as_echo "$as_me:$LINENO: result: no" >&5
+	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
 $as_echo "no" >&6; }
 
 else
 	places="$TCL_H_PLACES"
 	if test "x$d" != "x" -a "x$d" != xyes; then
 		if test ! -d $d; then
-			{ { $as_echo "$as_me:$LINENO: error: $d is not a directory" >&5
-$as_echo "$as_me: error: $d is not a directory" >&2;}
-   { (exit 1); exit 1; }; }
+			as_fn_error "$d is not a directory" "$LINENO" 5
 		fi
 		places="$TCL_H_PLACES_D"
 	fi
@@ -6429,7 +5647,7 @@
 
 NS_PACKAGE_tcl_COMPLETE=false
 
-		{ $as_echo "$as_me:$LINENO: result: no" >&5
+		{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
 $as_echo "no" >&6; }
 	else
 
@@ -6444,621 +5662,91 @@
 
 		NS_PACKAGE_tcl_UNDERWAY=true
 
-		{ $as_echo "$as_me:$LINENO: result: $V_INCLUDE_TCL" >&5
-$as_echo "$V_INCLUDE_TCL" >&6; }
-	fi
-fi
-
-
-{ $as_echo "$as_me:$LINENO: checking for tclInt.h" >&5
-$as_echo_n "checking for tclInt.h... " >&6; }
-if test "x$d" = "xno"; then
-	: disable header
-	V_INCLUDE_TCL=FAIL
-
-NS_PACKAGE_tcl_COMPLETE=false
-
-	{ $as_echo "$as_me:$LINENO: result: no" >&5
-$as_echo "no" >&6; }
-
-else
-	places="$TCL_H_PLACES"
-	if test "x$d" != "x" -a "x$d" != xyes; then
-		if test ! -d $d; then
-			{ { $as_echo "$as_me:$LINENO: error: $d is not a directory" >&5
-$as_echo "$as_me: error: $d is not a directory" >&2;}
-   { (exit 1); exit 1; }; }
-		fi
-		places="$TCL_H_PLACES_D"
-	fi
-
-	V_INCLUDE_TCL=""
-	found=""
-	for dir in $places; do
-		if test -r $dir/tclInt.h; then
-                        found="$dir"
-                        if test "$CC" != "icc" ||
-                                test "$dir" != "/usr/include"; then
-                                V_INCLUDE_TCL="-I$dir"
-                        fi
-			break
-		fi
-	done
-	if test "FAIL$found" = "FAIL" ; then
-
-NS_PACKAGE_tcl_COMPLETE=false
-
-		{ $as_echo "$as_me:$LINENO: result: no" >&5
-$as_echo "no" >&6; }
-	else
-
-				  ac_tr_hdr=HAVE_`echo tclInt.h | sed 'y%abcdefghijklmnopqrstuvwxyz./-%ABCDEFGHIJKLMNOPQRSTUVWXYZ___%'`
-		                cat >>confdefs.h <<_ACEOF
-#define $ac_tr_hdr 1
-_ACEOF
-
-
-		V_INCLUDES="$V_INCLUDE_TCL $V_INCLUDES"
-		V_DEFINES="-D$ac_tr_hdr $V_DEFINES"
-
-		NS_PACKAGE_tcl_UNDERWAY=true
-
-		{ $as_echo "$as_me:$LINENO: result: $V_INCLUDE_TCL" >&5
+		{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $V_INCLUDE_TCL" >&5
 $as_echo "$V_INCLUDE_TCL" >&6; }
-	fi
-fi
-
-
-{ $as_echo "$as_me:$LINENO: checking for libtcl$TCL_HI_VERS" >&5
-$as_echo_n "checking for libtcl$TCL_HI_VERS... " >&6; }
-if test "x$d" = "xno"; then
-	: disable library
-	V_LIB_TCL=FAIL
-
-NS_PACKAGE_tcl_COMPLETE=false
-
-	{ $as_echo "$as_me:$LINENO: result: no" >&5
-$as_echo "no" >&6; }
-
-else
-	places="$TCL_LIB_PLACES"
-	if test "x$d" != "x" -a "x$d" != xyes; then
-		if test ! -d $d; then
-			{ { $as_echo "$as_me:$LINENO: error: $d is not a directory" >&5
-$as_echo "$as_me: error: $d is not a directory" >&2;}
-   { (exit 1); exit 1; }; }
-		fi
-		places="$TCL_LIB_PLACES_D"
-	fi
-
-	V_LIB_TCL=""
-		full_lib_name="tcl$TCL_HI_VERS"
-		simple_lib_name=`echo $full_lib_name | sed -e 's/\.//'`
-		other_simple_lib_name=`echo $full_lib_name | sed -e 's/\./_/'`
-		simpler_lib_name=`echo $simple_lib_name | sed -e 'y/0123456789/          /'`
-	double_break=false
-	for dir in $places; do
-		for file in $full_lib_name $simple_lib_name $other_simple_lib_name $simpler_lib_name
-		do
-			if test -r $dir/lib$file.so -o -r $dir/lib$file.a -o -r $dir/lib$file.dylib; then
-				V_LIB_TCL="-L$dir -l$file"
-				double_break=true
-				break
-			fi
-		done
-		if $double_break; then
-			break
-		fi
-	done
-	if test "FAIL$V_LIB_TCL" = "FAIL" ; then
-
-NS_PACKAGE_tcl_COMPLETE=false
-
-		{ $as_echo "$as_me:$LINENO: result: no" >&5
-$as_echo "no" >&6; }
-	else
-		if test "$solaris"; then
-			V_LIB_TCL="-R$dir $V_LIB_TCL"
-		fi
-
-				ac_tr_lib=HAVE_LIB`echo tcl$TCL_HI_VERS | sed -e 's/[^a-zA-Z0-9_]/_/g' \
-		    -e 'y/abcdefghijklmnopqrstuvwxyz/ABCDEFGHIJKLMNOPQRSTUVWXYZ/'`
-				cat >>confdefs.h <<_ACEOF
-#define $ac_tr_lib 1
-_ACEOF
-
-
-				V_LIBS="$V_LIB_TCL $V_LIBS"
-		V_DEFINES="-D$ac_tr_lib $V_DEFINES"
-
-		NS_PACKAGE_tcl_UNDERWAY=true
-
-		{ $as_echo "$as_me:$LINENO: result: $V_LIB_TCL" >&5
-$as_echo "$V_LIB_TCL" >&6; }
-	fi
-fi
-
-
-{ $as_echo "$as_me:$LINENO: checking for init.tcl" >&5
-$as_echo_n "checking for init.tcl... " >&6; }
-if test "x$d" = "xno"; then
-	: disable header
-	V_LIBRARY_TCL=FAIL
-
-NS_PACKAGE_tcl_COMPLETE=false
-
-	{ $as_echo "$as_me:$LINENO: result: no" >&5
-$as_echo "no" >&6; }
-
-else
-	places="$TCL_TCL_PLACES"
-	if test "x$d" != "x" -a "x$d" != xyes; then
-		if test ! -d $d; then
-			{ { $as_echo "$as_me:$LINENO: error: $d is not a directory" >&5
-$as_echo "$as_me: error: $d is not a directory" >&2;}
-   { (exit 1); exit 1; }; }
-		fi
-		places="$TCL_TCL_PLACES_D"
-	fi
-
-	V_LIBRARY_TCL=""
-	for dir in $places; do
-		if test -r $dir/init.tcl; then
-			V_LIBRARY_TCL="$dir"
-			break
-		fi
-	done
-	if test "FAIL$V_LIBRARY_TCL" = "FAIL" ; then
-
-NS_PACKAGE_tcl_COMPLETE=false
-
-		{ $as_echo "$as_me:$LINENO: result: no" >&5
-$as_echo "no" >&6; }
-	else
-
-		NS_PACKAGE_tcl_UNDERWAY=true
-
-		{ $as_echo "$as_me:$LINENO: result: $V_LIBRARY_TCL" >&5
-$as_echo "$V_LIBRARY_TCL" >&6; }
-	fi
-fi
-
-
-tcl_http_library_dir=/dev/null
-tcl_http_places=" \
-	$V_LIBRARY_TCL \
-	$V_LIBRARY_TCL/http \
-	$V_LIBRARY_TCL/http2.4 \
-	$V_LIBRARY_TCL/http2.3 \
-	$V_LIBRARY_TCL/http2.1 \
-	$V_LIBRARY_TCL/http2.0 \
-	$V_LIBRARY_TCL/http1.0 \
-	"
-
-{ $as_echo "$as_me:$LINENO: checking for http.tcl" >&5
-$as_echo_n "checking for http.tcl... " >&6; }
-if test "x""" = "xno"; then
-	: disable header
-	tcl_http_library_dir=FAIL
-
-NS_PACKAGE_tcl_COMPLETE=false
-
-	{ $as_echo "$as_me:$LINENO: result: no" >&5
-$as_echo "no" >&6; }
-
-else
-	places="$tcl_http_places"
-	if test "x""" != "x" -a "x""" != xyes; then
-		if test ! -d ""; then
-			{ { $as_echo "$as_me:$LINENO: error: \"\" is not a directory" >&5
-$as_echo "$as_me: error: \"\" is not a directory" >&2;}
-   { (exit 1); exit 1; }; }
-		fi
-		places=""""
-	fi
-
-	tcl_http_library_dir=""
-	for dir in $places; do
-		if test -r $dir/http.tcl; then
-			tcl_http_library_dir="$dir"
-			break
-		fi
-	done
-	if test "FAIL$tcl_http_library_dir" = "FAIL" ; then
-
-NS_PACKAGE_tcl_COMPLETE=false
-
-		{ $as_echo "$as_me:$LINENO: result: no" >&5
-$as_echo "no" >&6; }
-	else
-
-		NS_PACKAGE_tcl_UNDERWAY=true
-
-		{ $as_echo "$as_me:$LINENO: result: $tcl_http_library_dir" >&5
-$as_echo "$tcl_http_library_dir" >&6; }
-	fi
-fi
-
-{ $as_echo "$as_me:$LINENO: checking Tcl http.tcl library" >&5
-$as_echo_n "checking Tcl http.tcl library... " >&6; }
-if test -f $tcl_http_library_dir/http.tcl
-then
-	{ $as_echo "$as_me:$LINENO: result: yes" >&5
-$as_echo "yes" >&6; }
-else
-	{ { $as_echo "$as_me:$LINENO: error: Couldn't find http.tcl in $tcl_http_places" >&5
-$as_echo "$as_me: error: Couldn't find http.tcl in $tcl_http_places" >&2;}
-   { (exit 1); exit 1; }; }
-fi
-
-
-V_TCL_LIBRARY_FILES="\$(TCL_BASE_LIBRARY_FILES) $tcl_http_library_dir/http.tcl"
-
-
-#
-# check for tclsh
-#
-oldpath=$PATH
-# $d/unix works if $d is the 8.0 distribution
-# $d/bin is for the ns-allinone distribution (kind of hacky, isn't it?)
-PATH=../bin:../tcl$TCL_HI_VERS/unix:../tcl$TCL_VERS/unix:$d/unix:$d/bin:$PATH
-for ac_prog in tclsh$TCL_VERS tclsh$TCL_HI_VERS tclsh tclsh$TCL_OLD_VERS
-do
-  # Extract the first word of "$ac_prog", so it can be a program name with args.
-set dummy $ac_prog; ac_word=$2
-{ $as_echo "$as_me:$LINENO: checking for $ac_word" >&5
-$as_echo_n "checking for $ac_word... " >&6; }
-if test "${ac_cv_path_V_TCLSH+set}" = set; then
-  $as_echo_n "(cached) " >&6
-else
-  case $V_TCLSH in
-  [\\/]* | ?:[\\/]*)
-  ac_cv_path_V_TCLSH="$V_TCLSH" # Let the user override the test with a path.
-  ;;
-  *)
-  as_save_IFS=$IFS; IFS=$PATH_SEPARATOR
-for as_dir in $PATH
-do
-  IFS=$as_save_IFS
-  test -z "$as_dir" && as_dir=.
-  for ac_exec_ext in '' $ac_executable_extensions; do
-  if { test -f "$as_dir/$ac_word$ac_exec_ext" && $as_test_x "$as_dir/$ac_word$ac_exec_ext"; }; then
-    ac_cv_path_V_TCLSH="$as_dir/$ac_word$ac_exec_ext"
-    $as_echo "$as_me:$LINENO: found $as_dir/$ac_word$ac_exec_ext" >&5
-    break 2
-  fi
-done
-done
-IFS=$as_save_IFS
-
-  ;;
-esac
-fi
-V_TCLSH=$ac_cv_path_V_TCLSH
-if test -n "$V_TCLSH"; then
-  { $as_echo "$as_me:$LINENO: result: $V_TCLSH" >&5
-$as_echo "$V_TCLSH" >&6; }
-else
-  { $as_echo "$as_me:$LINENO: result: no" >&5
-$as_echo "no" >&6; }
-fi
-
-
-  test -n "$V_TCLSH" && break
-done
-test -n "$V_TCLSH" || V_TCLSH="no"
-
-if test x"$V_TCLSH" = xno
-then
-	# out of luck
-
-NS_PACKAGE_tcl_COMPLETE=false
-
-fi
-# absolutize it
-V_TCLSH=`absolutize $V_TCLSH`
-PATH=$oldpath
-
-
-NS_PACKAGE_tcl_VALID=false
-if $NS_PACKAGE_tcl_UNDERWAY; then
-	if $NS_PACKAGE_tcl_COMPLETE; then
-		: All components of tcl found.
-		NS_PACKAGE_tcl_VALID=true
-	else
-		{ { $as_echo "$as_me:$LINENO: error: Installation of tcl seems incomplete or can't be found automatically.
-Please correct the problem by telling configure where tcl is
-using the argument --with-tcl=/path/to/package
-(perhaps after installing it),
-or the package is not required, disable it with --with-tcl=no." >&5
-$as_echo "$as_me: error: Installation of tcl seems incomplete or can't be found automatically.
-Please correct the problem by telling configure where tcl is
-using the argument --with-tcl=/path/to/package
-(perhaps after installing it),
-or the package is not required, disable it with --with-tcl=no." >&2;}
-   { (exit 1); exit 1; }; }
-	fi
-fi
-if test "xyes" = xyes; then
-	if $NS_PACKAGE_tcl_VALID; then
-		:
-	else
-		{ { $as_echo "$as_me:$LINENO: error: tcl is required but could not be completely found.
-Please correct the problem by telling configure where tcl is
-using the argument --with-tcl=/path/to/package,
-or the package is not required, disable it with --with-tcl=no." >&5
-$as_echo "$as_me: error: tcl is required but could not be completely found.
-Please correct the problem by telling configure where tcl is
-using the argument --with-tcl=/path/to/package,
-or the package is not required, disable it with --with-tcl=no." >&2;}
-   { (exit 1); exit 1; }; }
-	fi
-fi
-
-
-
-
-
-
-
-
-# Check whether --with-tk was given.
-if test "${with_tk+set}" = set; then
-  withval=$with_tk; d=$withval
-else
-  d=""
-fi
-
-
-
-# Check whether --with-tk-ver was given.
-if test "${with_tk_ver+set}" = set; then
-  withval=$with_tk_ver; TK_VERS=$withval
-else
-  TK_VERS=8.4.18
-fi
-
-
-
-
-TK_HI_VERS=`echo $TK_VERS | sed 's/\([0-9]*\)\.\([0-9]*\)\.\([0-9]*\)/\1.\2/'`
-TK_MAJOR_VERS=`echo $TK_VERS | sed 's/\([0-9]*\)\.\([0-9]*\)\.\([0-9]*\)/\1/'`
-TK_ALT_VERS=`echo $TK_VERS | sed 's/\.//'`
-
-TK_OLD_VERS=8.3.5
-TK_OLD_ALT_VERS=`echo $TK_OLD_VERS | sed 's/\.//'`
-
-TK_TCL_PLACES_D="$d \
-                $d/lib64/tk$TK_VERS \
-                $d/lib64/tk$TK_ALT_VERS \
-                $d/lib64/tk$TK_VERS \
-                $d/lib/tk$TK_ALT_VERS \
-		$d/lib/tk$TK_HI_VERS \
-                $d/library \
-                $d/lib/tk \
-                $d/../lib/tk$TK_VERS \
-                $d/../lib/tk$TK_ALT_VERS \
-                $d/../lib/tk$TK_HI_VERS \
-                $d/../lib/tk \
-                $d/lib/tk$TK_OLD_VERS \
-                $d/lib/tk$TK_OLD_ALT_VERS \
-                $d/../lib/tk$TK_OLD_VERS \
-                $d/../lib/tk$TK_OLD_ALT_VERS \
-                $d/../lib/tk \
-                $d/lib \
-                $d/library"
-TK_TCL_PLACES=" \
-		../lib/tk$TK_HI_VERS \
-		../lib/tk$TK_VERS \
-		../lib/tk$TK_ALT_VERS \
-		../tk$TK_VERS/library \
-                ../tk$TK_ALT_VERS/library \
-                ../tk$TK_HI_VERS/library \
-		../tk/library \
-                /usr/src/local/tk$TK_VERS/library \
-                /usr/src/local/tk$TK_ALT_VERS/library \
-                /usr/src/local/tk$TK_HI_VERS/library \
-                /usr/contrib/include \
-                /usr/local/lib/tk$TK_VERS \
-                /usr/local/lib/tk$TK_ALT_VERS \
-                /usr/local/lib/tk$TK_HI_VERS \
-                /usr/local/include/tk$TK_VERS \
-                /usr/local/include/tk$TK_ALT_VERS \
-                /usr/local/include/tk$TK_HI_VERS \
-                /usr/local/include \
-                /usr/lib64/tk$TK_VERS \
-                /usr/lib64/tk$TK_ALT_VERS \
-                /usr/lib64/tk$TK_HI_VERS \
-                /usr/lib64/tk \
-                /usr/lib/tk$TK_VERS \
-                /usr/lib/tk$TK_ALT_VERS \
-                /usr/lib/tk$TK_HI_VERS \
-                /usr/lib/tk \
-                /usr/share/tk$TK_VERS \
-                /usr/share/tk$TK_ALT_VERS \
-                /usr/share/tk$TK_HI_VERS \
-                /usr/share/tk \
-		../tk$TK_OLD_VERS/library \
-                ../tk$TK_OLD_ALT_VERS/library \
-                /usr/src/local/tk$TK_OLD_VERS/library \
-                /usr/src/local/tk$TK_OLD_ALT_VERS/library \
-                /usr/local/lib/tk$TK_OLD_VERS \
-                /usr/local/lib/tk$TK_OLD_ALT_VERS \
-                /usr/local/include/tk$TK_OLD_VERS \
-                /usr/local/include/tk$TK_OLD_ALT_VERS \
-                /usr/lib/tk$TK_OLD_VERS \
-                /usr/lib/tk$TK_OLD_ALT_VERS \
-                $prefix/include \
-		$prefix/lib/tk \
-                $x_includes/tk \
-                $x_includes \
-                /usr/include"
-TK_H_PLACES_D="$d \
-                $d/generic \
-                $d/../include/tk$TK_VERS \
-                $d/../include/tk$TK_HI_VERS \
-                $d/../include/tk$TK_OLD_VERS \
-		$d/include/tk$TK_VERS \
-		$d/include/tk$TK_HI_VERS \
-		$d/include/tk$TK_OLD_VERS \
-                $d/include"
-TK_H_PLACES=" \
-		../include \
-		../tk$TK_VERS/generic \
-                ../tk$TK_ALT_VERS/generic \
-                ../tk$TK_HI_VERS/generic \
-		/usr/src/local/tk$TK_VERS/generic \
-                /usr/src/local/tk$TK_ALT_VERS/generic \
-                /usr/src/local/tk$TK_HI_VERS/generic \
-                /usr/contrib/include \
-                /usr/local/lib/tk$TK_VERS \
-                /usr/local/lib/tk$TK_ALT_VERS \
-                /usr/local/lib/tk$TK_HI_VERS \
-                /usr/local/include/tk$TK_VERS \
-                /usr/local/include/tk$TK_ALT_VERS \
-                /usr/local/include/tk$TK_HI_VERS \
-                /usr/local/include \
-                /import/tk/include/tk$TK_VERS \
-                /import/tk/include/tk$TK_ALT_VERS \
-                /import/tk/include/tk$TK_HI_VERS \
-		../tk$TK_OLD_VERS/generic \
-                ../tk$TK_OLD_ALT_VERS/generic \
-		/usr/src/local/tk$TK_OLD_VERS/generic \
-                /usr/src/local/tk$TK_OLD_ALT_VERS/generic \
-                /usr/local/lib/tk$TK_OLD_VERS \
-                /usr/local/lib/tk$TK_OLD_ALT_VERS \
-                /usr/local/include/tk$TK_OLD_VERS \
-                /usr/local/include/tk$TK_OLD_ALT_VERS \
-                /import/tk/include/tk$TK_OLD_VERS \
-                /import/tk/include/tk$TK_OLD_ALT_VERS \
-                $prefix/include \
-                $x_includes/tk \
-                $x_includes \
-                /usr/include \
-                /usr/include/tcl \
-                /usr/include/tcl$TK_VERS \
-                /usr/include/tcl$TK_ALT_VERS \
-                /usr/include/tcl$TK_HI_VERS \
-                "
-TK_LIB_PLACES_D="$d \
-                $d/lib \
-		$d/unix"
-TK_LIB_PLACES=" \
-		../lib \
-		../lib/tk$TK_HI_VERS \
-		../lib/tk$TK_VERS \
-		../lib/tk$TK_ALT_VERS \
-		../tk$TK_VERS/unix \
-                ../tk$TK_ALT_VERS/unix \
-                ../tk$TK_HI_VERS/unix \
-                /usr/src/local/tk$TK_VERS/unix \
-                /usr/src/local/tk$TK_ALT_VERS/unix \
-                /usr/src/local/tk$TK_HI_VERS/unix \
-                /usr/contrib/lib \
-                /usr/local/lib/tk$TK_VERS \
-                /usr/local/lib/tk$TK_ALT_VERS \
-                /usr/local/lib/tk$TK_HI_VERS \
-		../tk$TK_OLD_VERS/unix \
-                ../tk$TK_OLD_ALT_VERS/unix \
-                /usr/src/local/tk$TK_OLD_VERS/unix \
-                /usr/src/local/tk$TK_OLD_ALT_VERS/unix \
-                /usr/local/lib/tk$TK_OLD_VERS \
-                /usr/local/lib/tk$TK_OLD_ALT_VERS \
-                /usr/local/lib \
-                $prefix/lib \
-                $x_libs/tk \
-                $x_libs \
-                /usr/lib64 \
-                /usr/lib"
-
-
-NS_PACKAGE_tk_UNDERWAY=false
-NS_PACKAGE_tk_COMPLETE=true
+	fi
+fi
 
 
-{ $as_echo "$as_me:$LINENO: checking for tk.h" >&5
-$as_echo_n "checking for tk.h... " >&6; }
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for tclInt.h" >&5
+$as_echo_n "checking for tclInt.h... " >&6; }
 if test "x$d" = "xno"; then
 	: disable header
-	V_INCLUDE_TK=FAIL
+	V_INCLUDE_TCL=FAIL
 
-NS_PACKAGE_tk_COMPLETE=false
+NS_PACKAGE_tcl_COMPLETE=false
 
-	{ $as_echo "$as_me:$LINENO: result: no" >&5
+	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
 $as_echo "no" >&6; }
 
 else
-	places="$TK_H_PLACES"
+	places="$TCL_H_PLACES"
 	if test "x$d" != "x" -a "x$d" != xyes; then
 		if test ! -d $d; then
-			{ { $as_echo "$as_me:$LINENO: error: $d is not a directory" >&5
-$as_echo "$as_me: error: $d is not a directory" >&2;}
-   { (exit 1); exit 1; }; }
+			as_fn_error "$d is not a directory" "$LINENO" 5
 		fi
-		places="$TK_H_PLACES_D"
+		places="$TCL_H_PLACES_D"
 	fi
 
-	V_INCLUDE_TK=""
+	V_INCLUDE_TCL=""
 	found=""
 	for dir in $places; do
-		if test -r $dir/tk.h; then
+		if test -r $dir/tclInt.h; then
                         found="$dir"
                         if test "$CC" != "icc" ||
                                 test "$dir" != "/usr/include"; then
-                                V_INCLUDE_TK="-I$dir"
+                                V_INCLUDE_TCL="-I$dir"
                         fi
 			break
 		fi
 	done
 	if test "FAIL$found" = "FAIL" ; then
 
-NS_PACKAGE_tk_COMPLETE=false
+NS_PACKAGE_tcl_COMPLETE=false
 
-		{ $as_echo "$as_me:$LINENO: result: no" >&5
+		{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
 $as_echo "no" >&6; }
 	else
 
-				  ac_tr_hdr=HAVE_`echo tk.h | sed 'y%abcdefghijklmnopqrstuvwxyz./-%ABCDEFGHIJKLMNOPQRSTUVWXYZ___%'`
+				  ac_tr_hdr=HAVE_`echo tclInt.h | sed 'y%abcdefghijklmnopqrstuvwxyz./-%ABCDEFGHIJKLMNOPQRSTUVWXYZ___%'`
 		                cat >>confdefs.h <<_ACEOF
 #define $ac_tr_hdr 1
 _ACEOF
 
 
-		V_INCLUDES="$V_INCLUDE_TK $V_INCLUDES"
+		V_INCLUDES="$V_INCLUDE_TCL $V_INCLUDES"
 		V_DEFINES="-D$ac_tr_hdr $V_DEFINES"
 
-		NS_PACKAGE_tk_UNDERWAY=true
+		NS_PACKAGE_tcl_UNDERWAY=true
 
-		{ $as_echo "$as_me:$LINENO: result: $V_INCLUDE_TK" >&5
-$as_echo "$V_INCLUDE_TK" >&6; }
+		{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $V_INCLUDE_TCL" >&5
+$as_echo "$V_INCLUDE_TCL" >&6; }
 	fi
 fi
 
 
-{ $as_echo "$as_me:$LINENO: checking for libtk$TK_HI_VERS" >&5
-$as_echo_n "checking for libtk$TK_HI_VERS... " >&6; }
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for libtcl$TCL_HI_VERS" >&5
+$as_echo_n "checking for libtcl$TCL_HI_VERS... " >&6; }
 if test "x$d" = "xno"; then
 	: disable library
-	V_LIB_TK=FAIL
+	V_LIB_TCL=FAIL
 
-NS_PACKAGE_tk_COMPLETE=false
+NS_PACKAGE_tcl_COMPLETE=false
 
-	{ $as_echo "$as_me:$LINENO: result: no" >&5
+	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
 $as_echo "no" >&6; }
 
 else
-	places="$TK_LIB_PLACES"
+	places="$TCL_LIB_PLACES"
 	if test "x$d" != "x" -a "x$d" != xyes; then
 		if test ! -d $d; then
-			{ { $as_echo "$as_me:$LINENO: error: $d is not a directory" >&5
-$as_echo "$as_me: error: $d is not a directory" >&2;}
-   { (exit 1); exit 1; }; }
+			as_fn_error "$d is not a directory" "$LINENO" 5
 		fi
-		places="$TK_LIB_PLACES_D"
+		places="$TCL_LIB_PLACES_D"
 	fi
 
-	V_LIB_TK=""
-		full_lib_name="tk$TK_HI_VERS"
+	V_LIB_TCL=""
+		full_lib_name="tcl$TCL_HI_VERS"
 		simple_lib_name=`echo $full_lib_name | sed -e 's/\.//'`
 		other_simple_lib_name=`echo $full_lib_name | sed -e 's/\./_/'`
 		simpler_lib_name=`echo $simple_lib_name | sed -e 'y/0123456789/          /'`
@@ -7067,7 +5755,7 @@
 		for file in $full_lib_name $simple_lib_name $other_simple_lib_name $simpler_lib_name
 		do
 			if test -r $dir/lib$file.so -o -r $dir/lib$file.a -o -r $dir/lib$file.dylib; then
-				V_LIB_TK="-L$dir -l$file"
+				V_LIB_TCL="-L$dir -l$file"
 				double_break=true
 				break
 			fi
@@ -7076,334 +5764,231 @@
 			break
 		fi
 	done
-	if test "FAIL$V_LIB_TK" = "FAIL" ; then
+	if test "FAIL$V_LIB_TCL" = "FAIL" ; then
 
-NS_PACKAGE_tk_COMPLETE=false
+NS_PACKAGE_tcl_COMPLETE=false
 
-		{ $as_echo "$as_me:$LINENO: result: no" >&5
+		{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
 $as_echo "no" >&6; }
 	else
 		if test "$solaris"; then
-			V_LIB_TK="-R$dir $V_LIB_TK"
+			V_LIB_TCL="-R$dir $V_LIB_TCL"
 		fi
 
-				ac_tr_lib=HAVE_LIB`echo tk$TK_HI_VERS | sed -e 's/[^a-zA-Z0-9_]/_/g' \
+				ac_tr_lib=HAVE_LIB`echo tcl$TCL_HI_VERS | sed -e 's/[^a-zA-Z0-9_]/_/g' \
 		    -e 'y/abcdefghijklmnopqrstuvwxyz/ABCDEFGHIJKLMNOPQRSTUVWXYZ/'`
 				cat >>confdefs.h <<_ACEOF
 #define $ac_tr_lib 1
 _ACEOF
 
 
-				V_LIBS="$V_LIB_TK $V_LIBS"
+				V_LIBS="$V_LIB_TCL $V_LIBS"
 		V_DEFINES="-D$ac_tr_lib $V_DEFINES"
 
-		NS_PACKAGE_tk_UNDERWAY=true
+		NS_PACKAGE_tcl_UNDERWAY=true
 
-		{ $as_echo "$as_me:$LINENO: result: $V_LIB_TK" >&5
-$as_echo "$V_LIB_TK" >&6; }
+		{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $V_LIB_TCL" >&5
+$as_echo "$V_LIB_TCL" >&6; }
 	fi
 fi
 
 
-{ $as_echo "$as_me:$LINENO: checking for tk.tcl" >&5
-$as_echo_n "checking for tk.tcl... " >&6; }
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for init.tcl" >&5
+$as_echo_n "checking for init.tcl... " >&6; }
 if test "x$d" = "xno"; then
 	: disable header
-	V_LIBRARY_TK=FAIL
+	V_LIBRARY_TCL=FAIL
 
-NS_PACKAGE_tk_COMPLETE=false
+NS_PACKAGE_tcl_COMPLETE=false
 
-	{ $as_echo "$as_me:$LINENO: result: no" >&5
+	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
 $as_echo "no" >&6; }
 
 else
-	places="$TK_TCL_PLACES"
+	places="$TCL_TCL_PLACES"
 	if test "x$d" != "x" -a "x$d" != xyes; then
 		if test ! -d $d; then
-			{ { $as_echo "$as_me:$LINENO: error: $d is not a directory" >&5
-$as_echo "$as_me: error: $d is not a directory" >&2;}
-   { (exit 1); exit 1; }; }
+			as_fn_error "$d is not a directory" "$LINENO" 5
 		fi
-		places="$TK_TCL_PLACES_D"
+		places="$TCL_TCL_PLACES_D"
 	fi
 
-	V_LIBRARY_TK=""
+	V_LIBRARY_TCL=""
 	for dir in $places; do
-		if test -r $dir/tk.tcl; then
-			V_LIBRARY_TK="$dir"
+		if test -r $dir/init.tcl; then
+			V_LIBRARY_TCL="$dir"
 			break
 		fi
 	done
-	if test "FAIL$V_LIBRARY_TK" = "FAIL" ; then
+	if test "FAIL$V_LIBRARY_TCL" = "FAIL" ; then
 
-NS_PACKAGE_tk_COMPLETE=false
+NS_PACKAGE_tcl_COMPLETE=false
 
-		{ $as_echo "$as_me:$LINENO: result: no" >&5
+		{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
 $as_echo "no" >&6; }
 	else
 
-		NS_PACKAGE_tk_UNDERWAY=true
-
-		{ $as_echo "$as_me:$LINENO: result: $V_LIBRARY_TK" >&5
-$as_echo "$V_LIBRARY_TK" >&6; }
-	fi
-fi
-
+		NS_PACKAGE_tcl_UNDERWAY=true
 
-NS_PACKAGE_tk_VALID=false
-if $NS_PACKAGE_tk_UNDERWAY; then
-	if $NS_PACKAGE_tk_COMPLETE; then
-		: All components of tk found.
-		NS_PACKAGE_tk_VALID=true
-	else
-		{ { $as_echo "$as_me:$LINENO: error: Installation of tk seems incomplete or can't be found automatically.
-Please correct the problem by telling configure where tk is
-using the argument --with-tk=/path/to/package
-(perhaps after installing it),
-or the package is not required, disable it with --with-tk=no." >&5
-$as_echo "$as_me: error: Installation of tk seems incomplete or can't be found automatically.
-Please correct the problem by telling configure where tk is
-using the argument --with-tk=/path/to/package
-(perhaps after installing it),
-or the package is not required, disable it with --with-tk=no." >&2;}
-   { (exit 1); exit 1; }; }
-	fi
-fi
-if test "xno" = xyes; then
-	if $NS_PACKAGE_tk_VALID; then
-		:
-	else
-		{ { $as_echo "$as_me:$LINENO: error: tk is required but could not be completely found.
-Please correct the problem by telling configure where tk is
-using the argument --with-tk=/path/to/package,
-or the package is not required, disable it with --with-tk=no." >&5
-$as_echo "$as_me: error: tk is required but could not be completely found.
-Please correct the problem by telling configure where tk is
-using the argument --with-tk=/path/to/package,
-or the package is not required, disable it with --with-tk=no." >&2;}
-   { (exit 1); exit 1; }; }
+		{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $V_LIBRARY_TCL" >&5
+$as_echo "$V_LIBRARY_TCL" >&6; }
 	fi
 fi
 
 
-if test -r $V_LIBRARY_TK/optionMenu.tcl ; then
-	V_TKDOSNAMES='$(LIBRARY_TK)/optionMenu.tcl $(LIBRARY_TK)/scrollbar.tcl'
-	V_NEED_DL=""
-else
-	V_TKDOSNAMES='$(LIBRARY_TK)/optMenu.tcl $(LIBRARY_TK)/scrlbar.tcl'
-	V_NEED_DL=YES
-fi
-
-
-
-
-
-
-# Check whether --with-otcl was given.
-if test "${with_otcl+set}" = set; then
-  withval=$with_otcl; d=$withval
-else
-  d=""
-fi
-
-
-OTCL_VERS=1.13
-OTCL_ALT_VERS=1.0
-
-OTCL_H_PLACES_D="$d \
-		$d/include"
-OTCL_H_PLACES="../otcl \
-		/usr/src/local/otcl \
-		../otcl-$OTCL_VERS \
-		/import/otcl/include \
-		/usr/src/local/otcl-$OTCL_VERS \
-		/usr/src/local/otcl-$OTCL_ALT_VERS \
-		$prefix/include \
-		/usr/local/include \
-		/usr/contrib/include \
-		/usr/include"
-OTCL_LIB_PLACES_D="$d \
-		$d/lib \
-		"
-OTCL_LIB_PLACES="../otcl \
-		../otcl-$OTCL_VERS \
-		../otcl-$OTCL_ALT_VERS \
-		$prefix/lib \
-		$x_libraries \
-		/usr/contrib/lib \
-		/usr/local/lib \
-		/usr/lib \
-		/usr/src/local/otcl \
-		/usr/src/local/otcl-$OTCL_VERS \
-		/usr/src/local/otcl-$OTCL_ALT_VERS \
-		"
-
-
-NS_PACKAGE_otcl_UNDERWAY=false
-NS_PACKAGE_otcl_COMPLETE=true
-
+tcl_http_library_dir=/dev/null
+tcl_http_places=" \
+	$V_LIBRARY_TCL \
+	$V_LIBRARY_TCL/http \
+	$V_LIBRARY_TCL/http2.4 \
+	$V_LIBRARY_TCL/http2.3 \
+	$V_LIBRARY_TCL/http2.1 \
+	$V_LIBRARY_TCL/http2.0 \
+	$V_LIBRARY_TCL/http1.0 \
+	"
 
-{ $as_echo "$as_me:$LINENO: checking for otcl.h" >&5
-$as_echo_n "checking for otcl.h... " >&6; }
-if test "x$d" = "xno"; then
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for http.tcl" >&5
+$as_echo_n "checking for http.tcl... " >&6; }
+if test "x""" = "xno"; then
 	: disable header
-	V_INCLUDE_OTCL=FAIL
+	tcl_http_library_dir=FAIL
 
-NS_PACKAGE_otcl_COMPLETE=false
+NS_PACKAGE_tcl_COMPLETE=false
 
-	{ $as_echo "$as_me:$LINENO: result: no" >&5
+	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
 $as_echo "no" >&6; }
 
 else
-	places="$OTCL_H_PLACES"
-	if test "x$d" != "x" -a "x$d" != xyes; then
-		if test ! -d $d; then
-			{ { $as_echo "$as_me:$LINENO: error: $d is not a directory" >&5
-$as_echo "$as_me: error: $d is not a directory" >&2;}
-   { (exit 1); exit 1; }; }
+	places="$tcl_http_places"
+	if test "x""" != "x" -a "x""" != xyes; then
+		if test ! -d ""; then
+			as_fn_error "\"\" is not a directory" "$LINENO" 5
 		fi
-		places="$OTCL_H_PLACES_D"
+		places=""""
 	fi
 
-	V_INCLUDE_OTCL=""
-	found=""
+	tcl_http_library_dir=""
 	for dir in $places; do
-		if test -r $dir/otcl.h; then
-                        found="$dir"
-                        if test "$CC" != "icc" ||
-                                test "$dir" != "/usr/include"; then
-                                V_INCLUDE_OTCL="-I$dir"
-                        fi
+		if test -r $dir/http.tcl; then
+			tcl_http_library_dir="$dir"
 			break
 		fi
 	done
-	if test "FAIL$found" = "FAIL" ; then
+	if test "FAIL$tcl_http_library_dir" = "FAIL" ; then
 
-NS_PACKAGE_otcl_COMPLETE=false
+NS_PACKAGE_tcl_COMPLETE=false
 
-		{ $as_echo "$as_me:$LINENO: result: no" >&5
+		{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
 $as_echo "no" >&6; }
 	else
 
-				  ac_tr_hdr=HAVE_`echo otcl.h | sed 'y%abcdefghijklmnopqrstuvwxyz./-%ABCDEFGHIJKLMNOPQRSTUVWXYZ___%'`
-		                cat >>confdefs.h <<_ACEOF
-#define $ac_tr_hdr 1
-_ACEOF
+		NS_PACKAGE_tcl_UNDERWAY=true
 
+		{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $tcl_http_library_dir" >&5
+$as_echo "$tcl_http_library_dir" >&6; }
+	fi
+fi
 
-		V_INCLUDES="$V_INCLUDE_OTCL $V_INCLUDES"
-		V_DEFINES="-D$ac_tr_hdr $V_DEFINES"
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking Tcl http.tcl library" >&5
+$as_echo_n "checking Tcl http.tcl library... " >&6; }
+if test -f $tcl_http_library_dir/http.tcl
+then
+	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: yes" >&5
+$as_echo "yes" >&6; }
+else
+	as_fn_error "Couldn't find http.tcl in $tcl_http_places" "$LINENO" 5
+fi
 
-		NS_PACKAGE_otcl_UNDERWAY=true
 
-		{ $as_echo "$as_me:$LINENO: result: $V_INCLUDE_OTCL" >&5
-$as_echo "$V_INCLUDE_OTCL" >&6; }
-	fi
+V_TCL_LIBRARY_FILES="\$(TCL_BASE_LIBRARY_FILES) $tcl_http_library_dir/http.tcl"
+
+
+#
+# check for tclsh
+#
+oldpath=$PATH
+# $d/unix works if $d is the 8.0 distribution
+# $d/bin is for the ns-allinone distribution (kind of hacky, isn't it?)
+PATH=../bin:../tcl$TCL_HI_VERS/unix:../tcl$TCL_VERS/unix:$d/unix:$d/bin:$PATH
+for ac_prog in tclsh$TCL_VERS tclsh$TCL_HI_VERS tclsh tclsh$TCL_OLD_VERS
+do
+  # Extract the first word of "$ac_prog", so it can be a program name with args.
+set dummy $ac_prog; ac_word=$2
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for $ac_word" >&5
+$as_echo_n "checking for $ac_word... " >&6; }
+if test "${ac_cv_path_V_TCLSH+set}" = set; then :
+  $as_echo_n "(cached) " >&6
+else
+  case $V_TCLSH in
+  [\\/]* | ?:[\\/]*)
+  ac_cv_path_V_TCLSH="$V_TCLSH" # Let the user override the test with a path.
+  ;;
+  *)
+  as_save_IFS=$IFS; IFS=$PATH_SEPARATOR
+for as_dir in $PATH
+do
+  IFS=$as_save_IFS
+  test -z "$as_dir" && as_dir=.
+    for ac_exec_ext in '' $ac_executable_extensions; do
+  if { test -f "$as_dir/$ac_word$ac_exec_ext" && $as_test_x "$as_dir/$ac_word$ac_exec_ext"; }; then
+    ac_cv_path_V_TCLSH="$as_dir/$ac_word$ac_exec_ext"
+    $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
+    break 2
+  fi
+done
+  done
+IFS=$as_save_IFS
+
+  ;;
+esac
 fi
-
-
-{ $as_echo "$as_me:$LINENO: checking for libotcl$OTCL_VERS" >&5
-$as_echo_n "checking for libotcl$OTCL_VERS... " >&6; }
-if test "x$d" = "xno"; then
-	: disable library
-	V_LIB_OTCL=FAIL
-
-NS_PACKAGE_otcl_COMPLETE=false
-
-	{ $as_echo "$as_me:$LINENO: result: no" >&5
-$as_echo "no" >&6; }
-
+V_TCLSH=$ac_cv_path_V_TCLSH
+if test -n "$V_TCLSH"; then
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $V_TCLSH" >&5
+$as_echo "$V_TCLSH" >&6; }
 else
-	places="$OTCL_LIB_PLACES"
-	if test "x$d" != "x" -a "x$d" != xyes; then
-		if test ! -d $d; then
-			{ { $as_echo "$as_me:$LINENO: error: $d is not a directory" >&5
-$as_echo "$as_me: error: $d is not a directory" >&2;}
-   { (exit 1); exit 1; }; }
-		fi
-		places="$OTCL_LIB_PLACES_D"
-	fi
-
-	V_LIB_OTCL=""
-		full_lib_name="otcl$OTCL_VERS"
-		simple_lib_name=`echo $full_lib_name | sed -e 's/\.//'`
-		other_simple_lib_name=`echo $full_lib_name | sed -e 's/\./_/'`
-		simpler_lib_name=`echo $simple_lib_name | sed -e 'y/0123456789/          /'`
-	double_break=false
-	for dir in $places; do
-		for file in $full_lib_name $simple_lib_name $other_simple_lib_name $simpler_lib_name
-		do
-			if test -r $dir/lib$file.so -o -r $dir/lib$file.a -o -r $dir/lib$file.dylib; then
-				V_LIB_OTCL="-L$dir -l$file"
-				double_break=true
-				break
-			fi
-		done
-		if $double_break; then
-			break
-		fi
-	done
-	if test "FAIL$V_LIB_OTCL" = "FAIL" ; then
-
-NS_PACKAGE_otcl_COMPLETE=false
-
-		{ $as_echo "$as_me:$LINENO: result: no" >&5
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
 $as_echo "no" >&6; }
-	else
-		if test "$solaris"; then
-			V_LIB_OTCL="-R$dir $V_LIB_OTCL"
-		fi
+fi
 
-				ac_tr_lib=HAVE_LIB`echo otcl$OTCL_VERS | sed -e 's/[^a-zA-Z0-9_]/_/g' \
-		    -e 'y/abcdefghijklmnopqrstuvwxyz/ABCDEFGHIJKLMNOPQRSTUVWXYZ/'`
-				cat >>confdefs.h <<_ACEOF
-#define $ac_tr_lib 1
-_ACEOF
 
+  test -n "$V_TCLSH" && break
+done
+test -n "$V_TCLSH" || V_TCLSH="no"
 
-				V_LIBS="$V_LIB_OTCL $V_LIBS"
-		V_DEFINES="-D$ac_tr_lib $V_DEFINES"
+if test x"$V_TCLSH" = xno
+then
+	# out of luck
 
-		NS_PACKAGE_otcl_UNDERWAY=true
+NS_PACKAGE_tcl_COMPLETE=false
 
-		{ $as_echo "$as_me:$LINENO: result: $V_LIB_OTCL" >&5
-$as_echo "$V_LIB_OTCL" >&6; }
-	fi
 fi
+# absolutize it
+V_TCLSH=`absolutize $V_TCLSH`
+PATH=$oldpath
 
 
-NS_PACKAGE_otcl_VALID=false
-if $NS_PACKAGE_otcl_UNDERWAY; then
-	if $NS_PACKAGE_otcl_COMPLETE; then
-		: All components of otcl found.
-		NS_PACKAGE_otcl_VALID=true
+NS_PACKAGE_tcl_VALID=false
+if $NS_PACKAGE_tcl_UNDERWAY; then
+	if $NS_PACKAGE_tcl_COMPLETE; then
+		: All components of tcl found.
+		NS_PACKAGE_tcl_VALID=true
 	else
-		{ { $as_echo "$as_me:$LINENO: error: Installation of otcl seems incomplete or can't be found automatically.
-Please correct the problem by telling configure where otcl is
-using the argument --with-otcl=/path/to/package
-(perhaps after installing it),
-or the package is not required, disable it with --with-otcl=no." >&5
-$as_echo "$as_me: error: Installation of otcl seems incomplete or can't be found automatically.
-Please correct the problem by telling configure where otcl is
-using the argument --with-otcl=/path/to/package
+		as_fn_error "Installation of tcl seems incomplete or can't be found automatically.
+Please correct the problem by telling configure where tcl is
+using the argument --with-tcl=/path/to/package
 (perhaps after installing it),
-or the package is not required, disable it with --with-otcl=no." >&2;}
-   { (exit 1); exit 1; }; }
+or the package is not required, disable it with --with-tcl=no." "$LINENO" 5
 	fi
 fi
 if test "xyes" = xyes; then
-	if $NS_PACKAGE_otcl_VALID; then
+	if $NS_PACKAGE_tcl_VALID; then
 		:
 	else
-		{ { $as_echo "$as_me:$LINENO: error: otcl is required but could not be completely found.
-Please correct the problem by telling configure where otcl is
-using the argument --with-otcl=/path/to/package,
-or the package is not required, disable it with --with-otcl=no." >&5
-$as_echo "$as_me: error: otcl is required but could not be completely found.
-Please correct the problem by telling configure where otcl is
-using the argument --with-otcl=/path/to/package,
-or the package is not required, disable it with --with-otcl=no." >&2;}
-   { (exit 1); exit 1; }; }
+		as_fn_error "tcl is required but could not be completely found.
+Please correct the problem by telling configure where tcl is
+using the argument --with-tcl=/path/to/package,
+or the package is not required, disable it with --with-tcl=no." "$LINENO" 5
 	fi
 fi
 
@@ -7411,171 +5996,265 @@
 
 
 
-# Check whether --with-Tcl was given.
-if test "${with_Tcl+set}" = set; then
-  withval=$with_Tcl; { { $as_echo "$as_me:$LINENO: error: The --with-Tcl option has been replaced with --with-tclcl.
-Please insure you have an up-to-date copy of TclCL and re-run your configuration." >&5
-$as_echo "$as_me: error: The --with-Tcl option has been replaced with --with-tclcl.
-Please insure you have an up-to-date copy of TclCL and re-run your configuration." >&2;}
-   { (exit 1); exit 1; }; }
-fi
 
 
 
-# Check whether --with-tclcl was given.
-if test "${with_tclcl+set}" = set; then
-  withval=$with_tclcl; d=$withval
+# Check whether --with-tk was given.
+if test "${with_tk+set}" = set; then :
+  withval=$with_tk; d=$withval
 else
   d=""
 fi
 
 
-TCLCL_VERS=1.19
-TCLCL_ALT_VERS=1.0
 
-TCLCL_H_PLACES="\
-		../tclcl-$TCLCL_VERS \
-		../tclcl-$TCLCL_ALT_VERS \
-		../tclcl \
-		../TclCL \
-		../Tcl-$TCLCL_VERS \
-		../Tcl-$TCLCL_ALT_VERS \
-		../Tcl \
-                /usr/src/local/Tcl \
-                /usr/src/local/Tcl-1.0 \
-                /import/Tcl/include \
-                /usr/local/include \
+# Check whether --with-tk-ver was given.
+if test "${with_tk_ver+set}" = set; then :
+  withval=$with_tk_ver; TK_VERS=$withval
+else
+  TK_VERS=8.4.18
+fi
+
+
+
+
+TK_HI_VERS=`echo $TK_VERS | sed 's/\([0-9]*\)\.\([0-9]*\)\.\([0-9]*\)/\1.\2/'`
+TK_MAJOR_VERS=`echo $TK_VERS | sed 's/\([0-9]*\)\.\([0-9]*\)\.\([0-9]*\)/\1/'`
+TK_ALT_VERS=`echo $TK_VERS | sed 's/\.//'`
+
+TK_OLD_VERS=8.3.5
+TK_OLD_ALT_VERS=`echo $TK_OLD_VERS | sed 's/\.//'`
+
+TK_TCL_PLACES_D="$d \
+                $d/lib64/tk$TK_VERS \
+                $d/lib64/tk$TK_ALT_VERS \
+                $d/lib64/tk$TK_VERS \
+                $d/lib/tk$TK_ALT_VERS \
+		$d/lib/tk$TK_HI_VERS \
+                $d/library \
+                $d/lib/tk \
+                $d/../lib/tk$TK_VERS \
+                $d/../lib/tk$TK_ALT_VERS \
+                $d/../lib/tk$TK_HI_VERS \
+                $d/../lib/tk \
+                $d/lib/tk$TK_OLD_VERS \
+                $d/lib/tk$TK_OLD_ALT_VERS \
+                $d/../lib/tk$TK_OLD_VERS \
+                $d/../lib/tk$TK_OLD_ALT_VERS \
+                $d/../lib/tk \
+                $d/lib \
+                $d/library"
+TK_TCL_PLACES=" \
+		../lib/tk$TK_HI_VERS \
+		../lib/tk$TK_VERS \
+		../lib/tk$TK_ALT_VERS \
+		../tk$TK_VERS/library \
+                ../tk$TK_ALT_VERS/library \
+                ../tk$TK_HI_VERS/library \
+		../tk/library \
+                /usr/src/local/tk$TK_VERS/library \
+                /usr/src/local/tk$TK_ALT_VERS/library \
+                /usr/src/local/tk$TK_HI_VERS/library \
                 /usr/contrib/include \
+                /usr/local/lib/tk$TK_VERS \
+                /usr/local/lib/tk$TK_ALT_VERS \
+                /usr/local/lib/tk$TK_HI_VERS \
+                /usr/local/include/tk$TK_VERS \
+                /usr/local/include/tk$TK_ALT_VERS \
+                /usr/local/include/tk$TK_HI_VERS \
+                /usr/local/include \
+                /usr/lib64/tk$TK_VERS \
+                /usr/lib64/tk$TK_ALT_VERS \
+                /usr/lib64/tk$TK_HI_VERS \
+                /usr/lib64/tk \
+                /usr/lib/tk$TK_VERS \
+                /usr/lib/tk$TK_ALT_VERS \
+                /usr/lib/tk$TK_HI_VERS \
+                /usr/lib/tk \
+                /usr/share/tk$TK_VERS \
+                /usr/share/tk$TK_ALT_VERS \
+                /usr/share/tk$TK_HI_VERS \
+                /usr/share/tcltk/tk$TK_VERS \
+                /usr/share/tcltk/tk$TK_ALT_VERS \
+                /usr/share/tcltk/tk$TK_HI_VERS \
+                /usr/share/tk \
+		../tk$TK_OLD_VERS/library \
+                ../tk$TK_OLD_ALT_VERS/library \
+                /usr/src/local/tk$TK_OLD_VERS/library \
+                /usr/src/local/tk$TK_OLD_ALT_VERS/library \
+                /usr/local/lib/tk$TK_OLD_VERS \
+                /usr/local/lib/tk$TK_OLD_ALT_VERS \
+                /usr/local/include/tk$TK_OLD_VERS \
+                /usr/local/include/tk$TK_OLD_ALT_VERS \
+                /usr/lib/tk$TK_OLD_VERS \
+                /usr/lib/tk$TK_OLD_ALT_VERS \
+                $prefix/include \
+		$prefix/lib/tk \
+                $x_includes/tk \
+                $x_includes \
                 /usr/include"
-TCLCL_H_PLACES_D="$d \
- 		$d/include"
-TCLCL_LIB_PLACES="\
-		../tclcl-$TCLCL_VERS \
-		../tclcl-$TCLCL_ALT_VERS \
-		../tclcl \
-		../TclCL \
-		../Tcl-$TCLCL_VERS \
-		../Tcl-$TCLCL_ALT_VERS \
-		../Tcl \
-                $x_libraries \
+TK_H_PLACES_D="$d \
+                $d/generic \
+                $d/../include/tk$TK_VERS \
+                $d/../include/tk$TK_HI_VERS \
+                $d/../include/tk$TK_OLD_VERS \
+		$d/include/tk$TK_VERS \
+		$d/include/tk$TK_HI_VERS \
+		$d/include/tk$TK_OLD_VERS \
+                $d/include"
+TK_H_PLACES=" \
+		../include \
+		../tk$TK_VERS/generic \
+                ../tk$TK_ALT_VERS/generic \
+                ../tk$TK_HI_VERS/generic \
+		/usr/src/local/tk$TK_VERS/generic \
+                /usr/src/local/tk$TK_ALT_VERS/generic \
+                /usr/src/local/tk$TK_HI_VERS/generic \
+                /usr/contrib/include \
+                /usr/local/lib/tk$TK_VERS \
+                /usr/local/lib/tk$TK_ALT_VERS \
+                /usr/local/lib/tk$TK_HI_VERS \
+                /usr/local/include/tk$TK_VERS \
+                /usr/local/include/tk$TK_ALT_VERS \
+                /usr/local/include/tk$TK_HI_VERS \
+                /usr/local/include \
+                /import/tk/include/tk$TK_VERS \
+                /import/tk/include/tk$TK_ALT_VERS \
+                /import/tk/include/tk$TK_HI_VERS \
+		../tk$TK_OLD_VERS/generic \
+                ../tk$TK_OLD_ALT_VERS/generic \
+		/usr/src/local/tk$TK_OLD_VERS/generic \
+                /usr/src/local/tk$TK_OLD_ALT_VERS/generic \
+                /usr/local/lib/tk$TK_OLD_VERS \
+                /usr/local/lib/tk$TK_OLD_ALT_VERS \
+                /usr/local/include/tk$TK_OLD_VERS \
+                /usr/local/include/tk$TK_OLD_ALT_VERS \
+                /import/tk/include/tk$TK_OLD_VERS \
+                /import/tk/include/tk$TK_OLD_ALT_VERS \
+                $prefix/include \
+                $x_includes/tk \
+                $x_includes \
+                /usr/include \
+                /usr/include/tcl \
+                /usr/include/tcl$TK_VERS \
+                /usr/include/tcl$TK_ALT_VERS \
+                /usr/include/tcl$TK_HI_VERS \
+                "
+TK_LIB_PLACES_D="$d \
+                $d/lib \
+		$d/unix"
+TK_LIB_PLACES=" \
+		../lib \
+		../lib/tk$TK_HI_VERS \
+		../lib/tk$TK_VERS \
+		../lib/tk$TK_ALT_VERS \
+		../tk$TK_VERS/unix \
+                ../tk$TK_ALT_VERS/unix \
+                ../tk$TK_HI_VERS/unix \
+                /usr/src/local/tk$TK_VERS/unix \
+                /usr/src/local/tk$TK_ALT_VERS/unix \
+                /usr/src/local/tk$TK_HI_VERS/unix \
                 /usr/contrib/lib \
+                /usr/local/lib/tk$TK_VERS \
+                /usr/local/lib/tk$TK_ALT_VERS \
+                /usr/local/lib/tk$TK_HI_VERS \
+		../tk$TK_OLD_VERS/unix \
+                ../tk$TK_OLD_ALT_VERS/unix \
+                /usr/src/local/tk$TK_OLD_VERS/unix \
+                /usr/src/local/tk$TK_OLD_ALT_VERS/unix \
+                /usr/local/lib/tk$TK_OLD_VERS \
+                /usr/local/lib/tk$TK_OLD_ALT_VERS \
                 /usr/local/lib \
-                /usr/lib \
-                /usr/src/local/Tcl \
-                /usr/src/local/Tcl-1.0"
-TCLCL_LIB_PLACES_D="\
-        $d \
-        $d/lib \
-        $d/bin"
-TCLCL_PROG_PLACES="\
-		../tclcl-$TCLCL_VERS \
-		../tclcl-$TCLCL_ALT_VERS \
-		../tclcl \
-		../TclCL \
-		../Tcl-$TCLCL_VERS \
-		../Tcl-$TCLCL_ALT_VERS \
-		../Tcl \
-                $prefix/bin \
-                $x_libraries \
-                /usr/contrib/bin \
-                /usr/local/bin \
-                /usr/bin \
-                /usr/src/local/Tcl \
-                /usr/src/local/Tcl-1.0 \
-                "
-TCLCL_PROG_PLACES_D="
-	$d \
-	$d/bin"
-
+                $prefix/lib \
+                $x_libs/tk \
+                $x_libs \
+                /usr/lib64 \
+                /usr/lib"
 
 
-NS_PACKAGE_tclcl_UNDERWAY=false
-NS_PACKAGE_tclcl_COMPLETE=true
+NS_PACKAGE_tk_UNDERWAY=false
+NS_PACKAGE_tk_COMPLETE=true
 
 
-{ $as_echo "$as_me:$LINENO: checking for tclcl.h" >&5
-$as_echo_n "checking for tclcl.h... " >&6; }
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for tk.h" >&5
+$as_echo_n "checking for tk.h... " >&6; }
 if test "x$d" = "xno"; then
 	: disable header
-	V_INCLUDE_TCLCL=FAIL
+	V_INCLUDE_TK=FAIL
 
-NS_PACKAGE_tclcl_COMPLETE=false
+NS_PACKAGE_tk_COMPLETE=false
 
-	{ $as_echo "$as_me:$LINENO: result: no" >&5
+	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
 $as_echo "no" >&6; }
 
 else
-	places="$TCLCL_H_PLACES"
+	places="$TK_H_PLACES"
 	if test "x$d" != "x" -a "x$d" != xyes; then
 		if test ! -d $d; then
-			{ { $as_echo "$as_me:$LINENO: error: $d is not a directory" >&5
-$as_echo "$as_me: error: $d is not a directory" >&2;}
-   { (exit 1); exit 1; }; }
+			as_fn_error "$d is not a directory" "$LINENO" 5
 		fi
-		places="$TCLCL_H_PLACES_D"
+		places="$TK_H_PLACES_D"
 	fi
 
-	V_INCLUDE_TCLCL=""
+	V_INCLUDE_TK=""
 	found=""
 	for dir in $places; do
-		if test -r $dir/tclcl.h; then
+		if test -r $dir/tk.h; then
                         found="$dir"
                         if test "$CC" != "icc" ||
                                 test "$dir" != "/usr/include"; then
-                                V_INCLUDE_TCLCL="-I$dir"
+                                V_INCLUDE_TK="-I$dir"
                         fi
 			break
 		fi
 	done
 	if test "FAIL$found" = "FAIL" ; then
 
-NS_PACKAGE_tclcl_COMPLETE=false
+NS_PACKAGE_tk_COMPLETE=false
 
-		{ $as_echo "$as_me:$LINENO: result: no" >&5
+		{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
 $as_echo "no" >&6; }
 	else
 
-				  ac_tr_hdr=HAVE_`echo tclcl.h | sed 'y%abcdefghijklmnopqrstuvwxyz./-%ABCDEFGHIJKLMNOPQRSTUVWXYZ___%'`
+				  ac_tr_hdr=HAVE_`echo tk.h | sed 'y%abcdefghijklmnopqrstuvwxyz./-%ABCDEFGHIJKLMNOPQRSTUVWXYZ___%'`
 		                cat >>confdefs.h <<_ACEOF
 #define $ac_tr_hdr 1
 _ACEOF
 
 
-		V_INCLUDES="$V_INCLUDE_TCLCL $V_INCLUDES"
+		V_INCLUDES="$V_INCLUDE_TK $V_INCLUDES"
 		V_DEFINES="-D$ac_tr_hdr $V_DEFINES"
 
-		NS_PACKAGE_tclcl_UNDERWAY=true
+		NS_PACKAGE_tk_UNDERWAY=true
 
-		{ $as_echo "$as_me:$LINENO: result: $V_INCLUDE_TCLCL" >&5
-$as_echo "$V_INCLUDE_TCLCL" >&6; }
+		{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $V_INCLUDE_TK" >&5
+$as_echo "$V_INCLUDE_TK" >&6; }
 	fi
 fi
 
 
-{ $as_echo "$as_me:$LINENO: checking for libtclcl$tclcl_VERS" >&5
-$as_echo_n "checking for libtclcl$tclcl_VERS... " >&6; }
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for libtk$TK_HI_VERS" >&5
+$as_echo_n "checking for libtk$TK_HI_VERS... " >&6; }
 if test "x$d" = "xno"; then
 	: disable library
-	V_LIB_TCLCL=FAIL
+	V_LIB_TK=FAIL
 
-NS_PACKAGE_tclcl_COMPLETE=false
+NS_PACKAGE_tk_COMPLETE=false
 
-	{ $as_echo "$as_me:$LINENO: result: no" >&5
+	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
 $as_echo "no" >&6; }
 
 else
-	places="$TCLCL_LIB_PLACES"
+	places="$TK_LIB_PLACES"
 	if test "x$d" != "x" -a "x$d" != xyes; then
 		if test ! -d $d; then
-			{ { $as_echo "$as_me:$LINENO: error: $d is not a directory" >&5
-$as_echo "$as_me: error: $d is not a directory" >&2;}
-   { (exit 1); exit 1; }; }
+			as_fn_error "$d is not a directory" "$LINENO" 5
 		fi
-		places="$TCLCL_LIB_PLACES_D"
+		places="$TK_LIB_PLACES_D"
 	fi
 
-	V_LIB_TCLCL=""
-		full_lib_name="tclcl$tclcl_VERS"
+	V_LIB_TK=""
+		full_lib_name="tk$TK_HI_VERS"
 		simple_lib_name=`echo $full_lib_name | sed -e 's/\.//'`
 		other_simple_lib_name=`echo $full_lib_name | sed -e 's/\./_/'`
 		simpler_lib_name=`echo $simple_lib_name | sed -e 'y/0123456789/          /'`
@@ -7584,7 +6263,7 @@
 		for file in $full_lib_name $simple_lib_name $other_simple_lib_name $simpler_lib_name
 		do
 			if test -r $dir/lib$file.so -o -r $dir/lib$file.a -o -r $dir/lib$file.dylib; then
-				V_LIB_TCLCL="-L$dir -l$file"
+				V_LIB_TK="-L$dir -l$file"
 				double_break=true
 				break
 			fi
@@ -7593,570 +6272,471 @@
 			break
 		fi
 	done
-	if test "FAIL$V_LIB_TCLCL" = "FAIL" ; then
+	if test "FAIL$V_LIB_TK" = "FAIL" ; then
 
-NS_PACKAGE_tclcl_COMPLETE=false
+NS_PACKAGE_tk_COMPLETE=false
 
-		{ $as_echo "$as_me:$LINENO: result: no" >&5
+		{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
 $as_echo "no" >&6; }
 	else
 		if test "$solaris"; then
-			V_LIB_TCLCL="-R$dir $V_LIB_TCLCL"
+			V_LIB_TK="-R$dir $V_LIB_TK"
 		fi
 
-				ac_tr_lib=HAVE_LIB`echo tclcl$tclcl_VERS | sed -e 's/[^a-zA-Z0-9_]/_/g' \
+				ac_tr_lib=HAVE_LIB`echo tk$TK_HI_VERS | sed -e 's/[^a-zA-Z0-9_]/_/g' \
 		    -e 'y/abcdefghijklmnopqrstuvwxyz/ABCDEFGHIJKLMNOPQRSTUVWXYZ/'`
 				cat >>confdefs.h <<_ACEOF
 #define $ac_tr_lib 1
 _ACEOF
 
 
-				V_LIBS="$V_LIB_TCLCL $V_LIBS"
+				V_LIBS="$V_LIB_TK $V_LIBS"
 		V_DEFINES="-D$ac_tr_lib $V_DEFINES"
 
-		NS_PACKAGE_tclcl_UNDERWAY=true
+		NS_PACKAGE_tk_UNDERWAY=true
 
-		{ $as_echo "$as_me:$LINENO: result: $V_LIB_TCLCL" >&5
-$as_echo "$V_LIB_TCLCL" >&6; }
+		{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $V_LIB_TK" >&5
+$as_echo "$V_LIB_TK" >&6; }
 	fi
 fi
 
 
-{ $as_echo "$as_me:$LINENO: checking for tcl2c++" >&5
-$as_echo_n "checking for tcl2c++... " >&6; }
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for tk.tcl" >&5
+$as_echo_n "checking for tk.tcl... " >&6; }
 if test "x$d" = "xno"; then
 	: disable header
-	V_TCL2CPP_DIR=FAIL
+	V_LIBRARY_TK=FAIL
 
-NS_PACKAGE_tclcl_COMPLETE=false
+NS_PACKAGE_tk_COMPLETE=false
 
-	{ $as_echo "$as_me:$LINENO: result: no" >&5
+	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
 $as_echo "no" >&6; }
 
 else
-	places="$TCLCL_PROG_PLACES"
+	places="$TK_TCL_PLACES"
 	if test "x$d" != "x" -a "x$d" != xyes; then
 		if test ! -d $d; then
-			{ { $as_echo "$as_me:$LINENO: error: $d is not a directory" >&5
-$as_echo "$as_me: error: $d is not a directory" >&2;}
-   { (exit 1); exit 1; }; }
+			as_fn_error "$d is not a directory" "$LINENO" 5
 		fi
-		places="$TCLCL_PROG_PLACES_D"
+		places="$TK_TCL_PLACES_D"
 	fi
 
-	V_TCL2CPP_DIR=""
+	V_LIBRARY_TK=""
 	for dir in $places; do
-		if test -r $dir/tcl2c++; then
-			V_TCL2CPP_DIR="$dir"
+		if test -r $dir/tk.tcl; then
+			V_LIBRARY_TK="$dir"
 			break
 		fi
 	done
-	if test "FAIL$V_TCL2CPP_DIR" = "FAIL" ; then
+	if test "FAIL$V_LIBRARY_TK" = "FAIL" ; then
 
-NS_PACKAGE_tclcl_COMPLETE=false
+NS_PACKAGE_tk_COMPLETE=false
 
-		{ $as_echo "$as_me:$LINENO: result: no" >&5
+		{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
 $as_echo "no" >&6; }
 	else
 
-		NS_PACKAGE_tclcl_UNDERWAY=true
-
-		{ $as_echo "$as_me:$LINENO: result: $V_TCL2CPP_DIR" >&5
-$as_echo "$V_TCL2CPP_DIR" >&6; }
-	fi
-fi
-
-
-V_TCL2CPP=$V_TCL2CPP_DIR/tcl2c++
-
-
+		NS_PACKAGE_tk_UNDERWAY=true
 
-NS_PACKAGE_tclcl_VALID=false
-if $NS_PACKAGE_tclcl_UNDERWAY; then
-	if $NS_PACKAGE_tclcl_COMPLETE; then
-		: All components of tclcl found.
-		NS_PACKAGE_tclcl_VALID=true
-	else
-		{ { $as_echo "$as_me:$LINENO: error: Installation of tclcl seems incomplete or can't be found automatically.
-Please correct the problem by telling configure where tclcl is
-using the argument --with-tclcl=/path/to/package
-(perhaps after installing it),
-or the package is not required, disable it with --with-tclcl=no." >&5
-$as_echo "$as_me: error: Installation of tclcl seems incomplete or can't be found automatically.
-Please correct the problem by telling configure where tclcl is
-using the argument --with-tclcl=/path/to/package
-(perhaps after installing it),
-or the package is not required, disable it with --with-tclcl=no." >&2;}
-   { (exit 1); exit 1; }; }
-	fi
-fi
-if test "xyes" = xyes; then
-	if $NS_PACKAGE_tclcl_VALID; then
-		:
-	else
-		{ { $as_echo "$as_me:$LINENO: error: tclcl is required but could not be completely found.
-Please correct the problem by telling configure where tclcl is
-using the argument --with-tclcl=/path/to/package,
-or the package is not required, disable it with --with-tclcl=no." >&5
-$as_echo "$as_me: error: tclcl is required but could not be completely found.
-Please correct the problem by telling configure where tclcl is
-using the argument --with-tclcl=/path/to/package,
-or the package is not required, disable it with --with-tclcl=no." >&2;}
-   { (exit 1); exit 1; }; }
+		{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $V_LIBRARY_TK" >&5
+$as_echo "$V_LIBRARY_TK" >&6; }
 	fi
 fi
 
-
-
-
-case "$target" in
-*-dec-*)
-					V_DEFINE="$V_DEFINE -D_XOPEN_SOURCE_EXTENDED"
-	cat >>confdefs.h <<\_ACEOF
-#define _XOPEN_SOURCE_EXTENDED 1
-_ACEOF
-
-	;;
-sparc-sun-solaris*)
-	if test $CC != gcc ; then
-	        V_DEFINE="$V_DEFINE -D__FUNCTION__=__func__ -features=extensions"
-	fi
-        V_DEFINE="$V_DEFINE -D__svr4__ -DSOLARIS_MIN_MAX"
-	V_LIB="$V_LIB -ldl"
-	;;
-sparc-sun-sunos*)
-	V_DEFINE="$V_DEFINE -DNEED_SUNOS_PROTOS"
-	;;
-*-sgi-irix5*)
-	V_DEFINE="$V_DEFINE -DIRIX5 -D_BSD_SIGNALS"
-	if test "$target_os" = irix5.3 ; then
-		V_DEFINE="$V_DEFINE -DIRIX5_3"
-	fi
-	V_TARCMD="tar cfL"
-	V_SHELL="SHELL = /bin/sh"
-	if test $CC != gcc ; then
-		V_DEFINE="$V_DEFINE -signed -g3"
-		V_CXXOPT="$V_CXXOPT +p -float"
-		CC="cc -xansi -D__STDC__ -Dinline="
-		CXX="CC +p -float -DSGI_COMPAT"
-	fi
-	V_RANLIB="ar ts"
-	;;
-*-sgi-irix6*)
-	V_DEFINE="$V_DEFINE -DIRIX6 -D_BSD_SIGNALS"
-	V_TARCMD="tar cfL"
-	V_SHELL="SHELL = /bin/sh"
-	if test $CC != gcc ; then
-		V_DEFINE="$V_DEFINE -signed -g3"
-		V_CXXOPT="$V_CXXOPT +p -float"
-		CC="cc -xansi -D__STDC__ -Dinline="
-		CXX="CC +p -float -DSGI_COMPAT"
-	fi
-	V_RANLIB="ar ts"
-	;;
-*-*-bsdi1*)
-	V_SHM=""
-	V_TARCMD="tar cfL"
-	;;
-*-*-bsdi2.0*)
-	V_SHM=""
-	V_TARCMD="tar cfL"
-	;;
-*-*-bsdi2.1*)
-	# bsdi2.1 added sys-v shared memory support but their implementation
-	# is broken so we have to turn it off.  If they ever fix libipc,
-	# the following line should be deleted.
-	V_SHM=""
-	V_TARCMD="tar cfL"
-	V_CCOPT="-O2 -m486"
-	V_LIB="$V_LIB -lipc -ldl"
-	;;
-*-*-bsdi3*)
-	V_SHM=""
-	V_TARCMD="tar cfL"
-	V_LIB="$V_LIB -lipc -ldl"
-	V_OBJ="$V_OBJ misc/serial.o"
-	;;
-*-*-freebsd*)
-	V_OBJ="$V_OBJ misc/serial.o"
-	;;
-*-*-netbsd*)
-	V_TARCMD="tar -h -c -f"
-	V_LIB="$V_LIB -L/usr/local/lib"
-	;;
-*-*-hpux*)
-	cat >>confdefs.h <<\_ACEOF
-#define random lrand48
-_ACEOF
-
-	cat >>confdefs.h <<\_ACEOF
-#define srandom srand
-_ACEOF
-
-	V_CCOPT="-O"
-	;;
-*-*-aix3*)
-	V_DEFINE="$V_DEFINE -DSIGARGS=int"
-	if test "$V_LIB_AIXSHM" != "" ; then
-		V_LIB="$V_LIB $V_LIB_AIXSHM"
+
+NS_PACKAGE_tk_VALID=false
+if $NS_PACKAGE_tk_UNDERWAY; then
+	if $NS_PACKAGE_tk_COMPLETE; then
+		: All components of tk found.
+		NS_PACKAGE_tk_VALID=true
 	else
-		V_SHM=""
+		as_fn_error "Installation of tk seems incomplete or can't be found automatically.
+Please correct the problem by telling configure where tk is
+using the argument --with-tk=/path/to/package
+(perhaps after installing it),
+or the package is not required, disable it with --with-tk=no." "$LINENO" 5
 	fi
-	CXX="xlC -+"
-	;;
-*-*-aix4*)
-	V_DEFINE="$V_DEFINE -DSIGARGS=int -D_AIX41"
-	if test "$V_LIB_AIXSHM" != "" ; then
-		V_LIB="$V_LIB $V_LIB_AIXSHM"
+fi
+if test "xno" = xyes; then
+	if $NS_PACKAGE_tk_VALID; then
+		:
 	else
-		V_SHM=""
+		as_fn_error "tk is required but could not be completely found.
+Please correct the problem by telling configure where tk is
+using the argument --with-tk=/path/to/package,
+or the package is not required, disable it with --with-tk=no." "$LINENO" 5
 	fi
-	CXX="g++"
-	;;
-*-*-linux*)
-	V_BROKEN_OBJ=
-	;;
-powerpc-apple-darwin*)
-	V_CCOPT="-fno-common -fPIC -pipe"
-	;;
-esac
+fi
 
 
-xlibdirs="\
-	/usr/openwin/lib \
-	/usr/X11R6/lib \
-	/usr/lib/X11R6 \
-	/usr/X11R5/lib \
-	/usr/lib/X11R5 \
-	/usr/X11R4/lib \
-	/usr/lib/X11R4 \
-	/usr/local/lib \
-	/usr/X386/lib \
-	/usr/X11/lib \
-	/usr/unsupported/lib \
-	/Developer/SDKs/MacOSX10.4u.sdk/usr/X11R6/lib \
-	/import/X11R4/usr/lib"
+if test -r $V_LIBRARY_TK/optionMenu.tcl ; then
+	V_TKDOSNAMES='$(LIBRARY_TK)/optionMenu.tcl $(LIBRARY_TK)/scrollbar.tcl'
+	V_NEED_DL=""
+else
+	V_TKDOSNAMES='$(LIBRARY_TK)/optMenu.tcl $(LIBRARY_TK)/scrlbar.tcl'
+	V_NEED_DL=YES
+fi
 
-xincdirs="\
-	/usr/openwin/include \
-	/usr/X11R6/include \
-	/usr/include/X11R6 \
-	/usr/X11R5/include \
-	/usr/include/X11R5 \
-	/usr/X11R4/include \
-	/usr/include/X11R4 \
-	/usr/local/include \
-	/usr/X386/include \
-	/usr/X11/include \
-	/usr/lpp/X11/include \
-	/usr/unsupported/include \
-	/Developer/SDKs/MacOSX10.4u.sdk/usr/X11R6/include \
-	/import/X11R4/include"
 
 
-echo "checking for X11 header files"
-if test "$x_includes" = NONE ; then
-	cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
-/* end confdefs.h.  */
-#include <X11/Intrinsic.h>
-_ACEOF
-if { (ac_try="$ac_cpp conftest.$ac_ext"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_cpp conftest.$ac_ext") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } >/dev/null && {
-	 test -z "$ac_c_preproc_warn_flag$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       }; then
-  x_includes=""
-else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
 
-  x_includes=NONE
+
+
+# Check whether --with-otcl was given.
+if test "${with_otcl+set}" = set; then :
+  withval=$with_otcl; d=$withval
+else
+  d=""
 fi
 
-rm -f conftest.err conftest.$ac_ext
-	if test "$x_includes" = NONE ; then
-	        for i in $xincdirs ; do
-			if test -r $i/X11/Intrinsic.h; then
-				x_includes=$i
-				break
-			fi
-	        done
-		if test "$x_includes" = NONE ; then
-			echo "can't find X includes"
-	       		exit 1
+
+OTCL_VERS=1.13
+OTCL_ALT_VERS=1.0
+
+OTCL_H_PLACES_D="$d \
+		$d/include"
+OTCL_H_PLACES="../otcl \
+		/usr/src/local/otcl \
+		../otcl-$OTCL_VERS \
+		/import/otcl/include \
+		/usr/src/local/otcl-$OTCL_VERS \
+		/usr/src/local/otcl-$OTCL_ALT_VERS \
+		$prefix/include \
+		/usr/local/include \
+		/usr/contrib/include \
+		/usr/include"
+OTCL_LIB_PLACES_D="$d \
+		$d/lib \
+		"
+OTCL_LIB_PLACES="../otcl \
+		../otcl-$OTCL_VERS \
+		../otcl-$OTCL_ALT_VERS \
+		$prefix/lib \
+		$x_libraries \
+		/usr/contrib/lib \
+		/usr/local/lib \
+		/usr/lib \
+		/usr/src/local/otcl \
+		/usr/src/local/otcl-$OTCL_VERS \
+		/usr/src/local/otcl-$OTCL_ALT_VERS \
+		"
+
+
+NS_PACKAGE_otcl_UNDERWAY=false
+NS_PACKAGE_otcl_COMPLETE=true
+
+
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for otcl.h" >&5
+$as_echo_n "checking for otcl.h... " >&6; }
+if test "x$d" = "xno"; then
+	: disable header
+	V_INCLUDE_OTCL=FAIL
+
+NS_PACKAGE_otcl_COMPLETE=false
+
+	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
+
+else
+	places="$OTCL_H_PLACES"
+	if test "x$d" != "x" -a "x$d" != xyes; then
+		if test ! -d $d; then
+			as_fn_error "$d is not a directory" "$LINENO" 5
 		fi
+		places="$OTCL_H_PLACES_D"
 	fi
-fi
-if test -n "$x_includes" ; then
-	V_INCLUDE_X11=-I$x_includes
 
-fi
+	V_INCLUDE_OTCL=""
+	found=""
+	for dir in $places; do
+		if test -r $dir/otcl.h; then
+                        found="$dir"
+                        if test "$CC" != "icc" ||
+                                test "$dir" != "/usr/include"; then
+                                V_INCLUDE_OTCL="-I$dir"
+                        fi
+			break
+		fi
+	done
+	if test "FAIL$found" = "FAIL" ; then
 
-echo "checking for X11 library archive"
-if test "$x_libraries" = NONE ; then
-	{ $as_echo "$as_me:$LINENO: checking for XOpenDisplay in -lX11" >&5
-$as_echo_n "checking for XOpenDisplay in -lX11... " >&6; }
-if test "${ac_cv_lib_X11_XOpenDisplay+set}" = set; then
-  $as_echo_n "(cached) " >&6
-else
-  ac_check_lib_save_LIBS=$LIBS
-LIBS="-lX11  $LIBS"
-cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
-/* end confdefs.h.  */
+NS_PACKAGE_otcl_COMPLETE=false
 
-/* Override any GCC internal prototype to avoid an error.
-   Use char because int might match the return type of a GCC
-   builtin and then its argument prototype would still apply.  */
-#ifdef __cplusplus
-extern "C"
-#endif
-char XOpenDisplay ();
-int
-main ()
-{
-return XOpenDisplay ();
-  ;
-  return 0;
-}
+		{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
+	else
+
+				  ac_tr_hdr=HAVE_`echo otcl.h | sed 'y%abcdefghijklmnopqrstuvwxyz./-%ABCDEFGHIJKLMNOPQRSTUVWXYZ___%'`
+		                cat >>confdefs.h <<_ACEOF
+#define $ac_tr_hdr 1
 _ACEOF
-rm -f conftest.$ac_objext conftest$ac_exeext
-if { (ac_try="$ac_link"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_link") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest$ac_exeext && {
-	 test "$cross_compiling" = yes ||
-	 $as_test_x conftest$ac_exeext
-       }; then
-  ac_cv_lib_X11_XOpenDisplay=yes
-else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
 
-	ac_cv_lib_X11_XOpenDisplay=no
-fi
 
-rm -rf conftest.dSYM
-rm -f core conftest.err conftest.$ac_objext conftest_ipa8_conftest.oo \
-      conftest$ac_exeext conftest.$ac_ext
-LIBS=$ac_check_lib_save_LIBS
+		V_INCLUDES="$V_INCLUDE_OTCL $V_INCLUDES"
+		V_DEFINES="-D$ac_tr_hdr $V_DEFINES"
+
+		NS_PACKAGE_otcl_UNDERWAY=true
+
+		{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $V_INCLUDE_OTCL" >&5
+$as_echo "$V_INCLUDE_OTCL" >&6; }
+	fi
 fi
-{ $as_echo "$as_me:$LINENO: result: $ac_cv_lib_X11_XOpenDisplay" >&5
-$as_echo "$ac_cv_lib_X11_XOpenDisplay" >&6; }
-if test "x$ac_cv_lib_X11_XOpenDisplay" = x""yes; then
-  x_libraries=""
+
+
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for libotcl$OTCL_VERS" >&5
+$as_echo_n "checking for libotcl$OTCL_VERS... " >&6; }
+if test "x$d" = "xno"; then
+	: disable library
+	V_LIB_OTCL=FAIL
+
+NS_PACKAGE_otcl_COMPLETE=false
+
+	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
+
 else
-  x_libraries=NONE
-fi
+	places="$OTCL_LIB_PLACES"
+	if test "x$d" != "x" -a "x$d" != xyes; then
+		if test ! -d $d; then
+			as_fn_error "$d is not a directory" "$LINENO" 5
+		fi
+		places="$OTCL_LIB_PLACES_D"
+	fi
 
-	if test "$x_libraries" = NONE ; then
-		for i in $xlibdirs ; do
-			if test -r $i/libX11.a -o -r $i/libX11.so -o -r $i/libX11.dll.a; then
-				x_libraries=$i
+	V_LIB_OTCL=""
+		full_lib_name="otcl$OTCL_VERS"
+		simple_lib_name=`echo $full_lib_name | sed -e 's/\.//'`
+		other_simple_lib_name=`echo $full_lib_name | sed -e 's/\./_/'`
+		simpler_lib_name=`echo $simple_lib_name | sed -e 'y/0123456789/          /'`
+	double_break=false
+	for dir in $places; do
+		for file in $full_lib_name $simple_lib_name $other_simple_lib_name $simpler_lib_name
+		do
+			if test -r $dir/lib$file.so -o -r $dir/lib$file.a -o -r $dir/lib$file.dylib; then
+				V_LIB_OTCL="-L$dir -l$file"
+				double_break=true
 				break
 			fi
-       		done
-		if test "$x_libraries" = NONE ; then
-			echo "can't find X library"
-			exit 1
+		done
+		if $double_break; then
+			break
 		fi
-	fi
-fi
+	done
+	if test "FAIL$V_LIB_OTCL" = "FAIL" ; then
 
-V_LIB_X11=-lX11
+NS_PACKAGE_otcl_COMPLETE=false
 
-if test -n "$V_SHM" ; then
-	if test -z "$x_libraries" ; then
-		{ $as_echo "$as_me:$LINENO: checking for XShmAttach in -lXext" >&5
-$as_echo_n "checking for XShmAttach in -lXext... " >&6; }
-if test "${ac_cv_lib_Xext_XShmAttach+set}" = set; then
-  $as_echo_n "(cached) " >&6
-else
-  ac_check_lib_save_LIBS=$LIBS
-LIBS="-lXext -lX11 $LIBS"
-cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
-/* end confdefs.h.  */
+		{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
+	else
+		if test "$solaris"; then
+			V_LIB_OTCL="-R$dir $V_LIB_OTCL"
+		fi
 
-/* Override any GCC internal prototype to avoid an error.
-   Use char because int might match the return type of a GCC
-   builtin and then its argument prototype would still apply.  */
-#ifdef __cplusplus
-extern "C"
-#endif
-char XShmAttach ();
-int
-main ()
-{
-return XShmAttach ();
-  ;
-  return 0;
-}
+				ac_tr_lib=HAVE_LIB`echo otcl$OTCL_VERS | sed -e 's/[^a-zA-Z0-9_]/_/g' \
+		    -e 'y/abcdefghijklmnopqrstuvwxyz/ABCDEFGHIJKLMNOPQRSTUVWXYZ/'`
+				cat >>confdefs.h <<_ACEOF
+#define $ac_tr_lib 1
 _ACEOF
-rm -f conftest.$ac_objext conftest$ac_exeext
-if { (ac_try="$ac_link"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_link") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest$ac_exeext && {
-	 test "$cross_compiling" = yes ||
-	 $as_test_x conftest$ac_exeext
-       }; then
-  ac_cv_lib_Xext_XShmAttach=yes
-else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
 
-	ac_cv_lib_Xext_XShmAttach=no
-fi
 
-rm -rf conftest.dSYM
-rm -f core conftest.err conftest.$ac_objext conftest_ipa8_conftest.oo \
-      conftest$ac_exeext conftest.$ac_ext
-LIBS=$ac_check_lib_save_LIBS
-fi
-{ $as_echo "$as_me:$LINENO: result: $ac_cv_lib_Xext_XShmAttach" >&5
-$as_echo "$ac_cv_lib_Xext_XShmAttach" >&6; }
-if test "x$ac_cv_lib_Xext_XShmAttach" = x""yes; then
-  V_Xext="-lXext"
-else
-  V_Xext=NONE
+				V_LIBS="$V_LIB_OTCL $V_LIBS"
+		V_DEFINES="-D$ac_tr_lib $V_DEFINES"
+
+		NS_PACKAGE_otcl_UNDERWAY=true
+
+		{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $V_LIB_OTCL" >&5
+$as_echo "$V_LIB_OTCL" >&6; }
+	fi
 fi
 
+
+NS_PACKAGE_otcl_VALID=false
+if $NS_PACKAGE_otcl_UNDERWAY; then
+	if $NS_PACKAGE_otcl_COMPLETE; then
+		: All components of otcl found.
+		NS_PACKAGE_otcl_VALID=true
 	else
-		echo "checking for libXext.a"
-		if test -f $x_libraries/libXext.a -o -f $x_libraries/libXext.so; then
-			V_Xext="-lXext"
-		else
-			echo "warning: compiling without -lXext"
-		fi
+		as_fn_error "Installation of otcl seems incomplete or can't be found automatically.
+Please correct the problem by telling configure where otcl is
+using the argument --with-otcl=/path/to/package
+(perhaps after installing it),
+or the package is not required, disable it with --with-otcl=no." "$LINENO" 5
 	fi
-	if test "$V_Xext" = NONE ; then
-		echo "warning: compiling without -lXext"
+fi
+if test "xyes" = xyes; then
+	if $NS_PACKAGE_otcl_VALID; then
+		:
 	else
-		V_LIB_X11="$V_Xext $V_LIB_X11"
+		as_fn_error "otcl is required but could not be completely found.
+Please correct the problem by telling configure where otcl is
+using the argument --with-otcl=/path/to/package,
+or the package is not required, disable it with --with-otcl=no." "$LINENO" 5
 	fi
 fi
 
-if test -n "$x_libraries" ; then
-	V_LIB_X11="-L$x_libraries $V_LIB_X11"
-	if test $solaris ; then
-		V_LIB_X11="-R$x_libraries $V_LIB_X11"
-	fi
-fi
 
 
 
 
-# Check whether --with-tcldebug was given.
-if test "${with_tcldebug+set}" = set; then
-  withval=$with_tcldebug; d=$withval
+# Check whether --with-Tcl was given.
+if test "${with_Tcl+set}" = set; then :
+  withval=$with_Tcl; as_fn_error "The --with-Tcl option has been replaced with --with-tclcl.
+Please insure you have an up-to-date copy of TclCL and re-run your configuration." "$LINENO" 5
+fi
+
+
+
+# Check whether --with-tclcl was given.
+if test "${with_tclcl+set}" = set; then :
+  withval=$with_tclcl; d=$withval
 else
   d=""
 fi
 
 
-#xxx: Don't know anything about 1.8
-# 2.0 = tcl 8.3
-# 1.9 = tcl 7.5, 7.6, 8.0
-TCLDEBUG_VERS="2.0 1.9 1.8 1.7"
-pwd_vers=""
-local_vers=""
-for vers in $TCLDEBUG_VERS; do
-	 pwd_vers="$pwd_vers $PWD/../tcl-debug-$vers"
-	 local_vers="$local_vers /usr/src/local/otcl-debug-$vers"
-done
-TCLDEBUG_PATH="\
-		$PWD/../tcl-debug \
-		$pwd_vers
-		/usr/contrib/lib \
-		/usr/local/lib \
-		/usr/lib \
-		/usr/src/local/tcl-debug \
-		$local_vers \
-		"
-TCLDEBUG_PATH_D="$d \
-		$d/lib \
-		$d/../lib \
-		"
+TCLCL_VERS=1.19
+TCLCL_ALT_VERS=1.0
+
+TCLCL_H_PLACES="\
+		../tclcl-$TCLCL_VERS \
+		../tclcl-$TCLCL_ALT_VERS \
+		../tclcl \
+		../TclCL \
+		../Tcl-$TCLCL_VERS \
+		../Tcl-$TCLCL_ALT_VERS \
+		../Tcl \
+                /usr/src/local/Tcl \
+                /usr/src/local/Tcl-1.0 \
+                /import/Tcl/include \
+                /usr/local/include \
+                /usr/contrib/include \
+                /usr/include"
+TCLCL_H_PLACES_D="$d \
+ 		$d/include"
+TCLCL_LIB_PLACES="\
+		../tclcl-$TCLCL_VERS \
+		../tclcl-$TCLCL_ALT_VERS \
+		../tclcl \
+		../TclCL \
+		../Tcl-$TCLCL_VERS \
+		../Tcl-$TCLCL_ALT_VERS \
+		../Tcl \
+                $x_libraries \
+                /usr/contrib/lib \
+                /usr/local/lib \
+                /usr/lib \
+                /usr/src/local/Tcl \
+                /usr/src/local/Tcl-1.0"
+TCLCL_LIB_PLACES_D="\
+        $d \
+        $d/lib \
+        $d/bin"
+TCLCL_PROG_PLACES="\
+		../tclcl-$TCLCL_VERS \
+		../tclcl-$TCLCL_ALT_VERS \
+		../tclcl \
+		../TclCL \
+		../Tcl-$TCLCL_VERS \
+		../Tcl-$TCLCL_ALT_VERS \
+		../Tcl \
+                $prefix/bin \
+                $x_libraries \
+                /usr/contrib/bin \
+                /usr/local/bin \
+                /usr/bin \
+                /usr/src/local/Tcl \
+                /usr/src/local/Tcl-1.0 \
+                "
+TCLCL_PROG_PLACES_D="
+	$d \
+	$d/bin"
 
 
-NS_PACKAGE_tcldebug_UNDERWAY=false
-NS_PACKAGE_tcldebug_COMPLETE=true
+
+NS_PACKAGE_tclcl_UNDERWAY=false
+NS_PACKAGE_tclcl_COMPLETE=true
 
 
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for tclcl.h" >&5
+$as_echo_n "checking for tclcl.h... " >&6; }
+if test "x$d" = "xno"; then
+	: disable header
+	V_INCLUDE_TCLCL=FAIL
 
-{ $as_echo "$as_me:$LINENO: checking for libtcldbg" >&5
-$as_echo_n "checking for libtcldbg... " >&6; }
+NS_PACKAGE_tclcl_COMPLETE=false
+
+	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
+
+else
+	places="$TCLCL_H_PLACES"
+	if test "x$d" != "x" -a "x$d" != xyes; then
+		if test ! -d $d; then
+			as_fn_error "$d is not a directory" "$LINENO" 5
+		fi
+		places="$TCLCL_H_PLACES_D"
+	fi
+
+	V_INCLUDE_TCLCL=""
+	found=""
+	for dir in $places; do
+		if test -r $dir/tclcl.h; then
+                        found="$dir"
+                        if test "$CC" != "icc" ||
+                                test "$dir" != "/usr/include"; then
+                                V_INCLUDE_TCLCL="-I$dir"
+                        fi
+			break
+		fi
+	done
+	if test "FAIL$found" = "FAIL" ; then
+
+NS_PACKAGE_tclcl_COMPLETE=false
+
+		{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
+	else
+
+				  ac_tr_hdr=HAVE_`echo tclcl.h | sed 'y%abcdefghijklmnopqrstuvwxyz./-%ABCDEFGHIJKLMNOPQRSTUVWXYZ___%'`
+		                cat >>confdefs.h <<_ACEOF
+#define $ac_tr_hdr 1
+_ACEOF
+
+
+		V_INCLUDES="$V_INCLUDE_TCLCL $V_INCLUDES"
+		V_DEFINES="-D$ac_tr_hdr $V_DEFINES"
+
+		NS_PACKAGE_tclcl_UNDERWAY=true
+
+		{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $V_INCLUDE_TCLCL" >&5
+$as_echo "$V_INCLUDE_TCLCL" >&6; }
+	fi
+fi
+
+
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for libtclcl$tclcl_VERS" >&5
+$as_echo_n "checking for libtclcl$tclcl_VERS... " >&6; }
 if test "x$d" = "xno"; then
 	: disable library
-	V_LIB_TCLDEBUG=FAIL
+	V_LIB_TCLCL=FAIL
 
-NS_PACKAGE_tcldebug_COMPLETE=false
+NS_PACKAGE_tclcl_COMPLETE=false
 
-	{ $as_echo "$as_me:$LINENO: result: no" >&5
+	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
 $as_echo "no" >&6; }
 
 else
-	places="$TCLDEBUG_PATH"
+	places="$TCLCL_LIB_PLACES"
 	if test "x$d" != "x" -a "x$d" != xyes; then
 		if test ! -d $d; then
-			{ { $as_echo "$as_me:$LINENO: error: $d is not a directory" >&5
-$as_echo "$as_me: error: $d is not a directory" >&2;}
-   { (exit 1); exit 1; }; }
+			as_fn_error "$d is not a directory" "$LINENO" 5
 		fi
-		places="$TCLDEBUG_PATH_D"
+		places="$TCLCL_LIB_PLACES_D"
 	fi
 
-	V_LIB_TCLDEBUG=""
-		full_lib_name="tcldbg"
+	V_LIB_TCLCL=""
+		full_lib_name="tclcl$tclcl_VERS"
 		simple_lib_name=`echo $full_lib_name | sed -e 's/\.//'`
 		other_simple_lib_name=`echo $full_lib_name | sed -e 's/\./_/'`
 		simpler_lib_name=`echo $simple_lib_name | sed -e 'y/0123456789/          /'`
@@ -8165,7 +6745,7 @@
 		for file in $full_lib_name $simple_lib_name $other_simple_lib_name $simpler_lib_name
 		do
 			if test -r $dir/lib$file.so -o -r $dir/lib$file.a -o -r $dir/lib$file.dylib; then
-				V_LIB_TCLDEBUG="-L$dir -l$file"
+				V_LIB_TCLCL="-L$dir -l$file"
 				double_break=true
 				break
 			fi
@@ -8174,2066 +6754,1356 @@
 			break
 		fi
 	done
-	if test "FAIL$V_LIB_TCLDEBUG" = "FAIL" ; then
+	if test "FAIL$V_LIB_TCLCL" = "FAIL" ; then
 
-NS_PACKAGE_tcldebug_COMPLETE=false
+NS_PACKAGE_tclcl_COMPLETE=false
 
-		{ $as_echo "$as_me:$LINENO: result: no" >&5
+		{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
 $as_echo "no" >&6; }
 	else
 		if test "$solaris"; then
-			V_LIB_TCLDEBUG="-R$dir $V_LIB_TCLDEBUG"
+			V_LIB_TCLCL="-R$dir $V_LIB_TCLCL"
 		fi
 
-				ac_tr_lib=HAVE_LIB`echo tcldbg | sed -e 's/[^a-zA-Z0-9_]/_/g' \
+				ac_tr_lib=HAVE_LIB`echo tclcl$tclcl_VERS | sed -e 's/[^a-zA-Z0-9_]/_/g' \
 		    -e 'y/abcdefghijklmnopqrstuvwxyz/ABCDEFGHIJKLMNOPQRSTUVWXYZ/'`
 				cat >>confdefs.h <<_ACEOF
 #define $ac_tr_lib 1
 _ACEOF
 
 
-				V_LIBS="$V_LIB_TCLDEBUG $V_LIBS"
+				V_LIBS="$V_LIB_TCLCL $V_LIBS"
 		V_DEFINES="-D$ac_tr_lib $V_DEFINES"
 
-		NS_PACKAGE_tcldebug_UNDERWAY=true
-
-		{ $as_echo "$as_me:$LINENO: result: $V_LIB_TCLDEBUG" >&5
-$as_echo "$V_LIB_TCLDEBUG" >&6; }
-	fi
-fi
-
-#if $NS_PACKAGE_tcldebug_COMPLETE; then
-	# look for debugger entry point function
-	#tmpLIBS=$LIBS
-	#LIBS="$V_LIB_TCL $V_LIB_TCLDEBUG"
-
-	# the following two may be needed for linking during tcldbg CHECK_LIB
-	#AC_CHECK_LIB(m, main)
-        #AC_CHECK_LIB(dl, dlopen)
-
-	#notfound=false
-	#AC_CHECK_LIB(tcldbg, Dbg_Init, V_DEFINES="-DHAVE_Dbg_Init $V_DEFINES",notfound=true)
-	#if $notfound; then
-	#	notfound=false
-	#	AC_CHECK_LIB(tcldbg, Tcldbg_Init, V_DEFINES="-DHAVE_Tcldbg_Init $V_DEFINES",notfound=true)
-	#fi
-	#LIBS=$tmpLIBS
-	#if $notfound; then
-	#	echo "configure: warning: Tcl debugger init point is not found.  You \
-#will not be able to use Tcl debugger." 1>&2
-	#	NS_PACKAGE_tcldebug_COMPLETE=false
-	#fi
-#fi
-
-if $NS_PACKAGE_tcldebug_COMPLETE; then
+		NS_PACKAGE_tclcl_UNDERWAY=true
 
-NS_PACKAGE_tcldebug_VALID=false
-if $NS_PACKAGE_tcldebug_UNDERWAY; then
-	if $NS_PACKAGE_tcldebug_COMPLETE; then
-		: All components of tcldebug found.
-		NS_PACKAGE_tcldebug_VALID=true
-	else
-		{ { $as_echo "$as_me:$LINENO: error: Installation of tcldebug seems incomplete or can't be found automatically.
-Please correct the problem by telling configure where tcldebug is
-using the argument --with-tcldebug=/path/to/package
-(perhaps after installing it),
-or the package is not required, disable it with --with-tcldebug=no." >&5
-$as_echo "$as_me: error: Installation of tcldebug seems incomplete or can't be found automatically.
-Please correct the problem by telling configure where tcldebug is
-using the argument --with-tcldebug=/path/to/package
-(perhaps after installing it),
-or the package is not required, disable it with --with-tcldebug=no." >&2;}
-   { (exit 1); exit 1; }; }
-	fi
-fi
-if test "xno" = xyes; then
-	if $NS_PACKAGE_tcldebug_VALID; then
-		:
-	else
-		{ { $as_echo "$as_me:$LINENO: error: tcldebug is required but could not be completely found.
-Please correct the problem by telling configure where tcldebug is
-using the argument --with-tcldebug=/path/to/package,
-or the package is not required, disable it with --with-tcldebug=no." >&5
-$as_echo "$as_me: error: tcldebug is required but could not be completely found.
-Please correct the problem by telling configure where tcldebug is
-using the argument --with-tcldebug=/path/to/package,
-or the package is not required, disable it with --with-tcldebug=no." >&2;}
-   { (exit 1); exit 1; }; }
+		{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $V_LIB_TCLCL" >&5
+$as_echo "$V_LIB_TCLCL" >&6; }
 	fi
 fi
 
-fi
-
-
-
-# Check whether --with-dmalloc was given.
-if test "${with_dmalloc+set}" = set; then
-  withval=$with_dmalloc; d="$withval"
-else
-  d="UNDEF"
-fi
-
-
-DMALLOC_VERS=3.2.1
-
-DMALLOC_PATH="$PWD/../dmalloc \
-	$PWD/../dmalloc-$DMALLOC_VERS \
-	/usr/contrib/lib \
-	/usr/local/lib \
-	/usr/lib \
-	/usr/contrib/include \
-	/usr/local/include \
-	/usr/include \
-	"
-DMALLOC_PATH_D="$d $d/lib $d/include"
-
-if test "x$d" = xUNDEF; then
-	{ $as_echo "$as_me:$LINENO: checking dmalloc" >&5
-$as_echo_n "checking dmalloc... " >&6; }
-	{ $as_echo "$as_me:$LINENO: result: not requested with --with-dmalloc" >&5
-$as_echo "not requested with --with-dmalloc" >&6; }
-else
-
-NS_PACKAGE_dmalloc_UNDERWAY=false
-NS_PACKAGE_dmalloc_COMPLETE=true
-
 
-{ $as_echo "$as_me:$LINENO: checking for libdmalloc" >&5
-$as_echo_n "checking for libdmalloc... " >&6; }
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for tcl2c++" >&5
+$as_echo_n "checking for tcl2c++... " >&6; }
 if test "x$d" = "xno"; then
-	: disable library
-	V_LIB_DMALLOC=FAIL
+	: disable header
+	V_TCL2CPP_DIR=FAIL
 
-NS_PACKAGE_dmalloc_COMPLETE=false
+NS_PACKAGE_tclcl_COMPLETE=false
 
-	{ $as_echo "$as_me:$LINENO: result: no" >&5
+	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
 $as_echo "no" >&6; }
 
 else
-	places="$DMALLOC_PATH"
+	places="$TCLCL_PROG_PLACES"
 	if test "x$d" != "x" -a "x$d" != xyes; then
 		if test ! -d $d; then
-			{ { $as_echo "$as_me:$LINENO: error: $d is not a directory" >&5
-$as_echo "$as_me: error: $d is not a directory" >&2;}
-   { (exit 1); exit 1; }; }
+			as_fn_error "$d is not a directory" "$LINENO" 5
 		fi
-		places="$DMALLOC_PATH_D"
+		places="$TCLCL_PROG_PLACES_D"
 	fi
 
-	V_LIB_DMALLOC=""
-		full_lib_name="dmalloc"
-		simple_lib_name=`echo $full_lib_name | sed -e 's/\.//'`
-		other_simple_lib_name=`echo $full_lib_name | sed -e 's/\./_/'`
-		simpler_lib_name=`echo $simple_lib_name | sed -e 'y/0123456789/          /'`
-	double_break=false
+	V_TCL2CPP_DIR=""
 	for dir in $places; do
-		for file in $full_lib_name $simple_lib_name $other_simple_lib_name $simpler_lib_name
-		do
-			if test -r $dir/lib$file.so -o -r $dir/lib$file.a -o -r $dir/lib$file.dylib; then
-				V_LIB_DMALLOC="-L$dir -l$file"
-				double_break=true
-				break
-			fi
-		done
-		if $double_break; then
+		if test -r $dir/tcl2c++; then
+			V_TCL2CPP_DIR="$dir"
 			break
 		fi
 	done
-	if test "FAIL$V_LIB_DMALLOC" = "FAIL" ; then
+	if test "FAIL$V_TCL2CPP_DIR" = "FAIL" ; then
 
-NS_PACKAGE_dmalloc_COMPLETE=false
+NS_PACKAGE_tclcl_COMPLETE=false
 
-		{ $as_echo "$as_me:$LINENO: result: no" >&5
+		{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
 $as_echo "no" >&6; }
 	else
-		if test "$solaris"; then
-			V_LIB_DMALLOC="-R$dir $V_LIB_DMALLOC"
-		fi
 
-				ac_tr_lib=HAVE_LIB`echo dmalloc | sed -e 's/[^a-zA-Z0-9_]/_/g' \
-		    -e 'y/abcdefghijklmnopqrstuvwxyz/ABCDEFGHIJKLMNOPQRSTUVWXYZ/'`
-				cat >>confdefs.h <<_ACEOF
-#define $ac_tr_lib 1
-_ACEOF
+		NS_PACKAGE_tclcl_UNDERWAY=true
 
+		{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $V_TCL2CPP_DIR" >&5
+$as_echo "$V_TCL2CPP_DIR" >&6; }
+	fi
+fi
 
-				V_LIBS="$V_LIB_DMALLOC $V_LIBS"
-		V_DEFINES="-D$ac_tr_lib $V_DEFINES"
 
-		NS_PACKAGE_dmalloc_UNDERWAY=true
+V_TCL2CPP=$V_TCL2CPP_DIR/tcl2c++
 
-		{ $as_echo "$as_me:$LINENO: result: $V_LIB_DMALLOC" >&5
-$as_echo "$V_LIB_DMALLOC" >&6; }
+
+
+NS_PACKAGE_tclcl_VALID=false
+if $NS_PACKAGE_tclcl_UNDERWAY; then
+	if $NS_PACKAGE_tclcl_COMPLETE; then
+		: All components of tclcl found.
+		NS_PACKAGE_tclcl_VALID=true
+	else
+		as_fn_error "Installation of tclcl seems incomplete or can't be found automatically.
+Please correct the problem by telling configure where tclcl is
+using the argument --with-tclcl=/path/to/package
+(perhaps after installing it),
+or the package is not required, disable it with --with-tclcl=no." "$LINENO" 5
+	fi
+fi
+if test "xyes" = xyes; then
+	if $NS_PACKAGE_tclcl_VALID; then
+		:
+	else
+		as_fn_error "tclcl is required but could not be completely found.
+Please correct the problem by telling configure where tclcl is
+using the argument --with-tclcl=/path/to/package,
+or the package is not required, disable it with --with-tclcl=no." "$LINENO" 5
 	fi
 fi
 
 
-{ $as_echo "$as_me:$LINENO: checking for dmalloc.h" >&5
-$as_echo_n "checking for dmalloc.h... " >&6; }
-if test "x$d" = "xno"; then
-	: disable header
-	V_HEADER_DMALLOC=FAIL
 
-NS_PACKAGE_dmalloc_COMPLETE=false
 
-	{ $as_echo "$as_me:$LINENO: result: no" >&5
-$as_echo "no" >&6; }
+case "$target" in
+*-dec-*)
+					V_DEFINE="$V_DEFINE -D_XOPEN_SOURCE_EXTENDED"
+	$as_echo "#define _XOPEN_SOURCE_EXTENDED 1" >>confdefs.h
+
+	;;
+sparc-sun-solaris*)
+	if test $CC != gcc ; then
+	        V_DEFINE="$V_DEFINE -D__FUNCTION__=__func__ -features=extensions"
+	fi
+        V_DEFINE="$V_DEFINE -D__svr4__ -DSOLARIS_MIN_MAX"
+	V_LIB="$V_LIB -ldl"
+	;;
+sparc-sun-sunos*)
+	V_DEFINE="$V_DEFINE -DNEED_SUNOS_PROTOS"
+	;;
+*-sgi-irix5*)
+	V_DEFINE="$V_DEFINE -DIRIX5 -D_BSD_SIGNALS"
+	if test "$target_os" = irix5.3 ; then
+		V_DEFINE="$V_DEFINE -DIRIX5_3"
+	fi
+	V_TARCMD="tar cfL"
+	V_SHELL="SHELL = /bin/sh"
+	if test $CC != gcc ; then
+		V_DEFINE="$V_DEFINE -signed -g3"
+		V_CXXOPT="$V_CXXOPT +p -float"
+		CC="cc -xansi -D__STDC__ -Dinline="
+		CXX="CC +p -float -DSGI_COMPAT"
+	fi
+	V_RANLIB="ar ts"
+	;;
+*-sgi-irix6*)
+	V_DEFINE="$V_DEFINE -DIRIX6 -D_BSD_SIGNALS"
+	V_TARCMD="tar cfL"
+	V_SHELL="SHELL = /bin/sh"
+	if test $CC != gcc ; then
+		V_DEFINE="$V_DEFINE -signed -g3"
+		V_CXXOPT="$V_CXXOPT +p -float"
+		CC="cc -xansi -D__STDC__ -Dinline="
+		CXX="CC +p -float -DSGI_COMPAT"
+	fi
+	V_RANLIB="ar ts"
+	;;
+*-*-bsdi1*)
+	V_SHM=""
+	V_TARCMD="tar cfL"
+	;;
+*-*-bsdi2.0*)
+	V_SHM=""
+	V_TARCMD="tar cfL"
+	;;
+*-*-bsdi2.1*)
+	# bsdi2.1 added sys-v shared memory support but their implementation
+	# is broken so we have to turn it off.  If they ever fix libipc,
+	# the following line should be deleted.
+	V_SHM=""
+	V_TARCMD="tar cfL"
+	V_CCOPT="-O2 -m486"
+	V_LIB="$V_LIB -lipc -ldl"
+	;;
+*-*-bsdi3*)
+	V_SHM=""
+	V_TARCMD="tar cfL"
+	V_LIB="$V_LIB -lipc -ldl"
+	V_OBJ="$V_OBJ misc/serial.o"
+	;;
+*-*-freebsd*)
+	V_OBJ="$V_OBJ misc/serial.o"
+	;;
+*-*-netbsd*)
+	V_TARCMD="tar -h -c -f"
+	V_LIB="$V_LIB -L/usr/local/lib"
+	;;
+*-*-hpux*)
+	$as_echo "#define random lrand48" >>confdefs.h
+
+	$as_echo "#define srandom srand" >>confdefs.h
 
-else
-	places="$DMALLOC_PATH"
-	if test "x$d" != "x" -a "x$d" != xyes; then
-		if test ! -d $d; then
-			{ { $as_echo "$as_me:$LINENO: error: $d is not a directory" >&5
-$as_echo "$as_me: error: $d is not a directory" >&2;}
-   { (exit 1); exit 1; }; }
-		fi
-		places="$DMALLOC_PATH_D"
+	V_CCOPT="-O"
+	;;
+*-*-aix3*)
+	V_DEFINE="$V_DEFINE -DSIGARGS=int"
+	if test "$V_LIB_AIXSHM" != "" ; then
+		V_LIB="$V_LIB $V_LIB_AIXSHM"
+	else
+		V_SHM=""
 	fi
-
-	V_HEADER_DMALLOC=""
-	found=""
-	for dir in $places; do
-		if test -r $dir/dmalloc.h; then
-                        found="$dir"
-                        if test "$CC" != "icc" ||
-                                test "$dir" != "/usr/include"; then
-                                V_HEADER_DMALLOC="-I$dir"
-                        fi
-			break
-		fi
-	done
-	if test "FAIL$found" = "FAIL" ; then
-
-NS_PACKAGE_dmalloc_COMPLETE=false
-
-		{ $as_echo "$as_me:$LINENO: result: no" >&5
-$as_echo "no" >&6; }
+	CXX="xlC -+"
+	;;
+*-*-aix4*)
+	V_DEFINE="$V_DEFINE -DSIGARGS=int -D_AIX41"
+	if test "$V_LIB_AIXSHM" != "" ; then
+		V_LIB="$V_LIB $V_LIB_AIXSHM"
 	else
-
-				  ac_tr_hdr=HAVE_`echo dmalloc.h | sed 'y%abcdefghijklmnopqrstuvwxyz./-%ABCDEFGHIJKLMNOPQRSTUVWXYZ___%'`
-		                cat >>confdefs.h <<_ACEOF
-#define $ac_tr_hdr 1
-_ACEOF
-
-
-		V_INCLUDES="$V_HEADER_DMALLOC $V_INCLUDES"
-		V_DEFINES="-D$ac_tr_hdr $V_DEFINES"
-
-		NS_PACKAGE_dmalloc_UNDERWAY=true
-
-		{ $as_echo "$as_me:$LINENO: result: $V_HEADER_DMALLOC" >&5
-$as_echo "$V_HEADER_DMALLOC" >&6; }
+		V_SHM=""
 	fi
-fi
+	CXX="g++"
+	;;
+*-*-linux*)
+	V_BROKEN_OBJ=
+	;;
+powerpc-apple-darwin*)
+	V_CCOPT="-fno-common -fPIC -pipe"
+	;;
+esac
 
 
-{ $as_echo "$as_me:$LINENO: checking for return.h" >&5
-$as_echo_n "checking for return.h... " >&6; }
-if test "x$d" = "xno"; then
-	: disable header
-	V_HEADER_RETURN=FAIL
+xlibdirs="\
+	/usr/openwin/lib \
+	/usr/X11R6/lib \
+	/usr/lib/X11R6 \
+	/usr/X11R5/lib \
+	/usr/lib/X11R5 \
+	/usr/X11R4/lib \
+	/usr/lib/X11R4 \
+	/usr/local/lib \
+	/usr/X386/lib \
+	/usr/X11/lib \
+	/usr/unsupported/lib \
+	/Developer/SDKs/MacOSX10.4u.sdk/usr/X11R6/lib \
+	/import/X11R4/usr/lib"
 
-NS_PACKAGE_dmalloc_COMPLETE=false
+xincdirs="\
+	/usr/openwin/include \
+	/usr/X11R6/include \
+	/usr/include/X11R6 \
+	/usr/X11R5/include \
+	/usr/include/X11R5 \
+	/usr/X11R4/include \
+	/usr/include/X11R4 \
+	/usr/local/include \
+	/usr/X386/include \
+	/usr/X11/include \
+	/usr/lpp/X11/include \
+	/usr/unsupported/include \
+	/Developer/SDKs/MacOSX10.4u.sdk/usr/X11R6/include \
+	/import/X11R4/include"
 
-	{ $as_echo "$as_me:$LINENO: result: no" >&5
-$as_echo "no" >&6; }
 
+echo "checking for X11 header files"
+if test "$x_includes" = NONE ; then
+	cat confdefs.h - <<_ACEOF >conftest.$ac_ext
+/* end confdefs.h.  */
+#include <X11/Intrinsic.h>
+_ACEOF
+if ac_fn_c_try_cpp "$LINENO"; then :
+  x_includes=""
 else
-	places="$DMALLOC_PATH"
-	if test "x$d" != "x" -a "x$d" != xyes; then
-		if test ! -d $d; then
-			{ { $as_echo "$as_me:$LINENO: error: $d is not a directory" >&5
-$as_echo "$as_me: error: $d is not a directory" >&2;}
-   { (exit 1); exit 1; }; }
+  x_includes=NONE
+fi
+rm -f conftest.err conftest.$ac_ext
+	if test "$x_includes" = NONE ; then
+	        for i in $xincdirs ; do
+			if test -r $i/X11/Intrinsic.h; then
+				x_includes=$i
+				break
+			fi
+	        done
+		if test "$x_includes" = NONE ; then
+			echo "can't find X includes"
+	       		exit 1
 		fi
-		places="$DMALLOC_PATH_D"
 	fi
+fi
+if test -n "$x_includes" ; then
+	V_INCLUDE_X11=-I$x_includes
 
-	V_HEADER_RETURN=""
-	found=""
-	for dir in $places; do
-		if test -r $dir/return.h; then
-                        found="$dir"
-                        if test "$CC" != "icc" ||
-                                test "$dir" != "/usr/include"; then
-                                V_HEADER_RETURN="-I$dir"
-                        fi
-			break
-		fi
-	done
-	if test "FAIL$found" = "FAIL" ; then
-
-NS_PACKAGE_dmalloc_COMPLETE=false
+fi
 
-		{ $as_echo "$as_me:$LINENO: result: no" >&5
-$as_echo "no" >&6; }
-	else
+echo "checking for X11 library archive"
+if test "$x_libraries" = NONE ; then
+	{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for XOpenDisplay in -lX11" >&5
+$as_echo_n "checking for XOpenDisplay in -lX11... " >&6; }
+if test "${ac_cv_lib_X11_XOpenDisplay+set}" = set; then :
+  $as_echo_n "(cached) " >&6
+else
+  ac_check_lib_save_LIBS=$LIBS
+LIBS="-lX11  $LIBS"
+cat confdefs.h - <<_ACEOF >conftest.$ac_ext
+/* end confdefs.h.  */
 
-				  ac_tr_hdr=HAVE_`echo return.h | sed 'y%abcdefghijklmnopqrstuvwxyz./-%ABCDEFGHIJKLMNOPQRSTUVWXYZ___%'`
-		                cat >>confdefs.h <<_ACEOF
-#define $ac_tr_hdr 1
+/* Override any GCC internal prototype to avoid an error.
+   Use char because int might match the return type of a GCC
+   builtin and then its argument prototype would still apply.  */
+#ifdef __cplusplus
+extern "C"
+#endif
+char XOpenDisplay ();
+int
+main ()
+{
+return XOpenDisplay ();
+  ;
+  return 0;
+}
 _ACEOF
-
-
-		V_INCLUDES="$V_HEADER_RETURN $V_INCLUDES"
-		V_DEFINES="-D$ac_tr_hdr $V_DEFINES"
-
-		NS_PACKAGE_dmalloc_UNDERWAY=true
-
-		{ $as_echo "$as_me:$LINENO: result: $V_HEADER_RETURN" >&5
-$as_echo "$V_HEADER_RETURN" >&6; }
-	fi
+if ac_fn_c_try_link "$LINENO"; then :
+  ac_cv_lib_X11_XOpenDisplay=yes
+else
+  ac_cv_lib_X11_XOpenDisplay=no
 fi
-
-
-NS_PACKAGE_dmalloc_VALID=false
-if $NS_PACKAGE_dmalloc_UNDERWAY; then
-	if $NS_PACKAGE_dmalloc_COMPLETE; then
-		: All components of dmalloc found.
-		NS_PACKAGE_dmalloc_VALID=true
-	else
-		{ { $as_echo "$as_me:$LINENO: error: Installation of dmalloc seems incomplete or can't be found automatically.
-Please correct the problem by telling configure where dmalloc is
-using the argument --with-dmalloc=/path/to/package
-(perhaps after installing it),
-or the package is not required, disable it with --with-dmalloc=no." >&5
-$as_echo "$as_me: error: Installation of dmalloc seems incomplete or can't be found automatically.
-Please correct the problem by telling configure where dmalloc is
-using the argument --with-dmalloc=/path/to/package
-(perhaps after installing it),
-or the package is not required, disable it with --with-dmalloc=no." >&2;}
-   { (exit 1); exit 1; }; }
-	fi
+rm -f core conftest.err conftest.$ac_objext \
+    conftest$ac_exeext conftest.$ac_ext
+LIBS=$ac_check_lib_save_LIBS
 fi
-if test "xno" = xyes; then
-	if $NS_PACKAGE_dmalloc_VALID; then
-		:
-	else
-		{ { $as_echo "$as_me:$LINENO: error: dmalloc is required but could not be completely found.
-Please correct the problem by telling configure where dmalloc is
-using the argument --with-dmalloc=/path/to/package,
-or the package is not required, disable it with --with-dmalloc=no." >&5
-$as_echo "$as_me: error: dmalloc is required but could not be completely found.
-Please correct the problem by telling configure where dmalloc is
-using the argument --with-dmalloc=/path/to/package,
-or the package is not required, disable it with --with-dmalloc=no." >&2;}
-   { (exit 1); exit 1; }; }
-	fi
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_lib_X11_XOpenDisplay" >&5
+$as_echo "$ac_cv_lib_X11_XOpenDisplay" >&6; }
+if test "x$ac_cv_lib_X11_XOpenDisplay" = x""yes; then :
+  x_libraries=""
+else
+  x_libraries=NONE
 fi
 
+	if test "$x_libraries" = NONE ; then
+		for i in $xlibdirs ; do
+			if test -r $i/libX11.a -o -r $i/libX11.so -o -r $i/libX11.dll.a; then
+				x_libraries=$i
+				break
+			fi
+       		done
+		if test "$x_libraries" = NONE ; then
+			echo "can't find X library"
+			exit 1
+		fi
+	fi
 fi
 
+V_LIB_X11=-lX11
 
+if test -n "$V_SHM" ; then
+	if test -z "$x_libraries" ; then
+		{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for XShmAttach in -lXext" >&5
+$as_echo_n "checking for XShmAttach in -lXext... " >&6; }
+if test "${ac_cv_lib_Xext_XShmAttach+set}" = set; then :
+  $as_echo_n "(cached) " >&6
+else
+  ac_check_lib_save_LIBS=$LIBS
+LIBS="-lXext -lX11 $LIBS"
+cat confdefs.h - <<_ACEOF >conftest.$ac_ext
+/* end confdefs.h.  */
 
-default_classinstvar=yes
-
-
-if test x$default_classinstvar = x
-then
-	default_classinstvar=no
+/* Override any GCC internal prototype to avoid an error.
+   Use char because int might match the return type of a GCC
+   builtin and then its argument prototype would still apply.  */
+#ifdef __cplusplus
+extern "C"
+#endif
+char XShmAttach ();
+int
+main ()
+{
+return XShmAttach ();
+  ;
+  return 0;
+}
+_ACEOF
+if ac_fn_c_try_link "$LINENO"; then :
+  ac_cv_lib_Xext_XShmAttach=yes
+else
+  ac_cv_lib_Xext_XShmAttach=no
 fi
-
-# Check whether --enable-tclcl-classinstvar was given.
-if test "${enable_tclcl_classinstvar+set}" = set; then
-  enableval=$enable_tclcl_classinstvar; enable_classinstvar=$enableval
+rm -f core conftest.err conftest.$ac_objext \
+    conftest$ac_exeext conftest.$ac_ext
+LIBS=$ac_check_lib_save_LIBS
+fi
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_lib_Xext_XShmAttach" >&5
+$as_echo "$ac_cv_lib_Xext_XShmAttach" >&6; }
+if test "x$ac_cv_lib_Xext_XShmAttach" = x""yes; then :
+  V_Xext="-lXext"
 else
-  enable_classinstvar=$default_classinstvar
+  V_Xext=NONE
 fi
 
-if test "$enable_classinstvar" = "yes";
-then
-	V_DEFINE="-DTCLCL_CLASSINSTVAR $V_DEFINE"
+	else
+		echo "checking for libXext.a"
+		if test -f $x_libraries/libXext.a -o -f $x_libraries/libXext.so; then
+			V_Xext="-lXext"
+		else
+			echo "warning: compiling without -lXext"
+		fi
+	fi
+	if test "$V_Xext" = NONE ; then
+		echo "warning: compiling without -lXext"
+	else
+		V_LIB_X11="$V_Xext $V_LIB_X11"
+	fi
 fi
 
+if test -n "$x_libraries" ; then
+	V_LIB_X11="-L$x_libraries $V_LIB_X11"
+	if test $solaris ; then
+		V_LIB_X11="-R$x_libraries $V_LIB_X11"
+	fi
+fi
 
 
 
-PERL_OPTIONAL=true
-
-
 
-# Check whether --with-perl was given.
-if test "${with_perl+set}" = set; then
-  withval=$with_perl; d=$withval
+# Check whether --with-tcldebug was given.
+if test "${with_tcldebug+set}" = set; then :
+  withval=$with_tcldebug; d=$withval
 else
   d=""
 fi
 
 
-# Next line is the minimum version of perl required.
-# 5.000 and 5.001 are generally scorned because of age and bugs.
-PERL_VERSION=${PERL_VERSION:-5.002}
-
-PERL_PLACES=`echo $PATH | sed 's/:/ /g'`
+#xxx: Don't know anything about 1.8
+# 2.0 = tcl 8.3
+# 1.9 = tcl 7.5, 7.6, 8.0
+TCLDEBUG_VERS="2.0 1.9 1.8 1.7"
+pwd_vers=""
+local_vers=""
+for vers in $TCLDEBUG_VERS; do
+	 pwd_vers="$pwd_vers $PWD/../tcl-debug-$vers"
+	 local_vers="$local_vers /usr/src/local/otcl-debug-$vers"
+done
+TCLDEBUG_PATH="\
+		$PWD/../tcl-debug \
+		$pwd_vers
+		/usr/contrib/lib \
+		/usr/local/lib \
+		/usr/lib \
+		/usr/src/local/tcl-debug \
+		$local_vers \
+		"
+TCLDEBUG_PATH_D="$d \
+		$d/lib \
+		$d/../lib \
+		"
 
-PERL_OPTIONAL=${PERL_OPTIONAL:-false}
 
+NS_PACKAGE_tcldebug_UNDERWAY=false
+NS_PACKAGE_tcldebug_COMPLETE=true
 
 
 
-{ $as_echo "$as_me:$LINENO: checking for perl" >&5
-$as_echo_n "checking for perl... " >&6; }
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for libtcldbg" >&5
+$as_echo_n "checking for libtcldbg... " >&6; }
 if test "x$d" = "xno"; then
-	: disable header
-	PERL=FAIL
+	: disable library
+	V_LIB_TCLDEBUG=FAIL
 
-NS_PACKAGE_no_COMPLETE=false
+NS_PACKAGE_tcldebug_COMPLETE=false
 
-	{ $as_echo "$as_me:$LINENO: result: no" >&5
+	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
 $as_echo "no" >&6; }
 
 else
-	places="$PERL_PLACES"
+	places="$TCLDEBUG_PATH"
 	if test "x$d" != "x" -a "x$d" != xyes; then
 		if test ! -d $d; then
-			{ { $as_echo "$as_me:$LINENO: error: $d is not a directory" >&5
-$as_echo "$as_me: error: $d is not a directory" >&2;}
-   { (exit 1); exit 1; }; }
+			as_fn_error "$d is not a directory" "$LINENO" 5
 		fi
-		places="$d"
+		places="$TCLDEBUG_PATH_D"
 	fi
 
-	PERL=""
+	V_LIB_TCLDEBUG=""
+		full_lib_name="tcldbg"
+		simple_lib_name=`echo $full_lib_name | sed -e 's/\.//'`
+		other_simple_lib_name=`echo $full_lib_name | sed -e 's/\./_/'`
+		simpler_lib_name=`echo $simple_lib_name | sed -e 'y/0123456789/          /'`
+	double_break=false
 	for dir in $places; do
-		if test -r $dir/perl; then
-			PERL="$dir"
+		for file in $full_lib_name $simple_lib_name $other_simple_lib_name $simpler_lib_name
+		do
+			if test -r $dir/lib$file.so -o -r $dir/lib$file.a -o -r $dir/lib$file.dylib; then
+				V_LIB_TCLDEBUG="-L$dir -l$file"
+				double_break=true
+				break
+			fi
+		done
+		if $double_break; then
 			break
 		fi
 	done
-	if test "FAIL$PERL" = "FAIL" ; then
+	if test "FAIL$V_LIB_TCLDEBUG" = "FAIL" ; then
 
-NS_PACKAGE_no_COMPLETE=false
+NS_PACKAGE_tcldebug_COMPLETE=false
 
-		{ $as_echo "$as_me:$LINENO: result: no" >&5
+		{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
 $as_echo "no" >&6; }
 	else
+		if test "$solaris"; then
+			V_LIB_TCLDEBUG="-R$dir $V_LIB_TCLDEBUG"
+		fi
 
-		NS_PACKAGE_no_UNDERWAY=true
+				ac_tr_lib=HAVE_LIB`echo tcldbg | sed -e 's/[^a-zA-Z0-9_]/_/g' \
+		    -e 'y/abcdefghijklmnopqrstuvwxyz/ABCDEFGHIJKLMNOPQRSTUVWXYZ/'`
+				cat >>confdefs.h <<_ACEOF
+#define $ac_tr_lib 1
+_ACEOF
 
-		{ $as_echo "$as_me:$LINENO: result: $PERL" >&5
-$as_echo "$PERL" >&6; }
-	fi
-fi
 
-if test "x$PERL" != x
-then
-    PERL=$PERL/perl
+				V_LIBS="$V_LIB_TCLDEBUG $V_LIBS"
+		V_DEFINES="-D$ac_tr_lib $V_DEFINES"
 
-echo $PERL -e "require $PERL_VERSION" 1>&5
-if $PERL -e "require $PERL_VERSION" 2>&5
-then
-    : good version
-else
-    : non-good version => zero pathname
-    { $as_echo "$as_me:$LINENO: result:     not version $PERL_VERSION" >&5
-$as_echo "    not version $PERL_VERSION" >&6; }
-    PERL=''
-fi
+		NS_PACKAGE_tcldebug_UNDERWAY=true
 
+		{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $V_LIB_TCLDEBUG" >&5
+$as_echo "$V_LIB_TCLDEBUG" >&6; }
+	fi
 fi
 
-if test "x$PERL" = "x"
-then
+#if $NS_PACKAGE_tcldebug_COMPLETE; then
+	# look for debugger entry point function
+	#tmpLIBS=$LIBS
+	#LIBS="$V_LIB_TCL $V_LIB_TCLDEBUG"
 
-{ $as_echo "$as_me:$LINENO: checking for perl5" >&5
-$as_echo_n "checking for perl5... " >&6; }
-if test "x$d" = "xno"; then
-	: disable header
-	PERL=FAIL
+	# the following two may be needed for linking during tcldbg CHECK_LIB
+	#AC_CHECK_LIB(m, main)
+        #AC_CHECK_LIB(dl, dlopen)
 
-NS_PACKAGE_no_COMPLETE=false
+	#notfound=false
+	#AC_CHECK_LIB(tcldbg, Dbg_Init, V_DEFINES="-DHAVE_Dbg_Init $V_DEFINES",notfound=true)
+	#if $notfound; then
+	#	notfound=false
+	#	AC_CHECK_LIB(tcldbg, Tcldbg_Init, V_DEFINES="-DHAVE_Tcldbg_Init $V_DEFINES",notfound=true)
+	#fi
+	#LIBS=$tmpLIBS
+	#if $notfound; then
+	#	echo "configure: warning: Tcl debugger init point is not found.  You \
+#will not be able to use Tcl debugger." 1>&2
+	#	NS_PACKAGE_tcldebug_COMPLETE=false
+	#fi
+#fi
 
-	{ $as_echo "$as_me:$LINENO: result: no" >&5
-$as_echo "no" >&6; }
+if $NS_PACKAGE_tcldebug_COMPLETE; then
 
-else
-	places="$PERL_PLACES"
-	if test "x$d" != "x" -a "x$d" != xyes; then
-		if test ! -d $d; then
-			{ { $as_echo "$as_me:$LINENO: error: $d is not a directory" >&5
-$as_echo "$as_me: error: $d is not a directory" >&2;}
-   { (exit 1); exit 1; }; }
-		fi
-		places="$d"
+NS_PACKAGE_tcldebug_VALID=false
+if $NS_PACKAGE_tcldebug_UNDERWAY; then
+	if $NS_PACKAGE_tcldebug_COMPLETE; then
+		: All components of tcldebug found.
+		NS_PACKAGE_tcldebug_VALID=true
+	else
+		as_fn_error "Installation of tcldebug seems incomplete or can't be found automatically.
+Please correct the problem by telling configure where tcldebug is
+using the argument --with-tcldebug=/path/to/package
+(perhaps after installing it),
+or the package is not required, disable it with --with-tcldebug=no." "$LINENO" 5
 	fi
-
-	PERL=""
-	for dir in $places; do
-		if test -r $dir/perl5; then
-			PERL="$dir"
-			break
-		fi
-	done
-	if test "FAIL$PERL" = "FAIL" ; then
-
-NS_PACKAGE_no_COMPLETE=false
-
-		{ $as_echo "$as_me:$LINENO: result: no" >&5
-$as_echo "no" >&6; }
+fi
+if test "xno" = xyes; then
+	if $NS_PACKAGE_tcldebug_VALID; then
+		:
 	else
-
-		NS_PACKAGE_no_UNDERWAY=true
-
-		{ $as_echo "$as_me:$LINENO: result: $PERL" >&5
-$as_echo "$PERL" >&6; }
+		as_fn_error "tcldebug is required but could not be completely found.
+Please correct the problem by telling configure where tcldebug is
+using the argument --with-tcldebug=/path/to/package,
+or the package is not required, disable it with --with-tcldebug=no." "$LINENO" 5
 	fi
 fi
 
-    if test "x$PERL" != "x"
-    then
-	PERL=$PERL/perl5
+fi
 
-echo $PERL -e "require $PERL_VERSION" 1>&5
-if $PERL -e "require $PERL_VERSION" 2>&5
-then
-    : good version
+
+
+# Check whether --with-dmalloc was given.
+if test "${with_dmalloc+set}" = set; then :
+  withval=$with_dmalloc; d="$withval"
 else
-    : non-good version => zero pathname
-    { $as_echo "$as_me:$LINENO: result:     not version $PERL_VERSION" >&5
-$as_echo "    not version $PERL_VERSION" >&6; }
-    PERL=''
+  d="UNDEF"
 fi
 
-    fi
-fi
 
-if test "x$PERL" = x
-then
-    if $PERL_OPTIONAL
-    then
-        { $as_echo "$as_me:$LINENO: result:     perl version $PERL_VERSION not found" >&5
-$as_echo "    perl version $PERL_VERSION not found" >&6; }
-    else
-        { { $as_echo "$as_me:$LINENO: error: Cannot find Perl 5." >&5
-$as_echo "$as_me: error: Cannot find Perl 5." >&2;}
-   { (exit 1); exit 1; }; }
-    fi
-fi
+DMALLOC_VERS=3.2.1
 
+DMALLOC_PATH="$PWD/../dmalloc \
+	$PWD/../dmalloc-$DMALLOC_VERS \
+	/usr/contrib/lib \
+	/usr/local/lib \
+	/usr/lib \
+	/usr/contrib/include \
+	/usr/local/include \
+	/usr/include \
+	"
+DMALLOC_PATH_D="$d $d/lib $d/include"
 
+if test "x$d" = xUNDEF; then
+	{ $as_echo "$as_me:${as_lineno-$LINENO}: checking dmalloc" >&5
+$as_echo_n "checking dmalloc... " >&6; }
+	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: not requested with --with-dmalloc" >&5
+$as_echo "not requested with --with-dmalloc" >&6; }
+else
 
+NS_PACKAGE_dmalloc_UNDERWAY=false
+NS_PACKAGE_dmalloc_COMPLETE=true
 
-if test "x$PERL" = x
-then
-	{ $as_echo "$as_me:$LINENO: WARNING: Perl5 not found; test scripts will not run succesfully." >&5
-$as_echo "$as_me: WARNING: Perl5 not found; test scripts will not run succesfully." >&2;}
-fi
 
-{ $as_echo "$as_me:$LINENO: checking for ANSI C header files" >&5
-$as_echo_n "checking for ANSI C header files... " >&6; }
-if test "${ac_cv_header_stdc+set}" = set; then
-  $as_echo_n "(cached) " >&6
-else
-  cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
-/* end confdefs.h.  */
-#include <stdlib.h>
-#include <stdarg.h>
-#include <string.h>
-#include <float.h>
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for libdmalloc" >&5
+$as_echo_n "checking for libdmalloc... " >&6; }
+if test "x$d" = "xno"; then
+	: disable library
+	V_LIB_DMALLOC=FAIL
 
-int
-main ()
-{
+NS_PACKAGE_dmalloc_COMPLETE=false
+
+	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
 
-  ;
-  return 0;
-}
-_ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
-  ac_cv_header_stdc=yes
 else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
+	places="$DMALLOC_PATH"
+	if test "x$d" != "x" -a "x$d" != xyes; then
+		if test ! -d $d; then
+			as_fn_error "$d is not a directory" "$LINENO" 5
+		fi
+		places="$DMALLOC_PATH_D"
+	fi
 
-	ac_cv_header_stdc=no
-fi
+	V_LIB_DMALLOC=""
+		full_lib_name="dmalloc"
+		simple_lib_name=`echo $full_lib_name | sed -e 's/\.//'`
+		other_simple_lib_name=`echo $full_lib_name | sed -e 's/\./_/'`
+		simpler_lib_name=`echo $simple_lib_name | sed -e 'y/0123456789/          /'`
+	double_break=false
+	for dir in $places; do
+		for file in $full_lib_name $simple_lib_name $other_simple_lib_name $simpler_lib_name
+		do
+			if test -r $dir/lib$file.so -o -r $dir/lib$file.a -o -r $dir/lib$file.dylib; then
+				V_LIB_DMALLOC="-L$dir -l$file"
+				double_break=true
+				break
+			fi
+		done
+		if $double_break; then
+			break
+		fi
+	done
+	if test "FAIL$V_LIB_DMALLOC" = "FAIL" ; then
 
-rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
+NS_PACKAGE_dmalloc_COMPLETE=false
 
-if test $ac_cv_header_stdc = yes; then
-  # SunOS 4.x string.h does not declare mem*, contrary to ANSI.
-  cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
-/* end confdefs.h.  */
-#include <string.h>
+		{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
+	else
+		if test "$solaris"; then
+			V_LIB_DMALLOC="-R$dir $V_LIB_DMALLOC"
+		fi
 
+				ac_tr_lib=HAVE_LIB`echo dmalloc | sed -e 's/[^a-zA-Z0-9_]/_/g' \
+		    -e 'y/abcdefghijklmnopqrstuvwxyz/ABCDEFGHIJKLMNOPQRSTUVWXYZ/'`
+				cat >>confdefs.h <<_ACEOF
+#define $ac_tr_lib 1
 _ACEOF
-if (eval "$ac_cpp conftest.$ac_ext") 2>&5 |
-  $EGREP "memchr" >/dev/null 2>&1; then
-  :
-else
-  ac_cv_header_stdc=no
-fi
-rm -f conftest*
 
-fi
 
-if test $ac_cv_header_stdc = yes; then
-  # ISC 2.0.2 stdlib.h does not declare free, contrary to ANSI.
-  cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
-/* end confdefs.h.  */
-#include <stdlib.h>
+				V_LIBS="$V_LIB_DMALLOC $V_LIBS"
+		V_DEFINES="-D$ac_tr_lib $V_DEFINES"
 
-_ACEOF
-if (eval "$ac_cpp conftest.$ac_ext") 2>&5 |
-  $EGREP "free" >/dev/null 2>&1; then
-  :
-else
-  ac_cv_header_stdc=no
-fi
-rm -f conftest*
+		NS_PACKAGE_dmalloc_UNDERWAY=true
 
+		{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $V_LIB_DMALLOC" >&5
+$as_echo "$V_LIB_DMALLOC" >&6; }
+	fi
 fi
 
-if test $ac_cv_header_stdc = yes; then
-  # /bin/cc in Irix-4.0.5 gets non-ANSI ctype macros unless using -ansi.
-  if test "$cross_compiling" = yes; then
-  :
-else
-  cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
-/* end confdefs.h.  */
-#include <ctype.h>
-#include <stdlib.h>
-#if ((' ' & 0x0FF) == 0x020)
-# define ISLOWER(c) ('a' <= (c) && (c) <= 'z')
-# define TOUPPER(c) (ISLOWER(c) ? 'A' + ((c) - 'a') : (c))
-#else
-# define ISLOWER(c) \
-		   (('a' <= (c) && (c) <= 'i') \
-		     || ('j' <= (c) && (c) <= 'r') \
-		     || ('s' <= (c) && (c) <= 'z'))
-# define TOUPPER(c) (ISLOWER(c) ? ((c) | 0x40) : (c))
-#endif
 
-#define XOR(e, f) (((e) && !(f)) || (!(e) && (f)))
-int
-main ()
-{
-  int i;
-  for (i = 0; i < 256; i++)
-    if (XOR (islower (i), ISLOWER (i))
-	|| toupper (i) != TOUPPER (i))
-      return 2;
-  return 0;
-}
-_ACEOF
-rm -f conftest$ac_exeext
-if { (ac_try="$ac_link"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_link") 2>&5
-  ac_status=$?
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && { ac_try='./conftest$ac_exeext'
-  { (case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_try") 2>&5
-  ac_status=$?
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); }; }; then
-  :
-else
-  $as_echo "$as_me: program exited with status $ac_status" >&5
-$as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for dmalloc.h" >&5
+$as_echo_n "checking for dmalloc.h... " >&6; }
+if test "x$d" = "xno"; then
+	: disable header
+	V_HEADER_DMALLOC=FAIL
 
-( exit $ac_status )
-ac_cv_header_stdc=no
-fi
-rm -rf conftest.dSYM
-rm -f core *.core core.conftest.* gmon.out bb.out conftest$ac_exeext conftest.$ac_objext conftest.$ac_ext
-fi
+NS_PACKAGE_dmalloc_COMPLETE=false
 
+	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
 
-fi
-fi
-{ $as_echo "$as_me:$LINENO: result: $ac_cv_header_stdc" >&5
-$as_echo "$ac_cv_header_stdc" >&6; }
-if test $ac_cv_header_stdc = yes; then
+else
+	places="$DMALLOC_PATH"
+	if test "x$d" != "x" -a "x$d" != xyes; then
+		if test ! -d $d; then
+			as_fn_error "$d is not a directory" "$LINENO" 5
+		fi
+		places="$DMALLOC_PATH_D"
+	fi
 
-cat >>confdefs.h <<\_ACEOF
-#define STDC_HEADERS 1
-_ACEOF
+	V_HEADER_DMALLOC=""
+	found=""
+	for dir in $places; do
+		if test -r $dir/dmalloc.h; then
+                        found="$dir"
+                        if test "$CC" != "icc" ||
+                                test "$dir" != "/usr/include"; then
+                                V_HEADER_DMALLOC="-I$dir"
+                        fi
+			break
+		fi
+	done
+	if test "FAIL$found" = "FAIL" ; then
 
-fi
+NS_PACKAGE_dmalloc_COMPLETE=false
 
+		{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
+	else
 
+				  ac_tr_hdr=HAVE_`echo dmalloc.h | sed 'y%abcdefghijklmnopqrstuvwxyz./-%ABCDEFGHIJKLMNOPQRSTUVWXYZ___%'`
+		                cat >>confdefs.h <<_ACEOF
+#define $ac_tr_hdr 1
+_ACEOF
 
 
+		V_INCLUDES="$V_HEADER_DMALLOC $V_INCLUDES"
+		V_DEFINES="-D$ac_tr_hdr $V_DEFINES"
 
+		NS_PACKAGE_dmalloc_UNDERWAY=true
 
+		{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $V_HEADER_DMALLOC" >&5
+$as_echo "$V_HEADER_DMALLOC" >&6; }
+	fi
+fi
 
 
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for return.h" >&5
+$as_echo_n "checking for return.h... " >&6; }
+if test "x$d" = "xno"; then
+	: disable header
+	V_HEADER_RETURN=FAIL
 
+NS_PACKAGE_dmalloc_COMPLETE=false
+
+	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
 
-for ac_header in arpa/inet.h fenv.h netinet/in.h string.h strings.h time.h unistd.h net/ethernet.h
-do
-as_ac_Header=`$as_echo "ac_cv_header_$ac_header" | $as_tr_sh`
-if { as_var=$as_ac_Header; eval "test \"\${$as_var+set}\" = set"; }; then
-  { $as_echo "$as_me:$LINENO: checking for $ac_header" >&5
-$as_echo_n "checking for $ac_header... " >&6; }
-if { as_var=$as_ac_Header; eval "test \"\${$as_var+set}\" = set"; }; then
-  $as_echo_n "(cached) " >&6
-fi
-ac_res=`eval 'as_val=${'$as_ac_Header'}
-		 $as_echo "$as_val"'`
-	       { $as_echo "$as_me:$LINENO: result: $ac_res" >&5
-$as_echo "$ac_res" >&6; }
-else
-  # Is the header compilable?
-{ $as_echo "$as_me:$LINENO: checking $ac_header usability" >&5
-$as_echo_n "checking $ac_header usability... " >&6; }
-cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
-/* end confdefs.h.  */
-$ac_includes_default
-#include <$ac_header>
-_ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
-  ac_header_compiler=yes
 else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
+	places="$DMALLOC_PATH"
+	if test "x$d" != "x" -a "x$d" != xyes; then
+		if test ! -d $d; then
+			as_fn_error "$d is not a directory" "$LINENO" 5
+		fi
+		places="$DMALLOC_PATH_D"
+	fi
 
-	ac_header_compiler=no
-fi
+	V_HEADER_RETURN=""
+	found=""
+	for dir in $places; do
+		if test -r $dir/return.h; then
+                        found="$dir"
+                        if test "$CC" != "icc" ||
+                                test "$dir" != "/usr/include"; then
+                                V_HEADER_RETURN="-I$dir"
+                        fi
+			break
+		fi
+	done
+	if test "FAIL$found" = "FAIL" ; then
 
-rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
-{ $as_echo "$as_me:$LINENO: result: $ac_header_compiler" >&5
-$as_echo "$ac_header_compiler" >&6; }
+NS_PACKAGE_dmalloc_COMPLETE=false
 
-# Is the header present?
-{ $as_echo "$as_me:$LINENO: checking $ac_header presence" >&5
-$as_echo_n "checking $ac_header presence... " >&6; }
-cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
-/* end confdefs.h.  */
-#include <$ac_header>
+		{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
+	else
+
+				  ac_tr_hdr=HAVE_`echo return.h | sed 'y%abcdefghijklmnopqrstuvwxyz./-%ABCDEFGHIJKLMNOPQRSTUVWXYZ___%'`
+		                cat >>confdefs.h <<_ACEOF
+#define $ac_tr_hdr 1
 _ACEOF
-if { (ac_try="$ac_cpp conftest.$ac_ext"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_cpp conftest.$ac_ext") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } >/dev/null && {
-	 test -z "$ac_c_preproc_warn_flag$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       }; then
-  ac_header_preproc=yes
-else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
 
-  ac_header_preproc=no
-fi
 
-rm -f conftest.err conftest.$ac_ext
-{ $as_echo "$as_me:$LINENO: result: $ac_header_preproc" >&5
-$as_echo "$ac_header_preproc" >&6; }
+		V_INCLUDES="$V_HEADER_RETURN $V_INCLUDES"
+		V_DEFINES="-D$ac_tr_hdr $V_DEFINES"
 
-# So?  What about this header?
-case $ac_header_compiler:$ac_header_preproc:$ac_c_preproc_warn_flag in
-  yes:no: )
-    { $as_echo "$as_me:$LINENO: WARNING: $ac_header: accepted by the compiler, rejected by the preprocessor!" >&5
-$as_echo "$as_me: WARNING: $ac_header: accepted by the compiler, rejected by the preprocessor!" >&2;}
-    { $as_echo "$as_me:$LINENO: WARNING: $ac_header: proceeding with the compiler's result" >&5
-$as_echo "$as_me: WARNING: $ac_header: proceeding with the compiler's result" >&2;}
-    ac_header_preproc=yes
-    ;;
-  no:yes:* )
-    { $as_echo "$as_me:$LINENO: WARNING: $ac_header: present but cannot be compiled" >&5
-$as_echo "$as_me: WARNING: $ac_header: present but cannot be compiled" >&2;}
-    { $as_echo "$as_me:$LINENO: WARNING: $ac_header:     check for missing prerequisite headers?" >&5
-$as_echo "$as_me: WARNING: $ac_header:     check for missing prerequisite headers?" >&2;}
-    { $as_echo "$as_me:$LINENO: WARNING: $ac_header: see the Autoconf documentation" >&5
-$as_echo "$as_me: WARNING: $ac_header: see the Autoconf documentation" >&2;}
-    { $as_echo "$as_me:$LINENO: WARNING: $ac_header:     section \"Present But Cannot Be Compiled\"" >&5
-$as_echo "$as_me: WARNING: $ac_header:     section \"Present But Cannot Be Compiled\"" >&2;}
-    { $as_echo "$as_me:$LINENO: WARNING: $ac_header: proceeding with the preprocessor's result" >&5
-$as_echo "$as_me: WARNING: $ac_header: proceeding with the preprocessor's result" >&2;}
-    { $as_echo "$as_me:$LINENO: WARNING: $ac_header: in the future, the compiler will take precedence" >&5
-$as_echo "$as_me: WARNING: $ac_header: in the future, the compiler will take precedence" >&2;}
+		NS_PACKAGE_dmalloc_UNDERWAY=true
 
-    ;;
-esac
-{ $as_echo "$as_me:$LINENO: checking for $ac_header" >&5
-$as_echo_n "checking for $ac_header... " >&6; }
-if { as_var=$as_ac_Header; eval "test \"\${$as_var+set}\" = set"; }; then
-  $as_echo_n "(cached) " >&6
-else
-  eval "$as_ac_Header=\$ac_header_preproc"
+		{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $V_HEADER_RETURN" >&5
+$as_echo "$V_HEADER_RETURN" >&6; }
+	fi
 fi
-ac_res=`eval 'as_val=${'$as_ac_Header'}
-		 $as_echo "$as_val"'`
-	       { $as_echo "$as_me:$LINENO: result: $ac_res" >&5
-$as_echo "$ac_res" >&6; }
 
+
+NS_PACKAGE_dmalloc_VALID=false
+if $NS_PACKAGE_dmalloc_UNDERWAY; then
+	if $NS_PACKAGE_dmalloc_COMPLETE; then
+		: All components of dmalloc found.
+		NS_PACKAGE_dmalloc_VALID=true
+	else
+		as_fn_error "Installation of dmalloc seems incomplete or can't be found automatically.
+Please correct the problem by telling configure where dmalloc is
+using the argument --with-dmalloc=/path/to/package
+(perhaps after installing it),
+or the package is not required, disable it with --with-dmalloc=no." "$LINENO" 5
+	fi
+fi
+if test "xno" = xyes; then
+	if $NS_PACKAGE_dmalloc_VALID; then
+		:
+	else
+		as_fn_error "dmalloc is required but could not be completely found.
+Please correct the problem by telling configure where dmalloc is
+using the argument --with-dmalloc=/path/to/package,
+or the package is not required, disable it with --with-dmalloc=no." "$LINENO" 5
+	fi
 fi
-as_val=`eval 'as_val=${'$as_ac_Header'}
-		 $as_echo "$as_val"'`
-   if test "x$as_val" = x""yes; then
-  cat >>confdefs.h <<_ACEOF
-#define `$as_echo "HAVE_$ac_header" | $as_tr_cpp` 1
-_ACEOF
 
 fi
 
-done
 
 
-{ $as_echo "$as_me:$LINENO: checking for main in -lm" >&5
-$as_echo_n "checking for main in -lm... " >&6; }
-if test "${ac_cv_lib_m_main+set}" = set; then
-  $as_echo_n "(cached) " >&6
-else
-  ac_check_lib_save_LIBS=$LIBS
-LIBS="-lm  $LIBS"
-cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
-/* end confdefs.h.  */
 
 
-int
-main ()
-{
-return main ();
-  ;
-  return 0;
-}
-_ACEOF
-rm -f conftest.$ac_objext conftest$ac_exeext
-if { (ac_try="$ac_link"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_link") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest$ac_exeext && {
-	 test "$cross_compiling" = yes ||
-	 $as_test_x conftest$ac_exeext
-       }; then
-  ac_cv_lib_m_main=yes
+# Check whether --with-click was given.
+if test "${with_click+set}" = set; then :
+  withval=$with_click; d="$withval"
 else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-	ac_cv_lib_m_main=no
-fi
-
-rm -rf conftest.dSYM
-rm -f core conftest.err conftest.$ac_objext conftest_ipa8_conftest.oo \
-      conftest$ac_exeext conftest.$ac_ext
-LIBS=$ac_check_lib_save_LIBS
+  d=""
 fi
-{ $as_echo "$as_me:$LINENO: result: $ac_cv_lib_m_main" >&5
-$as_echo "$ac_cv_lib_m_main" >&6; }
-if test "x$ac_cv_lib_m_main" = x""yes; then
-  cat >>confdefs.h <<_ACEOF
-#define HAVE_LIBM 1
-_ACEOF
 
-  LIBS="-lm $LIBS"
 
-else
-  { { $as_echo "$as_me:$LINENO: error: Could not find math library" >&5
-$as_echo "$as_me: error: Could not find math library" >&2;}
-   { (exit cannot continue.); exit cannot continue.; }; }
-fi
+CLICK_VERS=1.3
 
+CLICK_PATH="$PWD/../click \
+	$PWD/../../click \
+	$PWD/../click-$CLICK_VERS \
+	$PWD/../../click-$CLICK_VERS \
+	$PWD/../click/include \
+	$PWD/../../click/include \
+	$PWD/../click-$CLICK_VERS/include \
+	$PWD/../../click-$CLICK_VERS/include \
+	$PWD/../click/ns \
+	$PWD/../../click/ns \
+	$PWD/../click-$CLICK_VERS/ns \
+	$PWD/../../click-$CLICK_VERS/ns \
+	"
+CLICK_PATH_D="$d \
+	$d/lib \
+	$d/include \
+	"
 
 
+NS_PACKAGE_click_UNDERWAY=false
+NS_PACKAGE_click_COMPLETE=true
 
 
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for click/simclick.h" >&5
+$as_echo_n "checking for click/simclick.h... " >&6; }
+if test "x$d" = "xno"; then
+	: disable header
+	V_HEADER_CLICK=FAIL
 
+NS_PACKAGE_click_COMPLETE=false
 
+	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
 
-for ac_func in bcopy bzero fesetprecision feenableexcept getrusage sbrk snprintf
-do
-as_ac_var=`$as_echo "ac_cv_func_$ac_func" | $as_tr_sh`
-{ $as_echo "$as_me:$LINENO: checking for $ac_func" >&5
-$as_echo_n "checking for $ac_func... " >&6; }
-if { as_var=$as_ac_var; eval "test \"\${$as_var+set}\" = set"; }; then
-  $as_echo_n "(cached) " >&6
 else
-  cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
-/* end confdefs.h.  */
-/* Define $ac_func to an innocuous variant, in case <limits.h> declares $ac_func.
-   For example, HP-UX 11i <limits.h> declares gettimeofday.  */
-#define $ac_func innocuous_$ac_func
-
-/* System header to define __stub macros and hopefully few prototypes,
-    which can conflict with char $ac_func (); below.
-    Prefer <limits.h> to <assert.h> if __STDC__ is defined, since
-    <limits.h> exists even on freestanding compilers.  */
+	places="$CLICK_PATH"
+	if test "x$d" != "x" -a "x$d" != xyes; then
+		if test ! -d $d; then
+			as_fn_error "$d is not a directory" "$LINENO" 5
+		fi
+		places="$CLICK_PATH_D"
+	fi
 
-#ifdef __STDC__
-# include <limits.h>
-#else
-# include <assert.h>
-#endif
+	V_HEADER_CLICK=""
+	found=""
+	for dir in $places; do
+		if test -r $dir/click/simclick.h; then
+                        found="$dir"
+                        if test "$CC" != "icc" ||
+                                test "$dir" != "/usr/include"; then
+                                V_HEADER_CLICK="-I$dir"
+                        fi
+			break
+		fi
+	done
+	if test "FAIL$found" = "FAIL" ; then
 
-#undef $ac_func
+NS_PACKAGE_click_COMPLETE=false
 
-/* Override any GCC internal prototype to avoid an error.
-   Use char because int might match the return type of a GCC
-   builtin and then its argument prototype would still apply.  */
-#ifdef __cplusplus
-extern "C"
-#endif
-char $ac_func ();
-/* The GNU C library defines this for functions which it implements
-    to always fail with ENOSYS.  Some functions are actually named
-    something starting with __ and the normal name is an alias.  */
-#if defined __stub_$ac_func || defined __stub___$ac_func
-choke me
-#endif
+		{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
+	else
 
-int
-main ()
-{
-return $ac_func ();
-  ;
-  return 0;
-}
+				  ac_tr_hdr=HAVE_`echo click/simclick.h | sed 'y%abcdefghijklmnopqrstuvwxyz./-%ABCDEFGHIJKLMNOPQRSTUVWXYZ___%'`
+		                cat >>confdefs.h <<_ACEOF
+#define $ac_tr_hdr 1
 _ACEOF
-rm -f conftest.$ac_objext conftest$ac_exeext
-if { (ac_try="$ac_link"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_link") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest$ac_exeext && {
-	 test "$cross_compiling" = yes ||
-	 $as_test_x conftest$ac_exeext
-       }; then
-  eval "$as_ac_var=yes"
-else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-	eval "$as_ac_var=no"
-fi
 
-rm -rf conftest.dSYM
-rm -f core conftest.err conftest.$ac_objext conftest_ipa8_conftest.oo \
-      conftest$ac_exeext conftest.$ac_ext
-fi
-ac_res=`eval 'as_val=${'$as_ac_var'}
-		 $as_echo "$as_val"'`
-	       { $as_echo "$as_me:$LINENO: result: $ac_res" >&5
-$as_echo "$ac_res" >&6; }
-as_val=`eval 'as_val=${'$as_ac_var'}
-		 $as_echo "$as_val"'`
-   if test "x$as_val" = x""yes; then
-  cat >>confdefs.h <<_ACEOF
-#define `$as_echo "HAVE_$ac_func" | $as_tr_cpp` 1
-_ACEOF
 
-fi
-done
+		V_INCLUDES="$V_HEADER_CLICK $V_INCLUDES"
+		V_DEFINES="-D$ac_tr_hdr $V_DEFINES"
 
+		NS_PACKAGE_click_UNDERWAY=true
 
-{ $as_echo "$as_me:$LINENO: checking return type of random" >&5
-$as_echo_n "checking return type of random... " >&6; }
-touch confdefs.h
-if test "$cross_compiling" = yes; then
-  { $as_echo "$as_me:$LINENO: result: cross compiling--guessing int" >&5
-$as_echo "cross compiling--guessing int" >&6; }
-cat >>confdefs.h <<\_ACEOF
-#define RANDOM_RETURN_TYPE int
-_ACEOF
+		{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $V_HEADER_CLICK" >&5
+$as_echo "$V_HEADER_CLICK" >&6; }
+	fi
+fi
 
 
-else
-  cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
-/* end confdefs.h.  */
-#include <stdlib.h>
-#include "confdefs.h"
-long random() { return 1; }
-main() { exit(0); }
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for libnsclick" >&5
+$as_echo_n "checking for libnsclick... " >&6; }
+if test "x$d" = "xno"; then
+	: disable library
+	V_LIB_CLICK=FAIL
 
-_ACEOF
-rm -f conftest$ac_exeext
-if { (ac_try="$ac_link"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_link") 2>&5
-  ac_status=$?
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && { ac_try='./conftest$ac_exeext'
-  { (case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_try") 2>&5
-  ac_status=$?
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); }; }; then
-  { $as_echo "$as_me:$LINENO: result: long" >&5
-$as_echo "long" >&6; }
-cat >>confdefs.h <<\_ACEOF
-#define RANDOM_RETURN_TYPE long
-_ACEOF
+NS_PACKAGE_click_COMPLETE=false
 
+	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
 
 else
-  $as_echo "$as_me: program exited with status $ac_status" >&5
-$as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-( exit $ac_status )
-{ $as_echo "$as_me:$LINENO: result: int" >&5
-$as_echo "int" >&6; }
-cat >>confdefs.h <<\_ACEOF
-#define RANDOM_RETURN_TYPE int
-_ACEOF
-
+	places="$CLICK_PATH"
+	if test "x$d" != "x" -a "x$d" != xyes; then
+		if test ! -d $d; then
+			as_fn_error "$d is not a directory" "$LINENO" 5
+		fi
+		places="$CLICK_PATH_D"
+	fi
 
-fi
-rm -rf conftest.dSYM
-rm -f core *.core core.conftest.* gmon.out bb.out conftest$ac_exeext conftest.$ac_objext conftest.$ac_ext
-fi
+	V_LIB_CLICK=""
+		full_lib_name="nsclick"
+		simple_lib_name=`echo $full_lib_name | sed -e 's/\.//'`
+		other_simple_lib_name=`echo $full_lib_name | sed -e 's/\./_/'`
+		simpler_lib_name=`echo $simple_lib_name | sed -e 'y/0123456789/          /'`
+	double_break=false
+	for dir in $places; do
+		for file in $full_lib_name $simple_lib_name $other_simple_lib_name $simpler_lib_name
+		do
+			if test -r $dir/lib$file.so -o -r $dir/lib$file.a -o -r $dir/lib$file.dylib; then
+				V_LIB_CLICK="-L$dir -l$file"
+				double_break=true
+				break
+			fi
+		done
+		if $double_break; then
+			break
+		fi
+	done
+	if test "FAIL$V_LIB_CLICK" = "FAIL" ; then
 
+NS_PACKAGE_click_COMPLETE=false
 
+		{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
+	else
+		if test "$solaris"; then
+			V_LIB_CLICK="-R$dir $V_LIB_CLICK"
+		fi
 
-{ $as_echo "$as_me:$LINENO: checking for int8_t" >&5
-$as_echo_n "checking for int8_t... " >&6; }
-if test "${ac_cv_type_int8_t+set}" = set; then
-  $as_echo_n "(cached) " >&6
-else
-  ac_cv_type_int8_t=no
-cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
-/* end confdefs.h.  */
-$ac_includes_default
-int
-main ()
-{
-if (sizeof (int8_t))
-       return 0;
-  ;
-  return 0;
-}
-_ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
-  cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
-/* end confdefs.h.  */
-$ac_includes_default
-int
-main ()
-{
-if (sizeof ((int8_t)))
-	  return 0;
-  ;
-  return 0;
-}
+				ac_tr_lib=HAVE_LIB`echo nsclick | sed -e 's/[^a-zA-Z0-9_]/_/g' \
+		    -e 'y/abcdefghijklmnopqrstuvwxyz/ABCDEFGHIJKLMNOPQRSTUVWXYZ/'`
+				cat >>confdefs.h <<_ACEOF
+#define $ac_tr_lib 1
 _ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
-  :
-else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
 
-	ac_cv_type_int8_t=yes
-fi
 
-rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
-else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
+				V_LIBS="$V_LIB_CLICK $V_LIBS"
+		V_DEFINES="-D$ac_tr_lib $V_DEFINES"
 
+		NS_PACKAGE_click_UNDERWAY=true
 
+		{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $V_LIB_CLICK" >&5
+$as_echo "$V_LIB_CLICK" >&6; }
+	fi
 fi
 
-rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
+V_DEFINES="-DCLICK_NS $V_DEFINES"
+
+NS_PACKAGE_click_VALID=false
+if $NS_PACKAGE_click_UNDERWAY; then
+	if $NS_PACKAGE_click_COMPLETE; then
+		: All components of click found.
+		NS_PACKAGE_click_VALID=true
+	else
+		as_fn_error "Installation of click seems incomplete or can't be found automatically.
+Please correct the problem by telling configure where click is
+using the argument --with-click=/path/to/package
+(perhaps after installing it),
+or the package is not required, disable it with --with-click=no." "$LINENO" 5
+	fi
+fi
+if test "xyes" = xyes; then
+	if $NS_PACKAGE_click_VALID; then
+		:
+	else
+		as_fn_error "click is required but could not be completely found.
+Please correct the problem by telling configure where click is
+using the argument --with-click=/path/to/package,
+or the package is not required, disable it with --with-click=no." "$LINENO" 5
+	fi
 fi
-{ $as_echo "$as_me:$LINENO: result: $ac_cv_type_int8_t" >&5
-$as_echo "$ac_cv_type_int8_t" >&6; }
-if test "x$ac_cv_type_int8_t" = x""yes; then
-  :
-else
 
-cat >>confdefs.h <<_ACEOF
-#define int8_t signed char
-_ACEOF
 
-fi
+default_classinstvar=yes
 
-{ $as_echo "$as_me:$LINENO: checking for int16_t" >&5
-$as_echo_n "checking for int16_t... " >&6; }
-if test "${ac_cv_type_int16_t+set}" = set; then
-  $as_echo_n "(cached) " >&6
-else
-  ac_cv_type_int16_t=no
-cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
-/* end confdefs.h.  */
-$ac_includes_default
-int
-main ()
-{
-if (sizeof (int16_t))
-       return 0;
-  ;
-  return 0;
-}
-_ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
-  cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
-/* end confdefs.h.  */
-$ac_includes_default
-int
-main ()
-{
-if (sizeof ((int16_t)))
-	  return 0;
-  ;
-  return 0;
-}
-_ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
-  :
-else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
 
-	ac_cv_type_int16_t=yes
+if test x$default_classinstvar = x
+then
+	default_classinstvar=no
 fi
 
-rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
+# Check whether --enable-tclcl-classinstvar was given.
+if test "${enable_tclcl_classinstvar+set}" = set; then :
+  enableval=$enable_tclcl_classinstvar; enable_classinstvar=$enableval
 else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-
+  enable_classinstvar=$default_classinstvar
 fi
 
-rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
+if test "$enable_classinstvar" = "yes";
+then
+	V_DEFINE="-DTCLCL_CLASSINSTVAR $V_DEFINE"
 fi
-{ $as_echo "$as_me:$LINENO: result: $ac_cv_type_int16_t" >&5
-$as_echo "$ac_cv_type_int16_t" >&6; }
-if test "x$ac_cv_type_int16_t" = x""yes; then
-  :
-else
 
-cat >>confdefs.h <<_ACEOF
-#define int16_t short
-_ACEOF
 
-fi
 
-{ $as_echo "$as_me:$LINENO: checking for int32_t" >&5
-$as_echo_n "checking for int32_t... " >&6; }
-if test "${ac_cv_type_int32_t+set}" = set; then
-  $as_echo_n "(cached) " >&6
-else
-  ac_cv_type_int32_t=no
-cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
-/* end confdefs.h.  */
-$ac_includes_default
-int
-main ()
-{
-if (sizeof (int32_t))
-       return 0;
-  ;
-  return 0;
-}
-_ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
-  cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
-/* end confdefs.h.  */
-$ac_includes_default
-int
-main ()
-{
-if (sizeof ((int32_t)))
-	  return 0;
-  ;
-  return 0;
-}
-_ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
-  :
-else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
 
-	ac_cv_type_int32_t=yes
-fi
+PERL_OPTIONAL=true
 
-rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
-else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
 
 
+# Check whether --with-perl was given.
+if test "${with_perl+set}" = set; then :
+  withval=$with_perl; d=$withval
+else
+  d=""
 fi
 
-rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
-fi
-{ $as_echo "$as_me:$LINENO: result: $ac_cv_type_int32_t" >&5
-$as_echo "$ac_cv_type_int32_t" >&6; }
-if test "x$ac_cv_type_int32_t" = x""yes; then
-  :
-else
 
-cat >>confdefs.h <<_ACEOF
-#define int32_t int
-_ACEOF
+# Next line is the minimum version of perl required.
+# 5.000 and 5.001 are generally scorned because of age and bugs.
+PERL_VERSION=${PERL_VERSION:-5.002}
 
-fi
+PERL_PLACES=`echo $PATH | sed 's/:/ /g'`
 
-{ $as_echo "$as_me:$LINENO: checking for u_int8_t" >&5
-$as_echo_n "checking for u_int8_t... " >&6; }
-if test "${ac_cv_type_u_int8_t+set}" = set; then
-  $as_echo_n "(cached) " >&6
-else
-  ac_cv_type_u_int8_t=no
-cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
-/* end confdefs.h.  */
-$ac_includes_default
-int
-main ()
-{
-if (sizeof (u_int8_t))
-       return 0;
-  ;
-  return 0;
-}
-_ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
-  cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
-/* end confdefs.h.  */
-$ac_includes_default
-int
-main ()
-{
-if (sizeof ((u_int8_t)))
-	  return 0;
-  ;
-  return 0;
-}
-_ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
-  :
-else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
+PERL_OPTIONAL=${PERL_OPTIONAL:-false}
 
-	ac_cv_type_u_int8_t=yes
-fi
 
-rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
-else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
 
 
-fi
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for perl" >&5
+$as_echo_n "checking for perl... " >&6; }
+if test "x$d" = "xno"; then
+	: disable header
+	PERL=FAIL
+
+NS_PACKAGE_no_COMPLETE=false
+
+	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
 
-rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
-fi
-{ $as_echo "$as_me:$LINENO: result: $ac_cv_type_u_int8_t" >&5
-$as_echo "$ac_cv_type_u_int8_t" >&6; }
-if test "x$ac_cv_type_u_int8_t" = x""yes; then
-  :
 else
+	places="$PERL_PLACES"
+	if test "x$d" != "x" -a "x$d" != xyes; then
+		if test ! -d $d; then
+			as_fn_error "$d is not a directory" "$LINENO" 5
+		fi
+		places="$d"
+	fi
 
-cat >>confdefs.h <<_ACEOF
-#define u_int8_t unsigned char
-_ACEOF
+	PERL=""
+	for dir in $places; do
+		if test -r $dir/perl; then
+			PERL="$dir"
+			break
+		fi
+	done
+	if test "FAIL$PERL" = "FAIL" ; then
 
-fi
+NS_PACKAGE_no_COMPLETE=false
 
-{ $as_echo "$as_me:$LINENO: checking for u_int16_t" >&5
-$as_echo_n "checking for u_int16_t... " >&6; }
-if test "${ac_cv_type_u_int16_t+set}" = set; then
-  $as_echo_n "(cached) " >&6
-else
-  ac_cv_type_u_int16_t=no
-cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
-/* end confdefs.h.  */
-$ac_includes_default
-int
-main ()
-{
-if (sizeof (u_int16_t))
-       return 0;
-  ;
-  return 0;
-}
-_ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
-  cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
-/* end confdefs.h.  */
-$ac_includes_default
-int
-main ()
-{
-if (sizeof ((u_int16_t)))
-	  return 0;
-  ;
-  return 0;
-}
-_ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
-  :
-else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
+		{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
+	else
 
-	ac_cv_type_u_int16_t=yes
-fi
+		NS_PACKAGE_no_UNDERWAY=true
 
-rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
-else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
+		{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $PERL" >&5
+$as_echo "$PERL" >&6; }
+	fi
+fi
 
+if test "x$PERL" != x
+then
+    PERL=$PERL/perl
 
+echo $PERL -e "require $PERL_VERSION" 1>&5
+if $PERL -e "require $PERL_VERSION" 2>&5
+then
+    : good version
+else
+    : non-good version => zero pathname
+    { $as_echo "$as_me:${as_lineno-$LINENO}: result:     not version $PERL_VERSION" >&5
+$as_echo "    not version $PERL_VERSION" >&6; }
+    PERL=''
 fi
 
-rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
 fi
-{ $as_echo "$as_me:$LINENO: result: $ac_cv_type_u_int16_t" >&5
-$as_echo "$ac_cv_type_u_int16_t" >&6; }
-if test "x$ac_cv_type_u_int16_t" = x""yes; then
-  :
-else
 
-cat >>confdefs.h <<_ACEOF
-#define u_int16_t unsigned short
-_ACEOF
+if test "x$PERL" = "x"
+then
 
-fi
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for perl5" >&5
+$as_echo_n "checking for perl5... " >&6; }
+if test "x$d" = "xno"; then
+	: disable header
+	PERL=FAIL
+
+NS_PACKAGE_no_COMPLETE=false
+
+	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
 
-{ $as_echo "$as_me:$LINENO: checking for u_int32_t" >&5
-$as_echo_n "checking for u_int32_t... " >&6; }
-if test "${ac_cv_type_u_int32_t+set}" = set; then
-  $as_echo_n "(cached) " >&6
-else
-  ac_cv_type_u_int32_t=no
-cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
-/* end confdefs.h.  */
-$ac_includes_default
-int
-main ()
-{
-if (sizeof (u_int32_t))
-       return 0;
-  ;
-  return 0;
-}
-_ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
-  cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
-/* end confdefs.h.  */
-$ac_includes_default
-int
-main ()
-{
-if (sizeof ((u_int32_t)))
-	  return 0;
-  ;
-  return 0;
-}
-_ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
-  :
 else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
+	places="$PERL_PLACES"
+	if test "x$d" != "x" -a "x$d" != xyes; then
+		if test ! -d $d; then
+			as_fn_error "$d is not a directory" "$LINENO" 5
+		fi
+		places="$d"
+	fi
+
+	PERL=""
+	for dir in $places; do
+		if test -r $dir/perl5; then
+			PERL="$dir"
+			break
+		fi
+	done
+	if test "FAIL$PERL" = "FAIL" ; then
+
+NS_PACKAGE_no_COMPLETE=false
+
+		{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
+	else
+
+		NS_PACKAGE_no_UNDERWAY=true
 
-	ac_cv_type_u_int32_t=yes
+		{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $PERL" >&5
+$as_echo "$PERL" >&6; }
+	fi
 fi
 
-rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
-else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
+    if test "x$PERL" != "x"
+    then
+	PERL=$PERL/perl5
 
+echo $PERL -e "require $PERL_VERSION" 1>&5
+if $PERL -e "require $PERL_VERSION" 2>&5
+then
+    : good version
+else
+    : non-good version => zero pathname
+    { $as_echo "$as_me:${as_lineno-$LINENO}: result:     not version $PERL_VERSION" >&5
+$as_echo "    not version $PERL_VERSION" >&6; }
+    PERL=''
+fi
 
+    fi
 fi
 
-rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
+if test "x$PERL" = x
+then
+    if $PERL_OPTIONAL
+    then
+        { $as_echo "$as_me:${as_lineno-$LINENO}: result:     perl version $PERL_VERSION not found" >&5
+$as_echo "    perl version $PERL_VERSION not found" >&6; }
+    else
+        as_fn_error "Cannot find Perl 5." "$LINENO" 5
+    fi
 fi
-{ $as_echo "$as_me:$LINENO: result: $ac_cv_type_u_int32_t" >&5
-$as_echo "$ac_cv_type_u_int32_t" >&6; }
-if test "x$ac_cv_type_u_int32_t" = x""yes; then
-  :
-else
 
-cat >>confdefs.h <<_ACEOF
-#define u_int32_t unsigned int
-_ACEOF
 
+
+
+if test "x$PERL" = x
+then
+	{ $as_echo "$as_me:${as_lineno-$LINENO}: WARNING: Perl5 not found; test scripts will not run succesfully." >&5
+$as_echo "$as_me: WARNING: Perl5 not found; test scripts will not run succesfully." >&2;}
 fi
 
-{ $as_echo "$as_me:$LINENO: checking for u_char" >&5
-$as_echo_n "checking for u_char... " >&6; }
-if test "${ac_cv_type_u_char+set}" = set; then
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for ANSI C header files" >&5
+$as_echo_n "checking for ANSI C header files... " >&6; }
+if test "${ac_cv_header_stdc+set}" = set; then :
   $as_echo_n "(cached) " >&6
 else
-  ac_cv_type_u_char=no
-cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
-/* end confdefs.h.  */
-$ac_includes_default
-int
-main ()
-{
-if (sizeof (u_char))
-       return 0;
-  ;
-  return 0;
-}
-_ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
-  cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
-$ac_includes_default
+#include <stdlib.h>
+#include <stdarg.h>
+#include <string.h>
+#include <float.h>
+
 int
 main ()
 {
-if (sizeof ((u_char)))
-	  return 0;
+
   ;
   return 0;
 }
 _ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
-  :
+if ac_fn_c_try_compile "$LINENO"; then :
+  ac_cv_header_stdc=yes
 else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-	ac_cv_type_u_char=yes
+  ac_cv_header_stdc=no
 fi
-
 rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
-else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
 
+if test $ac_cv_header_stdc = yes; then
+  # SunOS 4.x string.h does not declare mem*, contrary to ANSI.
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
+/* end confdefs.h.  */
+#include <string.h>
+
+_ACEOF
+if (eval "$ac_cpp conftest.$ac_ext") 2>&5 |
+  $EGREP "memchr" >/dev/null 2>&1; then :
 
+else
+  ac_cv_header_stdc=no
 fi
+rm -f conftest*
 
-rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
 fi
-{ $as_echo "$as_me:$LINENO: result: $ac_cv_type_u_char" >&5
-$as_echo "$ac_cv_type_u_char" >&6; }
-if test "x$ac_cv_type_u_char" = x""yes; then
-  :
-else
 
-cat >>confdefs.h <<_ACEOF
-#define u_char unsigned char
+if test $ac_cv_header_stdc = yes; then
+  # ISC 2.0.2 stdlib.h does not declare free, contrary to ANSI.
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
+/* end confdefs.h.  */
+#include <stdlib.h>
+
 _ACEOF
+if (eval "$ac_cpp conftest.$ac_ext") 2>&5 |
+  $EGREP "free" >/dev/null 2>&1; then :
 
+else
+  ac_cv_header_stdc=no
 fi
+rm -f conftest*
 
-{ $as_echo "$as_me:$LINENO: checking for u_int" >&5
-$as_echo_n "checking for u_int... " >&6; }
-if test "${ac_cv_type_u_int+set}" = set; then
-  $as_echo_n "(cached) " >&6
+fi
+
+if test $ac_cv_header_stdc = yes; then
+  # /bin/cc in Irix-4.0.5 gets non-ANSI ctype macros unless using -ansi.
+  if test "$cross_compiling" = yes; then :
+  :
 else
-  ac_cv_type_u_int=no
-cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
-/* end confdefs.h.  */
-$ac_includes_default
-int
-main ()
-{
-if (sizeof (u_int))
-       return 0;
-  ;
-  return 0;
-}
-_ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
-  cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
-$ac_includes_default
+#include <ctype.h>
+#include <stdlib.h>
+#if ((' ' & 0x0FF) == 0x020)
+# define ISLOWER(c) ('a' <= (c) && (c) <= 'z')
+# define TOUPPER(c) (ISLOWER(c) ? 'A' + ((c) - 'a') : (c))
+#else
+# define ISLOWER(c) \
+		   (('a' <= (c) && (c) <= 'i') \
+		     || ('j' <= (c) && (c) <= 'r') \
+		     || ('s' <= (c) && (c) <= 'z'))
+# define TOUPPER(c) (ISLOWER(c) ? ((c) | 0x40) : (c))
+#endif
+
+#define XOR(e, f) (((e) && !(f)) || (!(e) && (f)))
 int
 main ()
 {
-if (sizeof ((u_int)))
-	  return 0;
-  ;
+  int i;
+  for (i = 0; i < 256; i++)
+    if (XOR (islower (i), ISLOWER (i))
+	|| toupper (i) != TOUPPER (i))
+      return 2;
   return 0;
 }
-_ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
-  :
-else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-	ac_cv_type_u_int=yes
-fi
+_ACEOF
+if ac_fn_c_try_run "$LINENO"; then :
 
-rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
 else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-
+  ac_cv_header_stdc=no
+fi
+rm -f core *.core core.conftest.* gmon.out bb.out conftest$ac_exeext \
+  conftest.$ac_objext conftest.beam conftest.$ac_ext
 fi
 
-rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
 fi
-{ $as_echo "$as_me:$LINENO: result: $ac_cv_type_u_int" >&5
-$as_echo "$ac_cv_type_u_int" >&6; }
-if test "x$ac_cv_type_u_int" = x""yes; then
-  :
-else
+fi
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_header_stdc" >&5
+$as_echo "$ac_cv_header_stdc" >&6; }
+if test $ac_cv_header_stdc = yes; then
 
-cat >>confdefs.h <<_ACEOF
-#define u_int unsigned int
-_ACEOF
+$as_echo "#define STDC_HEADERS 1" >>confdefs.h
 
 fi
 
 
+for ac_header in arpa/inet.h fenv.h netinet/in.h string.h strings.h time.h unistd.h net/ethernet.h
+do :
+  as_ac_Header=`$as_echo "ac_cv_header_$ac_header" | $as_tr_sh`
+ac_fn_c_check_header_mongrel "$LINENO" "$ac_header" "$as_ac_Header" "$ac_includes_default"
+eval as_val=\$$as_ac_Header
+   if test "x$as_val" = x""yes; then :
+  cat >>confdefs.h <<_ACEOF
+#define `$as_echo "HAVE_$ac_header" | $as_tr_cpp` 1
+_ACEOF
 
+fi
 
+done
 
-for ac_func in strtoq strtoll
-do
-as_ac_var=`$as_echo "ac_cv_func_$ac_func" | $as_tr_sh`
-{ $as_echo "$as_me:$LINENO: checking for $ac_func" >&5
-$as_echo_n "checking for $ac_func... " >&6; }
-if { as_var=$as_ac_var; eval "test \"\${$as_var+set}\" = set"; }; then
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for main in -lm" >&5
+$as_echo_n "checking for main in -lm... " >&6; }
+if test "${ac_cv_lib_m_main+set}" = set; then :
   $as_echo_n "(cached) " >&6
 else
-  cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+  ac_check_lib_save_LIBS=$LIBS
+LIBS="-lm  $LIBS"
+cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
-/* Define $ac_func to an innocuous variant, in case <limits.h> declares $ac_func.
-   For example, HP-UX 11i <limits.h> declares gettimeofday.  */
-#define $ac_func innocuous_$ac_func
-
-/* System header to define __stub macros and hopefully few prototypes,
-    which can conflict with char $ac_func (); below.
-    Prefer <limits.h> to <assert.h> if __STDC__ is defined, since
-    <limits.h> exists even on freestanding compilers.  */
-
-#ifdef __STDC__
-# include <limits.h>
-#else
-# include <assert.h>
-#endif
 
-#undef $ac_func
-
-/* Override any GCC internal prototype to avoid an error.
-   Use char because int might match the return type of a GCC
-   builtin and then its argument prototype would still apply.  */
-#ifdef __cplusplus
-extern "C"
-#endif
-char $ac_func ();
-/* The GNU C library defines this for functions which it implements
-    to always fail with ENOSYS.  Some functions are actually named
-    something starting with __ and the normal name is an alias.  */
-#if defined __stub_$ac_func || defined __stub___$ac_func
-choke me
-#endif
 
 int
 main ()
 {
-return $ac_func ();
+return main ();
   ;
   return 0;
 }
 _ACEOF
-rm -f conftest.$ac_objext conftest$ac_exeext
-if { (ac_try="$ac_link"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_link") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest$ac_exeext && {
-	 test "$cross_compiling" = yes ||
-	 $as_test_x conftest$ac_exeext
-       }; then
-  eval "$as_ac_var=yes"
+if ac_fn_c_try_link "$LINENO"; then :
+  ac_cv_lib_m_main=yes
 else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-	eval "$as_ac_var=no"
+  ac_cv_lib_m_main=no
+fi
+rm -f core conftest.err conftest.$ac_objext \
+    conftest$ac_exeext conftest.$ac_ext
+LIBS=$ac_check_lib_save_LIBS
 fi
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_lib_m_main" >&5
+$as_echo "$ac_cv_lib_m_main" >&6; }
+if test "x$ac_cv_lib_m_main" = x""yes; then :
+  cat >>confdefs.h <<_ACEOF
+#define HAVE_LIBM 1
+_ACEOF
+
+  LIBS="-lm $LIBS"
 
-rm -rf conftest.dSYM
-rm -f core conftest.err conftest.$ac_objext conftest_ipa8_conftest.oo \
-      conftest$ac_exeext conftest.$ac_ext
+else
+  { as_fn_set_status cannot continue.
+as_fn_error "Could not find math library" "$LINENO" 5; }
 fi
-ac_res=`eval 'as_val=${'$as_ac_var'}
-		 $as_echo "$as_val"'`
-	       { $as_echo "$as_me:$LINENO: result: $ac_res" >&5
-$as_echo "$ac_res" >&6; }
-as_val=`eval 'as_val=${'$as_ac_var'}
-		 $as_echo "$as_val"'`
-   if test "x$as_val" = x""yes; then
+
+for ac_func in bcopy bzero fesetprecision feenableexcept getrusage sbrk snprintf
+do :
+  as_ac_var=`$as_echo "ac_cv_func_$ac_func" | $as_tr_sh`
+ac_fn_c_check_func "$LINENO" "$ac_func" "$as_ac_var"
+eval as_val=\$$as_ac_var
+   if test "x$as_val" = x""yes; then :
   cat >>confdefs.h <<_ACEOF
 #define `$as_echo "HAVE_$ac_func" | $as_tr_cpp` 1
 _ACEOF
@@ -10242,360 +8112,175 @@
 done
 
 
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking return type of random" >&5
+$as_echo_n "checking return type of random... " >&6; }
+touch confdefs.h
+if test "$cross_compiling" = yes; then :
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: cross compiling--guessing int" >&5
+$as_echo "cross compiling--guessing int" >&6; }
+$as_echo "#define RANDOM_RETURN_TYPE int" >>confdefs.h
 
-INT64_T_ALTERNATIVE=none
-HAVE_SUPPORTING_FUNC=false
 
-# The cast to long int works around a bug in the HP C Compiler
-# version HP92453-01 B.11.11.23709.GP, which incorrectly rejects
-# declarations like `int a3[[(sizeof (unsigned char)) >= 0]];'.
-# This bug is HP SR number 8606223364.
-{ $as_echo "$as_me:$LINENO: checking size of long" >&5
-$as_echo_n "checking size of long... " >&6; }
-if test "${ac_cv_sizeof_long+set}" = set; then
-  $as_echo_n "(cached) " >&6
 else
-  if test "$cross_compiling" = yes; then
-  # Depending upon the size, compute the lo and hi bounds.
-cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
-$ac_includes_default
-int
-main ()
-{
-static int test_array [1 - 2 * !(((long int) (sizeof (long))) >= 0)];
-test_array [0] = 0
+#include <stdlib.h>
+#include "confdefs.h"
+long random() { return 1; }
+main() { exit(0); }
 
-  ;
-  return 0;
-}
-_ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
-  ac_lo=0 ac_mid=0
-  while :; do
-    cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
 _ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
-/* end confdefs.h.  */
-$ac_includes_default
-int
-main ()
-{
-static int test_array [1 - 2 * !(((long int) (sizeof (long))) <= $ac_mid)];
-test_array [0] = 0
+if ac_fn_c_try_run "$LINENO"; then :
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: long" >&5
+$as_echo "long" >&6; }
+$as_echo "#define RANDOM_RETURN_TYPE long" >>confdefs.h
+
 
-  ;
-  return 0;
-}
-_ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
-  ac_hi=$ac_mid; break
 else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: int" >&5
+$as_echo "int" >&6; }
+$as_echo "#define RANDOM_RETURN_TYPE int" >>confdefs.h
+
 
-	ac_lo=`expr $ac_mid + 1`
-			if test $ac_lo -le $ac_mid; then
-			  ac_lo= ac_hi=
-			  break
-			fi
-			ac_mid=`expr 2 '*' $ac_mid + 1`
+fi
+rm -f core *.core core.conftest.* gmon.out bb.out conftest$ac_exeext \
+  conftest.$ac_objext conftest.beam conftest.$ac_ext
 fi
 
-rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
-  done
+
+ac_fn_c_check_type "$LINENO" "int8_t" "ac_cv_type_int8_t" "$ac_includes_default"
+if test "x$ac_cv_type_int8_t" = x""yes; then :
+
 else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
 
-	cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
+cat >>confdefs.h <<_ACEOF
+#define int8_t signed char
 _ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
-/* end confdefs.h.  */
-$ac_includes_default
-int
-main ()
-{
-static int test_array [1 - 2 * !(((long int) (sizeof (long))) < 0)];
-test_array [0] = 0
 
-  ;
-  return 0;
-}
-_ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
-  ac_hi=-1 ac_mid=-1
-  while :; do
-    cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
-/* end confdefs.h.  */
-$ac_includes_default
-int
-main ()
-{
-static int test_array [1 - 2 * !(((long int) (sizeof (long))) >= $ac_mid)];
-test_array [0] = 0
+fi
+
+ac_fn_c_check_type "$LINENO" "int16_t" "ac_cv_type_int16_t" "$ac_includes_default"
+if test "x$ac_cv_type_int16_t" = x""yes; then :
 
-  ;
-  return 0;
-}
-_ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
-  ac_lo=$ac_mid; break
 else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
 
-	ac_hi=`expr '(' $ac_mid ')' - 1`
-			if test $ac_mid -le $ac_hi; then
-			  ac_lo= ac_hi=
-			  break
-			fi
-			ac_mid=`expr 2 '*' $ac_mid`
+cat >>confdefs.h <<_ACEOF
+#define int16_t short
+_ACEOF
+
 fi
 
-rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
-  done
+ac_fn_c_check_type "$LINENO" "int32_t" "ac_cv_type_int32_t" "$ac_includes_default"
+if test "x$ac_cv_type_int32_t" = x""yes; then :
+
 else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
 
-	ac_lo= ac_hi=
+cat >>confdefs.h <<_ACEOF
+#define int32_t int
+_ACEOF
+
 fi
 
-rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
+ac_fn_c_check_type "$LINENO" "u_int8_t" "ac_cv_type_u_int8_t" "$ac_includes_default"
+if test "x$ac_cv_type_u_int8_t" = x""yes; then :
+
+else
+
+cat >>confdefs.h <<_ACEOF
+#define u_int8_t unsigned char
+_ACEOF
+
 fi
 
-rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
-# Binary search between lo and hi bounds.
-while test "x$ac_lo" != "x$ac_hi"; do
-  ac_mid=`expr '(' $ac_hi - $ac_lo ')' / 2 + $ac_lo`
-  cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
+ac_fn_c_check_type "$LINENO" "u_int16_t" "ac_cv_type_u_int16_t" "$ac_includes_default"
+if test "x$ac_cv_type_u_int16_t" = x""yes; then :
+
+else
+
+cat >>confdefs.h <<_ACEOF
+#define u_int16_t unsigned short
 _ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
-/* end confdefs.h.  */
-$ac_includes_default
-int
-main ()
-{
-static int test_array [1 - 2 * !(((long int) (sizeof (long))) <= $ac_mid)];
-test_array [0] = 0
 
-  ;
-  return 0;
-}
+fi
+
+ac_fn_c_check_type "$LINENO" "u_int32_t" "ac_cv_type_u_int32_t" "$ac_includes_default"
+if test "x$ac_cv_type_u_int32_t" = x""yes; then :
+
+else
+
+cat >>confdefs.h <<_ACEOF
+#define u_int32_t unsigned int
 _ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
-  ac_hi=$ac_mid
+
+fi
+
+ac_fn_c_check_type "$LINENO" "u_char" "ac_cv_type_u_char" "$ac_includes_default"
+if test "x$ac_cv_type_u_char" = x""yes; then :
+
 else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
 
-	ac_lo=`expr '(' $ac_mid ')' + 1`
+cat >>confdefs.h <<_ACEOF
+#define u_char unsigned char
+_ACEOF
+
 fi
 
-rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
-done
-case $ac_lo in
-?*) ac_cv_sizeof_long=$ac_lo;;
-'') if test "$ac_cv_type_long" = yes; then
-     { { $as_echo "$as_me:$LINENO: error: in \`$ac_pwd':" >&5
-$as_echo "$as_me: error: in \`$ac_pwd':" >&2;}
-{ { $as_echo "$as_me:$LINENO: error: cannot compute sizeof (long)
-See \`config.log' for more details." >&5
-$as_echo "$as_me: error: cannot compute sizeof (long)
-See \`config.log' for more details." >&2;}
-   { (exit 77); exit 77; }; }; }
-   else
-     ac_cv_sizeof_long=0
-   fi ;;
-esac
+ac_fn_c_check_type "$LINENO" "u_int" "ac_cv_type_u_int" "$ac_includes_default"
+if test "x$ac_cv_type_u_int" = x""yes; then :
+
 else
-  cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
+
+cat >>confdefs.h <<_ACEOF
+#define u_int unsigned int
 _ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
-/* end confdefs.h.  */
-$ac_includes_default
-static long int longval () { return (long int) (sizeof (long)); }
-static unsigned long int ulongval () { return (long int) (sizeof (long)); }
-#include <stdio.h>
-#include <stdlib.h>
-int
-main ()
-{
 
-  FILE *f = fopen ("conftest.val", "w");
-  if (! f)
-    return 1;
-  if (((long int) (sizeof (long))) < 0)
-    {
-      long int i = longval ();
-      if (i != ((long int) (sizeof (long))))
-	return 1;
-      fprintf (f, "%ld", i);
-    }
-  else
-    {
-      unsigned long int i = ulongval ();
-      if (i != ((long int) (sizeof (long))))
-	return 1;
-      fprintf (f, "%lu", i);
-    }
-  /* Do not output a trailing newline, as this causes \r\n confusion
-     on some platforms.  */
-  return ferror (f) || fclose (f) != 0;
+fi
 
-  ;
-  return 0;
-}
+
+
+for ac_func in strtoq strtoll
+do :
+  as_ac_var=`$as_echo "ac_cv_func_$ac_func" | $as_tr_sh`
+ac_fn_c_check_func "$LINENO" "$ac_func" "$as_ac_var"
+eval as_val=\$$as_ac_var
+   if test "x$as_val" = x""yes; then :
+  cat >>confdefs.h <<_ACEOF
+#define `$as_echo "HAVE_$ac_func" | $as_tr_cpp` 1
 _ACEOF
-rm -f conftest$ac_exeext
-if { (ac_try="$ac_link"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_link") 2>&5
-  ac_status=$?
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && { ac_try='./conftest$ac_exeext'
-  { (case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_try") 2>&5
-  ac_status=$?
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); }; }; then
-  ac_cv_sizeof_long=`cat conftest.val`
+
+fi
+done
+
+
+
+INT64_T_ALTERNATIVE=none
+HAVE_SUPPORTING_FUNC=false
+
+# The cast to long int works around a bug in the HP C Compiler
+# version HP92453-01 B.11.11.23709.GP, which incorrectly rejects
+# declarations like `int a3[[(sizeof (unsigned char)) >= 0]];'.
+# This bug is HP SR number 8606223364.
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking size of long" >&5
+$as_echo_n "checking size of long... " >&6; }
+if test "${ac_cv_sizeof_long+set}" = set; then :
+  $as_echo_n "(cached) " >&6
 else
-  $as_echo "$as_me: program exited with status $ac_status" >&5
-$as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
+  if ac_fn_c_compute_int "$LINENO" "(long int) (sizeof (long))" "ac_cv_sizeof_long"        "$ac_includes_default"; then :
 
-( exit $ac_status )
-if test "$ac_cv_type_long" = yes; then
-     { { $as_echo "$as_me:$LINENO: error: in \`$ac_pwd':" >&5
+else
+  if test "$ac_cv_type_long" = yes; then
+     { { $as_echo "$as_me:${as_lineno-$LINENO}: error: in \`$ac_pwd':" >&5
 $as_echo "$as_me: error: in \`$ac_pwd':" >&2;}
-{ { $as_echo "$as_me:$LINENO: error: cannot compute sizeof (long)
-See \`config.log' for more details." >&5
-$as_echo "$as_me: error: cannot compute sizeof (long)
-See \`config.log' for more details." >&2;}
-   { (exit 77); exit 77; }; }; }
+{ as_fn_set_status 77
+as_fn_error "cannot compute sizeof (long)
+See \`config.log' for more details." "$LINENO" 5; }; }
    else
      ac_cv_sizeof_long=0
    fi
 fi
-rm -rf conftest.dSYM
-rm -f core *.core core.conftest.* gmon.out bb.out conftest$ac_exeext conftest.$ac_objext conftest.$ac_ext
-fi
-rm -f conftest.val
+
 fi
-{ $as_echo "$as_me:$LINENO: result: $ac_cv_sizeof_long" >&5
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_sizeof_long" >&5
 $as_echo "$ac_cv_sizeof_long" >&6; }
 
 
@@ -10608,213 +8293,70 @@
 if test $ac_cv_sizeof_long -ge 8
 then
 	INT64_T_ALTERNATIVE=long
-	{ $as_echo "$as_me:$LINENO: checking for strtol" >&5
-$as_echo_n "checking for strtol... " >&6; }
-if test "${ac_cv_func_strtol+set}" = set; then
-  $as_echo_n "(cached) " >&6
-else
-  cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
-/* end confdefs.h.  */
-/* Define strtol to an innocuous variant, in case <limits.h> declares strtol.
-   For example, HP-UX 11i <limits.h> declares gettimeofday.  */
-#define strtol innocuous_strtol
-
-/* System header to define __stub macros and hopefully few prototypes,
-    which can conflict with char strtol (); below.
-    Prefer <limits.h> to <assert.h> if __STDC__ is defined, since
-    <limits.h> exists even on freestanding compilers.  */
-
-#ifdef __STDC__
-# include <limits.h>
-#else
-# include <assert.h>
-#endif
-
-#undef strtol
-
-/* Override any GCC internal prototype to avoid an error.
-   Use char because int might match the return type of a GCC
-   builtin and then its argument prototype would still apply.  */
-#ifdef __cplusplus
-extern "C"
-#endif
-char strtol ();
-/* The GNU C library defines this for functions which it implements
-    to always fail with ENOSYS.  Some functions are actually named
-    something starting with __ and the normal name is an alias.  */
-#if defined __stub_strtol || defined __stub___strtol
-choke me
-#endif
-
-int
-main ()
-{
-return strtol ();
-  ;
-  return 0;
-}
-_ACEOF
-rm -f conftest.$ac_objext conftest$ac_exeext
-if { (ac_try="$ac_link"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_link") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest$ac_exeext && {
-	 test "$cross_compiling" = yes ||
-	 $as_test_x conftest$ac_exeext
-       }; then
-  ac_cv_func_strtol=yes
-else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-	ac_cv_func_strtol=no
-fi
+	ac_fn_c_check_func "$LINENO" "strtol" "ac_cv_func_strtol"
+if test "x$ac_cv_func_strtol" = x""yes; then :
 
-rm -rf conftest.dSYM
-rm -f core conftest.err conftest.$ac_objext conftest_ipa8_conftest.oo \
-      conftest$ac_exeext conftest.$ac_ext
 fi
-{ $as_echo "$as_me:$LINENO: result: $ac_cv_func_strtol" >&5
-$as_echo "$ac_cv_func_strtol" >&6; }
 
 fi
 
-{ $as_echo "$as_me:$LINENO: checking for __int64_t" >&5
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for __int64_t" >&5
 $as_echo_n "checking for __int64_t... " >&6; }
-if test "${nsnam_cv_int64_t_HAVE___INT64_T+set}" = set; then
+if test "${nsnam_cv_int64_t_HAVE___INT64_T+set}" = set; then :
   $as_echo_n "(cached) " >&6
 else
 
-if test "$cross_compiling" = yes; then
+if test "$cross_compiling" = yes; then :
   nsnam_cv_int64_t_HAVE___INT64_T=cross
 else
-  cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
 
 main() { __int64_t x; exit (sizeof(x) >= 8 ? 0 : 1); }
 
 _ACEOF
-rm -f conftest$ac_exeext
-if { (ac_try="$ac_link"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_link") 2>&5
-  ac_status=$?
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && { ac_try='./conftest$ac_exeext'
-  { (case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_try") 2>&5
-  ac_status=$?
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); }; }; then
+if ac_fn_c_try_run "$LINENO"; then :
   nsnam_cv_int64_t_HAVE___INT64_T=yes
 else
-  $as_echo "$as_me: program exited with status $ac_status" >&5
-$as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-( exit $ac_status )
-nsnam_cv_int64_t_HAVE___INT64_T=no
+  nsnam_cv_int64_t_HAVE___INT64_T=no
 fi
-rm -rf conftest.dSYM
-rm -f core *.core core.conftest.* gmon.out bb.out conftest$ac_exeext conftest.$ac_objext conftest.$ac_ext
+rm -f core *.core core.conftest.* gmon.out bb.out conftest$ac_exeext \
+  conftest.$ac_objext conftest.beam conftest.$ac_ext
 fi
 
-
 fi
-{ $as_echo "$as_me:$LINENO: result: $nsnam_cv_int64_t_HAVE___INT64_T" >&5
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $nsnam_cv_int64_t_HAVE___INT64_T" >&5
 $as_echo "$nsnam_cv_int64_t_HAVE___INT64_T" >&6; }
 if test x"$nsnam_cv_int64_t_HAVE___INT64_T" = x"yes" -a "x$INT64_T_ALTERNATIVE" = xnone; then
 	INT64_T_ALTERNATIVE=__int64_t
 fi
 
-{ $as_echo "$as_me:$LINENO: checking for long long" >&5
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for long long" >&5
 $as_echo_n "checking for long long... " >&6; }
-if test "${nsnam_cv_int64_t_HAVE_LONG_LONG+set}" = set; then
+if test "${nsnam_cv_int64_t_HAVE_LONG_LONG+set}" = set; then :
   $as_echo_n "(cached) " >&6
 else
 
-if test "$cross_compiling" = yes; then
+if test "$cross_compiling" = yes; then :
   nsnam_cv_int64_t_HAVE_LONG_LONG=cross
 else
-  cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
 
 main() { long long x; exit (sizeof(x) >= 8 ? 0 : 1); }
 
 _ACEOF
-rm -f conftest$ac_exeext
-if { (ac_try="$ac_link"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_link") 2>&5
-  ac_status=$?
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && { ac_try='./conftest$ac_exeext'
-  { (case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_try") 2>&5
-  ac_status=$?
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); }; }; then
+if ac_fn_c_try_run "$LINENO"; then :
   nsnam_cv_int64_t_HAVE_LONG_LONG=yes
 else
-  $as_echo "$as_me: program exited with status $ac_status" >&5
-$as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-( exit $ac_status )
-nsnam_cv_int64_t_HAVE_LONG_LONG=no
+  nsnam_cv_int64_t_HAVE_LONG_LONG=no
 fi
-rm -rf conftest.dSYM
-rm -f core *.core core.conftest.* gmon.out bb.out conftest$ac_exeext conftest.$ac_objext conftest.$ac_ext
+rm -f core *.core core.conftest.* gmon.out bb.out conftest$ac_exeext \
+  conftest.$ac_objext conftest.beam conftest.$ac_ext
 fi
 
-
 fi
-{ $as_echo "$as_me:$LINENO: result: $nsnam_cv_int64_t_HAVE_LONG_LONG" >&5
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $nsnam_cv_int64_t_HAVE_LONG_LONG" >&5
 $as_echo "$nsnam_cv_int64_t_HAVE_LONG_LONG" >&6; }
 if test x"$nsnam_cv_int64_t_HAVE_LONG_LONG" = x"yes" -a "x$INT64_T_ALTERNATIVE" = xnone; then
 	INT64_T_ALTERNATIVE="long long"
@@ -10822,16 +8364,12 @@
 
 
 
-{ $as_echo "$as_me:$LINENO: checking for int64_t" >&5
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for int64_t" >&5
 $as_echo_n "checking for int64_t... " >&6; }
-if test "${ac_cv_type_int64_t+set}" = set; then
+if test "${ac_cv_type_int64_t+set}" = set; then :
   $as_echo_n "(cached) " >&6
 else
-  cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
 #include <sys/types.h>
 #if STDC_HEADERS
@@ -10840,7 +8378,7 @@
 #endif
 _ACEOF
 if (eval "$ac_cpp conftest.$ac_ext") 2>&5 |
-  $EGREP "(^|[^a-zA-Z_0-9])int64_t[^a-zA-Z_0-9]" >/dev/null 2>&1; then
+  $EGREP "(^|[^a-zA-Z_0-9])int64_t[^a-zA-Z_0-9]" >/dev/null 2>&1; then :
   ac_cv_type_int64_t=yes
 else
   ac_cv_type_int64_t=no
@@ -10848,7 +8386,7 @@
 rm -f conftest*
 
 fi
-{ $as_echo "$as_me:$LINENO: result: $ac_cv_type_int64_t" >&5
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_type_int64_t" >&5
 $as_echo "$ac_cv_type_int64_t" >&6; }
 if test $ac_cv_type_int64_t = no; then
 
@@ -10859,31 +8397,29 @@
 fi
 
 
-{ $as_echo "$as_me:$LINENO: checking which kind of 64-bit int to use" >&5
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking which kind of 64-bit int to use" >&5
 $as_echo_n "checking which kind of 64-bit int to use... " >&6; }
 if test $ac_cv_type_int64_t = yes -o "$INT64_T_ALTERNATIVE" != none
 then
 	if test "$INT64_T_ALTERNATIVE" = long -o "$ac_cv_func_strtoq" = yes -o "$ac_cv_func_strtoll" = yes
 	then
 
-cat >>confdefs.h <<\_ACEOF
-#define HAVE_INT64 1
-_ACEOF
+$as_echo "#define HAVE_INT64 1" >>confdefs.h
 
 		if test $ac_cv_type_int64_t = yes
 		then
-			{ $as_echo "$as_me:$LINENO: result: int64_t" >&5
+			{ $as_echo "$as_me:${as_lineno-$LINENO}: result: int64_t" >&5
 $as_echo "int64_t" >&6; }
 		else
-			{ $as_echo "$as_me:$LINENO: result: $INT64_T_ALTERNATIVE" >&5
+			{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $INT64_T_ALTERNATIVE" >&5
 $as_echo "$INT64_T_ALTERNATIVE" >&6; }
 		fi
 	else
-		{ $as_echo "$as_me:$LINENO: result: missing strto 64-bit-type" >&5
+		{ $as_echo "$as_me:${as_lineno-$LINENO}: result: missing strto 64-bit-type" >&5
 $as_echo "missing strto 64-bit-type" >&6; }
 	fi
 else
-	{ $as_echo "$as_me:$LINENO: result: none" >&5
+	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: none" >&5
 $as_echo "none" >&6; }
 fi
 
@@ -10933,7 +8469,7 @@
 
 
 # Check whether --enable-shlib was given.
-if test "${enable_shlib+set}" = set; then
+if test "${enable_shlib+set}" = set; then :
   enableval=$enable_shlib;
 else
   enable_shlib="no"
@@ -10945,14 +8481,14 @@
 # for the system.  This can usually be done via the "uname" command, but
 # there are a few systems, like Next, where this doesn't work.
 
-{ $as_echo "$as_me:$LINENO: checking system version (for dynamic loading)" >&5
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking system version (for dynamic loading)" >&5
 $as_echo_n "checking system version (for dynamic loading)... " >&6; }
 if test -f /usr/lib/NextStep/software_version; then
     system=NEXTSTEP-`awk '/3/,/3/' /usr/lib/NextStep/software_version`
 else
     system=`uname -s`-`uname -r`
     if test "$?" -ne 0 ; then
-	{ $as_echo "$as_me:$LINENO: result: unknown (can't find uname command)" >&5
+	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: unknown (can't find uname command)" >&5
 $as_echo "unknown (can't find uname command)" >&6; }
 	system=unknown
     else
@@ -10965,7 +8501,7 @@
 	if test "`uname -s`" = "AIX" ; then
 	    system=AIX-`uname -v`.`uname -r`
 	fi
-	{ $as_echo "$as_me:$LINENO: result: $system" >&5
+	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $system" >&5
 $as_echo "$system" >&6; }
     fi
 fi
@@ -10973,18 +8509,14 @@
 # Step 2: check for existence of -ldl library.  This is needed because
 # Linux can use either -ldl or -ldld for dynamic loading.
 
-{ $as_echo "$as_me:$LINENO: checking for dlopen in -ldl" >&5
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for dlopen in -ldl" >&5
 $as_echo_n "checking for dlopen in -ldl... " >&6; }
-if test "${ac_cv_lib_dl_dlopen+set}" = set; then
+if test "${ac_cv_lib_dl_dlopen+set}" = set; then :
   $as_echo_n "(cached) " >&6
 else
   ac_check_lib_save_LIBS=$LIBS
 LIBS="-ldl  $LIBS"
-cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
 
 /* Override any GCC internal prototype to avoid an error.
@@ -11002,43 +8534,18 @@
   return 0;
 }
 _ACEOF
-rm -f conftest.$ac_objext conftest$ac_exeext
-if { (ac_try="$ac_link"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_link") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest$ac_exeext && {
-	 test "$cross_compiling" = yes ||
-	 $as_test_x conftest$ac_exeext
-       }; then
+if ac_fn_c_try_link "$LINENO"; then :
   ac_cv_lib_dl_dlopen=yes
 else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-	ac_cv_lib_dl_dlopen=no
+  ac_cv_lib_dl_dlopen=no
 fi
-
-rm -rf conftest.dSYM
-rm -f core conftest.err conftest.$ac_objext conftest_ipa8_conftest.oo \
-      conftest$ac_exeext conftest.$ac_ext
+rm -f core conftest.err conftest.$ac_objext \
+    conftest$ac_exeext conftest.$ac_ext
 LIBS=$ac_check_lib_save_LIBS
 fi
-{ $as_echo "$as_me:$LINENO: result: $ac_cv_lib_dl_dlopen" >&5
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_lib_dl_dlopen" >&5
 $as_echo "$ac_cv_lib_dl_dlopen" >&6; }
-if test "x$ac_cv_lib_dl_dlopen" = x""yes; then
+if test "x$ac_cv_lib_dl_dlopen" = x""yes; then :
   have_dl=yes
 else
   have_dl=no
@@ -11080,18 +8587,14 @@
 	DL_LD_SEARCH_FLAGS=""
 	;;
     HP-UX-*.08.*|HP-UX-*.09.*|HP-UX-*.10.*)
-	{ $as_echo "$as_me:$LINENO: checking for shl_load in -ldld" >&5
+	{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for shl_load in -ldld" >&5
 $as_echo_n "checking for shl_load in -ldld... " >&6; }
-if test "${ac_cv_lib_dld_shl_load+set}" = set; then
+if test "${ac_cv_lib_dld_shl_load+set}" = set; then :
   $as_echo_n "(cached) " >&6
 else
   ac_check_lib_save_LIBS=$LIBS
 LIBS="-ldld  $LIBS"
-cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
 
 /* Override any GCC internal prototype to avoid an error.
@@ -11109,43 +8612,18 @@
   return 0;
 }
 _ACEOF
-rm -f conftest.$ac_objext conftest$ac_exeext
-if { (ac_try="$ac_link"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_link") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest$ac_exeext && {
-	 test "$cross_compiling" = yes ||
-	 $as_test_x conftest$ac_exeext
-       }; then
+if ac_fn_c_try_link "$LINENO"; then :
   ac_cv_lib_dld_shl_load=yes
 else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-	ac_cv_lib_dld_shl_load=no
+  ac_cv_lib_dld_shl_load=no
 fi
-
-rm -rf conftest.dSYM
-rm -f core conftest.err conftest.$ac_objext conftest_ipa8_conftest.oo \
-      conftest$ac_exeext conftest.$ac_ext
+rm -f core conftest.err conftest.$ac_objext \
+    conftest$ac_exeext conftest.$ac_ext
 LIBS=$ac_check_lib_save_LIBS
 fi
-{ $as_echo "$as_me:$LINENO: result: $ac_cv_lib_dld_shl_load" >&5
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_lib_dld_shl_load" >&5
 $as_echo "$ac_cv_lib_dld_shl_load" >&6; }
-if test "x$ac_cv_lib_dld_shl_load" = x""yes; then
+if test "x$ac_cv_lib_dld_shl_load" = x""yes; then :
   dl_ok=yes
 else
   dl_ok=no
@@ -11189,144 +8667,18 @@
 	DL_LD_SEARCH_FLAGS='-Wl,-rpath,${SHLIB_RUNTIME_DIR}'
 	;;
     Linux*)
-	SHLIB_CFLAGS="-fPIC"
-	SHLIB_LD_LIBS=""
-	SHLIB_SUFFIX=".so"
-	LDFLAGS="$LDFLAGS -Wl,-export-dynamic"
-	if test "$have_dl" = yes; then
-	    SHLIB_LD="${CC} -shared"
-	    DL_LIBS="-ldl"
-	    DL_LD_FLAGS="-rdynamic"
-	    DL_LD_SEARCH_FLAGS=""
-	else
-	    if test "${ac_cv_header_dld_h+set}" = set; then
-  { $as_echo "$as_me:$LINENO: checking for dld.h" >&5
-$as_echo_n "checking for dld.h... " >&6; }
-if test "${ac_cv_header_dld_h+set}" = set; then
-  $as_echo_n "(cached) " >&6
-fi
-{ $as_echo "$as_me:$LINENO: result: $ac_cv_header_dld_h" >&5
-$as_echo "$ac_cv_header_dld_h" >&6; }
-else
-  # Is the header compilable?
-{ $as_echo "$as_me:$LINENO: checking dld.h usability" >&5
-$as_echo_n "checking dld.h usability... " >&6; }
-cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
-/* end confdefs.h.  */
-$ac_includes_default
-#include <dld.h>
-_ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
-  ac_header_compiler=yes
-else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-	ac_header_compiler=no
-fi
-
-rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
-{ $as_echo "$as_me:$LINENO: result: $ac_header_compiler" >&5
-$as_echo "$ac_header_compiler" >&6; }
-
-# Is the header present?
-{ $as_echo "$as_me:$LINENO: checking dld.h presence" >&5
-$as_echo_n "checking dld.h presence... " >&6; }
-cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
-/* end confdefs.h.  */
-#include <dld.h>
-_ACEOF
-if { (ac_try="$ac_cpp conftest.$ac_ext"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_cpp conftest.$ac_ext") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } >/dev/null && {
-	 test -z "$ac_c_preproc_warn_flag$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       }; then
-  ac_header_preproc=yes
-else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-  ac_header_preproc=no
-fi
-
-rm -f conftest.err conftest.$ac_ext
-{ $as_echo "$as_me:$LINENO: result: $ac_header_preproc" >&5
-$as_echo "$ac_header_preproc" >&6; }
-
-# So?  What about this header?
-case $ac_header_compiler:$ac_header_preproc:$ac_c_preproc_warn_flag in
-  yes:no: )
-    { $as_echo "$as_me:$LINENO: WARNING: dld.h: accepted by the compiler, rejected by the preprocessor!" >&5
-$as_echo "$as_me: WARNING: dld.h: accepted by the compiler, rejected by the preprocessor!" >&2;}
-    { $as_echo "$as_me:$LINENO: WARNING: dld.h: proceeding with the compiler's result" >&5
-$as_echo "$as_me: WARNING: dld.h: proceeding with the compiler's result" >&2;}
-    ac_header_preproc=yes
-    ;;
-  no:yes:* )
-    { $as_echo "$as_me:$LINENO: WARNING: dld.h: present but cannot be compiled" >&5
-$as_echo "$as_me: WARNING: dld.h: present but cannot be compiled" >&2;}
-    { $as_echo "$as_me:$LINENO: WARNING: dld.h:     check for missing prerequisite headers?" >&5
-$as_echo "$as_me: WARNING: dld.h:     check for missing prerequisite headers?" >&2;}
-    { $as_echo "$as_me:$LINENO: WARNING: dld.h: see the Autoconf documentation" >&5
-$as_echo "$as_me: WARNING: dld.h: see the Autoconf documentation" >&2;}
-    { $as_echo "$as_me:$LINENO: WARNING: dld.h:     section \"Present But Cannot Be Compiled\"" >&5
-$as_echo "$as_me: WARNING: dld.h:     section \"Present But Cannot Be Compiled\"" >&2;}
-    { $as_echo "$as_me:$LINENO: WARNING: dld.h: proceeding with the preprocessor's result" >&5
-$as_echo "$as_me: WARNING: dld.h: proceeding with the preprocessor's result" >&2;}
-    { $as_echo "$as_me:$LINENO: WARNING: dld.h: in the future, the compiler will take precedence" >&5
-$as_echo "$as_me: WARNING: dld.h: in the future, the compiler will take precedence" >&2;}
-
-    ;;
-esac
-{ $as_echo "$as_me:$LINENO: checking for dld.h" >&5
-$as_echo_n "checking for dld.h... " >&6; }
-if test "${ac_cv_header_dld_h+set}" = set; then
-  $as_echo_n "(cached) " >&6
-else
-  ac_cv_header_dld_h=$ac_header_preproc
-fi
-{ $as_echo "$as_me:$LINENO: result: $ac_cv_header_dld_h" >&5
-$as_echo "$ac_cv_header_dld_h" >&6; }
-
-fi
-if test "x$ac_cv_header_dld_h" = x""yes; then
+	SHLIB_CFLAGS="-fPIC"
+	SHLIB_LD_LIBS=""
+	SHLIB_SUFFIX=".so"
+	LDFLAGS="$LDFLAGS -Wl,-export-dynamic"
+	if test "$have_dl" = yes; then
+	    SHLIB_LD="${CC} -shared"
+	    DL_LIBS="-ldl"
+	    DL_LD_FLAGS="-rdynamic"
+	    DL_LD_SEARCH_FLAGS=""
+	else
+	    ac_fn_c_check_header_mongrel "$LINENO" "dld.h" "ac_cv_header_dld_h" "$ac_includes_default"
+if test "x$ac_cv_header_dld_h" = x""yes; then :
 
 		SHLIB_LD="ld -shared"
 		DL_LIBS="-ldld"
@@ -11346,19 +8698,17 @@
 	DL_LIBS="-ldl"
 	DL_LD_FLAGS="-rdynamic"
 	DL_LD_SEARCH_FLAGS=""
-	{ $as_echo "$as_me:$LINENO: checking for import libraries" >&5
+	{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for import libraries" >&5
 $as_echo_n "checking for import libraries... " >&6; }
 	V_IMPORT_LIBS=`echo "$V_LIBS" | sed "s/-L//g" | sed "s/ \-l/\/lib/g" | sed "s/ /\.a /g" `
 	for libfile in $V_IMPORT_LIBS ; do
 	        if test ! -f "$libfile" ; then
-	                { $as_echo "$as_me:$LINENO: result: failed!" >&5
+	                { $as_echo "$as_me:${as_lineno-$LINENO}: result: failed!" >&5
 $as_echo "failed!" >&6; }
-	                { { $as_echo "$as_me:$LINENO: error: Could not find \"$libfile\"" >&5
-$as_echo "$as_me: error: Could not find \"$libfile\"" >&2;}
-   { (exit 1); exit 1; }; }
+	                as_fn_error "Could not find \"$libfile\"" "$LINENO" 5
 	        fi
 	done
-	        { $as_echo "$as_me:$LINENO: result: ok" >&5
+	        { $as_echo "$as_me:${as_lineno-$LINENO}: result: ok" >&5
 $as_echo "ok" >&6; }
 
 	;;
@@ -11382,134 +8732,8 @@
 	;;
     NetBSD-*|FreeBSD-*|OpenBSD-*)
 	# Not available on all versions:  check for include file.
-	if test "${ac_cv_header_dlfcn_h+set}" = set; then
-  { $as_echo "$as_me:$LINENO: checking for dlfcn.h" >&5
-$as_echo_n "checking for dlfcn.h... " >&6; }
-if test "${ac_cv_header_dlfcn_h+set}" = set; then
-  $as_echo_n "(cached) " >&6
-fi
-{ $as_echo "$as_me:$LINENO: result: $ac_cv_header_dlfcn_h" >&5
-$as_echo "$ac_cv_header_dlfcn_h" >&6; }
-else
-  # Is the header compilable?
-{ $as_echo "$as_me:$LINENO: checking dlfcn.h usability" >&5
-$as_echo_n "checking dlfcn.h usability... " >&6; }
-cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
-/* end confdefs.h.  */
-$ac_includes_default
-#include <dlfcn.h>
-_ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
-  ac_header_compiler=yes
-else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-	ac_header_compiler=no
-fi
-
-rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
-{ $as_echo "$as_me:$LINENO: result: $ac_header_compiler" >&5
-$as_echo "$ac_header_compiler" >&6; }
-
-# Is the header present?
-{ $as_echo "$as_me:$LINENO: checking dlfcn.h presence" >&5
-$as_echo_n "checking dlfcn.h presence... " >&6; }
-cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
-/* end confdefs.h.  */
-#include <dlfcn.h>
-_ACEOF
-if { (ac_try="$ac_cpp conftest.$ac_ext"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_cpp conftest.$ac_ext") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } >/dev/null && {
-	 test -z "$ac_c_preproc_warn_flag$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       }; then
-  ac_header_preproc=yes
-else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-  ac_header_preproc=no
-fi
-
-rm -f conftest.err conftest.$ac_ext
-{ $as_echo "$as_me:$LINENO: result: $ac_header_preproc" >&5
-$as_echo "$ac_header_preproc" >&6; }
-
-# So?  What about this header?
-case $ac_header_compiler:$ac_header_preproc:$ac_c_preproc_warn_flag in
-  yes:no: )
-    { $as_echo "$as_me:$LINENO: WARNING: dlfcn.h: accepted by the compiler, rejected by the preprocessor!" >&5
-$as_echo "$as_me: WARNING: dlfcn.h: accepted by the compiler, rejected by the preprocessor!" >&2;}
-    { $as_echo "$as_me:$LINENO: WARNING: dlfcn.h: proceeding with the compiler's result" >&5
-$as_echo "$as_me: WARNING: dlfcn.h: proceeding with the compiler's result" >&2;}
-    ac_header_preproc=yes
-    ;;
-  no:yes:* )
-    { $as_echo "$as_me:$LINENO: WARNING: dlfcn.h: present but cannot be compiled" >&5
-$as_echo "$as_me: WARNING: dlfcn.h: present but cannot be compiled" >&2;}
-    { $as_echo "$as_me:$LINENO: WARNING: dlfcn.h:     check for missing prerequisite headers?" >&5
-$as_echo "$as_me: WARNING: dlfcn.h:     check for missing prerequisite headers?" >&2;}
-    { $as_echo "$as_me:$LINENO: WARNING: dlfcn.h: see the Autoconf documentation" >&5
-$as_echo "$as_me: WARNING: dlfcn.h: see the Autoconf documentation" >&2;}
-    { $as_echo "$as_me:$LINENO: WARNING: dlfcn.h:     section \"Present But Cannot Be Compiled\"" >&5
-$as_echo "$as_me: WARNING: dlfcn.h:     section \"Present But Cannot Be Compiled\"" >&2;}
-    { $as_echo "$as_me:$LINENO: WARNING: dlfcn.h: proceeding with the preprocessor's result" >&5
-$as_echo "$as_me: WARNING: dlfcn.h: proceeding with the preprocessor's result" >&2;}
-    { $as_echo "$as_me:$LINENO: WARNING: dlfcn.h: in the future, the compiler will take precedence" >&5
-$as_echo "$as_me: WARNING: dlfcn.h: in the future, the compiler will take precedence" >&2;}
-
-    ;;
-esac
-{ $as_echo "$as_me:$LINENO: checking for dlfcn.h" >&5
-$as_echo_n "checking for dlfcn.h... " >&6; }
-if test "${ac_cv_header_dlfcn_h+set}" = set; then
-  $as_echo_n "(cached) " >&6
-else
-  ac_cv_header_dlfcn_h=$ac_header_preproc
-fi
-{ $as_echo "$as_me:$LINENO: result: $ac_cv_header_dlfcn_h" >&5
-$as_echo "$ac_cv_header_dlfcn_h" >&6; }
-
-fi
-if test "x$ac_cv_header_dlfcn_h" = x""yes; then
+	ac_fn_c_check_header_mongrel "$LINENO" "dlfcn.h" "ac_cv_header_dlfcn_h" "$ac_includes_default"
+if test "x$ac_cv_header_dlfcn_h" = x""yes; then :
 
 	    SHLIB_CFLAGS="-fpic"
 	    SHLIB_LD="ld -Bshareable -x"
@@ -11644,14 +8868,10 @@
 	# Some UNIX_SV* systems (unixware 1.1.2 for example) have linkers
 	# that don't grok the -Bexport option.  Test that it does.
 	hold_ldflags=$LDFLAGS
-	{ $as_echo "$as_me:$LINENO: checking for ld accepts -Bexport flag" >&5
+	{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for ld accepts -Bexport flag" >&5
 $as_echo_n "checking for ld accepts -Bexport flag... " >&6; }
 	LDFLAGS="${LDFLAGS} -Wl,-Bexport"
-	cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+	cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
 
 int
@@ -11662,40 +8882,15 @@
   return 0;
 }
 _ACEOF
-rm -f conftest.$ac_objext conftest$ac_exeext
-if { (ac_try="$ac_link"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_link") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest$ac_exeext && {
-	 test "$cross_compiling" = yes ||
-	 $as_test_x conftest$ac_exeext
-       }; then
+if ac_fn_c_try_link "$LINENO"; then :
   found=yes
 else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-	found=no
+  found=no
 fi
-
-rm -rf conftest.dSYM
-rm -f core conftest.err conftest.$ac_objext conftest_ipa8_conftest.oo \
-      conftest$ac_exeext conftest.$ac_ext
+rm -f core conftest.err conftest.$ac_objext \
+    conftest$ac_exeext conftest.$ac_ext
 	LDFLAGS=$hold_ldflags
-	{ $as_echo "$as_me:$LINENO: result: $found" >&5
+	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $found" >&5
 $as_echo "$found" >&6; }
 	if test $found = yes; then
 	  SH_LD_FLAGS="-Wl,-Bexport"
@@ -11764,146 +8959,18 @@
 
 
 
-if test "${ac_cv_header_dlfcn_h+set}" = set; then
-  { $as_echo "$as_me:$LINENO: checking for dlfcn.h" >&5
-$as_echo_n "checking for dlfcn.h... " >&6; }
-if test "${ac_cv_header_dlfcn_h+set}" = set; then
-  $as_echo_n "(cached) " >&6
-fi
-{ $as_echo "$as_me:$LINENO: result: $ac_cv_header_dlfcn_h" >&5
-$as_echo "$ac_cv_header_dlfcn_h" >&6; }
-else
-  # Is the header compilable?
-{ $as_echo "$as_me:$LINENO: checking dlfcn.h usability" >&5
-$as_echo_n "checking dlfcn.h usability... " >&6; }
-cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
-/* end confdefs.h.  */
-$ac_includes_default
-#include <dlfcn.h>
-_ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
-  ac_header_compiler=yes
-else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-	ac_header_compiler=no
-fi
-
-rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
-{ $as_echo "$as_me:$LINENO: result: $ac_header_compiler" >&5
-$as_echo "$ac_header_compiler" >&6; }
-
-# Is the header present?
-{ $as_echo "$as_me:$LINENO: checking dlfcn.h presence" >&5
-$as_echo_n "checking dlfcn.h presence... " >&6; }
-cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
-/* end confdefs.h.  */
-#include <dlfcn.h>
-_ACEOF
-if { (ac_try="$ac_cpp conftest.$ac_ext"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_cpp conftest.$ac_ext") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } >/dev/null && {
-	 test -z "$ac_c_preproc_warn_flag$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       }; then
-  ac_header_preproc=yes
-else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-  ac_header_preproc=no
-fi
-
-rm -f conftest.err conftest.$ac_ext
-{ $as_echo "$as_me:$LINENO: result: $ac_header_preproc" >&5
-$as_echo "$ac_header_preproc" >&6; }
-
-# So?  What about this header?
-case $ac_header_compiler:$ac_header_preproc:$ac_c_preproc_warn_flag in
-  yes:no: )
-    { $as_echo "$as_me:$LINENO: WARNING: dlfcn.h: accepted by the compiler, rejected by the preprocessor!" >&5
-$as_echo "$as_me: WARNING: dlfcn.h: accepted by the compiler, rejected by the preprocessor!" >&2;}
-    { $as_echo "$as_me:$LINENO: WARNING: dlfcn.h: proceeding with the compiler's result" >&5
-$as_echo "$as_me: WARNING: dlfcn.h: proceeding with the compiler's result" >&2;}
-    ac_header_preproc=yes
-    ;;
-  no:yes:* )
-    { $as_echo "$as_me:$LINENO: WARNING: dlfcn.h: present but cannot be compiled" >&5
-$as_echo "$as_me: WARNING: dlfcn.h: present but cannot be compiled" >&2;}
-    { $as_echo "$as_me:$LINENO: WARNING: dlfcn.h:     check for missing prerequisite headers?" >&5
-$as_echo "$as_me: WARNING: dlfcn.h:     check for missing prerequisite headers?" >&2;}
-    { $as_echo "$as_me:$LINENO: WARNING: dlfcn.h: see the Autoconf documentation" >&5
-$as_echo "$as_me: WARNING: dlfcn.h: see the Autoconf documentation" >&2;}
-    { $as_echo "$as_me:$LINENO: WARNING: dlfcn.h:     section \"Present But Cannot Be Compiled\"" >&5
-$as_echo "$as_me: WARNING: dlfcn.h:     section \"Present But Cannot Be Compiled\"" >&2;}
-    { $as_echo "$as_me:$LINENO: WARNING: dlfcn.h: proceeding with the preprocessor's result" >&5
-$as_echo "$as_me: WARNING: dlfcn.h: proceeding with the preprocessor's result" >&2;}
-    { $as_echo "$as_me:$LINENO: WARNING: dlfcn.h: in the future, the compiler will take precedence" >&5
-$as_echo "$as_me: WARNING: dlfcn.h: in the future, the compiler will take precedence" >&2;}
-
-    ;;
-esac
-{ $as_echo "$as_me:$LINENO: checking for dlfcn.h" >&5
-$as_echo_n "checking for dlfcn.h... " >&6; }
-if test "${ac_cv_header_dlfcn_h+set}" = set; then
-  $as_echo_n "(cached) " >&6
-else
-  ac_cv_header_dlfcn_h=$ac_header_preproc
-fi
-{ $as_echo "$as_me:$LINENO: result: $ac_cv_header_dlfcn_h" >&5
-$as_echo "$ac_cv_header_dlfcn_h" >&6; }
+ac_fn_c_check_header_mongrel "$LINENO" "dlfcn.h" "ac_cv_header_dlfcn_h" "$ac_includes_default"
+if test "x$ac_cv_header_dlfcn_h" = x""yes; then :
 
-fi
-if test "x$ac_cv_header_dlfcn_h" = x""yes; then
-  :
 else
-   { { $as_echo "$as_me:$LINENO: error: cannot find dlfcn.h" >&5
-$as_echo "$as_me: error: cannot find dlfcn.h" >&2;}
-   { (exit 1); exit 1; }; }
+   as_fn_error "cannot find dlfcn.h" "$LINENO" 5
 fi
 
 
-{ $as_echo "$as_me:$LINENO: checking for ns library name" >&5
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for ns library name" >&5
 $as_echo_n "checking for ns library name... " >&6; }
 NSLIB=libns${SHLIB_SUFFIX}
-{ $as_echo "$as_me:$LINENO: result: $NSLIB" >&5
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $NSLIB" >&5
 $as_echo "$NSLIB" >&6; }
 
 
@@ -11913,13 +8980,9 @@
 
 
 
-{ $as_echo "$as_me:$LINENO: checking for struct ether_header" >&5
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for struct ether_header" >&5
 $as_echo_n "checking for struct ether_header... " >&6; }
-cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
 
 #include <stdio.h>
@@ -11940,52 +9003,25 @@
   return 0;
 }
 _ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
+if ac_fn_c_try_compile "$LINENO"; then :
 
-cat >>confdefs.h <<\_ACEOF
-#define HAVE_ETHER_HEADER_STRUCT 1
-_ACEOF
+$as_echo "#define HAVE_ETHER_HEADER_STRUCT 1" >>confdefs.h
 
-{ $as_echo "$as_me:$LINENO: result: found" >&5
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: found" >&5
 $as_echo "found" >&6; }
 
 else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
 
-
-{ $as_echo "$as_me:$LINENO: result: not found" >&5
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: not found" >&5
 $as_echo "not found" >&6; }
 
 fi
-
 rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
 
 
-{ $as_echo "$as_me:$LINENO: checking for struct ether_addr" >&5
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for struct ether_addr" >&5
 $as_echo_n "checking for struct ether_addr... " >&6; }
-cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
 
 #include <stdio.h>
@@ -12006,156 +9042,39 @@
   return 0;
 }
 _ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
+if ac_fn_c_try_compile "$LINENO"; then :
 
-cat >>confdefs.h <<\_ACEOF
-#define HAVE_ETHER_ADDRESS_STRUCT 1
-_ACEOF
+$as_echo "#define HAVE_ETHER_ADDRESS_STRUCT 1" >>confdefs.h
 
-{ $as_echo "$as_me:$LINENO: result: found" >&5
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: found" >&5
 $as_echo "found" >&6; }
 
 else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
 
-{ $as_echo "$as_me:$LINENO: result: not found" >&5
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: not found" >&5
 $as_echo "not found" >&6; }
 
 fi
-
 rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
 
 cross_compiling=no
-
 for ac_func in addr2ascii
-do
-as_ac_var=`$as_echo "ac_cv_func_$ac_func" | $as_tr_sh`
-{ $as_echo "$as_me:$LINENO: checking for $ac_func" >&5
-$as_echo_n "checking for $ac_func... " >&6; }
-if { as_var=$as_ac_var; eval "test \"\${$as_var+set}\" = set"; }; then
-  $as_echo_n "(cached) " >&6
-else
-  cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
-/* end confdefs.h.  */
-/* Define $ac_func to an innocuous variant, in case <limits.h> declares $ac_func.
-   For example, HP-UX 11i <limits.h> declares gettimeofday.  */
-#define $ac_func innocuous_$ac_func
-
-/* System header to define __stub macros and hopefully few prototypes,
-    which can conflict with char $ac_func (); below.
-    Prefer <limits.h> to <assert.h> if __STDC__ is defined, since
-    <limits.h> exists even on freestanding compilers.  */
-
-#ifdef __STDC__
-# include <limits.h>
-#else
-# include <assert.h>
-#endif
-
-#undef $ac_func
-
-/* Override any GCC internal prototype to avoid an error.
-   Use char because int might match the return type of a GCC
-   builtin and then its argument prototype would still apply.  */
-#ifdef __cplusplus
-extern "C"
-#endif
-char $ac_func ();
-/* The GNU C library defines this for functions which it implements
-    to always fail with ENOSYS.  Some functions are actually named
-    something starting with __ and the normal name is an alias.  */
-#if defined __stub_$ac_func || defined __stub___$ac_func
-choke me
-#endif
-
-int
-main ()
-{
-return $ac_func ();
-  ;
-  return 0;
-}
-_ACEOF
-rm -f conftest.$ac_objext conftest$ac_exeext
-if { (ac_try="$ac_link"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_link") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest$ac_exeext && {
-	 test "$cross_compiling" = yes ||
-	 $as_test_x conftest$ac_exeext
-       }; then
-  eval "$as_ac_var=yes"
-else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-	eval "$as_ac_var=no"
-fi
-
-rm -rf conftest.dSYM
-rm -f core conftest.err conftest.$ac_objext conftest_ipa8_conftest.oo \
-      conftest$ac_exeext conftest.$ac_ext
-fi
-ac_res=`eval 'as_val=${'$as_ac_var'}
-		 $as_echo "$as_val"'`
-	       { $as_echo "$as_me:$LINENO: result: $ac_res" >&5
-$as_echo "$ac_res" >&6; }
-as_val=`eval 'as_val=${'$as_ac_var'}
-		 $as_echo "$as_val"'`
-   if test "x$as_val" = x""yes; then
+do :
+  ac_fn_c_check_func "$LINENO" "addr2ascii" "ac_cv_func_addr2ascii"
+if test "x$ac_cv_func_addr2ascii" = x""yes; then :
   cat >>confdefs.h <<_ACEOF
-#define `$as_echo "HAVE_$ac_func" | $as_tr_cpp` 1
+#define HAVE_ADDR2ASCII 1
 _ACEOF
 
 fi
 done
 
 
-if test "$cross_compiling" = yes; then
+if test "$cross_compiling" = yes; then :
   echo 1
 
 else
-  cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
 #include <stdio.h>
 #include <sys/ioctl.h>
@@ -12166,54 +9085,21 @@
 }
 
 _ACEOF
-rm -f conftest$ac_exeext
-if { (ac_try="$ac_link"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_link") 2>&5
-  ac_status=$?
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && { ac_try='./conftest$ac_exeext'
-  { (case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_try") 2>&5
-  ac_status=$?
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); }; }; then
-  cat >>confdefs.h <<\_ACEOF
-#define HAVE_SIOCGIFHWADDR 1
-_ACEOF
-
-else
-  $as_echo "$as_me: program exited with status $ac_status" >&5
-$as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
+if ac_fn_c_try_run "$LINENO"; then :
+  $as_echo "#define HAVE_SIOCGIFHWADDR 1" >>confdefs.h
 
 fi
-rm -rf conftest.dSYM
-rm -f core *.core core.conftest.* gmon.out bb.out conftest$ac_exeext conftest.$ac_objext conftest.$ac_ext
+rm -f core *.core core.conftest.* gmon.out bb.out conftest$ac_exeext \
+  conftest.$ac_objext conftest.beam conftest.$ac_ext
 fi
 
 
-
 tcphdr=no
 pcap=no
 
-{ $as_echo "$as_me:$LINENO: checking for Linux compliant tcphdr" >&5
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for Linux compliant tcphdr" >&5
 $as_echo_n "checking for Linux compliant tcphdr... " >&6; }
-cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
 
 #include <stdio.h>
@@ -12229,55 +9115,30 @@
 	tcp->source= 1;
 
 	return 0;
-}
-
-  ;
-  return 0;
-}
-_ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
+}
+
+  ;
+  return 0;
+}
+_ACEOF
+if ac_fn_c_try_compile "$LINENO"; then :
 
 V_DEFINE="$V_DEFINE -DLINUX_TCP_HEADER"
-{ $as_echo "$as_me:$LINENO: result: found" >&5
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: found" >&5
 $as_echo "found" >&6; }
 tcphdr=yes
 
 else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
 
-
-{ $as_echo "$as_me:$LINENO: result: not found" >&5
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: not found" >&5
 $as_echo "not found" >&6; }
 
 fi
-
 rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
 
-{ $as_echo "$as_me:$LINENO: checking for BSD compliant tcphdr" >&5
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for BSD compliant tcphdr" >&5
 $as_echo_n "checking for BSD compliant tcphdr... " >&6; }
-cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
 
 #include <stdio.h>
@@ -12299,52 +9160,27 @@
   return 0;
 }
 _ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
+if ac_fn_c_try_compile "$LINENO"; then :
 
-{ $as_echo "$as_me:$LINENO: result: found" >&5
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: found" >&5
 $as_echo "found" >&6; }
 tcphdr=yes
 
 else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
 
-
-{ $as_echo "$as_me:$LINENO: result: not found" >&5
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: not found" >&5
 $as_echo "not found" >&6; }
 
 fi
-
 rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
 
-{ $as_echo "$as_me:$LINENO: checking for socklen_t" >&5
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for socklen_t" >&5
 $as_echo_n "checking for socklen_t... " >&6; }
-if test "${ac_cv_type_socklen_t+set}" = set; then
+if test "${ac_cv_type_socklen_t+set}" = set; then :
   $as_echo_n "(cached) " >&6
 else
 
-  cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
 #include <sys/types.h>
    #include <sys/socket.h>
@@ -12356,60 +9192,33 @@
   return 0;
 }
 _ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
+if ac_fn_c_try_compile "$LINENO"; then :
   ac_cv_type_socklen_t=yes
 else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-	ac_cv_type_socklen_t=no
+  ac_cv_type_socklen_t=no
 fi
-
 rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
 
 fi
-{ $as_echo "$as_me:$LINENO: result: $ac_cv_type_socklen_t" >&5
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_type_socklen_t" >&5
 $as_echo "$ac_cv_type_socklen_t" >&6; }
 
 if test x"$ac_cv_type_socklen_t" = xyes; then
-    cat >>confdefs.h <<\_ACEOF
-#define HAVE_SOCKLEN_T 1
-_ACEOF
+    $as_echo "#define HAVE_SOCKLEN_T 1" >>confdefs.h
 
 fi
 
 
 
 
-{ $as_echo "$as_me:$LINENO: checking for main in -lpcap" >&5
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for main in -lpcap" >&5
 $as_echo_n "checking for main in -lpcap... " >&6; }
-if test "${ac_cv_lib_pcap_main+set}" = set; then
+if test "${ac_cv_lib_pcap_main+set}" = set; then :
   $as_echo_n "(cached) " >&6
 else
   ac_check_lib_save_LIBS=$LIBS
 LIBS="-lpcap  $LIBS"
-cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
 
 
@@ -12421,58 +9230,33 @@
   return 0;
 }
 _ACEOF
-rm -f conftest.$ac_objext conftest$ac_exeext
-if { (ac_try="$ac_link"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_link") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest$ac_exeext && {
-	 test "$cross_compiling" = yes ||
-	 $as_test_x conftest$ac_exeext
-       }; then
+if ac_fn_c_try_link "$LINENO"; then :
   ac_cv_lib_pcap_main=yes
 else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-	ac_cv_lib_pcap_main=no
+  ac_cv_lib_pcap_main=no
 fi
-
-rm -rf conftest.dSYM
-rm -f core conftest.err conftest.$ac_objext conftest_ipa8_conftest.oo \
-      conftest$ac_exeext conftest.$ac_ext
+rm -f core conftest.err conftest.$ac_objext \
+    conftest$ac_exeext conftest.$ac_ext
 LIBS=$ac_check_lib_save_LIBS
 fi
-{ $as_echo "$as_me:$LINENO: result: $ac_cv_lib_pcap_main" >&5
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_lib_pcap_main" >&5
 $as_echo "$ac_cv_lib_pcap_main" >&6; }
-if test "x$ac_cv_lib_pcap_main" = x""yes; then
+if test "x$ac_cv_lib_pcap_main" = x""yes; then :
   V_LIB="$V_LIB -lpcap" pcap=yes
 fi
 
 V_INCLUDES="$V_INCLUDES -I/usr/include/pcap"
 
 
-{ $as_echo "$as_me:$LINENO: checking to make nse" >&5
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking to make nse" >&5
 $as_echo_n "checking to make nse... " >&6; }
 if test $tcphdr = yes && test $pcap = yes; then
 		build_nse="nse"
-		{ $as_echo "$as_me:$LINENO: result: yes" >&5
+		{ $as_echo "$as_me:${as_lineno-$LINENO}: result: yes" >&5
 $as_echo "yes" >&6; }
 
 else
-	{ $as_echo "$as_me:$LINENO: result: no" >&5
+	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
 $as_echo "no" >&6; }
 fi
 
@@ -12520,18 +9304,14 @@
 		V_LIB_DL="dld"
 		;;
 	*-*-linux*)
-		{ $as_echo "$as_me:$LINENO: checking for dlopen in -ldl" >&5
+		{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for dlopen in -ldl" >&5
 $as_echo_n "checking for dlopen in -ldl... " >&6; }
-if test "${ac_cv_lib_dl_dlopen+set}" = set; then
+if test "${ac_cv_lib_dl_dlopen+set}" = set; then :
   $as_echo_n "(cached) " >&6
 else
   ac_check_lib_save_LIBS=$LIBS
 LIBS="-ldl  $LIBS"
-cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
 
 /* Override any GCC internal prototype to avoid an error.
@@ -12549,43 +9329,18 @@
   return 0;
 }
 _ACEOF
-rm -f conftest.$ac_objext conftest$ac_exeext
-if { (ac_try="$ac_link"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_link") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest$ac_exeext && {
-	 test "$cross_compiling" = yes ||
-	 $as_test_x conftest$ac_exeext
-       }; then
+if ac_fn_c_try_link "$LINENO"; then :
   ac_cv_lib_dl_dlopen=yes
 else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-	ac_cv_lib_dl_dlopen=no
+  ac_cv_lib_dl_dlopen=no
 fi
-
-rm -rf conftest.dSYM
-rm -f core conftest.err conftest.$ac_objext conftest_ipa8_conftest.oo \
-      conftest$ac_exeext conftest.$ac_ext
+rm -f core conftest.err conftest.$ac_objext \
+    conftest$ac_exeext conftest.$ac_ext
 LIBS=$ac_check_lib_save_LIBS
 fi
-{ $as_echo "$as_me:$LINENO: result: $ac_cv_lib_dl_dlopen" >&5
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_lib_dl_dlopen" >&5
 $as_echo "$ac_cv_lib_dl_dlopen" >&6; }
-if test "x$ac_cv_lib_dl_dlopen" = x""yes; then
+if test "x$ac_cv_lib_dl_dlopen" = x""yes; then :
   V_LIB_DL="dl"
 else
   V_LIB_DL="dld"
@@ -12601,20 +9356,15 @@
 		*-*-linux*)
 			;;
 		*)
-
-as_ac_Lib=`$as_echo "ac_cv_lib_$V_LIB_DL''_main" | $as_tr_sh`
-{ $as_echo "$as_me:$LINENO: checking for main in -l$V_LIB_DL" >&5
+			as_ac_Lib=`$as_echo "ac_cv_lib_$V_LIB_DL''_main" | $as_tr_sh`
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for main in -l$V_LIB_DL" >&5
 $as_echo_n "checking for main in -l$V_LIB_DL... " >&6; }
-if { as_var=$as_ac_Lib; eval "test \"\${$as_var+set}\" = set"; }; then
+if { as_var=$as_ac_Lib; eval "test \"\${$as_var+set}\" = set"; }; then :
   $as_echo_n "(cached) " >&6
 else
   ac_check_lib_save_LIBS=$LIBS
 LIBS="-l$V_LIB_DL $V_STATIC $LIBS"
-cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
 
 
@@ -12626,47 +9376,20 @@
   return 0;
 }
 _ACEOF
-rm -f conftest.$ac_objext conftest$ac_exeext
-if { (ac_try="$ac_link"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_link") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest$ac_exeext && {
-	 test "$cross_compiling" = yes ||
-	 $as_test_x conftest$ac_exeext
-       }; then
+if ac_fn_c_try_link "$LINENO"; then :
   eval "$as_ac_Lib=yes"
 else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-	eval "$as_ac_Lib=no"
+  eval "$as_ac_Lib=no"
 fi
-
-rm -rf conftest.dSYM
-rm -f core conftest.err conftest.$ac_objext conftest_ipa8_conftest.oo \
-      conftest$ac_exeext conftest.$ac_ext
+rm -f core conftest.err conftest.$ac_objext \
+    conftest$ac_exeext conftest.$ac_ext
 LIBS=$ac_check_lib_save_LIBS
 fi
-ac_res=`eval 'as_val=${'$as_ac_Lib'}
-		 $as_echo "$as_val"'`
-	       { $as_echo "$as_me:$LINENO: result: $ac_res" >&5
+eval ac_res=\$$as_ac_Lib
+	       { $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_res" >&5
 $as_echo "$ac_res" >&6; }
-as_val=`eval 'as_val=${'$as_ac_Lib'}
-		 $as_echo "$as_val"'`
-   if test "x$as_val" = x""yes; then
+eval as_val=\$$as_ac_Lib
+   if test "x$as_val" = x""yes; then :
   cat >>confdefs.h <<_ACEOF
 #define `$as_echo "HAVE_LIB$V_LIB_DL" | $as_tr_cpp` 1
 _ACEOF
@@ -12784,10 +9507,10 @@
 # OS/2's system install, which has a completely different semantic
 # ./install, which can be erroneously created by make from ./install.sh.
 # Reject install programs that cannot install multiple files.
-{ $as_echo "$as_me:$LINENO: checking for a BSD-compatible install" >&5
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for a BSD-compatible install" >&5
 $as_echo_n "checking for a BSD-compatible install... " >&6; }
 if test -z "$INSTALL"; then
-if test "${ac_cv_path_install+set}" = set; then
+if test "${ac_cv_path_install+set}" = set; then :
   $as_echo_n "(cached) " >&6
 else
   as_save_IFS=$IFS; IFS=$PATH_SEPARATOR
@@ -12795,11 +9518,11 @@
 do
   IFS=$as_save_IFS
   test -z "$as_dir" && as_dir=.
-  # Account for people who put trailing slashes in PATH elements.
-case $as_dir/ in
-  ./ | .// | /cC/* | \
+    # Account for people who put trailing slashes in PATH elements.
+case $as_dir/ in #((
+  ./ | .// | /[cC]/* | \
   /etc/* | /usr/sbin/* | /usr/etc/* | /sbin/* | /usr/afsws/bin/* | \
-  ?:\\/os2\\/install\\/* | ?:\\/OS2\\/INSTALL\\/* | \
+  ?:[\\/]os2[\\/]install[\\/]* | ?:[\\/]OS2[\\/]INSTALL[\\/]* | \
   /usr/ucb/* ) ;;
   *)
     # OSF1 and SCO ODT 3.0 have their own names for install.
@@ -12836,7 +9559,7 @@
     ;;
 esac
 
-done
+  done
 IFS=$as_save_IFS
 
 rm -rf conftest.one conftest.two conftest.dir
@@ -12852,7 +9575,7 @@
     INSTALL=$ac_install_sh
   fi
 fi
-{ $as_echo "$as_me:$LINENO: result: $INSTALL" >&5
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $INSTALL" >&5
 $as_echo "$INSTALL" >&6; }
 
 # Use test -z because SunOS4 sh mishandles braces in ${var-val}.
@@ -12894,13 +9617,13 @@
     case $ac_val in #(
     *${as_nl}*)
       case $ac_var in #(
-      *_cv_*) { $as_echo "$as_me:$LINENO: WARNING: cache variable $ac_var contains a newline" >&5
+      *_cv_*) { $as_echo "$as_me:${as_lineno-$LINENO}: WARNING: cache variable $ac_var contains a newline" >&5
 $as_echo "$as_me: WARNING: cache variable $ac_var contains a newline" >&2;} ;;
       esac
       case $ac_var in #(
       _ | IFS | as_nl) ;; #(
       BASH_ARGV | BASH_SOURCE) eval $ac_var= ;; #(
-      *) $as_unset $ac_var ;;
+      *) { eval $ac_var=; unset $ac_var;} ;;
       esac ;;
     esac
   done
@@ -12908,8 +9631,8 @@
   (set) 2>&1 |
     case $as_nl`(ac_space=' '; set) 2>&1` in #(
     *${as_nl}ac_space=\ *)
-      # `set' does not quote correctly, so add quotes (double-quote
-      # substitution turns \\\\ into \\, and sed turns \\ into \).
+      # `set' does not quote correctly, so add quotes: double-quote
+      # substitution turns \\\\ into \\, and sed turns \\ into \.
       sed -n \
 	"s/'/'\\\\''/g;
 	  s/^\\([_$as_cr_alnum]*_cv_[_$as_cr_alnum]*\\)=\\(.*\\)/\\1='\\2'/p"
@@ -12932,11 +9655,11 @@
 if diff "$cache_file" confcache >/dev/null 2>&1; then :; else
   if test -w "$cache_file"; then
     test "x$cache_file" != "x/dev/null" &&
-      { $as_echo "$as_me:$LINENO: updating cache $cache_file" >&5
+      { $as_echo "$as_me:${as_lineno-$LINENO}: updating cache $cache_file" >&5
 $as_echo "$as_me: updating cache $cache_file" >&6;}
     cat confcache >$cache_file
   else
-    { $as_echo "$as_me:$LINENO: not updating unwritable cache $cache_file" >&5
+    { $as_echo "$as_me:${as_lineno-$LINENO}: not updating unwritable cache $cache_file" >&5
 $as_echo "$as_me: not updating unwritable cache $cache_file" >&6;}
   fi
 fi
@@ -12956,8 +9679,8 @@
   ac_i=`$as_echo "$ac_i" | sed "$ac_script"`
   # 2. Prepend LIBOBJDIR.  When used with automake>=1.10 LIBOBJDIR
   #    will be set to the directory where LIBOBJS objects are built.
-  ac_libobjs="$ac_libobjs \${LIBOBJDIR}$ac_i\$U.$ac_objext"
-  ac_ltlibobjs="$ac_ltlibobjs \${LIBOBJDIR}$ac_i"'$U.lo'
+  as_fn_append ac_libobjs " \${LIBOBJDIR}$ac_i\$U.$ac_objext"
+  as_fn_append ac_ltlibobjs " \${LIBOBJDIR}$ac_i"'$U.lo'
 done
 LIBOBJS=$ac_libobjs
 
@@ -12969,9 +9692,10 @@
 ac_write_fail=0
 ac_clean_files_save=$ac_clean_files
 ac_clean_files="$ac_clean_files $CONFIG_STATUS"
-{ $as_echo "$as_me:$LINENO: creating $CONFIG_STATUS" >&5
+{ $as_echo "$as_me:${as_lineno-$LINENO}: creating $CONFIG_STATUS" >&5
 $as_echo "$as_me: creating $CONFIG_STATUS" >&6;}
-cat >$CONFIG_STATUS <<_ACEOF || ac_write_fail=1
+as_write_fail=0
+cat >$CONFIG_STATUS <<_ASEOF || as_write_fail=1
 #! $SHELL
 # Generated by $as_me.
 # Run this file to recreate the current configuration.
@@ -12981,17 +9705,18 @@
 debug=false
 ac_cs_recheck=false
 ac_cs_silent=false
-SHELL=\${CONFIG_SHELL-$SHELL}
-_ACEOF
 
-cat >>$CONFIG_STATUS <<\_ACEOF || ac_write_fail=1
-## --------------------- ##
-## M4sh Initialization.  ##
-## --------------------- ##
+SHELL=\${CONFIG_SHELL-$SHELL}
+export SHELL
+_ASEOF
+cat >>$CONFIG_STATUS <<\_ASEOF || as_write_fail=1
+## -------------------- ##
+## M4sh Initialization. ##
+## -------------------- ##
 
 # Be more Bourne compatible
 DUALCASE=1; export DUALCASE # for MKS sh
-if test -n "${ZSH_VERSION+set}" && (emulate sh) >/dev/null 2>&1; then
+if test -n "${ZSH_VERSION+set}" && (emulate sh) >/dev/null 2>&1; then :
   emulate sh
   NULLCMD=:
   # Pre-4.2 versions of Zsh do word splitting on ${1+"$@"}, which
@@ -12999,23 +9724,15 @@
   alias -g '${1+"$@"}'='"$@"'
   setopt NO_GLOB_SUBST
 else
-  case `(set -o) 2>/dev/null` in
-  *posix*) set -o posix ;;
+  case `(set -o) 2>/dev/null` in #(
+  *posix*) :
+    set -o posix ;; #(
+  *) :
+     ;;
 esac
-
 fi
 
 
-
-
-# PATH needs CR
-# Avoid depending upon Character Ranges.
-as_cr_letters='abcdefghijklmnopqrstuvwxyz'
-as_cr_LETTERS='ABCDEFGHIJKLMNOPQRSTUVWXYZ'
-as_cr_Letters=$as_cr_letters$as_cr_LETTERS
-as_cr_digits='0123456789'
-as_cr_alnum=$as_cr_Letters$as_cr_digits
-
 as_nl='
 '
 export as_nl
@@ -13023,7 +9740,13 @@
 as_echo='\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\'
 as_echo=$as_echo$as_echo$as_echo$as_echo$as_echo
 as_echo=$as_echo$as_echo$as_echo$as_echo$as_echo$as_echo
-if (test "X`printf %s $as_echo`" = "X$as_echo") 2>/dev/null; then
+# Prefer a ksh shell builtin over an external printf program on Solaris,
+# but without wasting forks for bash or zsh.
+if test -z "$BASH_VERSION$ZSH_VERSION" \
+    && (test "X`print -r -- $as_echo`" = "X$as_echo") 2>/dev/null; then
+  as_echo='print -r --'
+  as_echo_n='print -rn --'
+elif (test "X`printf %s $as_echo`" = "X$as_echo") 2>/dev/null; then
   as_echo='printf %s\n'
   as_echo_n='printf %s'
 else
@@ -13034,7 +9757,7 @@
     as_echo_body='eval expr "X$1" : "X\\(.*\\)"'
     as_echo_n_body='eval
       arg=$1;
-      case $arg in
+      case $arg in #(
       *"$as_nl"*)
 	expr "X$arg" : "X\\(.*\\)$as_nl";
 	arg=`expr "X$arg" : ".*$as_nl\\(.*\\)"`;;
@@ -13057,13 +9780,6 @@
   }
 fi
 
-# Support unset when possible.
-if ( (MAIL=60; unset MAIL) || exit) >/dev/null 2>&1; then
-  as_unset=unset
-else
-  as_unset=false
-fi
-
 
 # IFS
 # We need space, tab and new line, in precisely that order.  Quoting is
@@ -13073,15 +9789,15 @@
 IFS=" ""	$as_nl"
 
 # Find who we are.  Look in the path if we contain no directory separator.
-case $0 in
+case $0 in #((
   *[\\/]* ) as_myself=$0 ;;
   *) as_save_IFS=$IFS; IFS=$PATH_SEPARATOR
 for as_dir in $PATH
 do
   IFS=$as_save_IFS
   test -z "$as_dir" && as_dir=.
-  test -r "$as_dir/$0" && as_myself=$as_dir/$0 && break
-done
+    test -r "$as_dir/$0" && as_myself=$as_dir/$0 && break
+  done
 IFS=$as_save_IFS
 
      ;;
@@ -13093,12 +9809,16 @@
 fi
 if test ! -f "$as_myself"; then
   $as_echo "$as_myself: error: cannot find myself; rerun with an absolute file name" >&2
-  { (exit 1); exit 1; }
+  exit 1
 fi
 
-# Work around bugs in pre-3.0 UWIN ksh.
-for as_var in ENV MAIL MAILPATH
-do ($as_unset $as_var) >/dev/null 2>&1 && $as_unset $as_var
+# Unset variables that we do not need and which cause bugs (e.g. in
+# pre-3.0 UWIN ksh).  But do not cause bugs in bash 2.01; the "|| exit 1"
+# suppresses any "Segmentation fault" message there.  '((' could
+# trigger a bug in pdksh 5.2.14.
+for as_var in BASH_ENV ENV MAIL MAILPATH
+do eval test x\${$as_var+set} = xset \
+  && ( (unset $as_var) || exit 1) >/dev/null 2>&1 && unset $as_var || :
 done
 PS1='$ '
 PS2='> '
@@ -13110,7 +9830,89 @@
 LANGUAGE=C
 export LANGUAGE
 
-# Required to use basename.
+# CDPATH.
+(unset CDPATH) >/dev/null 2>&1 && unset CDPATH
+
+
+# as_fn_error ERROR [LINENO LOG_FD]
+# ---------------------------------
+# Output "`basename $0`: error: ERROR" to stderr. If LINENO and LOG_FD are
+# provided, also output the error to LOG_FD, referencing LINENO. Then exit the
+# script with status $?, using 1 if that was 0.
+as_fn_error ()
+{
+  as_status=$?; test $as_status -eq 0 && as_status=1
+  if test "$3"; then
+    as_lineno=${as_lineno-"$2"} as_lineno_stack=as_lineno_stack=$as_lineno_stack
+    $as_echo "$as_me:${as_lineno-$LINENO}: error: $1" >&$3
+  fi
+  $as_echo "$as_me: error: $1" >&2
+  as_fn_exit $as_status
+} # as_fn_error
+
+
+# as_fn_set_status STATUS
+# -----------------------
+# Set $? to STATUS, without forking.
+as_fn_set_status ()
+{
+  return $1
+} # as_fn_set_status
+
+# as_fn_exit STATUS
+# -----------------
+# Exit the shell with STATUS, even in a "trap 0" or "set -e" context.
+as_fn_exit ()
+{
+  set +e
+  as_fn_set_status $1
+  exit $1
+} # as_fn_exit
+
+# as_fn_unset VAR
+# ---------------
+# Portably unset VAR.
+as_fn_unset ()
+{
+  { eval $1=; unset $1;}
+}
+as_unset=as_fn_unset
+# as_fn_append VAR VALUE
+# ----------------------
+# Append the text in VALUE to the end of the definition contained in VAR. Take
+# advantage of any shell optimizations that allow amortized linear growth over
+# repeated appends, instead of the typical quadratic growth present in naive
+# implementations.
+if (eval "as_var=1; as_var+=2; test x\$as_var = x12") 2>/dev/null; then :
+  eval 'as_fn_append ()
+  {
+    eval $1+=\$2
+  }'
+else
+  as_fn_append ()
+  {
+    eval $1=\$$1\$2
+  }
+fi # as_fn_append
+
+# as_fn_arith ARG...
+# ------------------
+# Perform arithmetic evaluation on the ARGs, and store the result in the
+# global $as_val. Take advantage of shells that can avoid forks. The arguments
+# must be portable across $(()) and expr.
+if (eval "test \$(( 1 + 1 )) = 2") 2>/dev/null; then :
+  eval 'as_fn_arith ()
+  {
+    as_val=$(( $* ))
+  }'
+else
+  as_fn_arith ()
+  {
+    as_val=`expr "$@" || test $? -eq 1`
+  }
+fi # as_fn_arith
+
+
 if expr a : '\(a\)' >/dev/null 2>&1 &&
    test "X`expr 00001 : '.*\(...\)'`" = X001; then
   as_expr=expr
@@ -13124,8 +9926,12 @@
   as_basename=false
 fi
 
+if (as_dir=`dirname -- /` && test "X$as_dir" = X/) >/dev/null 2>&1; then
+  as_dirname=dirname
+else
+  as_dirname=false
+fi
 
-# Name of the executable.
 as_me=`$as_basename -- "$0" ||
 $as_expr X/"$0" : '.*/\([^/][^/]*\)/*$' \| \
 	 X"$0" : 'X\(//\)$' \| \
@@ -13145,76 +9951,25 @@
 	  }
 	  s/.*/./; q'`
 
-# CDPATH.
-$as_unset CDPATH
-
-
-
-  as_lineno_1=$LINENO
-  as_lineno_2=$LINENO
-  test "x$as_lineno_1" != "x$as_lineno_2" &&
-  test "x`expr $as_lineno_1 + 1`" = "x$as_lineno_2" || {
-
-  # Create $as_me.lineno as a copy of $as_myself, but with $LINENO
-  # uniformly replaced by the line number.  The first 'sed' inserts a
-  # line-number line after each line using $LINENO; the second 'sed'
-  # does the real work.  The second script uses 'N' to pair each
-  # line-number line with the line containing $LINENO, and appends
-  # trailing '-' during substitution so that $LINENO is not a special
-  # case at line end.
-  # (Raja R Harinath suggested sed '=', and Paul Eggert wrote the
-  # scripts with optimization help from Paolo Bonzini.  Blame Lee
-  # E. McMahon (1931-1989) for sed's syntax.  :-)
-  sed -n '
-    p
-    /[$]LINENO/=
-  ' <$as_myself |
-    sed '
-      s/[$]LINENO.*/&-/
-      t lineno
-      b
-      :lineno
-      N
-      :loop
-      s/[$]LINENO\([^'$as_cr_alnum'_].*\n\)\(.*\)/\2\1\2/
-      t loop
-      s/-\n.*//
-    ' >$as_me.lineno &&
-  chmod +x "$as_me.lineno" ||
-    { $as_echo "$as_me: error: cannot create $as_me.lineno; rerun with a POSIX shell" >&2
-   { (exit 1); exit 1; }; }
-
-  # Don't try to exec as it changes $[0], causing all sort of problems
-  # (the dirname of $[0] is not the place where we might find the
-  # original and so on.  Autoconf is especially sensitive to this).
-  . "./$as_me.lineno"
-  # Exit status is that of the last command.
-  exit
-}
-
-
-if (as_dir=`dirname -- /` && test "X$as_dir" = X/) >/dev/null 2>&1; then
-  as_dirname=dirname
-else
-  as_dirname=false
-fi
+# Avoid depending upon Character Ranges.
+as_cr_letters='abcdefghijklmnopqrstuvwxyz'
+as_cr_LETTERS='ABCDEFGHIJKLMNOPQRSTUVWXYZ'
+as_cr_Letters=$as_cr_letters$as_cr_LETTERS
+as_cr_digits='0123456789'
+as_cr_alnum=$as_cr_Letters$as_cr_digits
 
 ECHO_C= ECHO_N= ECHO_T=
-case `echo -n x` in
+case `echo -n x` in #(((((
 -n*)
-  case `echo 'x\c'` in
+  case `echo 'xy\c'` in
   *c*) ECHO_T='	';;	# ECHO_T is single tab character.
-  *)   ECHO_C='\c';;
+  xy)  ECHO_C='\c';;
+  *)   echo `echo ksh88 bug on AIX 6.1` > /dev/null
+       ECHO_T='	';;
   esac;;
 *)
   ECHO_N='-n';;
 esac
-if expr a : '\(a\)' >/dev/null 2>&1 &&
-   test "X`expr 00001 : '.*\(...\)'`" = X001; then
-  as_expr=expr
-else
-  as_expr=false
-fi
 
 rm -f conf$$ conf$$.exe conf$$.file
 if test -d conf$$.dir; then
@@ -13243,8 +9998,56 @@
 rm -f conf$$ conf$$.exe conf$$.dir/conf$$.file conf$$.file
 rmdir conf$$.dir 2>/dev/null
 
+
+# as_fn_mkdir_p
+# -------------
+# Create "$as_dir" as a directory, including parents if necessary.
+as_fn_mkdir_p ()
+{
+
+  case $as_dir in #(
+  -*) as_dir=./$as_dir;;
+  esac
+  test -d "$as_dir" || eval $as_mkdir_p || {
+    as_dirs=
+    while :; do
+      case $as_dir in #(
+      *\'*) as_qdir=`$as_echo "$as_dir" | sed "s/'/'\\\\\\\\''/g"`;; #'(
+      *) as_qdir=$as_dir;;
+      esac
+      as_dirs="'$as_qdir' $as_dirs"
+      as_dir=`$as_dirname -- "$as_dir" ||
+$as_expr X"$as_dir" : 'X\(.*[^/]\)//*[^/][^/]*/*$' \| \
+	 X"$as_dir" : 'X\(//\)[^/]' \| \
+	 X"$as_dir" : 'X\(//\)$' \| \
+	 X"$as_dir" : 'X\(/\)' \| . 2>/dev/null ||
+$as_echo X"$as_dir" |
+    sed '/^X\(.*[^/]\)\/\/*[^/][^/]*\/*$/{
+	    s//\1/
+	    q
+	  }
+	  /^X\(\/\/\)[^/].*/{
+	    s//\1/
+	    q
+	  }
+	  /^X\(\/\/\)$/{
+	    s//\1/
+	    q
+	  }
+	  /^X\(\/\).*/{
+	    s//\1/
+	    q
+	  }
+	  s/.*/./; q'`
+      test -d "$as_dir" && break
+    done
+    test -z "$as_dirs" || eval "mkdir $as_dirs"
+  } || test -d "$as_dir" || as_fn_error "cannot create directory $as_dir"
+
+
+} # as_fn_mkdir_p
 if mkdir -p . 2>/dev/null; then
-  as_mkdir_p=:
+  as_mkdir_p='mkdir -p "$as_dir"'
 else
   test -d ./-p && rmdir ./-p
   as_mkdir_p=false
@@ -13263,10 +10066,10 @@
       if test -d "$1"; then
 	test -d "$1/.";
       else
-	case $1 in
+	case $1 in #(
 	-*)set "./$1";;
 	esac;
-	case `ls -ld'$as_ls_L_option' "$1" 2>/dev/null` in
+	case `ls -ld'$as_ls_L_option' "$1" 2>/dev/null` in #((
 	???[sx]*):;;*)false;;esac;fi
     '\'' sh
   '
@@ -13281,13 +10084,19 @@
 
 
 exec 6>&1
+## ----------------------------------- ##
+## Main body of $CONFIG_STATUS script. ##
+## ----------------------------------- ##
+_ASEOF
+test $as_write_fail = 0 && chmod +x $CONFIG_STATUS || ac_write_fail=1
 
-# Save the log message, to keep $[0] and so on meaningful, and to
+cat >>$CONFIG_STATUS <<\_ACEOF || ac_write_fail=1
+# Save the log message, to keep $0 and so on meaningful, and to
 # report actual input values of CONFIG_FILES etc. instead of their
 # values after options handling.
 ac_log="
 This file was extended by $as_me, which was
-generated by GNU Autoconf 2.63.  Invocation command line was
+generated by GNU Autoconf 2.64.  Invocation command line was
 
   CONFIG_FILES    = $CONFIG_FILES
   CONFIG_HEADERS  = $CONFIG_HEADERS
@@ -13318,10 +10127,11 @@
 
 cat >>$CONFIG_STATUS <<\_ACEOF || ac_write_fail=1
 ac_cs_usage="\
-\`$as_me' instantiates files from templates according to the
-current configuration.
+\`$as_me' instantiates files and other configuration actions
+from templates according to the current configuration.  Unless the files
+and actions are specified as TAGs, all are instantiated by default.
 
-Usage: $0 [OPTION]... [FILE]...
+Usage: $0 [OPTION]... [TAG]...
 
   -h, --help       print this help, then exit
   -V, --version    print version number and configuration settings, then exit
@@ -13340,16 +10150,16 @@
 Configuration headers:
 $config_headers
 
-Report bugs to <bug-autoconf@gnu.org>."
+Report bugs to the package provider."
 
 _ACEOF
 cat >>$CONFIG_STATUS <<_ACEOF || ac_write_fail=1
 ac_cs_version="\\
 config.status
-configured by $0, generated by GNU Autoconf 2.63,
+configured by $0, generated by GNU Autoconf 2.64,
   with options \\"`$as_echo "$ac_configure_args" | sed 's/^ //; s/[\\""\`\$]/\\\\&/g'`\\"
 
-Copyright (C) 2008 Free Software Foundation, Inc.
+Copyright (C) 2009 Free Software Foundation, Inc.
 This config.status script is free software; the Free Software Foundation
 gives unlimited permission to copy, distribute and modify it."
 
@@ -13390,20 +10200,19 @@
     case $ac_optarg in
     *\'*) ac_optarg=`$as_echo "$ac_optarg" | sed "s/'/'\\\\\\\\''/g"` ;;
     esac
-    CONFIG_FILES="$CONFIG_FILES '$ac_optarg'"
+    as_fn_append CONFIG_FILES " '$ac_optarg'"
     ac_need_defaults=false;;
   --header | --heade | --head | --hea )
     $ac_shift
     case $ac_optarg in
     *\'*) ac_optarg=`$as_echo "$ac_optarg" | sed "s/'/'\\\\\\\\''/g"` ;;
     esac
-    CONFIG_HEADERS="$CONFIG_HEADERS '$ac_optarg'"
+    as_fn_append CONFIG_HEADERS " '$ac_optarg'"
     ac_need_defaults=false;;
   --he | --h)
     # Conflict between --help and --header
-    { $as_echo "$as_me: error: ambiguous option: $1
-Try \`$0 --help' for more information." >&2
-   { (exit 1); exit 1; }; };;
+    as_fn_error "ambiguous option: \`$1'
+Try \`$0 --help' for more information.";;
   --help | --hel | -h )
     $as_echo "$ac_cs_usage"; exit ;;
   -q | -quiet | --quiet | --quie | --qui | --qu | --q \
@@ -13411,11 +10220,10 @@
     ac_cs_silent=: ;;
 
   # This is an error.
-  -*) { $as_echo "$as_me: error: unrecognized option: $1
-Try \`$0 --help' for more information." >&2
-   { (exit 1); exit 1; }; } ;;
+  -*) as_fn_error "unrecognized option: \`$1'
+Try \`$0 --help' for more information." ;;
 
-  *) ac_config_targets="$ac_config_targets $1"
+  *) as_fn_append ac_config_targets " $1"
      ac_need_defaults=false ;;
 
   esac
@@ -13470,9 +10278,7 @@
     "indep-utils/webtrace-conv/epa/Makefile") CONFIG_FILES="$CONFIG_FILES indep-utils/webtrace-conv/epa/Makefile" ;;
     "indep-utils/cmu-scen-gen/setdest/Makefile") CONFIG_FILES="$CONFIG_FILES indep-utils/cmu-scen-gen/setdest/Makefile" ;;
 
-  *) { { $as_echo "$as_me:$LINENO: error: invalid argument: $ac_config_target" >&5
-$as_echo "$as_me: error: invalid argument: $ac_config_target" >&2;}
-   { (exit 1); exit 1; }; };;
+  *) as_fn_error "invalid argument: \`$ac_config_target'" "$LINENO" 5;;
   esac
 done
 
@@ -13498,7 +10304,7 @@
   trap 'exit_status=$?
   { test -z "$tmp" || test ! -d "$tmp" || rm -fr "$tmp"; } && exit $exit_status
 ' 0
-  trap '{ (exit 1); exit 1; }' 1 2 13 15
+  trap 'as_fn_exit 1' 1 2 13 15
 }
 # Create a (secure) tmp directory for tmp files.
 
@@ -13509,11 +10315,7 @@
 {
   tmp=./conf$$-$RANDOM
   (umask 077 && mkdir "$tmp")
-} ||
-{
-   $as_echo "$as_me: cannot create a temporary directory in ." >&2
-   { (exit 1); exit 1; }
-}
+} || as_fn_error "cannot create a temporary directory in ." "$LINENO" 5
 
 # Set up the scripts for CONFIG_FILES section.
 # No need to generate them if there are no CONFIG_FILES.
@@ -13521,10 +10323,16 @@
 if test -n "$CONFIG_FILES"; then
 
 
-ac_cr=''
+ac_cr=`echo X | tr X '\015'`
+# On cygwin, bash can eat \r inside `` if the user requested igncr.
+# But we know of no other shell where ac_cr would be empty at this
+# point, so we can use a bashism as a fallback.
+if test "x$ac_cr" = x; then
+  eval ac_cr=\$\'\\r\'
+fi
 ac_cs_awk_cr=`$AWK 'BEGIN { print "a\rb" }' </dev/null 2>/dev/null`
 if test "$ac_cs_awk_cr" = "a${ac_cr}b"; then
-  ac_cs_awk_cr='\\r'
+  ac_cs_awk_cr='\r'
 else
   ac_cs_awk_cr=$ac_cr
 fi
@@ -13538,24 +10346,18 @@
   echo "$ac_subst_vars" | sed 's/.*/&!$&$ac_delim/' &&
   echo "_ACEOF"
 } >conf$$subs.sh ||
-  { { $as_echo "$as_me:$LINENO: error: could not make $CONFIG_STATUS" >&5
-$as_echo "$as_me: error: could not make $CONFIG_STATUS" >&2;}
-   { (exit 1); exit 1; }; }
+  as_fn_error "could not make $CONFIG_STATUS" "$LINENO" 5
 ac_delim_num=`echo "$ac_subst_vars" | grep -c '$'`
 ac_delim='%!_!# '
 for ac_last_try in false false false false false :; do
   . ./conf$$subs.sh ||
-    { { $as_echo "$as_me:$LINENO: error: could not make $CONFIG_STATUS" >&5
-$as_echo "$as_me: error: could not make $CONFIG_STATUS" >&2;}
-   { (exit 1); exit 1; }; }
+    as_fn_error "could not make $CONFIG_STATUS" "$LINENO" 5
 
   ac_delim_n=`sed -n "s/.*$ac_delim\$/X/p" conf$$subs.awk | grep -c X`
   if test $ac_delim_n = $ac_delim_num; then
     break
   elif $ac_last_try; then
-    { { $as_echo "$as_me:$LINENO: error: could not make $CONFIG_STATUS" >&5
-$as_echo "$as_me: error: could not make $CONFIG_STATUS" >&2;}
-   { (exit 1); exit 1; }; }
+    as_fn_error "could not make $CONFIG_STATUS" "$LINENO" 5
   else
     ac_delim="$ac_delim!$ac_delim _$ac_delim!! "
   fi
@@ -13644,9 +10446,7 @@
 else
   cat
 fi < "$tmp/subs1.awk" > "$tmp/subs.awk" \
-  || { { $as_echo "$as_me:$LINENO: error: could not setup config files machinery" >&5
-$as_echo "$as_me: error: could not setup config files machinery" >&2;}
-   { (exit 1); exit 1; }; }
+  || as_fn_error "could not setup config files machinery" "$LINENO" 5
 _ACEOF
 
 # VPATH may cause trouble with some makes, so we remove $(srcdir),
@@ -13687,9 +10487,7 @@
   if test -z "$ac_t"; then
     break
   elif $ac_last_try; then
-    { { $as_echo "$as_me:$LINENO: error: could not make $CONFIG_HEADERS" >&5
-$as_echo "$as_me: error: could not make $CONFIG_HEADERS" >&2;}
-   { (exit 1); exit 1; }; }
+    as_fn_error "could not make $CONFIG_HEADERS" "$LINENO" 5
   else
     ac_delim="$ac_delim!$ac_delim _$ac_delim!! "
   fi
@@ -13774,9 +10572,7 @@
 _ACAWK
 _ACEOF
 cat >>$CONFIG_STATUS <<\_ACEOF || ac_write_fail=1
-  { { $as_echo "$as_me:$LINENO: error: could not setup config headers machinery" >&5
-$as_echo "$as_me: error: could not setup config headers machinery" >&2;}
-   { (exit 1); exit 1; }; }
+  as_fn_error "could not setup config headers machinery" "$LINENO" 5
 fi # test -n "$CONFIG_HEADERS"
 
 
@@ -13789,9 +10585,7 @@
   esac
   case $ac_mode$ac_tag in
   :[FHL]*:*);;
-  :L* | :C*:*) { { $as_echo "$as_me:$LINENO: error: invalid tag $ac_tag" >&5
-$as_echo "$as_me: error: invalid tag $ac_tag" >&2;}
-   { (exit 1); exit 1; }; };;
+  :L* | :C*:*) as_fn_error "invalid tag \`$ac_tag'" "$LINENO" 5;;
   :[FH]-) ac_tag=-:-;;
   :[FH]*) ac_tag=$ac_tag:$ac_tag.in;;
   esac
@@ -13819,12 +10613,10 @@
 	   [\\/$]*) false;;
 	   *) test -f "$srcdir/$ac_f" && ac_f="$srcdir/$ac_f";;
 	   esac ||
-	   { { $as_echo "$as_me:$LINENO: error: cannot find input file: $ac_f" >&5
-$as_echo "$as_me: error: cannot find input file: $ac_f" >&2;}
-   { (exit 1); exit 1; }; };;
+	   as_fn_error "cannot find input file: \`$ac_f'" "$LINENO" 5;;
       esac
       case $ac_f in *\'*) ac_f=`$as_echo "$ac_f" | sed "s/'/'\\\\\\\\''/g"`;; esac
-      ac_file_inputs="$ac_file_inputs '$ac_f'"
+      as_fn_append ac_file_inputs " '$ac_f'"
     done
 
     # Let's still pretend it is `configure' which instantiates (i.e., don't
@@ -13835,7 +10627,7 @@
 	`' by configure.'
     if test x"$ac_file" != x-; then
       configure_input="$ac_file.  $configure_input"
-      { $as_echo "$as_me:$LINENO: creating $ac_file" >&5
+      { $as_echo "$as_me:${as_lineno-$LINENO}: creating $ac_file" >&5
 $as_echo "$as_me: creating $ac_file" >&6;}
     fi
     # Neutralize special characters interpreted by sed in replacement strings.
@@ -13848,9 +10640,7 @@
 
     case $ac_tag in
     *:-:* | *:-) cat >"$tmp/stdin" \
-      || { { $as_echo "$as_me:$LINENO: error: could not create $ac_file" >&5
-$as_echo "$as_me: error: could not create $ac_file" >&2;}
-   { (exit 1); exit 1; }; } ;;
+      || as_fn_error "could not create $ac_file" "$LINENO" 5 ;;
     esac
     ;;
   esac
@@ -13878,47 +10668,7 @@
 	    q
 	  }
 	  s/.*/./; q'`
-  { as_dir="$ac_dir"
-  case $as_dir in #(
-  -*) as_dir=./$as_dir;;
-  esac
-  test -d "$as_dir" || { $as_mkdir_p && mkdir -p "$as_dir"; } || {
-    as_dirs=
-    while :; do
-      case $as_dir in #(
-      *\'*) as_qdir=`$as_echo "$as_dir" | sed "s/'/'\\\\\\\\''/g"`;; #'(
-      *) as_qdir=$as_dir;;
-      esac
-      as_dirs="'$as_qdir' $as_dirs"
-      as_dir=`$as_dirname -- "$as_dir" ||
-$as_expr X"$as_dir" : 'X\(.*[^/]\)//*[^/][^/]*/*$' \| \
-	 X"$as_dir" : 'X\(//\)[^/]' \| \
-	 X"$as_dir" : 'X\(//\)$' \| \
-	 X"$as_dir" : 'X\(/\)' \| . 2>/dev/null ||
-$as_echo X"$as_dir" |
-    sed '/^X\(.*[^/]\)\/\/*[^/][^/]*\/*$/{
-	    s//\1/
-	    q
-	  }
-	  /^X\(\/\/\)[^/].*/{
-	    s//\1/
-	    q
-	  }
-	  /^X\(\/\/\)$/{
-	    s//\1/
-	    q
-	  }
-	  /^X\(\/\).*/{
-	    s//\1/
-	    q
-	  }
-	  s/.*/./; q'`
-      test -d "$as_dir" && break
-    done
-    test -z "$as_dirs" || eval "mkdir $as_dirs"
-  } || test -d "$as_dir" || { { $as_echo "$as_me:$LINENO: error: cannot create directory $as_dir" >&5
-$as_echo "$as_me: error: cannot create directory $as_dir" >&2;}
-   { (exit 1); exit 1; }; }; }
+  as_dir="$ac_dir"; as_fn_mkdir_p
   ac_builddir=.
 
 case "$ac_dir" in
@@ -13970,7 +10720,6 @@
 # If the template does not know about datarootdir, expand it.
 # FIXME: This hack should be removed a few years after 2.60.
 ac_datarootdir_hack=; ac_datarootdir_seen=
-
 ac_sed_dataroot='
 /datarootdir/ {
   p
@@ -13980,12 +10729,11 @@
 /@docdir@/p
 /@infodir@/p
 /@localedir@/p
-/@mandir@/p
-'
+/@mandir@/p'
 case `eval "sed -n \"\$ac_sed_dataroot\" $ac_file_inputs"` in
 *datarootdir*) ac_datarootdir_seen=yes;;
 *@datadir@*|*@docdir@*|*@infodir@*|*@localedir@*|*@mandir@*)
-  { $as_echo "$as_me:$LINENO: WARNING: $ac_file_inputs seems to ignore the --datarootdir setting" >&5
+  { $as_echo "$as_me:${as_lineno-$LINENO}: WARNING: $ac_file_inputs seems to ignore the --datarootdir setting" >&5
 $as_echo "$as_me: WARNING: $ac_file_inputs seems to ignore the --datarootdir setting" >&2;}
 _ACEOF
 cat >>$CONFIG_STATUS <<_ACEOF || ac_write_fail=1
@@ -13995,7 +10743,7 @@
   s&@infodir@&$infodir&g
   s&@localedir@&$localedir&g
   s&@mandir@&$mandir&g
-    s&\\\${datarootdir}&$datarootdir&g' ;;
+  s&\\\${datarootdir}&$datarootdir&g' ;;
 esac
 _ACEOF
 
@@ -14023,14 +10771,12 @@
 $ac_datarootdir_hack
 "
 eval sed \"\$ac_sed_extra\" "$ac_file_inputs" | $AWK -f "$tmp/subs.awk" >$tmp/out \
-  || { { $as_echo "$as_me:$LINENO: error: could not create $ac_file" >&5
-$as_echo "$as_me: error: could not create $ac_file" >&2;}
-   { (exit 1); exit 1; }; }
+  || as_fn_error "could not create $ac_file" "$LINENO" 5
 
 test -z "$ac_datarootdir_hack$ac_datarootdir_seen" &&
   { ac_out=`sed -n '/\${datarootdir}/p' "$tmp/out"`; test -n "$ac_out"; } &&
   { ac_out=`sed -n '/^[	 ]*datarootdir[	 ]*:*=/p' "$tmp/out"`; test -z "$ac_out"; } &&
-  { $as_echo "$as_me:$LINENO: WARNING: $ac_file contains a reference to the variable \`datarootdir'
+  { $as_echo "$as_me:${as_lineno-$LINENO}: WARNING: $ac_file contains a reference to the variable \`datarootdir'
 which seems to be undefined.  Please make sure it is defined." >&5
 $as_echo "$as_me: WARNING: $ac_file contains a reference to the variable \`datarootdir'
 which seems to be undefined.  Please make sure it is defined." >&2;}
@@ -14040,9 +10786,7 @@
   -) cat "$tmp/out" && rm -f "$tmp/out";;
   *) rm -f "$ac_file" && mv "$tmp/out" "$ac_file";;
   esac \
-  || { { $as_echo "$as_me:$LINENO: error: could not create $ac_file" >&5
-$as_echo "$as_me: error: could not create $ac_file" >&2;}
-   { (exit 1); exit 1; }; }
+  || as_fn_error "could not create $ac_file" "$LINENO" 5
  ;;
   :H)
   #
@@ -14053,25 +10797,19 @@
       $as_echo "/* $configure_input  */" \
       && eval '$AWK -f "$tmp/defines.awk"' "$ac_file_inputs"
     } >"$tmp/config.h" \
-      || { { $as_echo "$as_me:$LINENO: error: could not create $ac_file" >&5
-$as_echo "$as_me: error: could not create $ac_file" >&2;}
-   { (exit 1); exit 1; }; }
+      || as_fn_error "could not create $ac_file" "$LINENO" 5
     if diff "$ac_file" "$tmp/config.h" >/dev/null 2>&1; then
-      { $as_echo "$as_me:$LINENO: $ac_file is unchanged" >&5
+      { $as_echo "$as_me:${as_lineno-$LINENO}: $ac_file is unchanged" >&5
 $as_echo "$as_me: $ac_file is unchanged" >&6;}
     else
       rm -f "$ac_file"
       mv "$tmp/config.h" "$ac_file" \
-	|| { { $as_echo "$as_me:$LINENO: error: could not create $ac_file" >&5
-$as_echo "$as_me: error: could not create $ac_file" >&2;}
-   { (exit 1); exit 1; }; }
+	|| as_fn_error "could not create $ac_file" "$LINENO" 5
     fi
   else
     $as_echo "/* $configure_input  */" \
       && eval '$AWK -f "$tmp/defines.awk"' "$ac_file_inputs" \
-      || { { $as_echo "$as_me:$LINENO: error: could not create -" >&5
-$as_echo "$as_me: error: could not create -" >&2;}
-   { (exit 1); exit 1; }; }
+      || as_fn_error "could not create -" "$LINENO" 5
   fi
  ;;
 
@@ -14081,15 +10819,12 @@
 done # for ac_tag
 
 
-{ (exit 0); exit 0; }
+as_fn_exit 0
 _ACEOF
-chmod +x $CONFIG_STATUS
 ac_clean_files=$ac_clean_files_save
 
 test $ac_write_fail = 0 ||
-  { { $as_echo "$as_me:$LINENO: error: write failure creating $CONFIG_STATUS" >&5
-$as_echo "$as_me: error: write failure creating $CONFIG_STATUS" >&2;}
-   { (exit 1); exit 1; }; }
+  as_fn_error "write failure creating $CONFIG_STATUS" "$LINENO" 5
 
 
 # configure is writing to config.log, and then calls config.status.
@@ -14110,10 +10845,10 @@
   exec 5>>config.log
   # Use ||, not &&, to avoid exiting from the if with $? = 1, which
   # would make configure fail if this is the last instruction.
-  $ac_cs_success || { (exit 1); exit 1; }
+  $ac_cs_success || as_fn_exit $?
 fi
 if test -n "$ac_unrecognized_opts" && test "$enable_option_checking" != no; then
-  { $as_echo "$as_me:$LINENO: WARNING: unrecognized options: $ac_unrecognized_opts" >&5
+  { $as_echo "$as_me:${as_lineno-$LINENO}: WARNING: unrecognized options: $ac_unrecognized_opts" >&5
 $as_echo "$as_me: WARNING: unrecognized options: $ac_unrecognized_opts" >&2;}
 fi
 
diff -ruN --exclude='*.o' --exclude='autom4*' ns-2.34-pure/configure.in ns-2.34/configure.in
--- ns-2.34-pure/configure.in	2009-06-14 10:35:07.000000000 -0700
+++ ns-2.34/configure.in	2010-02-28 09:31:39.000000000 -0800
@@ -26,6 +26,7 @@
 builtin(include, ./conf/configure.in.x11)
 builtin(include, ./conf/configure.in.tcldebug)
 builtin(include, ./conf/configure.in.dmalloc)
+builtin(include, ./conf/configure.in.click)
 default_classinstvar=yes
 builtin(include, ./conf/configure.in.debugopts)
 
diff -ruN --exclude='*.o' --exclude='autom4*' ns-2.34-pure/diffusion/diffusion.h ns-2.34/diffusion/diffusion.h
--- ns-2.34-pure/diffusion/diffusion.h	2009-06-14 10:35:44.000000000 -0700
+++ ns-2.34/diffusion/diffusion.h	2010-02-28 09:31:39.000000000 -0800
@@ -138,6 +138,10 @@
 };
 
 
+void XmitFailedCallback(Packet *pkt, void *data);
+class ArpBufferTimer;
+class SendBufTimer;
+
 class DiffusionAgent : public Agent {
  public:
   DiffusionAgent();
diff -ruN --exclude='*.o' --exclude='autom4*' ns-2.34-pure/diffusion/omni_mcast.h ns-2.34/diffusion/omni_mcast.h
--- ns-2.34-pure/diffusion/omni_mcast.h	2009-06-14 10:35:44.000000000 -0700
+++ ns-2.34/diffusion/omni_mcast.h	2010-02-28 09:31:39.000000000 -0800
@@ -157,6 +157,10 @@
 
 
 
+void OmniMcastXmitFailedCallback(Packet *pkt, void *data);
+
+class OmniMcastArpBufferTimer;
+class OmniMcastSendBufTimer;
 
 class OmniMcastAgent : public Agent {
  public:
diff -ruN --exclude='*.o' --exclude='autom4*' ns-2.34-pure/dsr/dsragent.h ns-2.34/dsr/dsragent.h
--- ns-2.34-pure/dsr/dsragent.h	2009-06-14 10:35:44.000000000 -0700
+++ ns-2.34/dsr/dsragent.h	2010-02-28 09:31:39.000000000 -0800
@@ -110,6 +110,12 @@
 
 LIST_HEAD(DSRAgent_List, DSRAgent);
 
+void XmitFailureCallback(Packet *pkt, void *data);
+void XmitFlowFailureCallback(Packet *pkt, void *data);
+int FilterFailure(Packet *p, void *data);
+class SendBufferTimer;
+
+
 class DSRAgent : public Tap, public Agent {
 public:
 
diff -ruN --exclude='*.o' --exclude='autom4*' ns-2.34-pure/mac/channel.cc ns-2.34/mac/channel.cc
--- ns-2.34-pure/mac/channel.cc	2009-06-14 10:35:44.000000000 -0700
+++ ns-2.34/mac/channel.cc	2010-02-28 09:31:39.000000000 -0800
@@ -121,6 +121,12 @@
 			((Phy*) obj)->setchnl(this);
 			return TCL_OK;
 		}
+		else if(strcmp(argv[1], "delif") == 0) {
+			// Remove phy from channel
+			((Phy*) obj)->setchnl(0);
+			((Phy*) obj)->removechnl();
+			return TCL_OK;
+		}
 
 		// add interface for grid_keeper_
 		/*else if(strncasecmp(argv[1], "grid_keeper", 5) == 0) {
@@ -345,17 +351,18 @@
 						         outlist);
 	    for (i=0; i < out_index; i ++) {
 		
-		  newp = p->copy();
+		  // fix Szymon Chachulski
 		  rnode = outlist[i];
 		  propdelay = get_pdelay(tnode, rnode);
 
 		  rifp = (rnode->ifhead()).lh_first; 
 		  for(; rifp; rifp = rifp->nextnode()){
 			  if (rifp->channel() == this){
+				 newp = p->copy();
 				 s.schedule(rifp, newp, propdelay); 
-				 break;
 			  }
 		  }
+		  //!fix Szymon Chachulski
  	    }
 	    delete [] outlist; 
 	 
@@ -376,14 +383,17 @@
 			 if(rnode == tnode)
 				 continue;
 			 
-			 newp = p->copy();
-			 
+			 // fix Szymon Chachulski
 			 propdelay = get_pdelay(tnode, rnode);
 			 
 			 rifp = (rnode->ifhead()).lh_first;
 			 for(; rifp; rifp = rifp->nextnode()){
-				 s.schedule(rifp, newp, propdelay);
+				 if (rifp->channel() == this){
+					 newp = p->copy();
+					 s.schedule(rifp, newp, propdelay);
+				}
 			 }
+			//!fix Szymon Chachulski
 		 }
 		 delete [] affectedNodes;
 	 }
diff -ruN --exclude='*.o' --exclude='autom4*' ns-2.34-pure/mac/ll-ext.cc ns-2.34/mac/ll-ext.cc
--- ns-2.34-pure/mac/ll-ext.cc	1969-12-31 16:00:00.000000000 -0800
+++ ns-2.34/mac/ll-ext.cc	2010-02-28 09:31:39.000000000 -0800
@@ -0,0 +1,173 @@
+/*
+ * ll-ext.cc
+ * This is a special link layer which explicitly notifies the attached
+ * queue when it becomes free.
+ */
+
+/*****************************************************************************
+ *  Copyright 2002, Univerity of Colorado at Boulder.                        *
+ *                                                                           *
+ *                        All Rights Reserved                                *
+ *                                                                           *
+ *  Permission to use, copy, modify, and distribute this software and its    *
+ *  documentation for any purpose other than its incorporation into a        *
+ *  commercial product is hereby granted without fee, provided that the      *
+ *  above copyright notice appear in all copies and that both that           *
+ *  copyright notice and this permission notice appear in supporting         *
+ *  documentation, and that the name of the University not be used in        *
+ *  advertising or publicity pertaining to distribution of the software      *
+ *  without specific, written prior permission.                              *
+ *                                                                           *
+ *  UNIVERSITY OF COLORADO DISCLAIMS ALL WARRANTIES WITH REGARD TO THIS      *
+ *  SOFTWARE, INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY AND        *
+ *  FITNESS FOR ANY PARTICULAR PURPOSE.  IN NO EVENT SHALL THE UNIVERSITY    *
+ *  OF COLORADO BE LIABLE FOR ANY SPECIAL, INDIRECT OR CONSEQUENTIAL         *
+ *  DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM LOSS OF USE, DATA       *
+ *  OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR OTHER        *
+ *  TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR         *
+ *  PERFORMANCE OF THIS SOFTWARE.                                            *
+ *                                                                           *
+ ****************************************************************************/
+
+// XXX This is really a click link layer now - not just ext...
+
+#include "config.h"
+#include <stdlib.h>
+#include <ctype.h>
+#include <sys/time.h>
+#include <unistd.h>
+//#include <stl.h>
+//#include <hash_map.h>
+#include <map>
+#include <math.h>
+#include <string>
+#include "packet.h"
+#include "ip.h"
+#include "mac.h"
+#include "classifier.h"
+//#include "classifier-hash.h"
+#include "scheduler.h"
+#include "ll.h"
+#include <click/simclick.h>
+#include "ll-ext.h"
+#include "packet.h"
+#include "extrouter.h"
+#include "classifier.h"
+#include "classifier-ext.h"
+#include "classifier-click.h"
+#include "clickqueue.h"
+
+static class LLExtClass : public TclClass {
+public:
+  LLExtClass() : TclClass("LL/Ext") {}
+  TclObject* create(int, const char*const*) {
+    return (new LLExt());
+  }
+} class_ll_ext;
+
+void
+LLExtEventHandler::handle(Event* event) {
+  // XXX dangerous downcast - should use RTTI
+  LLExtEvent* myevent = (LLExtEvent*) event;
+  myevent->llext->setpending(0);
+  delete myevent;
+}
+
+
+LLExt::LLExt() {
+  extid_ = -1;
+  macDA_ = -1;
+  packetpending_ = 0;
+}
+
+LLExt::~LLExt() {
+}
+
+int LLExt::command(int argc, const char*const* argv) {
+  //Tcl& tcl = Tcl::instance();
+  if(argc == 2) {
+  }
+  else if (argc == 3) {
+    if (strcmp("setid",argv[1]) == 0) {
+      extid_ = atoi(argv[2]);
+      return TCL_OK;
+    }
+    else if (strcmp("setpromiscuous",argv[1]) == 0) {
+      bool promisc = (atoi(argv[2]) != 0);
+      setpromiscuous(promisc);
+      return TCL_OK;
+    }
+  }
+  else if (argc == 4) {
+  }
+
+  return LL::command(argc,argv);
+}
+
+void LLExt::recv(Packet* p, Handler* h) {
+  /*
+   * Tag the packet and then defer to standard link layer handling.
+   */
+  struct hdr_cmn* hdr = HDR_CMN(p);
+  hdr->iface() = extid_;
+  // printf("ll = %d, ifid = %d\n",(int)this,hdr->iface());
+  LL::recv(p,h);
+}
+
+void LLExt::sendDown(Packet* p) {
+  // Someone decided that it would be A Good Thing to overlay
+  // the 802.11 MAC packet info on top of the regular MAC packet info.
+  // We need to fix the source and destination addresses here by accessing the
+  // MAC object itself.
+  struct hdr_mac* mhdr = HDR_MAC(p);
+  int macdst = mhdr->macDA();
+  int macsrc = mhdr->macSA();
+  memset(mhdr,0,sizeof(struct hdr_mac));
+  mac_->hdr_dst((char*)mhdr,macdst);
+  mac_->hdr_src((char*)mhdr,macsrc);
+
+  // Bleah. Send the packet down, mark ourself as being busy, and then
+  // schedule an event to mark ourselves unbusy.
+  packetpending_ = 1;
+  LL::sendDown(p);
+  LLExtEvent* llev = new LLExtEvent();
+  llev->llext = this;
+  Scheduler& s = Scheduler::instance();
+  s.schedule(&evhandle_,llev,delay_);
+}
+
+int LLExt::ready() {
+  ClickQueue* pcq = (ClickQueue*) ifq_;
+  if (pcq) {
+    return (!packetpending_ && pcq->ready());
+  }
+
+  // No ClickQueue? Then we're always ready.
+  return 1;
+}
+
+void
+LLExt::setpromiscuous(bool promisc) {
+  if (!mac_) {
+    return;
+  }
+
+  if (promisc) {
+    mac_->installTap(this,true);
+  }
+  else {
+    mac_->installTap(0,true);
+  }
+}
+
+void 
+LLExt::tap(const Packet *packet)
+  /* process packets that are promiscously listened to from the MAC layer tap
+  *** do not change or free packet *** */
+{
+  // XXX send a copy of packets received here up to the next layer.
+  // This code assumes that the tap is being used with the "filterown"
+  // option set, otherwise duplicate packets will get sent up the pipe.
+  Packet* newp = packet->copy();
+  recv(newp,0);
+}
diff -ruN --exclude='*.o' --exclude='autom4*' ns-2.34-pure/mac/ll-ext.h ns-2.34/mac/ll-ext.h
--- ns-2.34-pure/mac/ll-ext.h	1969-12-31 16:00:00.000000000 -0800
+++ ns-2.34/mac/ll-ext.h	2010-02-28 09:31:39.000000000 -0800
@@ -0,0 +1,78 @@
+/*
+ * ll-ext.h
+ *
+ * Much like the multicast routing system, ext routers needs to know what
+ * interface packets come in from. However, the multicast interface
+ * thing doesn't quite do what we need it to, so you get what
+ * we've got here. 
+ */
+
+/*****************************************************************************
+ *  Copyright 2002, Univerity of Colorado at Boulder.                        *
+ *                                                                           *
+ *                        All Rights Reserved                                *
+ *                                                                           *
+ *  Permission to use, copy, modify, and distribute this software and its    *
+ *  documentation for any purpose other than its incorporation into a        *
+ *  commercial product is hereby granted without fee, provided that the      *
+ *  above copyright notice appear in all copies and that both that           *
+ *  copyright notice and this permission notice appear in supporting         *
+ *  documentation, and that the name of the University not be used in        *
+ *  advertising or publicity pertaining to distribution of the software      *
+ *  without specific, written prior permission.                              *
+ *                                                                           *
+ *  UNIVERSITY OF COLORADO DISCLAIMS ALL WARRANTIES WITH REGARD TO THIS      *
+ *  SOFTWARE, INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY AND        *
+ *  FITNESS FOR ANY PARTICULAR PURPOSE.  IN NO EVENT SHALL THE UNIVERSITY    *
+ *  OF COLORADO BE LIABLE FOR ANY SPECIAL, INDIRECT OR CONSEQUENTIAL         *
+ *  DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM LOSS OF USE, DATA       *
+ *  OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR OTHER        *
+ *  TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR         *
+ *  PERFORMANCE OF THIS SOFTWARE.                                            *
+ *                                                                           *
+ ****************************************************************************/
+
+#ifndef ns_ll_ext_h
+#define ns_ll_ext_h
+
+#include "object.h"
+
+class Packet;
+class LLExt;
+
+class LLExtEvent : public Event {
+ public:
+  LLExt* llext;
+};
+
+class LLExtEventHandler : public Handler {
+ public:
+  virtual void handle(Event* event);
+};
+
+class LLExt : public LL, public Tap {
+ public:
+  LLExt();
+  virtual ~LLExt();
+	
+  virtual void recv(Packet* p, Handler* h);
+  virtual void sendDown(Packet* p);
+
+  // Allow us to do promiscuous mode by acting as a tap.
+  void tap(const Packet *p);
+
+  void setExtID(int newid) {extid_ = newid;}
+  int getExtID() {return extid_;}
+  int ready();
+  int getpending() { return packetpending_; }
+  void setpending(int newpend) { packetpending_ = newpend; };
+  void setpromiscuous(bool promisc);
+  
+ protected:
+  virtual int command(int argc, const char*const* argv);
+  int extid_;
+  int packetpending_;
+  LLExtEventHandler evhandle_;
+};
+
+#endif
diff -ruN --exclude='*.o' --exclude='autom4*' ns-2.34-pure/mac/ll.cc ns-2.34/mac/ll.cc
--- ns-2.34-pure/mac/ll.cc	2009-06-14 10:35:44.000000000 -0700
+++ ns-2.34/mac/ll.cc	2010-02-28 09:31:39.000000000 -0800
@@ -203,6 +203,9 @@
 			tx = arptable_->arpresolve(dst, p, this);
 			break;
 		}
+		if (PT_RAW == ch->ptype()) {
+			break;
+		}
 		//if (varp_) {
 		//tx = varp_->arpresolve(dst, p);
 		//break;
diff -ruN --exclude='*.o' --exclude='autom4*' ns-2.34-pure/mac/mac-802_11.cc ns-2.34/mac/mac-802_11.cc
--- ns-2.34-pure/mac/mac-802_11.cc	2009-06-14 10:35:44.000000000 -0700
+++ ns-2.34/mac/mac-802_11.cc	2010-02-28 09:31:39.000000000 -0800
@@ -39,9 +39,17 @@
  *   - Sushmita
  */
 
+/*
+ *	Modified by Nicolas Letor to support wifi elements.
+ * 	Performance Analysis of Telecommunication Systems (PATS) research group,
+ * 	Interdisciplinary Institute for Broadband Technology (IBBT) & Universiteit Antwerpen.
+ */
 #include "delay.h"
 #include "connector.h"
+#include "agent.h"
 #include "packet.h"
+#include "rawpacket.h"
+#include "packet_anno.h"
 #include "random.h"
 #include "mobilenode.h"
 
@@ -1054,6 +1062,39 @@
 	transmit(pktTx_, timeout);
 	return 0;
 }
+
+// helper function
+click_wifi_extra* 
+getWifiExtra(Packet* p)
+{
+  	struct hdr_cmn* chdr = HDR_CMN(p);
+	if (chdr->ptype() == PT_RAW){
+		hdr_raw* rhdr = hdr_raw::access(p);
+		if (rhdr->subtype == hdr_raw::MADWIFI) {
+			click_wifi_extra* ceh = (click_wifi_extra*)(p->accessdata());
+			if (ceh->magic == WIFI_EXTRA_MAGIC){
+				return ceh;
+			}			
+		}
+	}
+	return 0;
+}
+
+click_wifi* 
+getWifi(Packet* p)
+{
+  	struct hdr_cmn* chdr = HDR_CMN(p);
+	if (chdr->ptype() == PT_RAW){
+		hdr_raw* rhdr = hdr_raw::access(p);
+		if (rhdr->subtype == hdr_raw::MADWIFI) {
+			click_wifi_extra* ceh = (click_wifi_extra*)(p->accessdata());
+			if (ceh->magic == WIFI_EXTRA_MAGIC){
+				return (click_wifi*)(p->accessdata() + sizeof(click_wifi_extra));
+			}			
+		}
+	}
+	return 0;
+}
 /*
  * Low-level transmit functions that actually place the packet onto
  * the channel.
@@ -1072,10 +1113,26 @@
 	 *  If the size of the packet is larger than the
 	 *  RTSThreshold, then perform the RTS/CTS exchange.
 	 */
-	if( (u_int32_t) HDR_CMN(pktTx_)->size() < macmib_.getRTSThreshold() ||
+	click_wifi_extra* ceh = getWifiExtra(pktTx_);
+	if ((ceh != 0) && ((u_int32_t) dst != MAC_BROADCAST)) { 	
+		// madwifi case
+		if (!(ceh->flags & WIFI_EXTRA_DO_RTS_CTS)) {
+			Packet::free(p);
+			//p = 0;
+			return;
+		}
+		
+		if	( ceh->power > 0){
+			p->txinfo_.setPrLevel(ceh->power);	
+		}
+
+	} else {
+		// normal case
+		if( (u_int32_t) HDR_CMN(pktTx_)->size() < macmib_.getRTSThreshold() ||
             (u_int32_t) dst == MAC_BROADCAST) {
-		Packet::free(p);
-		return;
+			Packet::free(p);
+			return;
+		}
 	}
 
 	ch->uid() = 0;
@@ -1219,6 +1276,7 @@
 	/*
 	 * Update the MAC header
 	 */
+	click_wifi_extra* ceh = getWifiExtra(p);
 	ch->size() += phymib_.getHdrLen11();
 
 	dh->dh_fc.fc_protocol_version = MAC_ProtocolVersion;
@@ -1247,6 +1305,20 @@
 	if(dst != MAC_BROADCAST) {
 		/* store data tx time for unicast packets */
 		ch->txtime() = txtime(ch->size(), dataRate_);
+		p->txinfo_.setRate(dataRate_);
+
+		// nsmadwifi
+		if ( ceh != 0 ){
+			
+			if ( ceh->rate > 0){
+				double rate = ((short int)(ceh->rate))*500000; 
+				ch->txtime() = txtime(ch->size(),rate);
+				p->txinfo_.setRate(rate);
+			}
+			if	( ceh->power > 0){
+				p->txinfo_.setPrLevel(ceh->power);	
+			}
+		}
 		
 		dh->dh_duration = usec(txtime(phymib_.getACKlen(), basicRate_)
 				       + phymib_.getSIFS());
@@ -1256,6 +1328,7 @@
 	} else {
 		/* store data tx time for broadcast packets (see 9.6) */
 		ch->txtime() = txtime(ch->size(), basicRate_);
+		p->txinfo_.setRate(basicRate_);
 		
 		dh->dh_duration = 0;
 	}
@@ -1276,7 +1349,25 @@
 
 	ssrc_ += 1;			// STA Short Retry Count
 		
+	bool failure = false;
+	double count = ssrc_;
+
+	click_wifi_extra* ceh = getWifiExtra(pktTx_);
+	if ((ceh != 0) && (ceh->max_tries != 0)){
+		ceh->retries = ssrc_;
+		if (count <= ceh->max_tries){
+		
+		} else {
+			failure = true;	
+		}
+	} else {
 	if(ssrc_ >= macmib_.getShortRetryLimit()) {
+			failure = true;	
+		}	
+	}
+
+
+	if(failure){
 		discard(pktRTS_, DROP_MAC_RETRY_COUNT_EXCEEDED); pktRTS_ = 0;
 		/* tell the callback the send operation failed 
 		   before discarding the packet */
@@ -1292,7 +1383,24 @@
                         ch->xmit_failure_(pktTx_->copy(),
                                           ch->xmit_failure_data_);
                 }
+
+		if (ceh != 0){
+			Packet* p2 = pktTx_->copy();
+			click_wifi_extra* ceh2 = getWifiExtra(p2);
+			ceh2->flags |= WIFI_EXTRA_TX_FAIL;
+			ceh2->flags |= WIFI_EXTRA_TX;
+			struct hdr_cmn* ch2 = HDR_CMN(p2); 
+			ch2->direction() = hdr_cmn::UP; 
+			//printf("(%d)....discarding RTS:%x\n",index_,pktRTS_);
 		discard(pktTx_, DROP_MAC_RETRY_COUNT_EXCEEDED); 
+			uptarget_->recv(p2, (Handler*) 0);
+		
+		} else {
+			//printf("(%d)....discarding RTS:%x\n",index_,pktRTS_);
+			discard(pktTx_, DROP_MAC_RETRY_COUNT_EXCEEDED); 
+		}
+		
+		pktRTS_ = 0;
 		pktTx_ = 0;
 		ssrc_ = 0;
 		rst_cw();
@@ -1361,7 +1469,44 @@
 		sendPROBEREQ(MAC_BROADCAST);
 		return;
 	}	
-	if(*rcount >= thresh) {
+	bool failure = false;
+	double count = *rcount;
+	click_wifi_extra* ceh = getWifiExtra(pktTx_);
+
+	if ((ceh != 0) && (ceh->max_tries != 0)){
+		ceh->retries = (*rcount);
+			
+		if (count <= ceh->max_tries){
+			double rate = ((short int)(ceh->rate))*500000; 
+			ch->txtime() = txtime(ch->size(),rate);
+			pktTx_->txinfo_.setRate(rate);
+		} else if ( (count-=ceh->max_tries) <= ceh->max_tries1 ){
+			double rate = ((short int)(ceh->rate1))*500000; 
+			ch->txtime() = txtime(ch->size(),rate);
+			pktTx_->txinfo_.setRate(rate);
+			ceh->flags |= WIFI_EXTRA_TX_USED_ALT_RATE;
+		} else if ( (count-=ceh->max_tries1) <= ceh->max_tries2 ){
+			double rate = ((short int)(ceh->rate2))*500000; 
+			ch->txtime() = txtime(ch->size(),rate);
+			pktTx_->txinfo_.setRate(rate);
+			ceh->flags |= WIFI_EXTRA_TX_USED_ALT_RATE;
+		} else if ( (count-=ceh->max_tries2) <= ceh->max_tries3 ){
+			double rate = ((short int)(ceh->rate3))*500000; 
+			ch->txtime() = txtime(ch->size(),rate);
+			pktTx_->txinfo_.setRate(rate);
+			ceh->flags |= WIFI_EXTRA_TX_USED_ALT_RATE;
+		} else {
+			failure = true;	
+		}
+		
+	} else {
+		if(*rcount >= thresh) {
+			failure = true;	
+		}	
+	}
+
+	//if(*rcount >= thresh) {
+	if(failure){
 		/* IEEE Spec section 9.2.3.5 says this should be greater than
 		   or equal */
 		macmib_.FailedCount++;
@@ -1375,7 +1520,24 @@
                                           ch->xmit_failure_data_);
                 }
 
-		discard(pktTx_, DROP_MAC_RETRY_COUNT_EXCEEDED); 
+		if (ceh != 0){
+			Packet* p2 = pktTx_->copy();
+			click_wifi_extra* ceh2 = getWifiExtra(p2);
+			ceh2->flags |= WIFI_EXTRA_TX_FAIL;
+			ceh2->flags |= WIFI_EXTRA_TX;
+			struct hdr_cmn* ch2 = HDR_CMN(p2); 
+			ch2->direction() = hdr_cmn::UP; 
+			
+			// drop packet first
+			discard(pktTx_, DROP_MAC_RETRY_COUNT_EXCEEDED); 
+			// send feedback to madwifi 
+			uptarget_->recv(p2, (Handler*) 0);
+		
+		} else {
+			discard(pktTx_, DROP_MAC_RETRY_COUNT_EXCEEDED); 
+			//printf("(%d)DATA discarded: count exceeded\n",index_);
+		}
+		
 		pktTx_ = 0;
 		*rcount = 0;
 		rst_cw();
@@ -1384,7 +1546,13 @@
 		struct hdr_mac802_11 *dh;
 		dh = HDR_MAC802_11(pktTx_);
 		dh->dh_fc.fc_retry = 1;
-
+		
+		// nletor
+		click_wifi* cwh = getWifi(pktTx_);
+		if (cwh != 0){
+			cwh->i_fc[1] |= WIFI_FC1_RETRY;	
+		}
+		//!nletor 
 
 		sendRTS(ETHER_ADDR(mh->dh_ra));
 		inc_cw();
@@ -1584,6 +1752,8 @@
 	 *
 	 */
 
+	click_wifi_extra* rceh = getWifiExtra(p);
+
 	/*
 	 *  If the interface is currently in transmit mode, then
 	 *  it probably won't even see this packet.  However, the
@@ -1593,6 +1763,9 @@
 	 */
 	if(tx_active_ && hdr->error() == 0) {
 		hdr->error() = 1;
+		if(rceh != 0 && hdr->error()){
+			rceh->flags |= WIFI_EXTRA_RX_ERR;
+		}
 	}
 
 	if(rx_state_ == MAC_IDLE) {
@@ -1678,8 +1851,12 @@
 
         /* tap out - */
         if (tap_ && type == MAC_Type_Data &&
-            MAC_Subtype_Data == subtype ) 
-		tap_->tap(pktRx_);
+            MAC_Subtype_Data == subtype ) {
+		if (!tap_filterown_ ||
+		    ((dst != (u_int32_t)index_) && (dst != MAC_BROADCAST))) {
+			tap_->tap(pktRx_);
+		}
+	}
 	/*
 	 * Adaptive Fidelity Algorithm Support - neighborhood infomation 
 	 * collection
@@ -1905,6 +2082,7 @@
 	 * Adjust the MAC packet size - ie; strip
 	 * off the mac header
 	 */
+	click_wifi_extra* rceh = getWifiExtra(p);
 	ch->size() -= phymib_.getHdrLen11();
 	ch->num_forwards() += 1;
 
@@ -1912,7 +2090,9 @@
 	 *  If we sent a CTS, clean up...
 	 */
 	if(dst != MAC_BROADCAST) {
-		if(size >= macmib_.getRTSThreshold()) {
+		//if(size >= macmib_.getRTSThreshold()) {
+		if ( 	(!rceh && size >= macmib_.getRTSThreshold()) ||
+			 	( rceh && pktCTRL_)){
 			if (tx_state_ == MAC_CTS) {
 				assert(pktCTRL_);
 				Packet::free(pktCTRL_); pktCTRL_ = 0;
@@ -2063,7 +2243,9 @@
 			assert(mhBackoff_.busy() == 0);
 			mhBackoff_.start(cw_, is_idle());
 		}
-		goto done;
+		tx_resume();
+		mac_log(p);
+		return;
 	}
 	if(tx_state_ != MAC_SEND) {
 		discard(p, DROP_MAC_INVALID_STATE);
@@ -2071,6 +2253,17 @@
 	}
 	assert(pktTx_);
 
+	// nletor
+	Packet* p2 = 0;	//prepare feedback WIFI_EXTRA_TX
+	click_wifi_extra* ceh = getWifiExtra(pktTx_);
+	if (ceh != 0){
+		p2 = pktTx_->copy();
+		click_wifi_extra* ceh2 = getWifiExtra(p2);
+		ceh2->flags |= WIFI_EXTRA_TX;
+		struct hdr_cmn* ch2 = HDR_CMN(p2); 
+		ch2->direction() = hdr_cmn::UP; 
+	} 
+	//!nletor
 	mhSend_.stop();
 
 	/*
@@ -2095,11 +2288,15 @@
 
 	assert(mhBackoff_.busy() == 0);
 	mhBackoff_.start(cw_, is_idle());
-done:
 
 	tx_resume();
 
 	mac_log(p);
+	// nletor
+	if (p2 != 0 ){
+		uptarget_->recv(p2, (Handler*) 0);	// send feedback WIFI_EXTRA_TX
+	}
+	//!nletor
 }
 
 
diff -ruN --exclude='*.o' --exclude='autom4*' ns-2.34-pure/mac/mac-802_11.h ns-2.34/mac/mac-802_11.h
--- ns-2.34-pure/mac/mac-802_11.h	2009-06-14 10:35:44.000000000 -0700
+++ ns-2.34/mac/mac-802_11.h	2010-02-28 09:31:39.000000000 -0800
@@ -43,7 +43,6 @@
 // Added by Sushmita to support event tracing (singal@nunki.usc.edu)
 #include "address.h"
 #include "ip.h"
-
 #include "mac-timers.h"
 #include "marshall.h"
 #include <math.h>
diff -ruN --exclude='*.o' --exclude='autom4*' ns-2.34-pure/mac/mac-802_3.cc ns-2.34/mac/mac-802_3.cc
--- ns-2.34-pure/mac/mac-802_3.cc	2009-06-14 10:35:44.000000000 -0700
+++ ns-2.34/mac/mac-802_3.cc	2010-02-28 09:31:39.000000000 -0800
@@ -298,10 +298,6 @@
 	hdr_mac *mh= HDR_MAC(p);
 	int dst= mh->macDA();
 
-	if ((dst != BCAST_ADDR) && (dst != index_)) {
-		Packet::free(p);
-		goto done;
-	}
 	/* Strip off the mac header and padding if any */
 	ch->size() -= (ETHER_HDR_LEN + mh->padding_);
 
@@ -314,6 +310,19 @@
 		goto done;
 	}
 
+	/* tap out - */
+	if (tap_) {
+		if (!tap_filterown_ ||
+		    ((dst != index_) && (dst != BCAST_ADDR))) {
+			tap_->tap(p);
+		}
+	}
+
+
+	if ((dst != BCAST_ADDR) && (dst != index_)) {
+		Packet::free(p);
+		goto done;
+	}
 
 	/* we could schedule an event to account for mac-delay */
 	
diff -ruN --exclude='*.o' --exclude='autom4*' ns-2.34-pure/mac/mac.h ns-2.34/mac/mac.h
--- ns-2.34-pure/mac/mac.h	2009-06-14 10:35:44.000000000 -0700
+++ ns-2.34/mac/mac.h	2010-02-28 09:31:39.000000000 -0800
@@ -179,7 +179,10 @@
 	virtual void sendUp(Packet *p);
 
 	virtual void resume(Packet* p = 0);
-	virtual void installTap(Tap *t) { tap_ = t; }
+	virtual void installTap(Tap *t,bool filterown = false) {
+		tap_ = t;
+		tap_filterown_ = filterown;
+	}
 	
 	inline double txtime(int bytes) {
 		return (8. * bytes / bandwidth_);
@@ -233,6 +236,7 @@
         
 	Phy *netif_;            // network interface
         Tap *tap_;              // tap agent
+	bool tap_filterown_;    // filter tap packets destined for use anyhow
 	LL *ll_;             	// LL this MAC is connected to
 	Channel *channel_;	// channel this MAC is connected to
 
diff -ruN --exclude='*.o' --exclude='autom4*' ns-2.34-pure/mac/phy.cc ns-2.34/mac/phy.cc
--- ns-2.34-pure/mac/phy.cc	2009-06-14 10:35:44.000000000 -0700
+++ ns-2.34/mac/phy.cc	2010-02-28 09:31:39.000000000 -0800
@@ -68,6 +68,16 @@
 			tcl.resultf("%d", index_);
 			return TCL_OK;
 		}
+		
+		if (strcmp(argv[1],"getchannel") == 0) {
+			if (channel_) {
+				tcl.resultf("%s",channel_->name());
+			}
+			else {
+				tcl.resultf("%s","");
+			}
+			return TCL_OK;
+		}
 	}
 
 	else if(argc == 3) {
diff -ruN --exclude='*.o' --exclude='autom4*' ns-2.34-pure/mac/wireless-phy.cc ns-2.34/mac/wireless-phy.cc
--- ns-2.34-pure/mac/wireless-phy.cc	2009-06-14 10:35:44.000000000 -0700
+++ ns-2.34/mac/wireless-phy.cc	2010-02-28 09:31:39.000000000 -0800
@@ -37,9 +37,13 @@
  * Ported from CMU/Monarch's code, nov'98 -Padma Haldar.
  * wireless-phy.cc
  */
-
+/*
+ *	Modified by Nicolas Letor to support wifi elements.
+ * 	Performance Analysis of Telecommunication Systems (PATS) research group,
+ * 	Interdisciplinary Institute for Broadband Technology (IBBT) & Universiteit Antwerpen.
+ */
 #include <math.h>
-
+#include <limits>
 #include <packet.h>
 
 #include <mobilenode.h>
@@ -55,6 +59,8 @@
 #include <sys/param.h>  /* for MIN/MAX */
 
 #include "diffusion/diff_header.h"
+#include "rawpacket.h"
+#include "packet_anno.h"
 
 void Sleep_Timer::expire(Event *) {
 	a_->UpdateSleepEnergy();
@@ -98,6 +104,28 @@
 	bind("freq_", &freq_);
 	bind("L_", &L_);
 	
+	// nletor -- multirate madwifi configuration
+	RateCount_ = 0;
+	bind("RateCount_",&RateCount_);
+	if (RateCount_ > 0) {
+		//ratelist = RateList(RateCount_);
+		//rxlist = RXList(RateCount_);
+		char buffer[32];
+		for (int i=0; i< RateCount_; i++) {
+				double rate;
+				sprintf(buffer,"Rate%d",i);
+				bind_bw(buffer,&rate);
+				ratelist.push_back(rate);
+				
+				double thr;
+				sprintf(buffer,"RXThresh%d",i);
+				bind(buffer,&thr);
+				rxlist.push_back(thr);
+		}
+
+	}
+	//!nletor
+
 	lambda_ = SPEED_OF_LIGHT / freq_;
 
 	node_ = 0;
@@ -135,6 +163,7 @@
 WirelessPhy::command(int argc, const char*const* argv)
 {
 	TclObject *obj; 
+	Tcl& tcl = Tcl::instance();
 
 	if (argc==2) {
 		if (strcasecmp(argv[1], "NodeOn") == 0) {
@@ -157,7 +186,11 @@
 				update_energy_time_ = NOW;
 			}
 			return TCL_OK;
+		} else if (strcasecmp(argv[1], "getantenna") == 0) {
+			tcl.result(ant_->name());
+			return TCL_OK;
 		}
+
 	} else if(argc == 3) {
 		if (strcasecmp(argv[1], "setTxPower") == 0) {
 			Pt_consume_ = atof(argv[2]);
@@ -200,6 +233,9 @@
 	return Phy::command(argc,argv);
 }
  
+click_wifi_extra* 
+getWifiExtra(Packet* p);
+
 void 
 WirelessPhy::sendDown(Packet *p)
 {
@@ -314,6 +350,22 @@
 	 */
 	assert(initialized());
 
+	//unsigned char* pdat = p->accessdata();
+	
+	click_wifi_extra *ceh = 0;
+	struct hdr_cmn* chdr = HDR_CMN(p);
+	if (chdr->ptype() == PT_RAW){
+		hdr_raw* rhdr = hdr_raw::access(p);
+		if (rhdr->subtype == hdr_raw::MADWIFI) {
+			ceh = (click_wifi_extra*)(p->accessdata());
+			//u_int8_t rate = ceh->rate;
+			memset(ceh,0,sizeof(click_wifi_extra));
+			ceh->rate = int(p->txinfo_.getRate()/500000);
+			ceh->magic = WIFI_EXTRA_MAGIC;
+			//printf("Rate is %e Rate is %i and %i %i \n",p->txinfo_.getRate(),rate,int(p->txinfo_.getRate()/500000),ceh->rate);
+		} 
+	} 
+
 	PacketStamp s;
 	double Pr;
 	int pkt_recvd = 0;
@@ -344,11 +396,36 @@
 	if(propagation_) {
 		s.stamp((MobileNode*)node(), ant_, 0, lambda_);
 		Pr = propagation_->Pr(&p->txinfo_, &s, this);
+		if(ceh != 0){	
+			//analog to atheros formule -95dBm is lowest sens.
+			double LPr = (10 * log(Pr * 1000));
+			double LRXThr = (10 * log(RXThresh_ * 1000));
+			if (LPr < numeric_limits<double>::infinity()){
+				ceh->rssi = (short int)( (LPr - LRXThr ) * (60.0/100.0) );	
+				ceh->rssi = (ceh->rssi > 60) ? 60 : ceh->rssi;
+			} else {
+				ceh->rssi = 60;
+			}			
+		}
+
 		if (Pr < CSThresh_) {
 			pkt_recvd = 0;
 			goto DONE;
 		}
-		if (Pr < RXThresh_) {
+
+
+		double RXThr = RXThresh_; //rxlist[RateCount_ - 1];
+		
+		// compare to correct rate,moet nog aan gesleuteld worden
+		for (int i = 0; i < RateCount_; i++){
+			if (ratelist[i] >= p->txinfo_.getRate()){
+				RXThr = rxlist[i]; 	
+			}	
+		}
+		//printf("Rate is %e Pr is %e RXThr is %e\n",p->txinfo_.getRate(),Pr,RXThr);
+		
+		if (RateCount_ > 0 ) { 
+			if (Pr < RXThr) {
 			/*
 			 * We can detect, but not successfully receive
 			 * this packet.
@@ -362,10 +439,29 @@
 			       Pr,RXThresh);
 #endif
 		}
+		} else {
+			if (Pr < RXThresh_) {
+				/*
+				 * We can detect, but not successfully receive
+				 * this packet.
+				 */
+				hdr_cmn *hdr = HDR_CMN(p);
+				hdr->error() = 1;
+			#if DEBUG > 3
+				printf("SM %f.9 _%d_ drop pkt from %d low POWER %e/%e\n",
+				       Scheduler::instance().clock(), node()->index(),
+				       p->txinfo_.getNode()->index(),
+				       Pr,RXThresh);
+			#endif
+			}
+		}
 	}
 	if(modulation_) {
 		hdr_cmn *hdr = HDR_CMN(p);
 		hdr->error() = modulation_->BitError(Pr);
+		if(ceh != 0){
+			ceh->flags |= WIFI_EXTRA_RX_ERR;	
+		}
 	}
 	
 	/*
diff -ruN --exclude='*.o' --exclude='autom4*' ns-2.34-pure/mac/wireless-phy.h ns-2.34/mac/wireless-phy.h
--- ns-2.34-pure/mac/wireless-phy.h	2009-06-14 10:35:44.000000000 -0700
+++ ns-2.34/mac/wireless-phy.h	2010-02-28 09:31:39.000000000 -0800
@@ -42,6 +42,11 @@
 #ifndef ns_WirelessPhy_h
 #define ns_WirelessPhy_h
 
+#include <vector>
+#include <map>
+typedef std::vector< double > RateList;
+typedef std::vector< double > RXList;
+
 #include "propagation.h"
 #include "modulation.h"
 #include "omni-antenna.h"
@@ -119,6 +124,7 @@
 	double RXThresh_;	// receive power threshold (W)
 	double CSThresh_;	// carrier sense threshold (W)
 	double CPThresh_;	// capture threshold (db)
+  	int RateCount_;		// number of rates
   
 	Antenna *ant_;
 	Propagation *propagation_;	// Propagation Model
@@ -144,6 +150,8 @@
 
 	friend class Sleep_Timer;
 
+	RateList ratelist;
+	RXList rxlist;
 };
 
 #endif /* !ns_WirelessPhy_h */
diff -ruN --exclude='*.o' --exclude='autom4*' ns-2.34-pure/mobile/pattern-antenna.cc ns-2.34/mobile/pattern-antenna.cc
--- ns-2.34-pure/mobile/pattern-antenna.cc	1969-12-31 16:00:00.000000000 -0800
+++ ns-2.34/mobile/pattern-antenna.cc	2010-02-28 09:31:39.000000000 -0800
@@ -0,0 +1,238 @@
+
+/*
+ * Copyright (c) 2003 University of Colorado, Boulder
+ * All rights reserved.
+ *
+ */
+
+#include <antenna.h>
+#include <pattern-antenna.h> 
+#include <math.h>
+#include <iostream>
+#include <fstream>
+#include <string>
+
+static class PatternAntennaClass : public TclClass {
+public:
+  PatternAntennaClass() : TclClass("Antenna/PatternAntenna") {}
+  TclObject* create(int, const char*const*) {
+    return (new PatternAntenna);
+  }
+} class_PatternAntenna;
+
+PatternAntenna::PatternAntenna() {
+  Dir_ = 0.0;
+  bind("Dir_", &Dir_);
+}
+
+double
+PatternAntenna::normalize(double deg) {
+  while (360.0 <= deg) {
+    deg -= 360.0;
+  }
+
+  while (0.0 > deg) {
+    deg += 360.0;
+  }
+
+  return deg;
+}
+
+double
+PatternAntenna::get_angle(double dX, double dY) {
+  double angle;
+
+  // First take care of dX or both == 0
+  if ((0.0 == dY) && (0.0 == dX)) {
+    angle = 0.0;
+  }
+  else if (0.0 == dX) {
+    angle = M_PI/2.0;
+  }
+  else {
+    angle = atan2(dY,dX);
+    if (0.0 > angle) {
+      angle += 2*M_PI;
+    }
+  }
+
+  angle = (180.0/M_PI) * angle;
+
+  return angle;
+}
+
+PatternAntenna::gain_pattern::gain_pattern() {
+  samplecount_ = 0;
+  samples_ = 0;
+}
+
+PatternAntenna::gain_pattern::~gain_pattern() {
+  if (samples_) {
+    free(samples_);
+    samples_ = 0;
+  }
+}
+
+void
+PatternAntenna::gain_pattern::set_gain_pattern(int samplecount,double* samples)
+{
+  if (samples_) {
+    free(samples_);
+    samples_ = 0;
+    samplecount = 0;
+  }
+  samples_ = (double*)malloc(samplecount*sizeof(double));
+  samplecount_ = samplecount;
+  sample_quantum_ = 360.0/samplecount_;
+  memcpy(samples_,samples,samplecount*sizeof(double));
+}
+
+double
+PatternAntenna::gain_pattern::get_gain(double angle) {
+  // Find closest sample to angle.
+  // XXX Maybe interpolate between samples at some point?
+  int whichsamp = ( (int)((angle/sample_quantum_) + 0.5) ) % samplecount_;
+  return samples_[whichsamp];
+}
+
+void
+PatternAntenna::gain_pattern::copy_pattern(gain_pattern& pat) {
+  set_gain_pattern(pat.samplecount_,pat.samples_);
+}
+
+// return the gain for a signal to a node at vector dX, dY, dZ
+// from the transmitter at wavelength lambda  
+double
+PatternAntenna::getTxGain(double dX, double dY, double dZ, double l) {
+  double angle = get_angle(dX,dY);
+  return horiz_tx_gain_.get_gain(angle);
+}
+
+// return the gain for a signal from a node at vector dX, dY, dZ
+// from the receiver at wavelength lambda
+double
+PatternAntenna::getRxGain(double dX, double dY, double dZ, double l) {
+  double angle = get_angle(dX,dY);
+  return horiz_rx_gain_.get_gain(angle);
+}
+
+void
+PatternAntenna::setHorizRxGainPattern(int samplecount, double* samples) {
+  horiz_rx_gain_.set_gain_pattern(samplecount,samples);
+}
+
+
+void
+PatternAntenna::setHorizTxGainPattern(int samplecount, double* samples) {
+  horiz_tx_gain_.set_gain_pattern(samplecount,samples);
+}
+
+
+// return a pointer to a copy of this antenna that will return the 
+// same thing for get{Rx,Tx}Gain that this one would at this point
+// in time.  This is needed b/c if a pkt is sent with a directable
+// antenna, this antenna may be have been redirected by the time we
+// call getTxGain on the copy to determine if the pkt is received.  
+Antenna*
+PatternAntenna::copy() {
+  PatternAntenna* antcopy =
+    (PatternAntenna*)TclObject::New("Antenna/PatternAntenna");
+  antcopy->horiz_rx_gain_.copy_pattern(horiz_rx_gain_);
+  antcopy->horiz_tx_gain_.copy_pattern(horiz_tx_gain_);
+  return antcopy;
+}
+
+void
+PatternAntenna::release() {
+  TclObject::Delete((TclObject*)this);
+}
+
+int
+PatternAntenna::read_pattern_from_msi(const char* msifile) {
+  // XXX This code is by no means great. It is simplistic
+  // and fragile, but I think it'll work well enough for the
+  // simplistic kinds of tasks we'll give it.
+  double gain;
+  double* hpoints = 0;
+  int hpointcount = 0;
+  string units;
+  string nxttok;
+  int i = 0;
+  //int result = 0;
+  int finalresult = 0;
+  ifstream msistrm(msifile);
+  // MSI uses 0 deg as due north, we have 0 deg as due east (and 90 as N).
+  // Add 90 deg to MSI numbers to fix this.
+  int hoffset = 90;
+  // MSI can use either dBd or dBi. I believe that ns-2 uses dBi.
+  // We'll set this appropriately when we get the units.
+  double gainoffset = 0.0;
+
+  if (!msistrm) {
+    return -1;
+  }
+
+  while (!msistrm.eof()) {
+    msistrm >> nxttok;
+
+    if (msistrm.eof()) {
+      continue;
+    }
+    else if ("GAIN" == nxttok) {
+      msistrm >> gain;
+      msistrm >> units;
+      //cout << "GAIN " << gain  << " " << units << endl;
+      gainoffset = 0.0;
+      if ("dBd" == units) {
+	gainoffset = 2.15;
+      }
+    }
+    else if ("HORIZONTAL" == nxttok) {
+      msistrm >> hpointcount;
+      //cout << "Horizontal pointcount: " << hpointcount << endl;
+      hpoints = (double*) malloc(hpointcount*sizeof(double));
+      for (i=0;i<hpointcount;i++) {
+	double index = 0;
+	double curpoint = 0;
+	msistrm >> index;
+	msistrm >> curpoint;
+	//cout << "POINTS: " << index << " " << curpoint << endl;
+	int hindx = (i + hoffset) % 360;
+	if (0 > hindx) hindx += 360;
+	hpoints[hindx] = gain - curpoint + gainoffset;
+      }
+    }
+  }
+
+  if (hpoints) {
+    if (hpointcount) {
+      // Assume same gain for Tx and Rx
+      setHorizRxGainPattern(hpointcount,hpoints);
+      setHorizTxGainPattern(hpointcount,hpoints);
+    }
+    free(hpoints);
+    hpoints = 0;
+    hpointcount = 0;
+  }
+  return finalresult;
+}
+
+int
+PatternAntenna::command(int argc, const char*const* argv)
+{
+  Tcl& tcl = Tcl::instance();
+  if (2 == argc) {
+  }
+  else if (3 == argc) {
+    if(strcmp(argv[1], "loadmsi") == 0) {
+      int result = read_pattern_from_msi(argv[2]);
+      tcl.resultf("%d",result);
+      return TCL_OK;
+    }
+  }
+  else if (4 == argc) {
+  } else if (argc == 5) {
+  }
+
+  return Antenna::command(argc, argv);
+}
diff -ruN --exclude='*.o' --exclude='autom4*' ns-2.34-pure/mobile/pattern-antenna.h ns-2.34/mobile/pattern-antenna.h
--- ns-2.34-pure/mobile/pattern-antenna.h	1969-12-31 16:00:00.000000000 -0800
+++ ns-2.34/mobile/pattern-antenna.h	2010-02-28 09:31:39.000000000 -0800
@@ -0,0 +1,65 @@
+/*
+ * Copyright (c) 2003 University of Colorado, Boulder
+ * All rights reserved.
+ *
+ */
+
+#ifndef ns_patternantenna_h
+#define ns_patternantenna_h
+
+#include <antenna.h>
+
+class PatternAntenna : public Antenna {
+
+public:
+  PatternAntenna();
+  virtual int command(int argc, const char*const* argv);
+  // return the gain for a signal to a node at vector dX, dY, dZ
+  // from the transmitter at wavelength lambda  
+  virtual double getTxGain(double, double, double, double);
+
+  // return the gain for a signal from a node at vector dX, dY, dZ
+  // from the receiver at wavelength lambda
+  virtual double getRxGain(double, double, double, double);
+
+  // return a pointer to a copy of this antenna that will return the 
+  // same thing for get{Rx,Tx}Gain that this one would at this point
+  // in time.  This is needed b/c if a pkt is sent with a directable
+  // antenna, this antenna may be have been redirected by the time we
+  // call getTxGain on the copy to determine if the pkt is received.  
+  virtual Antenna* copy();
+  virtual void release();
+
+  void setDir(double newdir) { Dir_ = newdir; }
+  double getDir() { return Dir_; }
+
+  void setHorizRxGainPattern(int samplecount, double* samples);
+  void setHorizTxGainPattern(int samplecount, double* samples);
+
+  static double get_angle(double dX, double dY);
+  static double normalize(double deg);
+
+  int read_pattern_from_msi(const char* msifile);
+
+protected:
+  double Dir_;
+  typedef class gain_pattern {
+  public:
+    gain_pattern();
+    ~gain_pattern();
+    void set_gain_pattern(int samplecount, double* samples);
+    double get_gain(double angle);
+    void copy_pattern(gain_pattern& pat);
+
+  protected:
+    int samplecount_;
+    double* samples_;
+    double sample_quantum_;
+  };
+
+  gain_pattern horiz_tx_gain_;
+  gain_pattern horiz_rx_gain_;
+};
+
+
+#endif // ns_uniantenna_h
diff -ruN --exclude='*.o' --exclude='autom4*' ns-2.34-pure/mobile/uni-antenna.cc ns-2.34/mobile/uni-antenna.cc
--- ns-2.34-pure/mobile/uni-antenna.cc	1969-12-31 16:00:00.000000000 -0800
+++ ns-2.34/mobile/uni-antenna.cc	2010-02-28 09:31:39.000000000 -0800
@@ -0,0 +1,197 @@
+
+/* -*-	Mode:C++; c-basic-offset:8; tab-width:8; indent-tabs-mode:t -*- */
+/*
+ * Copyright (c) 1997 Regents of the University of California.
+ * All rights reserved.
+ *
+ * Redistribution and use in source and binary forms, with or without
+ * modification, are permitted provided that the following conditions
+ * are met:
+ * 1. Redistributions of source code must retain the above copyright
+ *    notice, this list of conditions and the following disclaimer.
+ * 2. Redistributions in binary form must reproduce the above copyright
+ *    notice, this list of conditions and the following disclaimer in the
+ *    documentation and/or other materials provided with the distribution.
+ * 3. All advertising materials mentioning features or use of this software
+ *    must display the following acknowledgement:
+ *	This product includes software developed by the Daedalus Research
+ *	Group at the University of California Berkeley.
+ * 4. Neither the name of the University nor of the Laboratory may be used
+ *    to endorse or promote products derived from this software without
+ *    specific prior written permission.
+ *
+ * THIS SOFTWARE IS PROVIDED BY THE REGENTS AND CONTRIBUTORS ``AS IS'' AND
+ * ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE
+ * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE
+ * ARE DISCLAIMED.  IN NO EVENT SHALL THE REGENTS OR CONTRIBUTORS BE LIABLE
+ * FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL
+ * DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS
+ * OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION)
+ * HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT
+ * LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY
+ * OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF
+ * SUCH DAMAGE.
+
+ * Ported from CMU/Monarch's code, nov'98 -Padma.
+   omni-antenna.cc
+   */
+
+#include <antenna.h>
+#include <uni-antenna.h> 
+#include <math.h>
+
+static class UniAntennaClass : public TclClass {
+public:
+  UniAntennaClass() : TclClass("Antenna/UniAntenna") {}
+  TclObject* create(int, const char*const*) {
+    return (new UniAntenna);
+  }
+} class_UniAntenna;
+
+UniAntenna::UniAntenna() : is_copy_(false) {
+  Gt_ = 1.0;
+  Gr_ = 1.0;
+  GtOmni_ = 0.0;
+  GrOmni_ = 0.0;
+  Dir_ = 0.0;
+  Width_ = 360.0;
+  bind("Gt_", &Gt_);
+  bind("Gr_", &Gr_);
+  bind("GtOmni_", &GtOmni_);
+  bind("GrOmni_", &GrOmni_);
+  bind("Dir_", &Dir_);
+  bind("Width_", &Width_);
+}
+
+double
+UniAntenna::normalize(double deg) {
+  while (360.0 <= deg) {
+    deg -= 360.0;
+  }
+
+  while (0.0 > deg) {
+    deg += 360.0;
+  }
+
+  return deg;
+}
+
+double
+UniAntenna::get_angle(double dX, double dY) {
+  double angle;
+
+  // First take care of dX or both == 0
+  if ((0.0 == dY) && (0.0 == dX)) {
+    angle = 0.0;
+  }
+  else if (0.0 == dX) {
+    angle = M_PI/2.0;
+  }
+  else {
+    angle = atan2(dY,dX);
+    if (0.0 > angle) {
+      angle += 2*M_PI;
+    }
+  }
+
+  angle = (180.0/M_PI) * angle;
+
+  return angle;
+}
+
+void
+UniAntenna::get_cone(double& lb, double& ub) {
+  lb = Dir_ - (Width_/2.0);
+  ub = Dir_ + (Width_/2.0);
+  lb = normalize(lb);
+  ub = normalize(ub);
+}
+
+bool
+UniAntenna::is_in_cone(double dX, double dY) {
+  bool result = false;
+  double angle = get_angle(dX,dY);
+  double lb, ub;
+  get_cone(lb,ub);
+
+  // If lb and ub are swapped, we had a wraparound. In this
+  // case, the specified range is the inverse of the cone
+  // we want to check for.
+  if (lb > ub) {
+    result = ! ((ub <= angle) && (angle <= lb));
+  }
+  else if (lb == ub) {
+    result = true;
+  }
+  else {
+    result = (lb <= angle) && (angle <= ub);
+  }
+
+  return result;
+}
+
+// return the gain for a signal to a node at vector dX, dY, dZ
+// from the transmitter at wavelength lambda  
+double
+UniAntenna::getTxGain(double dX, double dY, double dZ, double l) {
+  // XXX for now ignore dZ, just do 2 dimensions, and ignore lambda, too
+  double gain = Gt_;
+
+  // XXX very stupid model. Gt_ gain within cone, GtOmni_ outside.
+  // Hopefully good enough for what we need initially...
+  if (is_in_cone(dX,dY)) {
+    gain = Gt_;
+  }
+  else {
+    gain = GtOmni_;
+  }
+  
+  return gain;
+}
+
+// return the gain for a signal from a node at vector dX, dY, dZ
+// from the receiver at wavelength lambda
+double
+UniAntenna::getRxGain(double dX, double dY, double dZ, double l) {
+  // XXX for now ignore dZ, just do 2 dimensions, and ignore lambda, too.
+  double gain = Gr_;
+
+  // XXX very stupid model. Gr_ gain within cone, GrOmni_ outside.
+  // Hopefully good enough for what we need initially...
+  if (is_in_cone(dX,dY)) {
+    gain = Gr_;
+  }
+  else {
+    gain = GrOmni_;
+  }
+
+  return gain;
+}
+
+// return a pointer to a copy of this antenna that will return the 
+// same thing for get{Rx,Tx}Gain that this one would at this point
+// in time.  This is needed b/c if a pkt is sent with a directable
+// antenna, this antenna may be have been redirected by the time we
+// call getTxGain on the copy to determine if the pkt is received.  
+Antenna*
+UniAntenna::copy() {
+  UniAntenna* antcopy = (UniAntenna*)TclObject::New("Antenna/UniAntenna");
+  antcopy->X_ = X_;
+  antcopy->Y_ = Y_;
+  antcopy->Z_ = Z_;
+  antcopy->Gt_ = Gt_;
+  antcopy->Gr_ = Gr_;
+  antcopy->Dir_ = Dir_;
+  antcopy->Width_ = Width_;
+  antcopy->is_copy_ = true;
+  return antcopy;
+}
+
+void
+UniAntenna::release() {
+  if (is_copy_) {
+    TclObject::Delete((TclObject*)this);
+  }
+}
+
+
diff -ruN --exclude='*.o' --exclude='autom4*' ns-2.34-pure/mobile/uni-antenna.h ns-2.34/mobile/uni-antenna.h
--- ns-2.34-pure/mobile/uni-antenna.h	1969-12-31 16:00:00.000000000 -0800
+++ ns-2.34/mobile/uni-antenna.h	2010-02-28 09:31:39.000000000 -0800
@@ -0,0 +1,82 @@
+/* -*-	Mode:C++; c-basic-offset:8; tab-width:8; indent-tabs-mode:t -*- */
+/*
+ * Copyright (c) 1997 Regents of the University of California.
+ * All rights reserved.
+ *
+ * Redistribution and use in source and binary forms, with or without
+ * modification, are permitted provided that the following conditions
+ * are met:
+ * 1. Redistributions of source code must retain the above copyright
+ *    notice, this list of conditions and the following disclaimer.
+ * 2. Redistributions in binary form must reproduce the above copyright
+ *    notice, this list of conditions and the following disclaimer in the
+ *    documentation and/or other materials provided with the distribution.
+ * 3. All advertising materials mentioning features or use of this software
+ *    must display the following acknowledgement:
+ *	This product includes software developed by the Computer Systems
+ *	Engineering Group at Lawrence Berkeley Laboratory.
+ * 4. Neither the name of the University nor of the Laboratory may be used
+ *    to endorse or promote products derived from this software without
+ *    specific prior written permission.
+ *
+ * THIS SOFTWARE IS PROVIDED BY THE REGENTS AND CONTRIBUTORS ``AS IS'' AND
+ * ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE
+ * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE
+ * ARE DISCLAIMED.  IN NO EVENT SHALL THE REGENTS OR CONTRIBUTORS BE LIABLE
+ * FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL
+ * DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS
+ * OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION)
+ * HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT
+ * LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY
+ * OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF
+ * SUCH DAMAGE.
+ */
+/* Ported from CMU/Monarch's code, nov'98 -Padma.
+   omni-antenna.h
+   omni-directional antenna
+
+*/
+
+#ifndef ns_uniantenna_h
+#define ns_uniantenna_h
+
+#include <antenna.h>
+
+class UniAntenna : public Antenna {
+
+public:
+  UniAntenna();
+
+  // return the gain for a signal to a node at vector dX, dY, dZ
+  // from the transmitter at wavelength lambda  
+  virtual double getTxGain(double, double, double, double);
+
+  // return the gain for a signal from a node at vector dX, dY, dZ
+  // from the receiver at wavelength lambda
+  virtual double getRxGain(double, double, double, double);
+
+  // return a pointer to a copy of this antenna that will return the 
+  // same thing for get{Rx,Tx}Gain that this one would at this point
+  // in time.  This is needed b/c if a pkt is sent with a directable
+  // antenna, this antenna may be have been redirected by the time we
+  // call getTxGain on the copy to determine if the pkt is received.  
+  virtual Antenna* copy();
+  virtual void release();
+
+  static double get_angle(double dX, double dY);
+  static double normalize(double deg);
+  bool is_in_cone(double dX, double dY);
+  void get_cone(double& lb,double& ub);
+
+protected:
+  double Gt_;			// gain of transmitter (db)
+  double Gr_;			// gain of receiver (db)
+  double GtOmni_;               // Tx gain outside of cone
+  double GrOmni_;               // Rx gain outside of cone
+  double Dir_;
+  double Width_;
+  bool is_copy_;
+};
+
+
+#endif // ns_uniantenna_h
diff -ruN --exclude='*.o' --exclude='autom4*' ns-2.34-pure/queue/clickqueue.cc ns-2.34/queue/clickqueue.cc
--- ns-2.34-pure/queue/clickqueue.cc	1969-12-31 16:00:00.000000000 -0800
+++ ns-2.34/queue/clickqueue.cc	2010-02-28 09:31:39.000000000 -0800
@@ -0,0 +1,144 @@
+/*
+ * clickqueue.cc
+ * Special queue which runs the external Click router when it unblocks
+ *
+ */
+
+/*****************************************************************************
+ *  Copyright 2002, Univerity of Colorado at Boulder.                        *
+ *                                                                           *
+ *                        All Rights Reserved                                *
+ *                                                                           *
+ *  Permission to use, copy, modify, and distribute this software and its    *
+ *  documentation for any purpose other than its incorporation into a        *
+ *  commercial product is hereby granted without fee, provided that the      *
+ *  above copyright notice appear in all copies and that both that           *
+ *  copyright notice and this permission notice appear in supporting         *
+ *  documentation, and that the name of the University not be used in        *
+ *  advertising or publicity pertaining to distribution of the software      *
+ *  without specific, written prior permission.                              *
+ *                                                                           *
+ *  UNIVERSITY OF COLORADO DISCLAIMS ALL WARRANTIES WITH REGARD TO THIS      *
+ *  SOFTWARE, INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY AND        *
+ *  FITNESS FOR ANY PARTICULAR PURPOSE.  IN NO EVENT SHALL THE UNIVERSITY    *
+ *  OF COLORADO BE LIABLE FOR ANY SPECIAL, INDIRECT OR CONSEQUENTIAL         *
+ *  DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM LOSS OF USE, DATA       *
+ *  OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR OTHER        *
+ *  TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR         *
+ *  PERFORMANCE OF THIS SOFTWARE.                                            *
+ *                                                                           *
+ ****************************************************************************/
+
+#include <stdlib.h>
+#include <ctype.h>
+#include <sys/time.h>
+#include <unistd.h>
+//#include <stl.h>
+//#include <hash_map.h>
+#include <map>
+#include <math.h>
+#include <string>
+#include <click/simclick.h>
+#include "packet.h"
+#include "extrouter.h"
+#include "classifier.h"
+#include "classifier-ext.h"
+#include "classifier-click.h"
+#include "clickqueue.h"
+
+static class ClickQueueClass : public TclClass {
+public:
+	ClickQueueClass() : TclClass("Queue/ClickQueue") {}
+	TclObject* create(int, const char*const*) {
+		return (new ClickQueue);
+	}
+} class_click_queue;
+
+int 
+ClickQueue::command(int argc, const char*const* argv) {
+	if (3 == argc) {
+		if (!strcmp(argv[1],"setclickclassifier")) {
+			cc_ = (ClickClassifier*)TclObject::lookup(argv[2]);
+			return TCL_OK;
+		}
+	}
+	return Queue::command(argc, argv);
+}
+/*
+ * drop-tail
+ */
+ClickQueue::ClickQueue() { 
+	pq_ = new PacketQueue; 
+	qlim_ = 1;
+	cc_ = 0;
+}
+
+ClickQueue::~ClickQueue() {
+	delete pq_;
+}
+
+int
+ClickQueue::is_full() {
+	return (pq_->length() >= qlim_);
+}
+
+int
+ClickQueue::ready() {
+	return (!is_full() && !blocked());
+}
+
+void ClickQueue::enque(Packet* p)
+{
+	pq_->enque(p);
+	if (pq_->length() > qlim_) {
+		fprintf(stderr,"Hey!!! IFQ Overflow!!!\n");
+		Packet *pp = pq_->deque();
+		drop(pp);
+	}
+}
+
+Packet* ClickQueue::deque()
+{
+	Packet* retval = pq_->deque();
+	return retval;
+}
+
+void ClickQueue::on_unblock() {
+	//
+	// Queue has space - run the external router 
+	// and give it a chance to fill things up.
+	//
+	if (cc_) {
+		Scheduler& s = Scheduler::instance();
+		double dcurtime = s.clock();
+		double fracp, intp;
+		fracp = modf(dcurtime,&intp);
+		cc_->simclick_node_t::curtime.tv_sec = intp;
+		cc_->simclick_node_t::curtime.tv_usec = (fracp*1.0e6+0.5);
+		simclick_click_run(cc_);
+	}
+}
+
+#if 0
+void ClickQueue::runclick() {
+	if (is_full()) {
+		return;
+	}
+	//
+	// Queue has space - run the external router 
+	// and give it a chance to fill things up.
+	//
+	if (cc_) {
+		simclick_click clickinst = cc_->GetClickinst();
+		Scheduler& s = Scheduler::instance();
+		double dcurtime = s.clock();
+		simclick_simstate curstate;
+		memset(&curstate,0,sizeof(curstate));
+		double fracp, intp;
+		fracp = modf(dcurtime,&intp);
+		curstate.curtime.tv_sec = intp;
+		curstate.curtime.tv_usec = (fracp*1.0e6+0.5);
+		simclick_click_run(clickinst,&curstate);
+	}
+}
+#endif
diff -ruN --exclude='*.o' --exclude='autom4*' ns-2.34-pure/queue/clickqueue.h ns-2.34/queue/clickqueue.h
--- ns-2.34-pure/queue/clickqueue.h	1969-12-31 16:00:00.000000000 -0800
+++ ns-2.34/queue/clickqueue.h	2010-02-28 09:31:39.000000000 -0800
@@ -0,0 +1,61 @@
+/*
+ * clickqueue.h
+ * Special queue which runs the external Click router when it unblocks
+ *
+ */
+
+/*****************************************************************************
+ *  Copyright 2002, Univerity of Colorado at Boulder.                        *
+ *                                                                           *
+ *                        All Rights Reserved                                *
+ *                                                                           *
+ *  Permission to use, copy, modify, and distribute this software and its    *
+ *  documentation for any purpose other than its incorporation into a        *
+ *  commercial product is hereby granted without fee, provided that the      *
+ *  above copyright notice appear in all copies and that both that           *
+ *  copyright notice and this permission notice appear in supporting         *
+ *  documentation, and that the name of the University not be used in        *
+ *  advertising or publicity pertaining to distribution of the software      *
+ *  without specific, written prior permission.                              *
+ *                                                                           *
+ *  UNIVERSITY OF COLORADO DISCLAIMS ALL WARRANTIES WITH REGARD TO THIS      *
+ *  SOFTWARE, INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY AND        *
+ *  FITNESS FOR ANY PARTICULAR PURPOSE.  IN NO EVENT SHALL THE UNIVERSITY    *
+ *  OF COLORADO BE LIABLE FOR ANY SPECIAL, INDIRECT OR CONSEQUENTIAL         *
+ *  DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM LOSS OF USE, DATA       *
+ *  OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR OTHER        *
+ *  TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR         *
+ *  PERFORMANCE OF THIS SOFTWARE.                                            *
+ *                                                                           *
+ ****************************************************************************/
+
+#ifndef ns_clickqueue_h
+#define ns_clickqueue_h
+
+#include <string.h>
+#include "queue.h"
+#include "config.h"
+
+/*
+ * A degenerate queue designed to work with Click routers. Should only
+ * have 1 packet ever sitting in it since the queueing should be handled
+ * by Click. Also makes sure that simclick gets run whenever the queue
+ * empties and unblocks so that the polling simulated network driver
+ * will insert packets when it has them.
+ */
+class ClickQueue : public Queue {
+  public:
+	ClickQueue();
+	~ClickQueue();
+	void enque(Packet*);
+	Packet* deque();
+
+	int is_full();
+	int ready();
+  protected:
+	int command(int argc, const char*const* argv); 
+	ClickClassifier* cc_;
+	virtual void on_unblock();
+};
+
+#endif
diff -ruN --exclude='*.o' --exclude='autom4*' ns-2.34-pure/queue/queue.cc ns-2.34/queue/queue.cc
--- ns-2.34-pure/queue/queue.cc	2009-06-14 10:35:44.000000000 -0700
+++ ns-2.34/queue/queue.cc	2010-02-28 09:31:39.000000000 -0800
@@ -218,6 +218,7 @@
 			utilUpdate(last_change_, now, blocked_);
 			last_change_ = now;
 			blocked_ = 0;
+			on_unblock();
 		}
 		else {
 			utilUpdate(last_change_, now, blocked_);
@@ -227,6 +228,10 @@
 	}
 }
 
+void Queue::on_unblock() {
+	// Do nothing in base class
+}
+
 void Queue::reset()
 {
 	Packet* p;
diff -ruN --exclude='*.o' --exclude='autom4*' ns-2.34-pure/queue/queue.h ns-2.34/queue/queue.h
--- ns-2.34-pure/queue/queue.h	2009-06-14 10:35:44.000000000 -0700
+++ ns-2.34/queue/queue.h	2010-02-28 09:31:39.000000000 -0800
@@ -145,6 +145,7 @@
 protected:
 	Queue();
 	void reset();
+	virtual void on_unblock();
 	int qlim_;		/* maximum allowed pkts in queue */
 	int blocked_;		/* blocked now? */
 	int unblock_on_resume_;	/* unblock q on idle? */
diff -ruN --exclude='*.o' --exclude='autom4*' ns-2.34-pure/routing/extclickrouter.cc ns-2.34/routing/extclickrouter.cc
--- ns-2.34-pure/routing/extclickrouter.cc	1969-12-31 16:00:00.000000000 -0800
+++ ns-2.34/routing/extclickrouter.cc	2010-02-28 09:31:39.000000000 -0800
@@ -0,0 +1,20 @@
+/*
+ * XXX Insert CU copyright stuff here...
+ *
+ */
+
+#include "packet.h"
+#include "extrouter.h"
+#include "extclickrouter.h"
+
+ExtClickRouter::ExtClickRouter() {
+}
+
+ExtClickRouter::~ExtClickRouter() {
+}
+
+int ExtClickRouter::recv(Packet* p) {
+  int result = 0;
+
+  return result;
+}
diff -ruN --exclude='*.o' --exclude='autom4*' ns-2.34-pure/routing/extclickrouter.h ns-2.34/routing/extclickrouter.h
--- ns-2.34-pure/routing/extclickrouter.h	1969-12-31 16:00:00.000000000 -0800
+++ ns-2.34/routing/extclickrouter.h	2010-02-28 09:31:39.000000000 -0800
@@ -0,0 +1,27 @@
+/*
+ * XXX Insert CU copyright stuff here...
+ * 
+ * This defines the interface used by all external raw packet routing
+ * modules bolted on to ns.
+ *
+ */
+
+#ifndef __ns_extclickrouter_h__
+#define __ns_extclickrouter_h__
+
+class ExtClickRouter
+{
+
+ public:
+  ExtClickRouter();
+  virtual ~ExtClickRouter();
+  virtual int recv(Packet* p);
+
+  void* SetClickRouterPtr(void* crtptr);
+
+ private:
+  void* clickrouter_;
+  
+};
+
+#endif
diff -ruN --exclude='*.o' --exclude='autom4*' ns-2.34-pure/routing/extrouter.cc ns-2.34/routing/extrouter.cc
--- ns-2.34-pure/routing/extrouter.cc	1969-12-31 16:00:00.000000000 -0800
+++ ns-2.34/routing/extrouter.cc	2010-02-28 09:31:39.000000000 -0800
@@ -0,0 +1,15 @@
+/*
+ * XXX Insert CU copyright stuff here...
+ * 
+ * This defines the interface used by all external raw packet routing
+ * modules bolted on to ns.
+ *
+ */
+
+#include "packet.h"
+#include "extrouter.h"
+
+// Just here so we get virtual destructors
+ExtRouter::~ExtRouter() {
+}
+
diff -ruN --exclude='*.o' --exclude='autom4*' ns-2.34-pure/routing/extrouter.h ns-2.34/routing/extrouter.h
--- ns-2.34-pure/routing/extrouter.h	1969-12-31 16:00:00.000000000 -0800
+++ ns-2.34/routing/extrouter.h	2010-02-28 09:31:39.000000000 -0800
@@ -0,0 +1,29 @@
+/*
+ * XXX Insert CU copyright stuff here...
+ * 
+ * This defines the interface used by all external raw packet routing
+ * modules bolted on to ns.
+ *
+ */
+
+#ifndef __ns_extrouter_h__
+#define __ns_extrouter_h__
+
+class ExtRouter
+{
+
+public:
+  enum {
+    IFID_NONE = -1,
+    IFID_KERNELTAP = 0,
+    IFID_FIRSTIF = 1,
+    IFID_LASTIF = 32,
+    IFID_FIRSTIFDROP = 33,
+    IFID_LASTIFDROP = 64
+  };
+  virtual ~ExtRouter();
+  virtual int route(Packet* p) = 0;
+  
+};
+
+#endif
diff -ruN --exclude='*.o' --exclude='autom4*' ns-2.34-pure/routing/rtmodule.cc ns-2.34/routing/rtmodule.cc
--- ns-2.34-pure/routing/rtmodule.cc	2009-06-14 10:35:43.000000000 -0700
+++ ns-2.34/routing/rtmodule.cc	2010-02-28 09:31:39.000000000 -0800
@@ -137,6 +137,14 @@
         }
 } class_lms_routing_module;
 
+static class ClickRoutingModuleClass : public TclClass {
+public:
+        ClickRoutingModuleClass() : TclClass("RtModule/Click") {}
+        TclObject* create(int, const char*const*) {
+                return (new ClickRoutingModule);
+        }
+} class_click_routing_module;
+
 RoutingModule::RoutingModule() : 
 	next_rtm_(NULL), n_(NULL), classifier_(NULL) {
 	bind("classifier_", (TclObject**)&classifier_);
@@ -508,4 +516,3 @@
 	if (next_rtm_ != NULL)
 		next_rtm_->add_route(dst, target); 
 }
-
diff -ruN --exclude='*.o' --exclude='autom4*' ns-2.34-pure/routing/rtmodule.h ns-2.34/routing/rtmodule.h
--- ns-2.34-pure/routing/rtmodule.h	2009-06-14 10:35:43.000000000 -0700
+++ ns-2.34/routing/rtmodule.h	2010-02-28 09:31:39.000000000 -0800
@@ -178,4 +178,10 @@
 	virtual void add_route(char *dst, NsObject *target){}
 };
 
+class ClickRoutingModule : public RoutingModule {
+public:
+        ClickRoutingModule() : RoutingModule() {}
+        virtual const char* module_name() const { return "Click"; }
+};
+
 #endif //  ns_rtmodule_h
diff -ruN --exclude='*.o' --exclude='autom4*' ns-2.34-pure/tcl/ex/nsclick-raw-wlan.click ns-2.34/tcl/ex/nsclick-raw-wlan.click
--- ns-2.34-pure/tcl/ex/nsclick-raw-wlan.click	1969-12-31 16:00:00.000000000 -0800
+++ ns-2.34/tcl/ex/nsclick-raw-wlan.click	2010-02-28 09:31:39.000000000 -0800
@@ -0,0 +1,114 @@
+//
+//  Copyright 2002, Univerity of Colorado at Boulder.                        
+//                                                                            
+//                         All Rights Reserved                                
+//                                                                            
+//  Permission to use, copy, modify, and distribute this software and its    
+//  documentation for any purpose other than its incorporation into a        
+//  commercial product is hereby granted without fee, provided that the      
+//  above copyright notice appear in all copies and that both that           
+//  copyright notice and this permission notice appear in supporting         
+//  documentation, and that the name of the University not be used in        
+//  advertising or publicity pertaining to distribution of the software      
+//  without specific, written prior permission.                              
+//                                                                            
+//  UNIVERSITY OF COLORADO DISCLAIMS ALL WARRANTIES WITH REGARD TO THIS      
+//  SOFTWARE, INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY AND        
+//  FITNESS FOR ANY PARTICULAR PURPOSE.  IN NO EVENT SHALL THE UNIVERSITY    
+//  OF COLORADO BE LIABLE FOR ANY SPECIAL, INDIRECT OR CONSEQUENTIAL         
+//  DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM LOSS OF USE, DATA      
+//  OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR OTHER       
+//  TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR         
+//  PERFORMANCE OF THIS SOFTWARE.                                            
+//
+
+// nsclick-simple-lan.click
+//
+// This is a simple and stupid flat routing mechanism.
+// It broadcasts ARP requests if it wants to find a destination
+// address, and it responds to ARP requests made for it.
+
+elementclass DumbRouter {
+  $myaddr, $myaddr_ethernet |
+
+  class :: Classifier(12/0806 20/0001,12/0806 20/0002, -);
+  mypackets :: IPClassifier(dst host $myaddr,-);
+  myarpquerier :: ARPQuerier($myaddr,$myaddr_ethernet);
+  myarpresponder :: ARPResponder($myaddr $myaddr_ethernet);
+
+  rinfo::AvailableRates(DEFAULT 2 4 11 22)
+  rateselection::MadwifiRate(RT rinfo,ACTIVE true,OFFSET 4);
+  wlinfo :: WirelessInfo(SSID raw, BSSID 01:01:01:01:01:01,CHANNEL 2, IFID 0);
+  ethout :: Queue 	
+	-> WifiEncap(0x0, WIRELESS_INFO wlinfo)	
+	-> rateselection
+	-> PrintWifi(eth0_out)
+	-> ToDump(out_eth0,PER_NODE 1,ENCAP 802_11)
+	-> ExtraEncap()
+	-> ToSimDevice(eth0);
+
+  FromSimDevice(eth0,SNAPLEN 4096)
+	-> ExtraDecap()
+	-> filtertx::FilterTX()
+	-> ToDump(in_eth0,PER_NODE 1,ENCAP 802_11)
+	-> WifiDecap()
+	-> Print(eth0,64)	
+	-> HostEtherFilter($myaddr_ethernet)
+	-> class;
+
+  // transmission is fed back to the rate selection module	
+  filtertx[1]
+	-> [1]rateselection;
+
+  // ARP queries from other nodes go to the ARP responder module
+  class[0] -> myarpresponder;
+
+  // ARP responses go to our query module
+  class[1] -> [1]myarpquerier;
+
+  // All other packets get checked to see if they're meant for us
+  class[2]				
+	-> Strip(14)
+	-> CheckIPHeader
+	-> MarkIPHeader
+	-> GetIPAddress(16)
+	-> mypackets; 
+
+  // Packets for us go to "tap0" which sends them to the kernel
+  mypackets[0]
+	-> IPPrint(tokernel) 
+	-> ToDump(tokernel,2000,IP,PER_NODE 1) 
+	-> ToSimDevice(tap0,IP);
+
+  // Packets for other folks or broadcast packets get discarded
+  mypackets[1]
+	-> Print(discard,64)
+	-> ToDump(discard,2000,PER_NODE 1)
+	-> Discard;
+
+  // Packets sent out by the "kernel" get pushed into the ARP query module
+  FromSimDevice(tap0,SNAPLEN 4096)
+	-> CheckIPHeader 
+	-> IPPrint(fromkernel) 
+	-> ToDump(fromkernel,2000,IP,PER_NODE 1)
+	-> GetIPAddress(16)
+	-> myarpquerier;
+
+  // Both the ARP query and response modules send data out to
+  // the simulated network device, eth0.
+  myarpquerier
+	-> Print(fromarpquery,64)
+	-> ToDump(out_arpquery,PER_NODE 1)
+	-> ethout;
+
+  myarpresponder
+	-> Print(arpresponse,64)
+	-> ToDump(out_arprespond,PER_NODE 1)
+	-> ethout;
+}
+
+
+u :: DumbRouter(eth0,eth0);
+
+
+
diff -ruN --exclude='*.o' --exclude='autom4*' ns-2.34-pure/tcl/ex/nsclick-raw-wlan.tcl ns-2.34/tcl/ex/nsclick-raw-wlan.tcl
--- ns-2.34-pure/tcl/ex/nsclick-raw-wlan.tcl	1969-12-31 16:00:00.000000000 -0800
+++ ns-2.34/tcl/ex/nsclick-raw-wlan.tcl	2010-02-28 09:31:39.000000000 -0800
@@ -0,0 +1,331 @@
+#
+#  Copyright 2002, Univerity of Colorado at Boulder.                        
+#                                                                            
+#                         All Rights Reserved                                
+#                                                                            
+#  Permission to use, copy, modify, and distribute this software and its    
+#  documentation for any purpose other than its incorporation into a        
+#  commercial product is hereby granted without fee, provided that the      
+#  above copyright notice appear in all copies and that both that           
+#  copyright notice and this permission notice appear in supporting         
+#  documentation, and that the name of the University not be used in        
+#  advertising or publicity pertaining to distribution of the software      
+#  without specific, written prior permission.                              
+#                                                                            
+#  UNIVERSITY OF COLORADO DISCLAIMS ALL WARRANTIES WITH REGARD TO THIS      
+#  SOFTWARE, INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY AND        
+#  FITNESS FOR ANY PARTICULAR PURPOSE.  IN NO EVENT SHALL THE UNIVERSITY    
+#  OF COLORADO BE LIABLE FOR ANY SPECIAL, INDIRECT OR CONSEQUENTIAL         
+#  DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM LOSS OF USE, DATA      
+#  OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR OTHER       
+#  TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR         
+#  PERFORMANCE OF THIS SOFTWARE.                                            
+#
+# nsclick-simple-lan.tcl
+#
+# A sample nsclick script simulating a small LAN
+#
+
+#
+#	Modified by Nicolas Letor to support wifi elements.
+# 	Performance Analysis of Telecommunication Systems (PATS) research group,
+# 	Interdisciplinary Institute for Broadband Technology (IBBT) & Universiteit Antwerpen.
+#
+
+#
+# Set some general simulation parameters
+#
+
+#
+# Unity gain, omnidirectional antennas, centered 1.5m above each node.
+# These values are lifted from the ns-2 sample files.
+#
+
+Antenna/OmniAntenna set X_ 0
+Antenna/OmniAntenna set Y_ 0
+Antenna/OmniAntenna set Z_ 1.5
+Antenna/OmniAntenna set Gt_ 1.0
+Antenna/OmniAntenna set Gr_ 1.0
+
+#
+# Initialize the SharedMedia interface with parameters to make
+# it work like the 914MHz Lucent WaveLAN DSSS radio interface
+# These are taken directly from the ns-2 sample files.
+#
+Phy/WirelessPhy set CPThresh_ 10.0
+Phy/WirelessPhy set CSThresh_ 1.559e-11
+Phy/WirelessPhy set RXThresh_ 3.652e-10
+Phy/WirelessPhy set Rb_ 2*1e6
+Phy/WirelessPhy set Pt_ 0.2818
+Phy/WirelessPhy set freq_ 914e+6 
+Phy/WirelessPhy set L_ 1.0
+
+# Configure multirate aspect
+Phy/WirelessPhy set RateCount_ 4
+Phy/WirelessPhy set Rate0 11e6
+Phy/WirelessPhy set Rate1 5.5e6
+Phy/WirelessPhy set Rate2 2e6
+Phy/WirelessPhy set Rate3 1e6
+Phy/WirelessPhy set RXThresh0 1.427e-08 ;# 100m transmission range
+Phy/WirelessPhy set RXThresh1 2.818e-09 ;# 150m transmission range
+Phy/WirelessPhy set RXThresh2 8.916e-10 ;# 200m transmission range
+Phy/WirelessPhy set RXThresh3 3.652e-10 ;# 250m transmission range
+
+# 
+# Set the size of the playing field and the topography.
+#
+set xsize 100
+set ysize 100
+set wtopo	[new Topography]
+$wtopo load_flatgrid $xsize $ysize
+set gkeeper [new GridKeeper]
+$gkeeper dimension $xsize $ysize
+
+#
+# The network channel, physical layer, MAC, propagation model,
+# and antenna model are all standard ns-2.
+#  
+set netchan	Channel/WirelessChannel
+set netphy	Phy/WirelessPhy
+set netmac	Mac/802_11
+set netprop     Propagation/TwoRayGround
+set antenna     Antenna/OmniAntenna
+
+#
+# We have to use a special queue and link layer. This is so that
+# Click can have control over the network interface packet queue,
+# which is vital if we want to play with, e.g. QoS algorithms.
+#
+set netifq	Queue/ClickQueue
+set netll	LL/Ext
+LL set delay_			1ms
+
+#
+# These are pretty self-explanatory, just the number of nodes
+# and when we'll stop.
+#
+set nodecount   4
+set stoptime	10.0
+
+#
+# With nsclick, we have to worry about details like which network
+# port to use for communication. This sets the default ports to 5000.
+#
+Agent/Null set sport_		5000
+Agent/Null set dport_		5000
+
+Agent/CBR set sport_		5000
+Agent/CBR set dport_		5000
+
+#
+# Standard ns-2 stuff here - create the simulator object.
+#
+Simulator set MacTrace_ ON
+set ns_		[new Simulator]
+
+#
+# Create and activate trace files.
+#
+set tracefd	[open "nsclick-raw-wlan.tr" w]
+set namtrace    [open "nsclick-raw-wlan.nam" w]
+$ns_ trace-all $tracefd
+$ns_ namtrace-all-wireless $namtrace $xsize $ysize
+$ns_ use-newtrace
+
+
+#
+# Create the "god" object. This is another artifact of using
+# the mobile node type. We have to have this even though
+# we never use it.
+#
+set god_ [create-god $nodecount]
+
+#
+# Tell the simulator to create Click nodes.
+#
+Simulator set node_factory_ Node/MobileNode/ClickNode
+
+#
+# Create a network Channel for the nodes to use. One channel
+# per LAN. Create 13 channels of the 802.11 MAC layer
+for {set i 0} { $i <= 13} {incr i} {
+	set chan_($i) [new Channel/WirelessChannel]	
+}
+# And implement a channel switching function to WirelessInfo 
+# to switch from one channel to another channel
+proc SwitchChannel { i whichif whichnewchannel } {
+	global node_ chan_
+	if { $whichnewchannel > 0 } {
+#		set ns_ [Simulator instance] 
+#		set node [ $ns_ Node($i) ]
+		$node_($i) changechannel $whichif $chan_($whichnewchannel)
+		puts "Node $i changes if $whichif to channel $whichnewchannel"
+	}
+}
+
+#Also set the propagation model to be used.
+set prop_ [new $netprop]
+
+#
+# In nsclick we have to worry about assigning IP and MAC addresses
+# to out network interfaces. Here we generate a list of IP and MAC
+# addresses, one per node since we've only got one network interface
+# per node in this case. Also note that this scheme only works for
+# fewer than 255 nodes, and we aren't worrying about subnet masks.
+#
+set iptemplate "192.168.1.%d"
+set mactemplate "00:03:47:70:89:%0x"
+for {set i 0} {$i < $nodecount} {incr i} {
+    set node_ip($i) [format $iptemplate [expr $i+1]]
+    set node_mac($i) [format $mactemplate [expr $i+1]]
+}
+
+#
+# We set the routing protocol to "Empty" so that ns-2 doesn't do
+# any packet routing. All of the routing will be done by the
+# Click script.
+#
+$ns_ rtproto Empty
+
+#
+# Here is where we actually create all of the nodes.
+#
+for {set i 0} {$i < $nodecount } {incr i} {
+    set node_($i) [$ns_ node]
+
+    #
+    # After creating the node, we add one wireless network interface to
+    # it. By default, this interface will be named "eth0". If we
+    # added a second interface it would be named "eth1", a third
+    # "eth2" and so on.
+    #
+    $node_($i) add-interface $chan_(1) $prop_ $netll $netmac \
+	$netifq 1 $netphy $antenna $wtopo
+
+    #
+    # Now configure the interface eth0
+    #
+    $node_($i) setip "eth0" $node_ip($i)
+    $node_($i) setmac "eth0" $node_mac($i)
+
+    #
+    # Set some node properties
+    #
+    $gkeeper addnode $node_($i)
+    $node_($i) radius 1000
+    $node_($i) random-motion 0
+    $node_($i) topography $wtopo
+    $node_($i) nodetrace $tracefd
+
+    #
+    # The node name is used by Click to distinguish information
+    # coming from different nodes. For example, a "Print" element
+    # prepends this to the printed string so it's clear exactly
+    # which node is doing the printing.
+    #
+    [$node_($i) set classifier_] setnodename "node$i-simplelan"
+    
+    #
+    # Load the appropriate Click router script for the node.
+    # All nodes in this simulation are using the same script,
+    # but there's no reason why each node couldn't use a different
+    # script.
+    #
+    [$node_($i) entry] loadclick "nsclick-raw-wlan.click"
+}
+
+
+# 
+# Define node network traffic. There isn't a whole lot going on
+# in this simple test case, we're just going to have the first node
+# send packets to the last node, starting at 1 second, and ending at 10.
+# There are Perl scripts available to automatically generate network
+# traffic.
+#
+
+
+#
+# Start transmitting at $startxmittime, $xmitrate packets per second.
+#
+set startxmittime 1
+set xmitrate 4
+set xmitinterval 0.25
+set packetsize 64
+
+#
+# We use the "raw" packet type, which sends real packet data
+# down the pipe.
+#
+set raw_(0) [new Agent/Raw]
+$ns_ attach-agent $node_(0) $raw_(0)
+
+set lastnode [expr $nodecount-1]
+set null_(0) [new Agent/Null]
+$ns_ attach-agent $node_($lastnode) $null_(0)
+
+#
+# The CBR object is just the default ns-2 CBR object, so
+# no change in the meaning of the parameters.
+#
+set cbr_(0) [new Application/Traffic/CBR]
+$cbr_(0) set packetSize_ $packetsize
+$cbr_(0) set interval_ $xmitinterval
+$cbr_(0) set random_ 0
+$cbr_(0) set maxpkts_ [expr ($stoptime - $startxmittime)*$xmitrate]
+$cbr_(0) attach-agent $raw_(0)
+
+#
+# The Raw agent creates real UDP packets, so it has to know
+# the source and destination IP addresses and port numberes.
+#
+$raw_(0) set-srcip [$node_(0) getip eth0]
+$raw_(0) set-srcport 5000
+$raw_(0) set-destport 5000
+$raw_(0) set-destip [$node_($lastnode) getip eth0]
+
+$ns_ at $startxmittime "$cbr_(0) start"
+
+
+$node_(0) set X_ 10
+$node_(0) set Y_ 50
+$node_(0) set Z_ 0
+
+$node_(1) set X_ 50
+$node_(1) set Y_ 50
+$node_(1) set Z_ 0
+
+$node_(2) set X_ 90
+$node_(2) set Y_ 50
+$node_(2) set Z_ 0
+
+$node_(3) set X_ 50
+$node_(3) set Y_ 10
+$node_(3) set Z_ 0
+
+
+#
+# This sizes the nodes for use in nam. Currently, the trace files
+# produced by nsclick don't really work in nam.
+#
+for {set i 0} {$i < $nodecount} {incr i} {
+    $ns_ initial_node_pos $node_($i) 20
+    [$node_($i) entry] runclick
+}
+
+#
+# Stop the simulation
+#
+$ns_ at  $stoptime.000000001 "puts \"NS EXITING...\" ; $ns_ halt"
+
+#
+# Let nam know that the simulation is done.
+#
+$ns_ at  $stoptime	"$ns_ nam-end-wireless $stoptime"
+
+
+puts "Starting Simulation..."
+$ns_ run
+
+
+
+
diff -ruN --exclude='*.o' --exclude='autom4*' ns-2.34-pure/tcl/ex/nsclick-simple-bridge.click ns-2.34/tcl/ex/nsclick-simple-bridge.click
--- ns-2.34-pure/tcl/ex/nsclick-simple-bridge.click	1969-12-31 16:00:00.000000000 -0800
+++ ns-2.34/tcl/ex/nsclick-simple-bridge.click	2010-02-28 09:31:39.000000000 -0800
@@ -0,0 +1,40 @@
+//
+//  Copyright 2002, Univerity of Colorado at Boulder.                        
+//                                                                            
+//                         All Rights Reserved                                
+//                                                                            
+//  Permission to use, copy, modify, and distribute this software and its    
+//  documentation for any purpose other than its incorporation into a        
+//  commercial product is hereby granted without fee, provided that the      
+//  above copyright notice appear in all copies and that both that           
+//  copyright notice and this permission notice appear in supporting         
+//  documentation, and that the name of the University not be used in        
+//  advertising or publicity pertaining to distribution of the software      
+//  without specific, written prior permission.                              
+//                                                                            
+//  UNIVERSITY OF COLORADO DISCLAIMS ALL WARRANTIES WITH REGARD TO THIS      
+//  SOFTWARE, INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY AND        
+//  FITNESS FOR ANY PARTICULAR PURPOSE.  IN NO EVENT SHALL THE UNIVERSITY    
+//  OF COLORADO BE LIABLE FOR ANY SPECIAL, INDIRECT OR CONSEQUENTIAL         
+//  DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM LOSS OF USE, DATA      
+//  OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR OTHER       
+//  TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR         
+//  PERFORMANCE OF THIS SOFTWARE.                                            
+//
+
+// nsclick-simple-bridge.click
+//
+// This is a simple and stupid network "bridge." Packets coming
+// in off of eth0 are pumped out on eth1, and packets coming
+// in off of eth1 are pumped out on eth0.
+//
+
+FromSimDevice(eth0,SNAPLEN 4096)
+	-> Queue
+	-> ToSimDevice(eth1);
+	
+FromSimDevice(eth1,SNAPLEN 4096)
+	-> Queue
+	-> ToSimDevice(eth0);
+
+
diff -ruN --exclude='*.o' --exclude='autom4*' ns-2.34-pure/tcl/ex/nsclick-simple-hybrid.nam ns-2.34/tcl/ex/nsclick-simple-hybrid.nam
--- ns-2.34-pure/tcl/ex/nsclick-simple-hybrid.nam	1969-12-31 16:00:00.000000000 -0800
+++ ns-2.34/tcl/ex/nsclick-simple-hybrid.nam	2010-02-28 09:31:39.000000000 -0800
@@ -0,0 +1,371 @@
+n -t * -s 0  -x 10 -y 50 -Z 0 -z 10  -v circle -c black
+n -t * -s 1  -x 50 -y 50 -Z 0 -z 10  -v circle -c black
+n -t * -s 2  -x 90 -y 50 -Z 0 -z 10  -v circle -c black
+n -t * -s 3  -x 10 -y 0 -Z 0 -z 10  -v circle -c black
+n -t * -s 4  -x 50 -y 0 -Z 0 -z 10  -v circle -c black
+n -t * -s 5  -x 90 -y 0 -Z 0 -z 10  -v circle -c black
+n -t * -s 6  -x 50 -y 10 -Z 0 -z 10  -v circle -c black
+V -t * -v 1.0a5 -a 0
+W -t * -x 100 -y 100
+A -t * -n 1 -p 0 -o 0xffffffff -c 31 -a 1
+A -t * -h 1 -m 2147483647 -s 0
++ -t 1.000000000 -s 0 -d -1 -p raw -e 92 -c 2 -a 0 -i 0 -k AGT 
+- -t 1.000000000 -s 0 -d -1 -p raw -e 92 -c 2 -a 0 -i 0 -k AGT
+h -t 1.000000000 -s 0 -d -1 -p raw -e 92 -c 2 -a 0 -i 0 -k AGT
+r -t 1.016121766 -s 3 -d 3 -p raw -e 92 -c 2 -a 0 -i 0 -k AGT
+r -t 1.018301766 -s 3 -d 3 -p raw -e 92 -c 2 -a 0 -i 0 -k AGT
+r -t 1.021761766 -s 3 -d 3 -p raw -e 92 -c 2 -a 0 -i 0 -k AGT
+r -t 1.027061766 -s 3 -d 3 -p raw -e 92 -c 2 -a 0 -i 0 -k AGT
+r -t 1.035561766 -s 3 -d 3 -p raw -e 92 -c 2 -a 0 -i 0 -k AGT
+r -t 1.057281766 -s 3 -d 3 -p raw -e 92 -c 2 -a 0 -i 0 -k AGT
+r -t 1.066501766 -s 3 -d 3 -p raw -e 92 -c 2 -a 0 -i 0 -k AGT
++ -t 1.250000000 -s 0 -d -1 -p raw -e 92 -c 2 -a 0 -i 3 -k AGT 
+- -t 1.250000000 -s 0 -d -1 -p raw -e 92 -c 2 -a 0 -i 3 -k AGT
+h -t 1.250000000 -s 0 -d -1 -p raw -e 92 -c 2 -a 0 -i 3 -k AGT
+r -t 1.255530989 -s 3 -d 3 -p raw -e 92 -c 2 -a 0 -i 3 -k AGT
+r -t 1.257510989 -s 3 -d 3 -p raw -e 92 -c 2 -a 0 -i 3 -k AGT
+r -t 1.261230989 -s 3 -d 3 -p raw -e 92 -c 2 -a 0 -i 3 -k AGT
+r -t 1.266170989 -s 3 -d 3 -p raw -e 92 -c 2 -a 0 -i 3 -k AGT
+r -t 1.273130989 -s 3 -d 3 -p raw -e 92 -c 2 -a 0 -i 3 -k AGT
+r -t 1.276750989 -s 3 -d 3 -p raw -e 92 -c 2 -a 0 -i 3 -k AGT
+r -t 1.279670989 -s 3 -d 3 -p raw -e 92 -c 2 -a 0 -i 3 -k AGT
++ -t 1.500000000 -s 0 -d -1 -p raw -e 92 -c 2 -a 0 -i 4 -k AGT 
+- -t 1.500000000 -s 0 -d -1 -p raw -e 92 -c 2 -a 0 -i 4 -k AGT
+h -t 1.500000000 -s 0 -d -1 -p raw -e 92 -c 2 -a 0 -i 4 -k AGT
+r -t 1.505770989 -s 3 -d 3 -p raw -e 92 -c 2 -a 0 -i 4 -k AGT
+r -t 1.507390989 -s 3 -d 3 -p raw -e 92 -c 2 -a 0 -i 4 -k AGT
+r -t 1.509190989 -s 3 -d 3 -p raw -e 92 -c 2 -a 0 -i 4 -k AGT
+r -t 1.511290989 -s 3 -d 3 -p raw -e 92 -c 2 -a 0 -i 4 -k AGT
+r -t 1.520050989 -s 3 -d 3 -p raw -e 92 -c 2 -a 0 -i 4 -k AGT
+r -t 1.537710989 -s 3 -d 3 -p raw -e 92 -c 2 -a 0 -i 4 -k AGT
+r -t 1.551250989 -s 3 -d 3 -p raw -e 92 -c 2 -a 0 -i 4 -k AGT
++ -t 1.750000000 -s 0 -d -1 -p raw -e 92 -c 2 -a 0 -i 5 -k AGT 
+- -t 1.750000000 -s 0 -d -1 -p raw -e 92 -c 2 -a 0 -i 5 -k AGT
+h -t 1.750000000 -s 0 -d -1 -p raw -e 92 -c 2 -a 0 -i 5 -k AGT
+r -t 1.755730989 -s 3 -d 3 -p raw -e 92 -c 2 -a 0 -i 5 -k AGT
+r -t 1.757350989 -s 3 -d 3 -p raw -e 92 -c 2 -a 0 -i 5 -k AGT
+r -t 1.760310989 -s 3 -d 3 -p raw -e 92 -c 2 -a 0 -i 5 -k AGT
+r -t 1.765530989 -s 3 -d 3 -p raw -e 92 -c 2 -a 0 -i 5 -k AGT
+r -t 1.769510989 -s 3 -d 3 -p raw -e 92 -c 2 -a 0 -i 5 -k AGT
+r -t 1.777590989 -s 3 -d 3 -p raw -e 92 -c 2 -a 0 -i 5 -k AGT
+r -t 1.790930989 -s 3 -d 3 -p raw -e 92 -c 2 -a 0 -i 5 -k AGT
++ -t 2.000000000 -s 0 -d -1 -p raw -e 92 -c 2 -a 0 -i 6 -k AGT 
+- -t 2.000000000 -s 0 -d -1 -p raw -e 92 -c 2 -a 0 -i 6 -k AGT
+h -t 2.000000000 -s 0 -d -1 -p raw -e 92 -c 2 -a 0 -i 6 -k AGT
+r -t 2.005590989 -s 3 -d 3 -p raw -e 92 -c 2 -a 0 -i 6 -k AGT
+r -t 2.007810989 -s 3 -d 3 -p raw -e 92 -c 2 -a 0 -i 6 -k AGT
+r -t 2.010790989 -s 3 -d 3 -p raw -e 92 -c 2 -a 0 -i 6 -k AGT
+r -t 2.016050989 -s 3 -d 3 -p raw -e 92 -c 2 -a 0 -i 6 -k AGT
+r -t 2.026670989 -s 3 -d 3 -p raw -e 92 -c 2 -a 0 -i 6 -k AGT
+r -t 2.033350989 -s 3 -d 3 -p raw -e 92 -c 2 -a 0 -i 6 -k AGT
+r -t 2.044890989 -s 3 -d 3 -p raw -e 92 -c 2 -a 0 -i 6 -k AGT
++ -t 2.250000000 -s 0 -d -1 -p raw -e 92 -c 2 -a 0 -i 7 -k AGT 
+- -t 2.250000000 -s 0 -d -1 -p raw -e 92 -c 2 -a 0 -i 7 -k AGT
+h -t 2.250000000 -s 0 -d -1 -p raw -e 92 -c 2 -a 0 -i 7 -k AGT
+r -t 2.255810989 -s 3 -d 3 -p raw -e 92 -c 2 -a 0 -i 7 -k AGT
+r -t 2.257610989 -s 3 -d 3 -p raw -e 92 -c 2 -a 0 -i 7 -k AGT
+r -t 2.260650989 -s 3 -d 3 -p raw -e 92 -c 2 -a 0 -i 7 -k AGT
+r -t 2.263330989 -s 3 -d 3 -p raw -e 92 -c 2 -a 0 -i 7 -k AGT
+r -t 2.272450989 -s 3 -d 3 -p raw -e 92 -c 2 -a 0 -i 7 -k AGT
+r -t 2.292070989 -s 3 -d 3 -p raw -e 92 -c 2 -a 0 -i 7 -k AGT
+r -t 2.307570989 -s 3 -d 3 -p raw -e 92 -c 2 -a 0 -i 7 -k AGT
++ -t 2.500000000 -s 0 -d -1 -p raw -e 92 -c 2 -a 0 -i 8 -k AGT 
+- -t 2.500000000 -s 0 -d -1 -p raw -e 92 -c 2 -a 0 -i 8 -k AGT
+h -t 2.500000000 -s 0 -d -1 -p raw -e 92 -c 2 -a 0 -i 8 -k AGT
+r -t 2.505790989 -s 3 -d 3 -p raw -e 92 -c 2 -a 0 -i 8 -k AGT
+r -t 2.507350989 -s 3 -d 3 -p raw -e 92 -c 2 -a 0 -i 8 -k AGT
+r -t 2.509910989 -s 3 -d 3 -p raw -e 92 -c 2 -a 0 -i 8 -k AGT
+r -t 2.516170989 -s 3 -d 3 -p raw -e 92 -c 2 -a 0 -i 8 -k AGT
+r -t 2.524230989 -s 3 -d 3 -p raw -e 92 -c 2 -a 0 -i 8 -k AGT
+r -t 2.533190989 -s 3 -d 3 -p raw -e 92 -c 2 -a 0 -i 8 -k AGT
+r -t 2.541750989 -s 3 -d 3 -p raw -e 92 -c 2 -a 0 -i 8 -k AGT
++ -t 2.750000000 -s 0 -d -1 -p raw -e 92 -c 2 -a 0 -i 9 -k AGT 
+- -t 2.750000000 -s 0 -d -1 -p raw -e 92 -c 2 -a 0 -i 9 -k AGT
+h -t 2.750000000 -s 0 -d -1 -p raw -e 92 -c 2 -a 0 -i 9 -k AGT
+r -t 2.755610989 -s 3 -d 3 -p raw -e 92 -c 2 -a 0 -i 9 -k AGT
+r -t 2.757470989 -s 3 -d 3 -p raw -e 92 -c 2 -a 0 -i 9 -k AGT
+r -t 2.760090989 -s 3 -d 3 -p raw -e 92 -c 2 -a 0 -i 9 -k AGT
+r -t 2.763530989 -s 3 -d 3 -p raw -e 92 -c 2 -a 0 -i 9 -k AGT
+r -t 2.771450989 -s 3 -d 3 -p raw -e 92 -c 2 -a 0 -i 9 -k AGT
+r -t 2.779790989 -s 3 -d 3 -p raw -e 92 -c 2 -a 0 -i 9 -k AGT
+r -t 2.791470989 -s 3 -d 3 -p raw -e 92 -c 2 -a 0 -i 9 -k AGT
++ -t 3.000000000 -s 0 -d -1 -p raw -e 92 -c 2 -a 0 -i 10 -k AGT 
+- -t 3.000000000 -s 0 -d -1 -p raw -e 92 -c 2 -a 0 -i 10 -k AGT
+h -t 3.000000000 -s 0 -d -1 -p raw -e 92 -c 2 -a 0 -i 10 -k AGT
+r -t 3.005590989 -s 3 -d 3 -p raw -e 92 -c 2 -a 0 -i 10 -k AGT
+r -t 3.007190989 -s 3 -d 3 -p raw -e 92 -c 2 -a 0 -i 10 -k AGT
+r -t 3.010870989 -s 3 -d 3 -p raw -e 92 -c 2 -a 0 -i 10 -k AGT
+r -t 3.013790989 -s 3 -d 3 -p raw -e 92 -c 2 -a 0 -i 10 -k AGT
+r -t 3.024910989 -s 3 -d 3 -p raw -e 92 -c 2 -a 0 -i 10 -k AGT
+r -t 3.030890989 -s 3 -d 3 -p raw -e 92 -c 2 -a 0 -i 10 -k AGT
+r -t 3.045110989 -s 3 -d 3 -p raw -e 92 -c 2 -a 0 -i 10 -k AGT
++ -t 3.250000000 -s 0 -d -1 -p raw -e 92 -c 2 -a 0 -i 11 -k AGT 
+- -t 3.250000000 -s 0 -d -1 -p raw -e 92 -c 2 -a 0 -i 11 -k AGT
+h -t 3.250000000 -s 0 -d -1 -p raw -e 92 -c 2 -a 0 -i 11 -k AGT
+r -t 3.255330989 -s 3 -d 3 -p raw -e 92 -c 2 -a 0 -i 11 -k AGT
+r -t 3.257450989 -s 3 -d 3 -p raw -e 92 -c 2 -a 0 -i 11 -k AGT
+r -t 3.260150989 -s 3 -d 3 -p raw -e 92 -c 2 -a 0 -i 11 -k AGT
+r -t 3.264490989 -s 3 -d 3 -p raw -e 92 -c 2 -a 0 -i 11 -k AGT
+r -t 3.269070989 -s 3 -d 3 -p raw -e 92 -c 2 -a 0 -i 11 -k AGT
+r -t 3.290510989 -s 3 -d 3 -p raw -e 92 -c 2 -a 0 -i 11 -k AGT
+r -t 3.310890989 -s 3 -d 3 -p raw -e 92 -c 2 -a 0 -i 11 -k AGT
++ -t 3.500000000 -s 0 -d -1 -p raw -e 92 -c 2 -a 0 -i 12 -k AGT 
+- -t 3.500000000 -s 0 -d -1 -p raw -e 92 -c 2 -a 0 -i 12 -k AGT
+h -t 3.500000000 -s 0 -d -1 -p raw -e 92 -c 2 -a 0 -i 12 -k AGT
+r -t 3.505490989 -s 3 -d 3 -p raw -e 92 -c 2 -a 0 -i 12 -k AGT
+r -t 3.507690989 -s 3 -d 3 -p raw -e 92 -c 2 -a 0 -i 12 -k AGT
+r -t 3.510050989 -s 3 -d 3 -p raw -e 92 -c 2 -a 0 -i 12 -k AGT
+r -t 3.515570989 -s 3 -d 3 -p raw -e 92 -c 2 -a 0 -i 12 -k AGT
+r -t 3.524730989 -s 3 -d 3 -p raw -e 92 -c 2 -a 0 -i 12 -k AGT
+r -t 3.544910989 -s 3 -d 3 -p raw -e 92 -c 2 -a 0 -i 12 -k AGT
+r -t 3.564990989 -s 3 -d 3 -p raw -e 92 -c 2 -a 0 -i 12 -k AGT
++ -t 3.750000000 -s 0 -d -1 -p raw -e 92 -c 2 -a 0 -i 13 -k AGT 
+- -t 3.750000000 -s 0 -d -1 -p raw -e 92 -c 2 -a 0 -i 13 -k AGT
+h -t 3.750000000 -s 0 -d -1 -p raw -e 92 -c 2 -a 0 -i 13 -k AGT
+r -t 3.755410989 -s 3 -d 3 -p raw -e 92 -c 2 -a 0 -i 13 -k AGT
+r -t 3.758150989 -s 3 -d 3 -p raw -e 92 -c 2 -a 0 -i 13 -k AGT
+r -t 3.761790989 -s 3 -d 3 -p raw -e 92 -c 2 -a 0 -i 13 -k AGT
+r -t 3.763750989 -s 3 -d 3 -p raw -e 92 -c 2 -a 0 -i 13 -k AGT
+r -t 3.771710989 -s 3 -d 3 -p raw -e 92 -c 2 -a 0 -i 13 -k AGT
+r -t 3.773530989 -s 3 -d 3 -p raw -e 92 -c 2 -a 0 -i 13 -k AGT
+r -t 3.785270989 -s 3 -d 3 -p raw -e 92 -c 2 -a 0 -i 13 -k AGT
++ -t 4.000000000 -s 0 -d -1 -p raw -e 92 -c 2 -a 0 -i 14 -k AGT 
+- -t 4.000000000 -s 0 -d -1 -p raw -e 92 -c 2 -a 0 -i 14 -k AGT
+h -t 4.000000000 -s 0 -d -1 -p raw -e 92 -c 2 -a 0 -i 14 -k AGT
+r -t 4.005630989 -s 3 -d 3 -p raw -e 92 -c 2 -a 0 -i 14 -k AGT
+r -t 4.007150989 -s 3 -d 3 -p raw -e 92 -c 2 -a 0 -i 14 -k AGT
+r -t 4.009510989 -s 3 -d 3 -p raw -e 92 -c 2 -a 0 -i 14 -k AGT
+r -t 4.012030989 -s 3 -d 3 -p raw -e 92 -c 2 -a 0 -i 14 -k AGT
+r -t 4.014850989 -s 3 -d 3 -p raw -e 92 -c 2 -a 0 -i 14 -k AGT
+r -t 4.025210989 -s 3 -d 3 -p raw -e 92 -c 2 -a 0 -i 14 -k AGT
+r -t 4.038950989 -s 3 -d 3 -p raw -e 92 -c 2 -a 0 -i 14 -k AGT
++ -t 4.250000000 -s 0 -d -1 -p raw -e 92 -c 2 -a 0 -i 15 -k AGT 
+- -t 4.250000000 -s 0 -d -1 -p raw -e 92 -c 2 -a 0 -i 15 -k AGT
+h -t 4.250000000 -s 0 -d -1 -p raw -e 92 -c 2 -a 0 -i 15 -k AGT
+r -t 4.255690989 -s 3 -d 3 -p raw -e 92 -c 2 -a 0 -i 15 -k AGT
+r -t 4.258350989 -s 3 -d 3 -p raw -e 92 -c 2 -a 0 -i 15 -k AGT
+r -t 4.260270989 -s 3 -d 3 -p raw -e 92 -c 2 -a 0 -i 15 -k AGT
+r -t 4.263310989 -s 3 -d 3 -p raw -e 92 -c 2 -a 0 -i 15 -k AGT
+r -t 4.269150989 -s 3 -d 3 -p raw -e 92 -c 2 -a 0 -i 15 -k AGT
+r -t 4.280110989 -s 3 -d 3 -p raw -e 92 -c 2 -a 0 -i 15 -k AGT
+r -t 4.293770989 -s 3 -d 3 -p raw -e 92 -c 2 -a 0 -i 15 -k AGT
++ -t 4.500000000 -s 0 -d -1 -p raw -e 92 -c 2 -a 0 -i 16 -k AGT 
+- -t 4.500000000 -s 0 -d -1 -p raw -e 92 -c 2 -a 0 -i 16 -k AGT
+h -t 4.500000000 -s 0 -d -1 -p raw -e 92 -c 2 -a 0 -i 16 -k AGT
+r -t 4.505610989 -s 3 -d 3 -p raw -e 92 -c 2 -a 0 -i 16 -k AGT
+r -t 4.507970989 -s 3 -d 3 -p raw -e 92 -c 2 -a 0 -i 16 -k AGT
+r -t 4.511590989 -s 3 -d 3 -p raw -e 92 -c 2 -a 0 -i 16 -k AGT
+r -t 4.517610989 -s 3 -d 3 -p raw -e 92 -c 2 -a 0 -i 16 -k AGT
+r -t 4.525410989 -s 3 -d 3 -p raw -e 92 -c 2 -a 0 -i 16 -k AGT
+r -t 4.536250989 -s 3 -d 3 -p raw -e 92 -c 2 -a 0 -i 16 -k AGT
+r -t 4.556010989 -s 3 -d 3 -p raw -e 92 -c 2 -a 0 -i 16 -k AGT
++ -t 4.750000000 -s 0 -d -1 -p raw -e 92 -c 2 -a 0 -i 17 -k AGT 
+- -t 4.750000000 -s 0 -d -1 -p raw -e 92 -c 2 -a 0 -i 17 -k AGT
+h -t 4.750000000 -s 0 -d -1 -p raw -e 92 -c 2 -a 0 -i 17 -k AGT
+r -t 4.755390989 -s 3 -d 3 -p raw -e 92 -c 2 -a 0 -i 17 -k AGT
+r -t 4.757630989 -s 3 -d 3 -p raw -e 92 -c 2 -a 0 -i 17 -k AGT
+r -t 4.760130989 -s 3 -d 3 -p raw -e 92 -c 2 -a 0 -i 17 -k AGT
+r -t 4.762530989 -s 3 -d 3 -p raw -e 92 -c 2 -a 0 -i 17 -k AGT
+r -t 4.768670989 -s 3 -d 3 -p raw -e 92 -c 2 -a 0 -i 17 -k AGT
+r -t 4.789210989 -s 3 -d 3 -p raw -e 92 -c 2 -a 0 -i 17 -k AGT
+r -t 4.808110989 -s 3 -d 3 -p raw -e 92 -c 2 -a 0 -i 17 -k AGT
++ -t 5.000000000 -s 0 -d -1 -p raw -e 92 -c 2 -a 0 -i 18 -k AGT 
+- -t 5.000000000 -s 0 -d -1 -p raw -e 92 -c 2 -a 0 -i 18 -k AGT
+h -t 5.000000000 -s 0 -d -1 -p raw -e 92 -c 2 -a 0 -i 18 -k AGT
+r -t 5.005310989 -s 3 -d 3 -p raw -e 92 -c 2 -a 0 -i 18 -k AGT
+r -t 5.007070989 -s 3 -d 3 -p raw -e 92 -c 2 -a 0 -i 18 -k AGT
+r -t 5.009250989 -s 3 -d 3 -p raw -e 92 -c 2 -a 0 -i 18 -k AGT
+r -t 5.010830989 -s 3 -d 3 -p raw -e 92 -c 2 -a 0 -i 18 -k AGT
+r -t 5.020070989 -s 3 -d 3 -p raw -e 92 -c 2 -a 0 -i 18 -k AGT
+r -t 5.028790989 -s 3 -d 3 -p raw -e 92 -c 2 -a 0 -i 18 -k AGT
+r -t 5.045630989 -s 3 -d 3 -p raw -e 92 -c 2 -a 0 -i 18 -k AGT
++ -t 5.250000000 -s 0 -d -1 -p raw -e 92 -c 2 -a 0 -i 19 -k AGT 
+- -t 5.250000000 -s 0 -d -1 -p raw -e 92 -c 2 -a 0 -i 19 -k AGT
+h -t 5.250000000 -s 0 -d -1 -p raw -e 92 -c 2 -a 0 -i 19 -k AGT
+r -t 5.255670989 -s 3 -d 3 -p raw -e 92 -c 2 -a 0 -i 19 -k AGT
+r -t 5.257990989 -s 3 -d 3 -p raw -e 92 -c 2 -a 0 -i 19 -k AGT
+r -t 5.261170989 -s 3 -d 3 -p raw -e 92 -c 2 -a 0 -i 19 -k AGT
+r -t 5.267690989 -s 3 -d 3 -p raw -e 92 -c 2 -a 0 -i 19 -k AGT
+r -t 5.274410989 -s 3 -d 3 -p raw -e 92 -c 2 -a 0 -i 19 -k AGT
+r -t 5.286030989 -s 3 -d 3 -p raw -e 92 -c 2 -a 0 -i 19 -k AGT
+r -t 5.290170989 -s 3 -d 3 -p raw -e 92 -c 2 -a 0 -i 19 -k AGT
++ -t 5.500000000 -s 0 -d -1 -p raw -e 92 -c 2 -a 0 -i 20 -k AGT 
+- -t 5.500000000 -s 0 -d -1 -p raw -e 92 -c 2 -a 0 -i 20 -k AGT
+h -t 5.500000000 -s 0 -d -1 -p raw -e 92 -c 2 -a 0 -i 20 -k AGT
+r -t 5.505530989 -s 3 -d 3 -p raw -e 92 -c 2 -a 0 -i 20 -k AGT
+r -t 5.508070989 -s 3 -d 3 -p raw -e 92 -c 2 -a 0 -i 20 -k AGT
+r -t 5.510830989 -s 3 -d 3 -p raw -e 92 -c 2 -a 0 -i 20 -k AGT
+r -t 5.513830989 -s 3 -d 3 -p raw -e 92 -c 2 -a 0 -i 20 -k AGT
+r -t 5.522790989 -s 3 -d 3 -p raw -e 92 -c 2 -a 0 -i 20 -k AGT
+r -t 5.528590989 -s 3 -d 3 -p raw -e 92 -c 2 -a 0 -i 20 -k AGT
+r -t 5.546190989 -s 3 -d 3 -p raw -e 92 -c 2 -a 0 -i 20 -k AGT
++ -t 5.750000000 -s 0 -d -1 -p raw -e 92 -c 2 -a 0 -i 21 -k AGT 
+- -t 5.750000000 -s 0 -d -1 -p raw -e 92 -c 2 -a 0 -i 21 -k AGT
+h -t 5.750000000 -s 0 -d -1 -p raw -e 92 -c 2 -a 0 -i 21 -k AGT
+r -t 5.755870989 -s 3 -d 3 -p raw -e 92 -c 2 -a 0 -i 21 -k AGT
+r -t 5.758330989 -s 3 -d 3 -p raw -e 92 -c 2 -a 0 -i 21 -k AGT
+r -t 5.759910989 -s 3 -d 3 -p raw -e 92 -c 2 -a 0 -i 21 -k AGT
+r -t 5.765370989 -s 3 -d 3 -p raw -e 92 -c 2 -a 0 -i 21 -k AGT
+r -t 5.767510989 -s 3 -d 3 -p raw -e 92 -c 2 -a 0 -i 21 -k AGT
+r -t 5.787530989 -s 3 -d 3 -p raw -e 92 -c 2 -a 0 -i 21 -k AGT
+r -t 5.800310989 -s 3 -d 3 -p raw -e 92 -c 2 -a 0 -i 21 -k AGT
++ -t 6.000000000 -s 0 -d -1 -p raw -e 92 -c 2 -a 0 -i 22 -k AGT 
+- -t 6.000000000 -s 0 -d -1 -p raw -e 92 -c 2 -a 0 -i 22 -k AGT
+h -t 6.000000000 -s 0 -d -1 -p raw -e 92 -c 2 -a 0 -i 22 -k AGT
+r -t 6.005470989 -s 3 -d 3 -p raw -e 92 -c 2 -a 0 -i 22 -k AGT
+r -t 6.008150989 -s 3 -d 3 -p raw -e 92 -c 2 -a 0 -i 22 -k AGT
+r -t 6.012190989 -s 3 -d 3 -p raw -e 92 -c 2 -a 0 -i 22 -k AGT
+r -t 6.016850989 -s 3 -d 3 -p raw -e 92 -c 2 -a 0 -i 22 -k AGT
+r -t 6.025090989 -s 3 -d 3 -p raw -e 92 -c 2 -a 0 -i 22 -k AGT
+r -t 6.035290989 -s 3 -d 3 -p raw -e 92 -c 2 -a 0 -i 22 -k AGT
+r -t 6.046850989 -s 3 -d 3 -p raw -e 92 -c 2 -a 0 -i 22 -k AGT
++ -t 6.250000000 -s 0 -d -1 -p raw -e 92 -c 2 -a 0 -i 23 -k AGT 
+- -t 6.250000000 -s 0 -d -1 -p raw -e 92 -c 2 -a 0 -i 23 -k AGT
+h -t 6.250000000 -s 0 -d -1 -p raw -e 92 -c 2 -a 0 -i 23 -k AGT
+r -t 6.255650989 -s 3 -d 3 -p raw -e 92 -c 2 -a 0 -i 23 -k AGT
+r -t 6.258110989 -s 3 -d 3 -p raw -e 92 -c 2 -a 0 -i 23 -k AGT
+r -t 6.260230989 -s 3 -d 3 -p raw -e 92 -c 2 -a 0 -i 23 -k AGT
+r -t 6.265470989 -s 3 -d 3 -p raw -e 92 -c 2 -a 0 -i 23 -k AGT
+r -t 6.269890989 -s 3 -d 3 -p raw -e 92 -c 2 -a 0 -i 23 -k AGT
+r -t 6.275050989 -s 3 -d 3 -p raw -e 92 -c 2 -a 0 -i 23 -k AGT
+r -t 6.278350989 -s 3 -d 3 -p raw -e 92 -c 2 -a 0 -i 23 -k AGT
++ -t 6.500000000 -s 0 -d -1 -p raw -e 92 -c 2 -a 0 -i 24 -k AGT 
+- -t 6.500000000 -s 0 -d -1 -p raw -e 92 -c 2 -a 0 -i 24 -k AGT
+h -t 6.500000000 -s 0 -d -1 -p raw -e 92 -c 2 -a 0 -i 24 -k AGT
+r -t 6.505330989 -s 3 -d 3 -p raw -e 92 -c 2 -a 0 -i 24 -k AGT
+r -t 6.507870989 -s 3 -d 3 -p raw -e 92 -c 2 -a 0 -i 24 -k AGT
+r -t 6.511550989 -s 3 -d 3 -p raw -e 92 -c 2 -a 0 -i 24 -k AGT
+r -t 6.513550989 -s 3 -d 3 -p raw -e 92 -c 2 -a 0 -i 24 -k AGT
+r -t 6.517910989 -s 3 -d 3 -p raw -e 92 -c 2 -a 0 -i 24 -k AGT
+r -t 6.524950989 -s 3 -d 3 -p raw -e 92 -c 2 -a 0 -i 24 -k AGT
+r -t 6.533590989 -s 3 -d 3 -p raw -e 92 -c 2 -a 0 -i 24 -k AGT
++ -t 6.750000000 -s 0 -d -1 -p raw -e 92 -c 2 -a 0 -i 25 -k AGT 
+- -t 6.750000000 -s 0 -d -1 -p raw -e 92 -c 2 -a 0 -i 25 -k AGT
+h -t 6.750000000 -s 0 -d -1 -p raw -e 92 -c 2 -a 0 -i 25 -k AGT
+r -t 6.755630989 -s 3 -d 3 -p raw -e 92 -c 2 -a 0 -i 25 -k AGT
+r -t 6.757290989 -s 3 -d 3 -p raw -e 92 -c 2 -a 0 -i 25 -k AGT
+r -t 6.759010989 -s 3 -d 3 -p raw -e 92 -c 2 -a 0 -i 25 -k AGT
+r -t 6.764790989 -s 3 -d 3 -p raw -e 92 -c 2 -a 0 -i 25 -k AGT
+r -t 6.768150989 -s 3 -d 3 -p raw -e 92 -c 2 -a 0 -i 25 -k AGT
+r -t 6.771410989 -s 3 -d 3 -p raw -e 92 -c 2 -a 0 -i 25 -k AGT
+r -t 6.792230989 -s 3 -d 3 -p raw -e 92 -c 2 -a 0 -i 25 -k AGT
++ -t 7.000000000 -s 0 -d -1 -p raw -e 92 -c 2 -a 0 -i 26 -k AGT 
+- -t 7.000000000 -s 0 -d -1 -p raw -e 92 -c 2 -a 0 -i 26 -k AGT
+h -t 7.000000000 -s 0 -d -1 -p raw -e 92 -c 2 -a 0 -i 26 -k AGT
+r -t 7.005890989 -s 3 -d 3 -p raw -e 92 -c 2 -a 0 -i 26 -k AGT
+r -t 7.008230989 -s 3 -d 3 -p raw -e 92 -c 2 -a 0 -i 26 -k AGT
+r -t 7.010110989 -s 3 -d 3 -p raw -e 92 -c 2 -a 0 -i 26 -k AGT
+r -t 7.014230989 -s 3 -d 3 -p raw -e 92 -c 2 -a 0 -i 26 -k AGT
+r -t 7.021390989 -s 3 -d 3 -p raw -e 92 -c 2 -a 0 -i 26 -k AGT
+r -t 7.032270989 -s 3 -d 3 -p raw -e 92 -c 2 -a 0 -i 26 -k AGT
+r -t 7.048970989 -s 3 -d 3 -p raw -e 92 -c 2 -a 0 -i 26 -k AGT
++ -t 7.250000000 -s 0 -d -1 -p raw -e 92 -c 2 -a 0 -i 27 -k AGT 
+- -t 7.250000000 -s 0 -d -1 -p raw -e 92 -c 2 -a 0 -i 27 -k AGT
+h -t 7.250000000 -s 0 -d -1 -p raw -e 92 -c 2 -a 0 -i 27 -k AGT
+r -t 7.255690989 -s 3 -d 3 -p raw -e 92 -c 2 -a 0 -i 27 -k AGT
+r -t 7.257750989 -s 3 -d 3 -p raw -e 92 -c 2 -a 0 -i 27 -k AGT
+r -t 7.261470989 -s 3 -d 3 -p raw -e 92 -c 2 -a 0 -i 27 -k AGT
+r -t 7.266830989 -s 3 -d 3 -p raw -e 92 -c 2 -a 0 -i 27 -k AGT
+r -t 7.276410989 -s 3 -d 3 -p raw -e 92 -c 2 -a 0 -i 27 -k AGT
+r -t 7.296610989 -s 3 -d 3 -p raw -e 92 -c 2 -a 0 -i 27 -k AGT
+r -t 7.301790989 -s 3 -d 3 -p raw -e 92 -c 2 -a 0 -i 27 -k AGT
++ -t 7.500000000 -s 0 -d -1 -p raw -e 92 -c 2 -a 0 -i 28 -k AGT 
+- -t 7.500000000 -s 0 -d -1 -p raw -e 92 -c 2 -a 0 -i 28 -k AGT
+h -t 7.500000000 -s 0 -d -1 -p raw -e 92 -c 2 -a 0 -i 28 -k AGT
+r -t 7.505750989 -s 3 -d 3 -p raw -e 92 -c 2 -a 0 -i 28 -k AGT
+r -t 7.507670989 -s 3 -d 3 -p raw -e 92 -c 2 -a 0 -i 28 -k AGT
+r -t 7.510010989 -s 3 -d 3 -p raw -e 92 -c 2 -a 0 -i 28 -k AGT
+r -t 7.514930989 -s 3 -d 3 -p raw -e 92 -c 2 -a 0 -i 28 -k AGT
+r -t 7.518670989 -s 3 -d 3 -p raw -e 92 -c 2 -a 0 -i 28 -k AGT
+r -t 7.530950989 -s 3 -d 3 -p raw -e 92 -c 2 -a 0 -i 28 -k AGT
+r -t 7.539810989 -s 3 -d 3 -p raw -e 92 -c 2 -a 0 -i 28 -k AGT
++ -t 7.750000000 -s 0 -d -1 -p raw -e 92 -c 2 -a 0 -i 29 -k AGT 
+- -t 7.750000000 -s 0 -d -1 -p raw -e 92 -c 2 -a 0 -i 29 -k AGT
+h -t 7.750000000 -s 0 -d -1 -p raw -e 92 -c 2 -a 0 -i 29 -k AGT
+r -t 7.755330989 -s 3 -d 3 -p raw -e 92 -c 2 -a 0 -i 29 -k AGT
+r -t 7.757210989 -s 3 -d 3 -p raw -e 92 -c 2 -a 0 -i 29 -k AGT
+r -t 7.760190989 -s 3 -d 3 -p raw -e 92 -c 2 -a 0 -i 29 -k AGT
+r -t 7.762830989 -s 3 -d 3 -p raw -e 92 -c 2 -a 0 -i 29 -k AGT
+r -t 7.765770989 -s 3 -d 3 -p raw -e 92 -c 2 -a 0 -i 29 -k AGT
+r -t 7.774430989 -s 3 -d 3 -p raw -e 92 -c 2 -a 0 -i 29 -k AGT
+r -t 7.781810989 -s 3 -d 3 -p raw -e 92 -c 2 -a 0 -i 29 -k AGT
++ -t 8.000000000 -s 0 -d -1 -p raw -e 92 -c 2 -a 0 -i 30 -k AGT 
+- -t 8.000000000 -s 0 -d -1 -p raw -e 92 -c 2 -a 0 -i 30 -k AGT
+h -t 8.000000000 -s 0 -d -1 -p raw -e 92 -c 2 -a 0 -i 30 -k AGT
+r -t 8.005330989 -s 3 -d 3 -p raw -e 92 -c 2 -a 0 -i 30 -k AGT
+r -t 8.007610989 -s 3 -d 3 -p raw -e 92 -c 2 -a 0 -i 30 -k AGT
+r -t 8.010770989 -s 3 -d 3 -p raw -e 92 -c 2 -a 0 -i 30 -k AGT
+r -t 8.016410989 -s 3 -d 3 -p raw -e 92 -c 2 -a 0 -i 30 -k AGT
+r -t 8.025530989 -s 3 -d 3 -p raw -e 92 -c 2 -a 0 -i 30 -k AGT
+r -t 8.037930989 -s 3 -d 3 -p raw -e 92 -c 2 -a 0 -i 30 -k AGT
+r -t 8.053430989 -s 3 -d 3 -p raw -e 92 -c 2 -a 0 -i 30 -k AGT
++ -t 8.250000000 -s 0 -d -1 -p raw -e 92 -c 2 -a 0 -i 31 -k AGT 
+- -t 8.250000000 -s 0 -d -1 -p raw -e 92 -c 2 -a 0 -i 31 -k AGT
+h -t 8.250000000 -s 0 -d -1 -p raw -e 92 -c 2 -a 0 -i 31 -k AGT
+r -t 8.255390989 -s 3 -d 3 -p raw -e 92 -c 2 -a 0 -i 31 -k AGT
+r -t 8.257290989 -s 3 -d 3 -p raw -e 92 -c 2 -a 0 -i 31 -k AGT
+r -t 8.259650989 -s 3 -d 3 -p raw -e 92 -c 2 -a 0 -i 31 -k AGT
+r -t 8.261390989 -s 3 -d 3 -p raw -e 92 -c 2 -a 0 -i 31 -k AGT
+r -t 8.269810989 -s 3 -d 3 -p raw -e 92 -c 2 -a 0 -i 31 -k AGT
+r -t 8.289310989 -s 3 -d 3 -p raw -e 92 -c 2 -a 0 -i 31 -k AGT
+r -t 8.310470989 -s 3 -d 3 -p raw -e 92 -c 2 -a 0 -i 31 -k AGT
++ -t 8.500000000 -s 0 -d -1 -p raw -e 92 -c 2 -a 0 -i 32 -k AGT 
+- -t 8.500000000 -s 0 -d -1 -p raw -e 92 -c 2 -a 0 -i 32 -k AGT
+h -t 8.500000000 -s 0 -d -1 -p raw -e 92 -c 2 -a 0 -i 32 -k AGT
+r -t 8.505530989 -s 3 -d 3 -p raw -e 92 -c 2 -a 0 -i 32 -k AGT
+r -t 8.507310989 -s 3 -d 3 -p raw -e 92 -c 2 -a 0 -i 32 -k AGT
+r -t 8.509090989 -s 3 -d 3 -p raw -e 92 -c 2 -a 0 -i 32 -k AGT
+r -t 8.513370989 -s 3 -d 3 -p raw -e 92 -c 2 -a 0 -i 32 -k AGT
+r -t 8.521250989 -s 3 -d 3 -p raw -e 92 -c 2 -a 0 -i 32 -k AGT
+r -t 8.535690989 -s 3 -d 3 -p raw -e 92 -c 2 -a 0 -i 32 -k AGT
+r -t 8.538210989 -s 3 -d 3 -p raw -e 92 -c 2 -a 0 -i 32 -k AGT
++ -t 8.750000000 -s 0 -d -1 -p raw -e 92 -c 2 -a 0 -i 33 -k AGT 
+- -t 8.750000000 -s 0 -d -1 -p raw -e 92 -c 2 -a 0 -i 33 -k AGT
+h -t 8.750000000 -s 0 -d -1 -p raw -e 92 -c 2 -a 0 -i 33 -k AGT
+r -t 8.755770989 -s 3 -d 3 -p raw -e 92 -c 2 -a 0 -i 33 -k AGT
+r -t 8.757370989 -s 3 -d 3 -p raw -e 92 -c 2 -a 0 -i 33 -k AGT
+r -t 8.760790989 -s 3 -d 3 -p raw -e 92 -c 2 -a 0 -i 33 -k AGT
+r -t 8.764530989 -s 3 -d 3 -p raw -e 92 -c 2 -a 0 -i 33 -k AGT
+r -t 8.766570989 -s 3 -d 3 -p raw -e 92 -c 2 -a 0 -i 33 -k AGT
+r -t 8.782250989 -s 3 -d 3 -p raw -e 92 -c 2 -a 0 -i 33 -k AGT
+r -t 8.801350989 -s 3 -d 3 -p raw -e 92 -c 2 -a 0 -i 33 -k AGT
++ -t 9.000000000 -s 0 -d -1 -p raw -e 92 -c 2 -a 0 -i 34 -k AGT 
+- -t 9.000000000 -s 0 -d -1 -p raw -e 92 -c 2 -a 0 -i 34 -k AGT
+h -t 9.000000000 -s 0 -d -1 -p raw -e 92 -c 2 -a 0 -i 34 -k AGT
+r -t 9.005710989 -s 3 -d 3 -p raw -e 92 -c 2 -a 0 -i 34 -k AGT
+r -t 9.007630989 -s 3 -d 3 -p raw -e 92 -c 2 -a 0 -i 34 -k AGT
+r -t 9.011350989 -s 3 -d 3 -p raw -e 92 -c 2 -a 0 -i 34 -k AGT
+r -t 9.014170989 -s 3 -d 3 -p raw -e 92 -c 2 -a 0 -i 34 -k AGT
+r -t 9.020870989 -s 3 -d 3 -p raw -e 92 -c 2 -a 0 -i 34 -k AGT
+r -t 9.037750989 -s 3 -d 3 -p raw -e 92 -c 2 -a 0 -i 34 -k AGT
+r -t 9.050250989 -s 3 -d 3 -p raw -e 92 -c 2 -a 0 -i 34 -k AGT
++ -t 9.250000000 -s 0 -d -1 -p raw -e 92 -c 2 -a 0 -i 35 -k AGT 
+- -t 9.250000000 -s 0 -d -1 -p raw -e 92 -c 2 -a 0 -i 35 -k AGT
+h -t 9.250000000 -s 0 -d -1 -p raw -e 92 -c 2 -a 0 -i 35 -k AGT
+r -t 9.255410989 -s 3 -d 3 -p raw -e 92 -c 2 -a 0 -i 35 -k AGT
+r -t 9.257390989 -s 3 -d 3 -p raw -e 92 -c 2 -a 0 -i 35 -k AGT
+r -t 9.259670989 -s 3 -d 3 -p raw -e 92 -c 2 -a 0 -i 35 -k AGT
+r -t 9.264950989 -s 3 -d 3 -p raw -e 92 -c 2 -a 0 -i 35 -k AGT
+r -t 9.267750989 -s 3 -d 3 -p raw -e 92 -c 2 -a 0 -i 35 -k AGT
+r -t 9.284430989 -s 3 -d 3 -p raw -e 92 -c 2 -a 0 -i 35 -k AGT
+r -t 9.305150989 -s 3 -d 3 -p raw -e 92 -c 2 -a 0 -i 35 -k AGT
++ -t 9.500000000 -s 0 -d -1 -p raw -e 92 -c 2 -a 0 -i 36 -k AGT 
+- -t 9.500000000 -s 0 -d -1 -p raw -e 92 -c 2 -a 0 -i 36 -k AGT
+h -t 9.500000000 -s 0 -d -1 -p raw -e 92 -c 2 -a 0 -i 36 -k AGT
+r -t 9.505710989 -s 3 -d 3 -p raw -e 92 -c 2 -a 0 -i 36 -k AGT
+r -t 9.508030989 -s 3 -d 3 -p raw -e 92 -c 2 -a 0 -i 36 -k AGT
+r -t 9.511610989 -s 3 -d 3 -p raw -e 92 -c 2 -a 0 -i 36 -k AGT
+r -t 9.516250989 -s 3 -d 3 -p raw -e 92 -c 2 -a 0 -i 36 -k AGT
+r -t 9.526830989 -s 3 -d 3 -p raw -e 92 -c 2 -a 0 -i 36 -k AGT
+r -t 9.537410989 -s 3 -d 3 -p raw -e 92 -c 2 -a 0 -i 36 -k AGT
+r -t 9.545670989 -s 3 -d 3 -p raw -e 92 -c 2 -a 0 -i 36 -k AGT
++ -t 9.750000000 -s 0 -d -1 -p raw -e 92 -c 2 -a 0 -i 37 -k AGT 
+- -t 9.750000000 -s 0 -d -1 -p raw -e 92 -c 2 -a 0 -i 37 -k AGT
+h -t 9.750000000 -s 0 -d -1 -p raw -e 92 -c 2 -a 0 -i 37 -k AGT
+r -t 9.755810989 -s 3 -d 3 -p raw -e 92 -c 2 -a 0 -i 37 -k AGT
+r -t 9.757530989 -s 3 -d 3 -p raw -e 92 -c 2 -a 0 -i 37 -k AGT
+r -t 9.761510989 -s 3 -d 3 -p raw -e 92 -c 2 -a 0 -i 37 -k AGT
+r -t 9.764630989 -s 3 -d 3 -p raw -e 92 -c 2 -a 0 -i 37 -k AGT
+r -t 9.769570989 -s 3 -d 3 -p raw -e 92 -c 2 -a 0 -i 37 -k AGT
+r -t 9.783270989 -s 3 -d 3 -p raw -e 92 -c 2 -a 0 -i 37 -k AGT
+r -t 9.795090989 -s 3 -d 3 -p raw -e 92 -c 2 -a 0 -i 37 -k AGT
diff -ruN --exclude='*.o' --exclude='autom4*' ns-2.34-pure/tcl/ex/nsclick-simple-hybrid.tcl ns-2.34/tcl/ex/nsclick-simple-hybrid.tcl
--- ns-2.34-pure/tcl/ex/nsclick-simple-hybrid.tcl	1969-12-31 16:00:00.000000000 -0800
+++ ns-2.34/tcl/ex/nsclick-simple-hybrid.tcl	2010-02-28 09:31:39.000000000 -0800
@@ -0,0 +1,397 @@
+#
+#  Copyright 2002, Univerity of Colorado at Boulder.                        
+#                                                                            
+#                         All Rights Reserved                                
+#                                                                            
+#  Permission to use, copy, modify, and distribute this software and its    
+#  documentation for any purpose other than its incorporation into a        
+#  commercial product is hereby granted without fee, provided that the      
+#  above copyright notice appear in all copies and that both that           
+#  copyright notice and this permission notice appear in supporting         
+#  documentation, and that the name of the University not be used in        
+#  advertising or publicity pertaining to distribution of the software      
+#  without specific, written prior permission.                              
+#                                                                            
+#  UNIVERSITY OF COLORADO DISCLAIMS ALL WARRANTIES WITH REGARD TO THIS      
+#  SOFTWARE, INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY AND        
+#  FITNESS FOR ANY PARTICULAR PURPOSE.  IN NO EVENT SHALL THE UNIVERSITY    
+#  OF COLORADO BE LIABLE FOR ANY SPECIAL, INDIRECT OR CONSEQUENTIAL         
+#  DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM LOSS OF USE, DATA      
+#  OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR OTHER       
+#  TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR         
+#  PERFORMANCE OF THIS SOFTWARE.                                            
+#
+# nsclick-simple-hybrid.tcl
+#
+# A sample nsclick script simulating a small hybrid wired/wireless
+#
+
+#
+# Set some general simulation parameters
+#
+
+#
+# Unity gain, omnidirectional antennas, centered 1.5m above each node.
+# These values are lifted from the ns-2 sample files.
+#
+Antenna/OmniAntenna set X_ 0
+Antenna/OmniAntenna set Y_ 0
+Antenna/OmniAntenna set Z_ 1.5
+Antenna/OmniAntenna set Gt_ 1.0
+Antenna/OmniAntenna set Gr_ 1.0
+
+#
+# Initialize the SharedMedia interface with parameters to make
+# it work like the 914MHz Lucent WaveLAN DSSS radio interface
+# These are taken directly from the ns-2 sample files.
+#
+Phy/WirelessPhy set CPThresh_ 10.0
+Phy/WirelessPhy set CSThresh_ 1.559e-11
+Phy/WirelessPhy set RXThresh_ 3.652e-10
+Phy/WirelessPhy set Rb_ 2*1e6
+Phy/WirelessPhy set Pt_ 0.2818
+Phy/WirelessPhy set freq_ 914e+6 
+Phy/WirelessPhy set L_ 1.0
+
+#
+# Disable RTS/CTS handshake for the bridge to work
+#
+Mac/802_11 set RTSThreshold_ 2500
+
+# 
+# Set the size of the playing field and the topography.
+#
+set xsize 100
+set ysize 100
+set wtopo	[new Topography]
+$wtopo load_flatgrid $xsize $ysize
+
+#
+# The network channel, physical layer, MAC, propagation model,
+# and antenna model are all standard ns-2.
+#  
+set wirelesschan Channel/WirelessChannel
+set wiredchan Channel
+
+set wirelessphy Phy/WirelessPhy
+set wiredphy Phy/WiredPhy
+
+set wirelessmac Mac/802_11
+set wiredmac Mac/802_3
+
+set netprop Propagation/TwoRayGround
+set antenna Antenna/OmniAntenna
+
+#
+# We have to use a special queue and link layer. This is so that
+# Click can have control over the network interface packet queue,
+# which is vital if we want to play with, e.g. QoS algorithms.
+#
+set netifq	Queue/ClickQueue
+set netll	LL/Ext
+LL set delay_			1ms
+
+#
+# These are pretty self-explanatory, just the number of nodes
+# and when we'll stop.
+#
+set wirednodecount 3
+set wirelessnodecount 3
+set bridgenodecount 1
+set nodecount   7
+set stoptime	10.0
+
+#
+# With nsclick, we have to worry about details like which network
+# port to use for communication. This sets the default ports to 5000.
+#
+Agent/Null set sport_		5000
+Agent/Null set dport_		5000
+
+Agent/CBR set sport_		5000
+Agent/CBR set dport_		5000
+
+#
+# Standard ns-2 stuff here - create the simulator object.
+#
+set ns_		[new Simulator]
+
+#
+# Create and activate trace files.
+#
+set tracefd	[open "nsclick-simple-hybrid.tr" w]
+set namtrace    [open "nsclick-simple-hybrid.nam" w]
+$ns_ trace-all $tracefd
+$ns_ namtrace-all-wireless $namtrace $xsize $ysize
+$ns_ use-newtrace
+
+
+#
+# Create the "god" object. This is another artifact of using
+# the mobile node type. We have to have this even though
+# we never use it.
+#
+set god_ [create-god $nodecount]
+
+#
+# Tell the simulator to create Click nodes.
+#
+Simulator set node_factory_ Node/MobileNode/ClickNode
+
+#
+# Create a network Channel for the nodes to use. One channel
+# per LAN. Also set the propagation model to be used.
+#
+set wired_chan_ [new $wiredchan]
+set wireless_chan_ [new $wirelesschan]
+set prop_ [new $netprop]
+
+#
+# In nsclick we have to worry about assigning IP and MAC addresses
+# to out network interfaces. Here we generate a list of IP and MAC
+# addresses, one per node since we've only got one network interface
+# per node in this case. Also note that this scheme only works for
+# fewer than 255 nodes, and we aren't worrying about subnet masks.
+#
+set iptemplate "192.168.1.%d"
+set mactemplate "00:03:47:70:89:%0x"
+for {set i 0} {$i < $wirednodecount} {incr i} {
+    set wired_node_ip($i) [format $iptemplate [expr $i+1]]
+    set wired_node_mac($i) [format $mactemplate [expr $i+1]]
+}
+
+set iptemplate "192.168.2.%d"
+set mactemplate "00:03:47:70:8A:%0x"
+for {set i 0} {$i < $wirelessnodecount} {incr i} {
+    set wireless_node_ip($i) [format $iptemplate [expr $i+1]]
+    set wireless_node_mac($i) [format $mactemplate [expr $i+1]]
+}
+
+
+#
+# We set the routing protocol to "Empty" so that ns-2 doesn't do
+# any packet routing. All of the routing will be done by the
+# Click script.
+#
+$ns_ rtproto Empty
+
+#
+# Here is where we actually create all of the nodes.
+# We'll create the wired, wireless, and the bridge node
+# separately.
+#
+
+#
+# Start with the wireless nodes
+#
+for {set i 0} {$i < $wirelessnodecount } {incr i} {
+    set wireless_node_($i) [$ns_ node]
+
+    #
+    # After creating the node, we add one wireless network interface to
+    # it. By default, this interface will be named "eth0". If we
+    # added a second interface it would be named "eth1", a third
+    # "eth2" and so on.
+    #
+    $wireless_node_($i) add-interface $wireless_chan_ $prop_ $netll \
+	    $wirelessmac $netifq 1 $wirelessphy $antenna $wtopo
+
+    #
+    # Now configure the interface eth0
+    #
+    $wireless_node_($i) setip "eth0" $wireless_node_ip($i)
+    $wireless_node_($i) setmac "eth0" $wireless_node_mac($i)
+
+    #
+    # Set some node properties
+    #
+    $wireless_node_($i) random-motion 0
+    $wireless_node_($i) topography $wtopo
+    $wireless_node_($i) nodetrace $tracefd
+
+    #
+    # The node name is used by Click to distinguish information
+    # coming from different nodes. For example, a "Print" element
+    # prepends this to the printed string so it's clear exactly
+    # which node is doing the printing.
+    #
+    [$wireless_node_($i) set classifier_] setnodename "wirelessnode$i-hybrid"
+    
+    #
+    # Load the appropriate Click router script for the node.
+    #
+    [$wireless_node_($i) entry] loadclick "nsclick-simple-lan.click"
+}
+
+#
+# Now create the wired nodes
+#
+for {set i 0} {$i < $wirednodecount } {incr i} {
+    set wired_node_($i) [$ns_ node]
+
+    #
+    # After creating the node, we add one wired network interface to
+    # it. By default, this interface will be named "eth0". If we
+    # added a second interface it would be named "eth1", a third
+    # "eth2" and so on.
+    #
+    $wired_node_($i) add-wired-interface $wired_chan_ $netll $wiredmac \
+	$netifq 1 $wiredphy
+
+    #
+    # Now configure the interface eth0
+    #
+    $wired_node_($i) setip "eth0" $wired_node_ip($i)
+    $wired_node_($i) setmac "eth0" $wired_node_mac($i)
+
+    #
+    # Set some node properties
+    #
+    $wired_node_($i) random-motion 0
+    $wired_node_($i) topography $wtopo
+    $wired_node_($i) nodetrace $tracefd
+
+    #
+    # The node name is used by Click to distinguish information
+    # coming from different nodes. For example, a "Print" element
+    # prepends this to the printed string so it's clear exactly
+    # which node is doing the printing.
+    #
+    [$wired_node_($i) set classifier_] setnodename "wirednode$i-hybrid"
+    
+    #
+    # Load the appropriate Click router script for the node.
+    # All nodes in this simulation are using the same script,
+    # but there's no reason why each node couldn't use a different
+    # script.
+    #
+    [$wired_node_($i) entry] loadclick "nsclick-simple-lan.click"
+}
+
+#
+# Finally make the bridge node
+#
+set bridge_node_ [$ns_ node]
+$bridge_node_ add-wired-interface $wired_chan_ $netll $wiredmac \
+	$netifq 1 $wiredphy
+$bridge_node_ add-interface $wireless_chan_ $prop_ $netll \
+	    $wirelessmac $netifq 1 $wirelessphy $antenna $wtopo
+$bridge_node_ setpromiscuous 0 1
+$bridge_node_ setpromiscuous 1 1
+
+$bridge_node_ random-motion 0
+$bridge_node_ topography $wtopo
+$bridge_node_ nodetrace $tracefd
+
+[$bridge_node_ entry] loadclick "nsclick-simple-bridge.click"
+[$bridge_node_ set classifier_] setnodename "bridgenode-hybrid"
+
+# 
+# Define node network traffic. There isn't a whole lot going on
+# in this simple test case, we're just going to have the first wireless node
+# send packets to the first wired node, starting at 1 second, and ending at 10.
+# There are Perl scripts available to automatically generate network
+# traffic.
+#
+
+
+#
+# Start transmitting at $startxmittime, $xmitrate packets per second.
+#
+set startxmittime 1
+set xmitrate 4
+set xmitinterval 0.25
+set packetsize 64
+
+#
+# We use the "raw" packet type, which sends real packet data
+# down the pipe.
+#
+set raw_(0) [new Agent/Raw]
+$ns_ attach-agent $wireless_node_(0) $raw_(0)
+
+set null_(0) [new Agent/Null]
+$ns_ attach-agent $wired_node_(0) $null_(0)
+
+#
+# The CBR object is just the default ns-2 CBR object, so
+# no change in the meaning of the parameters.
+#
+set cbr_(0) [new Application/Traffic/CBR]
+$cbr_(0) set packetSize_ $packetsize
+$cbr_(0) set interval_ $xmitinterval
+$cbr_(0) set random_ 0
+$cbr_(0) set maxpkts_ [expr ($stoptime - $startxmittime)*$xmitrate]
+$cbr_(0) attach-agent $raw_(0)
+
+#
+# The Raw agent creates real UDP packets, so it has to know
+# the source and destination IP addresses and port numberes.
+#
+$raw_(0) set-srcip [$wireless_node_(0) getip eth0]
+$raw_(0) set-srcport 5000
+$raw_(0) set-destport 5000
+$raw_(0) set-destip [$wired_node_(0) getip eth0]
+
+$ns_ at $startxmittime "$cbr_(0) start"
+
+
+$wireless_node_(0) set X_ 10
+$wireless_node_(0) set Y_ 50
+$wireless_node_(0) set Z_ 0
+
+$wireless_node_(1) set X_ 50
+$wireless_node_(1) set Y_ 50
+$wireless_node_(1) set Z_ 0
+
+$wireless_node_(2) set X_ 90
+$wireless_node_(2) set Y_ 50
+$wireless_node_(2) set Z_ 0
+
+$bridge_node_ set X_ 50
+$bridge_node_ set Y_ 10
+$bridge_node_ set Z_ 0
+
+$wired_node_(0) set X_ 10
+$wired_node_(0) set Y_ 0
+$wired_node_(0) set Z_ 0
+
+$wired_node_(1) set X_ 50
+$wired_node_(1) set Y_ 0
+$wired_node_(1) set Z_ 0
+
+$wired_node_(2) set X_ 90
+$wired_node_(2) set Y_ 0
+$wired_node_(2) set Z_ 0
+#
+# This sizes the nodes for use in nam.
+#
+for {set i 0} {$i < $wirelessnodecount} {incr i} {
+    $ns_ initial_node_pos $wireless_node_($i) 10
+    [$wireless_node_($i) entry] runclick
+}
+
+for {set i 0} {$i < $wirednodecount} {incr i} {
+    $ns_ initial_node_pos $wired_node_($i) 10
+    [$wired_node_($i) entry] runclick
+}
+
+$ns_ initial_node_pos $bridge_node_ 10
+
+#
+# Stop the simulation
+#
+$ns_ at  $stoptime.000000001 "puts \"NS EXITING...\" ; $ns_ halt"
+
+#
+# Let nam know that the simulation is done.
+#
+$ns_ at  $stoptime	"$ns_ nam-end-wireless $stoptime"
+
+
+puts "Starting Simulation..."
+$ns_ run
+
+
+
+
diff -ruN --exclude='*.o' --exclude='autom4*' ns-2.34-pure/tcl/ex/nsclick-simple-hybrid.tr ns-2.34/tcl/ex/nsclick-simple-hybrid.tr
--- ns-2.34-pure/tcl/ex/nsclick-simple-hybrid.tr	1969-12-31 16:00:00.000000000 -0800
+++ ns-2.34/tcl/ex/nsclick-simple-hybrid.tr	2010-02-28 09:31:39.000000000 -0800
@@ -0,0 +1,288 @@
+s 1.000000000 _0_ AGT  --- 0 raw 92 [0 0 0 0] ------- [0:0 -1:-1 32 0] raw 
+r 1.016121766 _3_ AGT  --- 0 raw 92 [0 0 ffff0000 0] ------- [0:0 0:0 0 3] raw 
+r 1.018301766 _3_ AGT  --- 0 raw 92 [0 0 ffff0000 0] ------- [0:0 0:0 0 3] raw 
+r 1.021761766 _3_ AGT  --- 0 raw 92 [0 0 ffff0000 0] ------- [0:0 0:0 0 3] raw 
+r 1.027061766 _3_ AGT  --- 0 raw 92 [0 0 ffff0000 0] ------- [0:0 0:0 0 3] raw 
+r 1.035561766 _3_ AGT  --- 0 raw 92 [0 0 ffff0000 0] ------- [0:0 0:0 0 3] raw 
+r 1.057281766 _3_ AGT  --- 0 raw 92 [0 0 ffff0000 0] ------- [0:0 0:0 0 3] raw 
+r 1.066501766 _3_ AGT  --- 0 raw 92 [0 0 ffff0000 0] ------- [0:0 0:0 0 3] raw 
+s 1.250000000 _0_ AGT  --- 3 raw 92 [0 0 0 0] ------- [0:0 -1:-1 32 0] raw 
+r 1.255530989 _3_ AGT  --- 3 raw 92 [0 0 ffff0000 0] ------- [0:0 0:0 0 3] raw 
+r 1.257510989 _3_ AGT  --- 3 raw 92 [0 0 ffff0000 0] ------- [0:0 0:0 0 3] raw 
+r 1.261230989 _3_ AGT  --- 3 raw 92 [0 0 ffff0000 0] ------- [0:0 0:0 0 3] raw 
+r 1.266170989 _3_ AGT  --- 3 raw 92 [0 0 ffff0000 0] ------- [0:0 0:0 0 3] raw 
+r 1.273130989 _3_ AGT  --- 3 raw 92 [0 0 ffff0000 0] ------- [0:0 0:0 0 3] raw 
+r 1.276750989 _3_ AGT  --- 3 raw 92 [0 0 ffff0000 0] ------- [0:0 0:0 0 3] raw 
+r 1.279670989 _3_ AGT  --- 3 raw 92 [0 0 ffff0000 0] ------- [0:0 0:0 0 3] raw 
+s 1.500000000 _0_ AGT  --- 4 raw 92 [0 0 0 0] ------- [0:0 -1:-1 32 0] raw 
+r 1.505770989 _3_ AGT  --- 4 raw 92 [0 0 ffff0000 0] ------- [0:0 0:0 0 3] raw 
+r 1.507390989 _3_ AGT  --- 4 raw 92 [0 0 ffff0000 0] ------- [0:0 0:0 0 3] raw 
+r 1.509190989 _3_ AGT  --- 4 raw 92 [0 0 ffff0000 0] ------- [0:0 0:0 0 3] raw 
+r 1.511290989 _3_ AGT  --- 4 raw 92 [0 0 ffff0000 0] ------- [0:0 0:0 0 3] raw 
+r 1.520050989 _3_ AGT  --- 4 raw 92 [0 0 ffff0000 0] ------- [0:0 0:0 0 3] raw 
+r 1.537710989 _3_ AGT  --- 4 raw 92 [0 0 ffff0000 0] ------- [0:0 0:0 0 3] raw 
+r 1.551250989 _3_ AGT  --- 4 raw 92 [0 0 ffff0000 0] ------- [0:0 0:0 0 3] raw 
+s 1.750000000 _0_ AGT  --- 5 raw 92 [0 0 0 0] ------- [0:0 -1:-1 32 0] raw 
+r 1.755730989 _3_ AGT  --- 5 raw 92 [0 0 ffff0000 0] ------- [0:0 0:0 0 3] raw 
+r 1.757350989 _3_ AGT  --- 5 raw 92 [0 0 ffff0000 0] ------- [0:0 0:0 0 3] raw 
+r 1.760310989 _3_ AGT  --- 5 raw 92 [0 0 ffff0000 0] ------- [0:0 0:0 0 3] raw 
+r 1.765530989 _3_ AGT  --- 5 raw 92 [0 0 ffff0000 0] ------- [0:0 0:0 0 3] raw 
+r 1.769510989 _3_ AGT  --- 5 raw 92 [0 0 ffff0000 0] ------- [0:0 0:0 0 3] raw 
+r 1.777590989 _3_ AGT  --- 5 raw 92 [0 0 ffff0000 0] ------- [0:0 0:0 0 3] raw 
+r 1.790930989 _3_ AGT  --- 5 raw 92 [0 0 ffff0000 0] ------- [0:0 0:0 0 3] raw 
+s 2.000000000 _0_ AGT  --- 6 raw 92 [0 0 0 0] ------- [0:0 -1:-1 32 0] raw 
+r 2.005590989 _3_ AGT  --- 6 raw 92 [0 0 ffff0000 0] ------- [0:0 0:0 0 3] raw 
+r 2.007810989 _3_ AGT  --- 6 raw 92 [0 0 ffff0000 0] ------- [0:0 0:0 0 3] raw 
+r 2.010790989 _3_ AGT  --- 6 raw 92 [0 0 ffff0000 0] ------- [0:0 0:0 0 3] raw 
+r 2.016050989 _3_ AGT  --- 6 raw 92 [0 0 ffff0000 0] ------- [0:0 0:0 0 3] raw 
+r 2.026670989 _3_ AGT  --- 6 raw 92 [0 0 ffff0000 0] ------- [0:0 0:0 0 3] raw 
+r 2.033350989 _3_ AGT  --- 6 raw 92 [0 0 ffff0000 0] ------- [0:0 0:0 0 3] raw 
+r 2.044890989 _3_ AGT  --- 6 raw 92 [0 0 ffff0000 0] ------- [0:0 0:0 0 3] raw 
+s 2.250000000 _0_ AGT  --- 7 raw 92 [0 0 0 0] ------- [0:0 -1:-1 32 0] raw 
+r 2.255810989 _3_ AGT  --- 7 raw 92 [0 0 ffff0000 0] ------- [0:0 0:0 0 3] raw 
+r 2.257610989 _3_ AGT  --- 7 raw 92 [0 0 ffff0000 0] ------- [0:0 0:0 0 3] raw 
+r 2.260650989 _3_ AGT  --- 7 raw 92 [0 0 ffff0000 0] ------- [0:0 0:0 0 3] raw 
+r 2.263330989 _3_ AGT  --- 7 raw 92 [0 0 ffff0000 0] ------- [0:0 0:0 0 3] raw 
+r 2.272450989 _3_ AGT  --- 7 raw 92 [0 0 ffff0000 0] ------- [0:0 0:0 0 3] raw 
+r 2.292070989 _3_ AGT  --- 7 raw 92 [0 0 ffff0000 0] ------- [0:0 0:0 0 3] raw 
+r 2.307570989 _3_ AGT  --- 7 raw 92 [0 0 ffff0000 0] ------- [0:0 0:0 0 3] raw 
+s 2.500000000 _0_ AGT  --- 8 raw 92 [0 0 0 0] ------- [0:0 -1:-1 32 0] raw 
+r 2.505790989 _3_ AGT  --- 8 raw 92 [0 0 ffff0000 0] ------- [0:0 0:0 0 3] raw 
+r 2.507350989 _3_ AGT  --- 8 raw 92 [0 0 ffff0000 0] ------- [0:0 0:0 0 3] raw 
+r 2.509910989 _3_ AGT  --- 8 raw 92 [0 0 ffff0000 0] ------- [0:0 0:0 0 3] raw 
+r 2.516170989 _3_ AGT  --- 8 raw 92 [0 0 ffff0000 0] ------- [0:0 0:0 0 3] raw 
+r 2.524230989 _3_ AGT  --- 8 raw 92 [0 0 ffff0000 0] ------- [0:0 0:0 0 3] raw 
+r 2.533190989 _3_ AGT  --- 8 raw 92 [0 0 ffff0000 0] ------- [0:0 0:0 0 3] raw 
+r 2.541750989 _3_ AGT  --- 8 raw 92 [0 0 ffff0000 0] ------- [0:0 0:0 0 3] raw 
+s 2.750000000 _0_ AGT  --- 9 raw 92 [0 0 0 0] ------- [0:0 -1:-1 32 0] raw 
+r 2.755610989 _3_ AGT  --- 9 raw 92 [0 0 ffff0000 0] ------- [0:0 0:0 0 3] raw 
+r 2.757470989 _3_ AGT  --- 9 raw 92 [0 0 ffff0000 0] ------- [0:0 0:0 0 3] raw 
+r 2.760090989 _3_ AGT  --- 9 raw 92 [0 0 ffff0000 0] ------- [0:0 0:0 0 3] raw 
+r 2.763530989 _3_ AGT  --- 9 raw 92 [0 0 ffff0000 0] ------- [0:0 0:0 0 3] raw 
+r 2.771450989 _3_ AGT  --- 9 raw 92 [0 0 ffff0000 0] ------- [0:0 0:0 0 3] raw 
+r 2.779790989 _3_ AGT  --- 9 raw 92 [0 0 ffff0000 0] ------- [0:0 0:0 0 3] raw 
+r 2.791470989 _3_ AGT  --- 9 raw 92 [0 0 ffff0000 0] ------- [0:0 0:0 0 3] raw 
+s 3.000000000 _0_ AGT  --- 10 raw 92 [0 0 0 0] ------- [0:0 -1:-1 32 0] raw 
+r 3.005590989 _3_ AGT  --- 10 raw 92 [0 0 ffff0000 0] ------- [0:0 0:0 0 3] raw 
+r 3.007190989 _3_ AGT  --- 10 raw 92 [0 0 ffff0000 0] ------- [0:0 0:0 0 3] raw 
+r 3.010870989 _3_ AGT  --- 10 raw 92 [0 0 ffff0000 0] ------- [0:0 0:0 0 3] raw 
+r 3.013790989 _3_ AGT  --- 10 raw 92 [0 0 ffff0000 0] ------- [0:0 0:0 0 3] raw 
+r 3.024910989 _3_ AGT  --- 10 raw 92 [0 0 ffff0000 0] ------- [0:0 0:0 0 3] raw 
+r 3.030890989 _3_ AGT  --- 10 raw 92 [0 0 ffff0000 0] ------- [0:0 0:0 0 3] raw 
+r 3.045110989 _3_ AGT  --- 10 raw 92 [0 0 ffff0000 0] ------- [0:0 0:0 0 3] raw 
+s 3.250000000 _0_ AGT  --- 11 raw 92 [0 0 0 0] ------- [0:0 -1:-1 32 0] raw 
+r 3.255330989 _3_ AGT  --- 11 raw 92 [0 0 ffff0000 0] ------- [0:0 0:0 0 3] raw 
+r 3.257450989 _3_ AGT  --- 11 raw 92 [0 0 ffff0000 0] ------- [0:0 0:0 0 3] raw 
+r 3.260150989 _3_ AGT  --- 11 raw 92 [0 0 ffff0000 0] ------- [0:0 0:0 0 3] raw 
+r 3.264490989 _3_ AGT  --- 11 raw 92 [0 0 ffff0000 0] ------- [0:0 0:0 0 3] raw 
+r 3.269070989 _3_ AGT  --- 11 raw 92 [0 0 ffff0000 0] ------- [0:0 0:0 0 3] raw 
+r 3.290510989 _3_ AGT  --- 11 raw 92 [0 0 ffff0000 0] ------- [0:0 0:0 0 3] raw 
+r 3.310890989 _3_ AGT  --- 11 raw 92 [0 0 ffff0000 0] ------- [0:0 0:0 0 3] raw 
+s 3.500000000 _0_ AGT  --- 12 raw 92 [0 0 0 0] ------- [0:0 -1:-1 32 0] raw 
+r 3.505490989 _3_ AGT  --- 12 raw 92 [0 0 ffff0000 0] ------- [0:0 0:0 0 3] raw 
+r 3.507690989 _3_ AGT  --- 12 raw 92 [0 0 ffff0000 0] ------- [0:0 0:0 0 3] raw 
+r 3.510050989 _3_ AGT  --- 12 raw 92 [0 0 ffff0000 0] ------- [0:0 0:0 0 3] raw 
+r 3.515570989 _3_ AGT  --- 12 raw 92 [0 0 ffff0000 0] ------- [0:0 0:0 0 3] raw 
+r 3.524730989 _3_ AGT  --- 12 raw 92 [0 0 ffff0000 0] ------- [0:0 0:0 0 3] raw 
+r 3.544910989 _3_ AGT  --- 12 raw 92 [0 0 ffff0000 0] ------- [0:0 0:0 0 3] raw 
+r 3.564990989 _3_ AGT  --- 12 raw 92 [0 0 ffff0000 0] ------- [0:0 0:0 0 3] raw 
+s 3.750000000 _0_ AGT  --- 13 raw 92 [0 0 0 0] ------- [0:0 -1:-1 32 0] raw 
+r 3.755410989 _3_ AGT  --- 13 raw 92 [0 0 ffff0000 0] ------- [0:0 0:0 0 3] raw 
+r 3.758150989 _3_ AGT  --- 13 raw 92 [0 0 ffff0000 0] ------- [0:0 0:0 0 3] raw 
+r 3.761790989 _3_ AGT  --- 13 raw 92 [0 0 ffff0000 0] ------- [0:0 0:0 0 3] raw 
+r 3.763750989 _3_ AGT  --- 13 raw 92 [0 0 ffff0000 0] ------- [0:0 0:0 0 3] raw 
+r 3.771710989 _3_ AGT  --- 13 raw 92 [0 0 ffff0000 0] ------- [0:0 0:0 0 3] raw 
+r 3.773530989 _3_ AGT  --- 13 raw 92 [0 0 ffff0000 0] ------- [0:0 0:0 0 3] raw 
+r 3.785270989 _3_ AGT  --- 13 raw 92 [0 0 ffff0000 0] ------- [0:0 0:0 0 3] raw 
+s 4.000000000 _0_ AGT  --- 14 raw 92 [0 0 0 0] ------- [0:0 -1:-1 32 0] raw 
+r 4.005630989 _3_ AGT  --- 14 raw 92 [0 0 ffff0000 0] ------- [0:0 0:0 0 3] raw 
+r 4.007150989 _3_ AGT  --- 14 raw 92 [0 0 ffff0000 0] ------- [0:0 0:0 0 3] raw 
+r 4.009510989 _3_ AGT  --- 14 raw 92 [0 0 ffff0000 0] ------- [0:0 0:0 0 3] raw 
+r 4.012030989 _3_ AGT  --- 14 raw 92 [0 0 ffff0000 0] ------- [0:0 0:0 0 3] raw 
+r 4.014850989 _3_ AGT  --- 14 raw 92 [0 0 ffff0000 0] ------- [0:0 0:0 0 3] raw 
+r 4.025210989 _3_ AGT  --- 14 raw 92 [0 0 ffff0000 0] ------- [0:0 0:0 0 3] raw 
+r 4.038950989 _3_ AGT  --- 14 raw 92 [0 0 ffff0000 0] ------- [0:0 0:0 0 3] raw 
+s 4.250000000 _0_ AGT  --- 15 raw 92 [0 0 0 0] ------- [0:0 -1:-1 32 0] raw 
+r 4.255690989 _3_ AGT  --- 15 raw 92 [0 0 ffff0000 0] ------- [0:0 0:0 0 3] raw 
+r 4.258350989 _3_ AGT  --- 15 raw 92 [0 0 ffff0000 0] ------- [0:0 0:0 0 3] raw 
+r 4.260270989 _3_ AGT  --- 15 raw 92 [0 0 ffff0000 0] ------- [0:0 0:0 0 3] raw 
+r 4.263310989 _3_ AGT  --- 15 raw 92 [0 0 ffff0000 0] ------- [0:0 0:0 0 3] raw 
+r 4.269150989 _3_ AGT  --- 15 raw 92 [0 0 ffff0000 0] ------- [0:0 0:0 0 3] raw 
+r 4.280110989 _3_ AGT  --- 15 raw 92 [0 0 ffff0000 0] ------- [0:0 0:0 0 3] raw 
+r 4.293770989 _3_ AGT  --- 15 raw 92 [0 0 ffff0000 0] ------- [0:0 0:0 0 3] raw 
+s 4.500000000 _0_ AGT  --- 16 raw 92 [0 0 0 0] ------- [0:0 -1:-1 32 0] raw 
+r 4.505610989 _3_ AGT  --- 16 raw 92 [0 0 ffff0000 0] ------- [0:0 0:0 0 3] raw 
+r 4.507970989 _3_ AGT  --- 16 raw 92 [0 0 ffff0000 0] ------- [0:0 0:0 0 3] raw 
+r 4.511590989 _3_ AGT  --- 16 raw 92 [0 0 ffff0000 0] ------- [0:0 0:0 0 3] raw 
+r 4.517610989 _3_ AGT  --- 16 raw 92 [0 0 ffff0000 0] ------- [0:0 0:0 0 3] raw 
+r 4.525410989 _3_ AGT  --- 16 raw 92 [0 0 ffff0000 0] ------- [0:0 0:0 0 3] raw 
+r 4.536250989 _3_ AGT  --- 16 raw 92 [0 0 ffff0000 0] ------- [0:0 0:0 0 3] raw 
+r 4.556010989 _3_ AGT  --- 16 raw 92 [0 0 ffff0000 0] ------- [0:0 0:0 0 3] raw 
+s 4.750000000 _0_ AGT  --- 17 raw 92 [0 0 0 0] ------- [0:0 -1:-1 32 0] raw 
+r 4.755390989 _3_ AGT  --- 17 raw 92 [0 0 ffff0000 0] ------- [0:0 0:0 0 3] raw 
+r 4.757630989 _3_ AGT  --- 17 raw 92 [0 0 ffff0000 0] ------- [0:0 0:0 0 3] raw 
+r 4.760130989 _3_ AGT  --- 17 raw 92 [0 0 ffff0000 0] ------- [0:0 0:0 0 3] raw 
+r 4.762530989 _3_ AGT  --- 17 raw 92 [0 0 ffff0000 0] ------- [0:0 0:0 0 3] raw 
+r 4.768670989 _3_ AGT  --- 17 raw 92 [0 0 ffff0000 0] ------- [0:0 0:0 0 3] raw 
+r 4.789210989 _3_ AGT  --- 17 raw 92 [0 0 ffff0000 0] ------- [0:0 0:0 0 3] raw 
+r 4.808110989 _3_ AGT  --- 17 raw 92 [0 0 ffff0000 0] ------- [0:0 0:0 0 3] raw 
+s 5.000000000 _0_ AGT  --- 18 raw 92 [0 0 0 0] ------- [0:0 -1:-1 32 0] raw 
+r 5.005310989 _3_ AGT  --- 18 raw 92 [0 0 ffff0000 0] ------- [0:0 0:0 0 3] raw 
+r 5.007070989 _3_ AGT  --- 18 raw 92 [0 0 ffff0000 0] ------- [0:0 0:0 0 3] raw 
+r 5.009250989 _3_ AGT  --- 18 raw 92 [0 0 ffff0000 0] ------- [0:0 0:0 0 3] raw 
+r 5.010830989 _3_ AGT  --- 18 raw 92 [0 0 ffff0000 0] ------- [0:0 0:0 0 3] raw 
+r 5.020070989 _3_ AGT  --- 18 raw 92 [0 0 ffff0000 0] ------- [0:0 0:0 0 3] raw 
+r 5.028790989 _3_ AGT  --- 18 raw 92 [0 0 ffff0000 0] ------- [0:0 0:0 0 3] raw 
+r 5.045630989 _3_ AGT  --- 18 raw 92 [0 0 ffff0000 0] ------- [0:0 0:0 0 3] raw 
+s 5.250000000 _0_ AGT  --- 19 raw 92 [0 0 0 0] ------- [0:0 -1:-1 32 0] raw 
+r 5.255670989 _3_ AGT  --- 19 raw 92 [0 0 ffff0000 0] ------- [0:0 0:0 0 3] raw 
+r 5.257990989 _3_ AGT  --- 19 raw 92 [0 0 ffff0000 0] ------- [0:0 0:0 0 3] raw 
+r 5.261170989 _3_ AGT  --- 19 raw 92 [0 0 ffff0000 0] ------- [0:0 0:0 0 3] raw 
+r 5.267690989 _3_ AGT  --- 19 raw 92 [0 0 ffff0000 0] ------- [0:0 0:0 0 3] raw 
+r 5.274410989 _3_ AGT  --- 19 raw 92 [0 0 ffff0000 0] ------- [0:0 0:0 0 3] raw 
+r 5.286030989 _3_ AGT  --- 19 raw 92 [0 0 ffff0000 0] ------- [0:0 0:0 0 3] raw 
+r 5.290170989 _3_ AGT  --- 19 raw 92 [0 0 ffff0000 0] ------- [0:0 0:0 0 3] raw 
+s 5.500000000 _0_ AGT  --- 20 raw 92 [0 0 0 0] ------- [0:0 -1:-1 32 0] raw 
+r 5.505530989 _3_ AGT  --- 20 raw 92 [0 0 ffff0000 0] ------- [0:0 0:0 0 3] raw 
+r 5.508070989 _3_ AGT  --- 20 raw 92 [0 0 ffff0000 0] ------- [0:0 0:0 0 3] raw 
+r 5.510830989 _3_ AGT  --- 20 raw 92 [0 0 ffff0000 0] ------- [0:0 0:0 0 3] raw 
+r 5.513830989 _3_ AGT  --- 20 raw 92 [0 0 ffff0000 0] ------- [0:0 0:0 0 3] raw 
+r 5.522790989 _3_ AGT  --- 20 raw 92 [0 0 ffff0000 0] ------- [0:0 0:0 0 3] raw 
+r 5.528590989 _3_ AGT  --- 20 raw 92 [0 0 ffff0000 0] ------- [0:0 0:0 0 3] raw 
+r 5.546190989 _3_ AGT  --- 20 raw 92 [0 0 ffff0000 0] ------- [0:0 0:0 0 3] raw 
+s 5.750000000 _0_ AGT  --- 21 raw 92 [0 0 0 0] ------- [0:0 -1:-1 32 0] raw 
+r 5.755870989 _3_ AGT  --- 21 raw 92 [0 0 ffff0000 0] ------- [0:0 0:0 0 3] raw 
+r 5.758330989 _3_ AGT  --- 21 raw 92 [0 0 ffff0000 0] ------- [0:0 0:0 0 3] raw 
+r 5.759910989 _3_ AGT  --- 21 raw 92 [0 0 ffff0000 0] ------- [0:0 0:0 0 3] raw 
+r 5.765370989 _3_ AGT  --- 21 raw 92 [0 0 ffff0000 0] ------- [0:0 0:0 0 3] raw 
+r 5.767510989 _3_ AGT  --- 21 raw 92 [0 0 ffff0000 0] ------- [0:0 0:0 0 3] raw 
+r 5.787530989 _3_ AGT  --- 21 raw 92 [0 0 ffff0000 0] ------- [0:0 0:0 0 3] raw 
+r 5.800310989 _3_ AGT  --- 21 raw 92 [0 0 ffff0000 0] ------- [0:0 0:0 0 3] raw 
+s 6.000000000 _0_ AGT  --- 22 raw 92 [0 0 0 0] ------- [0:0 -1:-1 32 0] raw 
+r 6.005470989 _3_ AGT  --- 22 raw 92 [0 0 ffff0000 0] ------- [0:0 0:0 0 3] raw 
+r 6.008150989 _3_ AGT  --- 22 raw 92 [0 0 ffff0000 0] ------- [0:0 0:0 0 3] raw 
+r 6.012190989 _3_ AGT  --- 22 raw 92 [0 0 ffff0000 0] ------- [0:0 0:0 0 3] raw 
+r 6.016850989 _3_ AGT  --- 22 raw 92 [0 0 ffff0000 0] ------- [0:0 0:0 0 3] raw 
+r 6.025090989 _3_ AGT  --- 22 raw 92 [0 0 ffff0000 0] ------- [0:0 0:0 0 3] raw 
+r 6.035290989 _3_ AGT  --- 22 raw 92 [0 0 ffff0000 0] ------- [0:0 0:0 0 3] raw 
+r 6.046850989 _3_ AGT  --- 22 raw 92 [0 0 ffff0000 0] ------- [0:0 0:0 0 3] raw 
+s 6.250000000 _0_ AGT  --- 23 raw 92 [0 0 0 0] ------- [0:0 -1:-1 32 0] raw 
+r 6.255650989 _3_ AGT  --- 23 raw 92 [0 0 ffff0000 0] ------- [0:0 0:0 0 3] raw 
+r 6.258110989 _3_ AGT  --- 23 raw 92 [0 0 ffff0000 0] ------- [0:0 0:0 0 3] raw 
+r 6.260230989 _3_ AGT  --- 23 raw 92 [0 0 ffff0000 0] ------- [0:0 0:0 0 3] raw 
+r 6.265470989 _3_ AGT  --- 23 raw 92 [0 0 ffff0000 0] ------- [0:0 0:0 0 3] raw 
+r 6.269890989 _3_ AGT  --- 23 raw 92 [0 0 ffff0000 0] ------- [0:0 0:0 0 3] raw 
+r 6.275050989 _3_ AGT  --- 23 raw 92 [0 0 ffff0000 0] ------- [0:0 0:0 0 3] raw 
+r 6.278350989 _3_ AGT  --- 23 raw 92 [0 0 ffff0000 0] ------- [0:0 0:0 0 3] raw 
+s 6.500000000 _0_ AGT  --- 24 raw 92 [0 0 0 0] ------- [0:0 -1:-1 32 0] raw 
+r 6.505330989 _3_ AGT  --- 24 raw 92 [0 0 ffff0000 0] ------- [0:0 0:0 0 3] raw 
+r 6.507870989 _3_ AGT  --- 24 raw 92 [0 0 ffff0000 0] ------- [0:0 0:0 0 3] raw 
+r 6.511550989 _3_ AGT  --- 24 raw 92 [0 0 ffff0000 0] ------- [0:0 0:0 0 3] raw 
+r 6.513550989 _3_ AGT  --- 24 raw 92 [0 0 ffff0000 0] ------- [0:0 0:0 0 3] raw 
+r 6.517910989 _3_ AGT  --- 24 raw 92 [0 0 ffff0000 0] ------- [0:0 0:0 0 3] raw 
+r 6.524950989 _3_ AGT  --- 24 raw 92 [0 0 ffff0000 0] ------- [0:0 0:0 0 3] raw 
+r 6.533590989 _3_ AGT  --- 24 raw 92 [0 0 ffff0000 0] ------- [0:0 0:0 0 3] raw 
+s 6.750000000 _0_ AGT  --- 25 raw 92 [0 0 0 0] ------- [0:0 -1:-1 32 0] raw 
+r 6.755630989 _3_ AGT  --- 25 raw 92 [0 0 ffff0000 0] ------- [0:0 0:0 0 3] raw 
+r 6.757290989 _3_ AGT  --- 25 raw 92 [0 0 ffff0000 0] ------- [0:0 0:0 0 3] raw 
+r 6.759010989 _3_ AGT  --- 25 raw 92 [0 0 ffff0000 0] ------- [0:0 0:0 0 3] raw 
+r 6.764790989 _3_ AGT  --- 25 raw 92 [0 0 ffff0000 0] ------- [0:0 0:0 0 3] raw 
+r 6.768150989 _3_ AGT  --- 25 raw 92 [0 0 ffff0000 0] ------- [0:0 0:0 0 3] raw 
+r 6.771410989 _3_ AGT  --- 25 raw 92 [0 0 ffff0000 0] ------- [0:0 0:0 0 3] raw 
+r 6.792230989 _3_ AGT  --- 25 raw 92 [0 0 ffff0000 0] ------- [0:0 0:0 0 3] raw 
+s 7.000000000 _0_ AGT  --- 26 raw 92 [0 0 0 0] ------- [0:0 -1:-1 32 0] raw 
+r 7.005890989 _3_ AGT  --- 26 raw 92 [0 0 ffff0000 0] ------- [0:0 0:0 0 3] raw 
+r 7.008230989 _3_ AGT  --- 26 raw 92 [0 0 ffff0000 0] ------- [0:0 0:0 0 3] raw 
+r 7.010110989 _3_ AGT  --- 26 raw 92 [0 0 ffff0000 0] ------- [0:0 0:0 0 3] raw 
+r 7.014230989 _3_ AGT  --- 26 raw 92 [0 0 ffff0000 0] ------- [0:0 0:0 0 3] raw 
+r 7.021390989 _3_ AGT  --- 26 raw 92 [0 0 ffff0000 0] ------- [0:0 0:0 0 3] raw 
+r 7.032270989 _3_ AGT  --- 26 raw 92 [0 0 ffff0000 0] ------- [0:0 0:0 0 3] raw 
+r 7.048970989 _3_ AGT  --- 26 raw 92 [0 0 ffff0000 0] ------- [0:0 0:0 0 3] raw 
+s 7.250000000 _0_ AGT  --- 27 raw 92 [0 0 0 0] ------- [0:0 -1:-1 32 0] raw 
+r 7.255690989 _3_ AGT  --- 27 raw 92 [0 0 ffff0000 0] ------- [0:0 0:0 0 3] raw 
+r 7.257750989 _3_ AGT  --- 27 raw 92 [0 0 ffff0000 0] ------- [0:0 0:0 0 3] raw 
+r 7.261470989 _3_ AGT  --- 27 raw 92 [0 0 ffff0000 0] ------- [0:0 0:0 0 3] raw 
+r 7.266830989 _3_ AGT  --- 27 raw 92 [0 0 ffff0000 0] ------- [0:0 0:0 0 3] raw 
+r 7.276410989 _3_ AGT  --- 27 raw 92 [0 0 ffff0000 0] ------- [0:0 0:0 0 3] raw 
+r 7.296610989 _3_ AGT  --- 27 raw 92 [0 0 ffff0000 0] ------- [0:0 0:0 0 3] raw 
+r 7.301790989 _3_ AGT  --- 27 raw 92 [0 0 ffff0000 0] ------- [0:0 0:0 0 3] raw 
+s 7.500000000 _0_ AGT  --- 28 raw 92 [0 0 0 0] ------- [0:0 -1:-1 32 0] raw 
+r 7.505750989 _3_ AGT  --- 28 raw 92 [0 0 ffff0000 0] ------- [0:0 0:0 0 3] raw 
+r 7.507670989 _3_ AGT  --- 28 raw 92 [0 0 ffff0000 0] ------- [0:0 0:0 0 3] raw 
+r 7.510010989 _3_ AGT  --- 28 raw 92 [0 0 ffff0000 0] ------- [0:0 0:0 0 3] raw 
+r 7.514930989 _3_ AGT  --- 28 raw 92 [0 0 ffff0000 0] ------- [0:0 0:0 0 3] raw 
+r 7.518670989 _3_ AGT  --- 28 raw 92 [0 0 ffff0000 0] ------- [0:0 0:0 0 3] raw 
+r 7.530950989 _3_ AGT  --- 28 raw 92 [0 0 ffff0000 0] ------- [0:0 0:0 0 3] raw 
+r 7.539810989 _3_ AGT  --- 28 raw 92 [0 0 ffff0000 0] ------- [0:0 0:0 0 3] raw 
+s 7.750000000 _0_ AGT  --- 29 raw 92 [0 0 0 0] ------- [0:0 -1:-1 32 0] raw 
+r 7.755330989 _3_ AGT  --- 29 raw 92 [0 0 ffff0000 0] ------- [0:0 0:0 0 3] raw 
+r 7.757210989 _3_ AGT  --- 29 raw 92 [0 0 ffff0000 0] ------- [0:0 0:0 0 3] raw 
+r 7.760190989 _3_ AGT  --- 29 raw 92 [0 0 ffff0000 0] ------- [0:0 0:0 0 3] raw 
+r 7.762830989 _3_ AGT  --- 29 raw 92 [0 0 ffff0000 0] ------- [0:0 0:0 0 3] raw 
+r 7.765770989 _3_ AGT  --- 29 raw 92 [0 0 ffff0000 0] ------- [0:0 0:0 0 3] raw 
+r 7.774430989 _3_ AGT  --- 29 raw 92 [0 0 ffff0000 0] ------- [0:0 0:0 0 3] raw 
+r 7.781810989 _3_ AGT  --- 29 raw 92 [0 0 ffff0000 0] ------- [0:0 0:0 0 3] raw 
+s 8.000000000 _0_ AGT  --- 30 raw 92 [0 0 0 0] ------- [0:0 -1:-1 32 0] raw 
+r 8.005330989 _3_ AGT  --- 30 raw 92 [0 0 ffff0000 0] ------- [0:0 0:0 0 3] raw 
+r 8.007610989 _3_ AGT  --- 30 raw 92 [0 0 ffff0000 0] ------- [0:0 0:0 0 3] raw 
+r 8.010770989 _3_ AGT  --- 30 raw 92 [0 0 ffff0000 0] ------- [0:0 0:0 0 3] raw 
+r 8.016410989 _3_ AGT  --- 30 raw 92 [0 0 ffff0000 0] ------- [0:0 0:0 0 3] raw 
+r 8.025530989 _3_ AGT  --- 30 raw 92 [0 0 ffff0000 0] ------- [0:0 0:0 0 3] raw 
+r 8.037930989 _3_ AGT  --- 30 raw 92 [0 0 ffff0000 0] ------- [0:0 0:0 0 3] raw 
+r 8.053430989 _3_ AGT  --- 30 raw 92 [0 0 ffff0000 0] ------- [0:0 0:0 0 3] raw 
+s 8.250000000 _0_ AGT  --- 31 raw 92 [0 0 0 0] ------- [0:0 -1:-1 32 0] raw 
+r 8.255390989 _3_ AGT  --- 31 raw 92 [0 0 ffff0000 0] ------- [0:0 0:0 0 3] raw 
+r 8.257290989 _3_ AGT  --- 31 raw 92 [0 0 ffff0000 0] ------- [0:0 0:0 0 3] raw 
+r 8.259650989 _3_ AGT  --- 31 raw 92 [0 0 ffff0000 0] ------- [0:0 0:0 0 3] raw 
+r 8.261390989 _3_ AGT  --- 31 raw 92 [0 0 ffff0000 0] ------- [0:0 0:0 0 3] raw 
+r 8.269810989 _3_ AGT  --- 31 raw 92 [0 0 ffff0000 0] ------- [0:0 0:0 0 3] raw 
+r 8.289310989 _3_ AGT  --- 31 raw 92 [0 0 ffff0000 0] ------- [0:0 0:0 0 3] raw 
+r 8.310470989 _3_ AGT  --- 31 raw 92 [0 0 ffff0000 0] ------- [0:0 0:0 0 3] raw 
+s 8.500000000 _0_ AGT  --- 32 raw 92 [0 0 0 0] ------- [0:0 -1:-1 32 0] raw 
+r 8.505530989 _3_ AGT  --- 32 raw 92 [0 0 ffff0000 0] ------- [0:0 0:0 0 3] raw 
+r 8.507310989 _3_ AGT  --- 32 raw 92 [0 0 ffff0000 0] ------- [0:0 0:0 0 3] raw 
+r 8.509090989 _3_ AGT  --- 32 raw 92 [0 0 ffff0000 0] ------- [0:0 0:0 0 3] raw 
+r 8.513370989 _3_ AGT  --- 32 raw 92 [0 0 ffff0000 0] ------- [0:0 0:0 0 3] raw 
+r 8.521250989 _3_ AGT  --- 32 raw 92 [0 0 ffff0000 0] ------- [0:0 0:0 0 3] raw 
+r 8.535690989 _3_ AGT  --- 32 raw 92 [0 0 ffff0000 0] ------- [0:0 0:0 0 3] raw 
+r 8.538210989 _3_ AGT  --- 32 raw 92 [0 0 ffff0000 0] ------- [0:0 0:0 0 3] raw 
+s 8.750000000 _0_ AGT  --- 33 raw 92 [0 0 0 0] ------- [0:0 -1:-1 32 0] raw 
+r 8.755770989 _3_ AGT  --- 33 raw 92 [0 0 ffff0000 0] ------- [0:0 0:0 0 3] raw 
+r 8.757370989 _3_ AGT  --- 33 raw 92 [0 0 ffff0000 0] ------- [0:0 0:0 0 3] raw 
+r 8.760790989 _3_ AGT  --- 33 raw 92 [0 0 ffff0000 0] ------- [0:0 0:0 0 3] raw 
+r 8.764530989 _3_ AGT  --- 33 raw 92 [0 0 ffff0000 0] ------- [0:0 0:0 0 3] raw 
+r 8.766570989 _3_ AGT  --- 33 raw 92 [0 0 ffff0000 0] ------- [0:0 0:0 0 3] raw 
+r 8.782250989 _3_ AGT  --- 33 raw 92 [0 0 ffff0000 0] ------- [0:0 0:0 0 3] raw 
+r 8.801350989 _3_ AGT  --- 33 raw 92 [0 0 ffff0000 0] ------- [0:0 0:0 0 3] raw 
+s 9.000000000 _0_ AGT  --- 34 raw 92 [0 0 0 0] ------- [0:0 -1:-1 32 0] raw 
+r 9.005710989 _3_ AGT  --- 34 raw 92 [0 0 ffff0000 0] ------- [0:0 0:0 0 3] raw 
+r 9.007630989 _3_ AGT  --- 34 raw 92 [0 0 ffff0000 0] ------- [0:0 0:0 0 3] raw 
+r 9.011350989 _3_ AGT  --- 34 raw 92 [0 0 ffff0000 0] ------- [0:0 0:0 0 3] raw 
+r 9.014170989 _3_ AGT  --- 34 raw 92 [0 0 ffff0000 0] ------- [0:0 0:0 0 3] raw 
+r 9.020870989 _3_ AGT  --- 34 raw 92 [0 0 ffff0000 0] ------- [0:0 0:0 0 3] raw 
+r 9.037750989 _3_ AGT  --- 34 raw 92 [0 0 ffff0000 0] ------- [0:0 0:0 0 3] raw 
+r 9.050250989 _3_ AGT  --- 34 raw 92 [0 0 ffff0000 0] ------- [0:0 0:0 0 3] raw 
+s 9.250000000 _0_ AGT  --- 35 raw 92 [0 0 0 0] ------- [0:0 -1:-1 32 0] raw 
+r 9.255410989 _3_ AGT  --- 35 raw 92 [0 0 ffff0000 0] ------- [0:0 0:0 0 3] raw 
+r 9.257390989 _3_ AGT  --- 35 raw 92 [0 0 ffff0000 0] ------- [0:0 0:0 0 3] raw 
+r 9.259670989 _3_ AGT  --- 35 raw 92 [0 0 ffff0000 0] ------- [0:0 0:0 0 3] raw 
+r 9.264950989 _3_ AGT  --- 35 raw 92 [0 0 ffff0000 0] ------- [0:0 0:0 0 3] raw 
+r 9.267750989 _3_ AGT  --- 35 raw 92 [0 0 ffff0000 0] ------- [0:0 0:0 0 3] raw 
+r 9.284430989 _3_ AGT  --- 35 raw 92 [0 0 ffff0000 0] ------- [0:0 0:0 0 3] raw 
+r 9.305150989 _3_ AGT  --- 35 raw 92 [0 0 ffff0000 0] ------- [0:0 0:0 0 3] raw 
+s 9.500000000 _0_ AGT  --- 36 raw 92 [0 0 0 0] ------- [0:0 -1:-1 32 0] raw 
+r 9.505710989 _3_ AGT  --- 36 raw 92 [0 0 ffff0000 0] ------- [0:0 0:0 0 3] raw 
+r 9.508030989 _3_ AGT  --- 36 raw 92 [0 0 ffff0000 0] ------- [0:0 0:0 0 3] raw 
+r 9.511610989 _3_ AGT  --- 36 raw 92 [0 0 ffff0000 0] ------- [0:0 0:0 0 3] raw 
+r 9.516250989 _3_ AGT  --- 36 raw 92 [0 0 ffff0000 0] ------- [0:0 0:0 0 3] raw 
+r 9.526830989 _3_ AGT  --- 36 raw 92 [0 0 ffff0000 0] ------- [0:0 0:0 0 3] raw 
+r 9.537410989 _3_ AGT  --- 36 raw 92 [0 0 ffff0000 0] ------- [0:0 0:0 0 3] raw 
+r 9.545670989 _3_ AGT  --- 36 raw 92 [0 0 ffff0000 0] ------- [0:0 0:0 0 3] raw 
+s 9.750000000 _0_ AGT  --- 37 raw 92 [0 0 0 0] ------- [0:0 -1:-1 32 0] raw 
+r 9.755810989 _3_ AGT  --- 37 raw 92 [0 0 ffff0000 0] ------- [0:0 0:0 0 3] raw 
+r 9.757530989 _3_ AGT  --- 37 raw 92 [0 0 ffff0000 0] ------- [0:0 0:0 0 3] raw 
+r 9.761510989 _3_ AGT  --- 37 raw 92 [0 0 ffff0000 0] ------- [0:0 0:0 0 3] raw 
+r 9.764630989 _3_ AGT  --- 37 raw 92 [0 0 ffff0000 0] ------- [0:0 0:0 0 3] raw 
+r 9.769570989 _3_ AGT  --- 37 raw 92 [0 0 ffff0000 0] ------- [0:0 0:0 0 3] raw 
+r 9.783270989 _3_ AGT  --- 37 raw 92 [0 0 ffff0000 0] ------- [0:0 0:0 0 3] raw 
+r 9.795090989 _3_ AGT  --- 37 raw 92 [0 0 ffff0000 0] ------- [0:0 0:0 0 3] raw 
diff -ruN --exclude='*.o' --exclude='autom4*' ns-2.34-pure/tcl/ex/nsclick-simple-lan.click ns-2.34/tcl/ex/nsclick-simple-lan.click
--- ns-2.34-pure/tcl/ex/nsclick-simple-lan.click	1969-12-31 16:00:00.000000000 -0800
+++ ns-2.34/tcl/ex/nsclick-simple-lan.click	2010-02-28 09:31:39.000000000 -0800
@@ -0,0 +1,97 @@
+//
+//  Copyright 2002, Univerity of Colorado at Boulder.                        
+//                                                                            
+//                         All Rights Reserved                                
+//                                                                            
+//  Permission to use, copy, modify, and distribute this software and its    
+//  documentation for any purpose other than its incorporation into a        
+//  commercial product is hereby granted without fee, provided that the      
+//  above copyright notice appear in all copies and that both that           
+//  copyright notice and this permission notice appear in supporting         
+//  documentation, and that the name of the University not be used in        
+//  advertising or publicity pertaining to distribution of the software      
+//  without specific, written prior permission.                              
+//                                                                            
+//  UNIVERSITY OF COLORADO DISCLAIMS ALL WARRANTIES WITH REGARD TO THIS      
+//  SOFTWARE, INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY AND        
+//  FITNESS FOR ANY PARTICULAR PURPOSE.  IN NO EVENT SHALL THE UNIVERSITY    
+//  OF COLORADO BE LIABLE FOR ANY SPECIAL, INDIRECT OR CONSEQUENTIAL         
+//  DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM LOSS OF USE, DATA      
+//  OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR OTHER       
+//  TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR         
+//  PERFORMANCE OF THIS SOFTWARE.                                            
+//
+
+// nsclick-simple-lan.click
+//
+// This is a simple and stupid flat routing mechanism.
+// It broadcasts ARP requests if it wants to find a destination
+// address, and it responds to ARP requests made for it.
+
+elementclass DumbRouter {
+  $myaddr, $myaddr_ethernet |
+
+  class :: Classifier(12/0806 20/0001,12/0806 20/0002, -);
+  mypackets :: IPClassifier(dst host $myaddr,-);
+  myarpquerier :: ARPQuerier($myaddr,$myaddr_ethernet);
+  myarpresponder :: ARPResponder($myaddr $myaddr_ethernet);
+  ethout :: Queue -> ToSimDevice(eth0);
+
+  FromSimDevice(eth0,SNAPLEN 4096)
+	-> Print(eth0,64)
+	-> ToDump(in_eth0,PER_NODE 1)
+	-> HostEtherFilter($myaddr_ethernet)
+	-> class;
+	
+  // ARP queries from other nodes go to the ARP responder module
+  class[0] -> myarpresponder;
+
+  // ARP responses go to our query module
+  class[1] -> [1]myarpquerier;
+
+  // All other packets get checked to see if they're meant for us
+  class[2]				
+	-> Strip(14)
+	-> CheckIPHeader
+	-> MarkIPHeader
+	-> GetIPAddress(16)
+	-> mypackets; 
+
+  // Packets for us go to "tap0" which sends them to the kernel
+  mypackets[0]
+	-> IPPrint(tokernel) 
+	-> ToDump(tokernel,2000,IP,PER_NODE 1) 
+	-> ToSimDevice(tap0,IP);
+
+  // Packets for other folks or broadcast packets get discarded
+  mypackets[1]
+	-> Print(discard,64)
+	-> ToDump(discard,2000,PER_NODE 1)
+	-> Discard;
+
+  // Packets sent out by the "kernel" get pushed into the ARP query module
+  FromSimDevice(tap0,SNAPLEN 4096)
+	-> CheckIPHeader 
+	-> IPPrint(fromkernel) 
+	-> ToDump(fromkernel,2000,IP,PER_NODE 1)
+	-> GetIPAddress(16)
+	-> myarpquerier;
+
+  // Both the ARP query and response modules send data out to
+  // the simulated network device, eth0.
+  myarpquerier
+	-> Print(fromarpquery,64)
+	-> ToDump(out_arpquery,PER_NODE 1)
+	-> ethout;
+
+  myarpresponder
+	-> Print(arpresponse,64)
+	-> ToDump(out_arprespond,PER_NODE 1)
+	-> ethout;
+}
+
+
+u :: DumbRouter(eth0,eth0);
+
+
+
diff -ruN --exclude='*.o' --exclude='autom4*' ns-2.34-pure/tcl/ex/nsclick-simple-lan.nam ns-2.34/tcl/ex/nsclick-simple-lan.nam
--- ns-2.34-pure/tcl/ex/nsclick-simple-lan.nam	1969-12-31 16:00:00.000000000 -0800
+++ ns-2.34/tcl/ex/nsclick-simple-lan.nam	2010-02-28 12:24:49.000000000 -0800
@@ -0,0 +1,306 @@
+n -t * -s 0  -x 10 -y 50 -Z 0 -z 20  -v circle -c black
+n -t * -s 1  -x 50 -y 50 -Z 0 -z 20  -v circle -c black
+n -t * -s 2  -x 90 -y 50 -Z 0 -z 20  -v circle -c black
+n -t * -s 3  -x 50 -y 10 -Z 0 -z 20  -v circle -c black
+V -t * -v 1.0a5 -a 0
+W -t * -x 100 -y 100
+A -t * -n 1 -p 0 -o 0xffffffff -c 31 -a 1
+A -t * -h 1 -m 2147483647 -s 0
++ -t 1.000000000 -s 0 -d -1 -p raw -e 92 -c 2 -a 0 -i 0 -k AGT 
+- -t 1.000000000 -s 0 -d -1 -p raw -e 92 -c 2 -a 0 -i 0 -k AGT
+h -t 1.000000000 -s 0 -d -1 -p raw -e 92 -c 2 -a 0 -i 0 -k AGT
++ -t 1.001000000 -s 0 -d 0 -p raw -e 64 -c 2 -a 0 -i 1 -k MAC 
+- -t 1.001000000 -s 0 -d 0 -p raw -e 64 -c 2 -a 0 -i 1 -k MAC
+h -t 1.001000000 -s 0 -d 0 -p raw -e 64 -c 2 -a 0 -i 1 -k MAC
+r -t 1.001055200 -s 3 -d 0 -p raw -e 28 -c 2 -a 0 -i 1 -k MAC
+r -t 1.001055200 -s 2 -d 0 -p raw -e 28 -c 2 -a 0 -i 1 -k MAC
+r -t 1.001055200 -s 1 -d 0 -p raw -e 28 -c 2 -a 0 -i 1 -k MAC
++ -t 1.003055200 -s 3 -d 0 -p raw -e 64 -c 2 -a 0 -i 2 -k MAC 
+- -t 1.003055200 -s 3 -d 0 -p raw -e 64 -c 2 -a 0 -i 2 -k MAC
+h -t 1.003055200 -s 3 -d 0 -p raw -e 64 -c 2 -a 0 -i 2 -k MAC
+r -t 1.003110400 -s 0 -d 0 -p raw -e 28 -c 2 -a 0 -i 2 -k MAC
++ -t 1.005110400 -s 0 -d 3 -p raw -e 106 -c 2 -a 0 -i 0 -k MAC 
+- -t 1.005110400 -s 0 -d 3 -p raw -e 106 -c 2 -a 0 -i 0 -k MAC
+h -t 1.005110400 -s 0 -d 3 -p raw -e 106 -c 2 -a 0 -i 0 -k MAC
+r -t 1.005199200 -s 3 -d 3 -p raw -e 92 -c 2 -a 0 -i 0 -k MAC
+r -t 1.006199200 -s 3 -d 3 -p raw -e 92 -c 2 -a 0 -i 0 -k AGT
++ -t 1.250000000 -s 0 -d -1 -p raw -e 92 -c 2 -a 0 -i 3 -k AGT 
+- -t 1.250000000 -s 0 -d -1 -p raw -e 92 -c 2 -a 0 -i 3 -k AGT
+h -t 1.250000000 -s 0 -d -1 -p raw -e 92 -c 2 -a 0 -i 3 -k AGT
++ -t 1.251000000 -s 0 -d 3 -p raw -e 106 -c 2 -a 0 -i 3 -k MAC 
+- -t 1.251000000 -s 0 -d 3 -p raw -e 106 -c 2 -a 0 -i 3 -k MAC
+h -t 1.251000000 -s 0 -d 3 -p raw -e 106 -c 2 -a 0 -i 3 -k MAC
+r -t 1.251088800 -s 3 -d 3 -p raw -e 92 -c 2 -a 0 -i 3 -k MAC
+r -t 1.252088800 -s 3 -d 3 -p raw -e 92 -c 2 -a 0 -i 3 -k AGT
++ -t 1.500000000 -s 0 -d -1 -p raw -e 92 -c 2 -a 0 -i 4 -k AGT 
+- -t 1.500000000 -s 0 -d -1 -p raw -e 92 -c 2 -a 0 -i 4 -k AGT
+h -t 1.500000000 -s 0 -d -1 -p raw -e 92 -c 2 -a 0 -i 4 -k AGT
++ -t 1.501000000 -s 0 -d 3 -p raw -e 106 -c 2 -a 0 -i 4 -k MAC 
+- -t 1.501000000 -s 0 -d 3 -p raw -e 106 -c 2 -a 0 -i 4 -k MAC
+h -t 1.501000000 -s 0 -d 3 -p raw -e 106 -c 2 -a 0 -i 4 -k MAC
+r -t 1.501088800 -s 3 -d 3 -p raw -e 92 -c 2 -a 0 -i 4 -k MAC
+r -t 1.502088800 -s 3 -d 3 -p raw -e 92 -c 2 -a 0 -i 4 -k AGT
++ -t 1.750000000 -s 0 -d -1 -p raw -e 92 -c 2 -a 0 -i 5 -k AGT 
+- -t 1.750000000 -s 0 -d -1 -p raw -e 92 -c 2 -a 0 -i 5 -k AGT
+h -t 1.750000000 -s 0 -d -1 -p raw -e 92 -c 2 -a 0 -i 5 -k AGT
++ -t 1.751000000 -s 0 -d 3 -p raw -e 106 -c 2 -a 0 -i 5 -k MAC 
+- -t 1.751000000 -s 0 -d 3 -p raw -e 106 -c 2 -a 0 -i 5 -k MAC
+h -t 1.751000000 -s 0 -d 3 -p raw -e 106 -c 2 -a 0 -i 5 -k MAC
+r -t 1.751088800 -s 3 -d 3 -p raw -e 92 -c 2 -a 0 -i 5 -k MAC
+r -t 1.752088800 -s 3 -d 3 -p raw -e 92 -c 2 -a 0 -i 5 -k AGT
++ -t 2.000000000 -s 0 -d -1 -p raw -e 92 -c 2 -a 0 -i 6 -k AGT 
+- -t 2.000000000 -s 0 -d -1 -p raw -e 92 -c 2 -a 0 -i 6 -k AGT
+h -t 2.000000000 -s 0 -d -1 -p raw -e 92 -c 2 -a 0 -i 6 -k AGT
++ -t 2.001000000 -s 0 -d 3 -p raw -e 106 -c 2 -a 0 -i 6 -k MAC 
+- -t 2.001000000 -s 0 -d 3 -p raw -e 106 -c 2 -a 0 -i 6 -k MAC
+h -t 2.001000000 -s 0 -d 3 -p raw -e 106 -c 2 -a 0 -i 6 -k MAC
+r -t 2.001088800 -s 3 -d 3 -p raw -e 92 -c 2 -a 0 -i 6 -k MAC
+r -t 2.002088800 -s 3 -d 3 -p raw -e 92 -c 2 -a 0 -i 6 -k AGT
++ -t 2.250000000 -s 0 -d -1 -p raw -e 92 -c 2 -a 0 -i 7 -k AGT 
+- -t 2.250000000 -s 0 -d -1 -p raw -e 92 -c 2 -a 0 -i 7 -k AGT
+h -t 2.250000000 -s 0 -d -1 -p raw -e 92 -c 2 -a 0 -i 7 -k AGT
++ -t 2.251000000 -s 0 -d 3 -p raw -e 106 -c 2 -a 0 -i 7 -k MAC 
+- -t 2.251000000 -s 0 -d 3 -p raw -e 106 -c 2 -a 0 -i 7 -k MAC
+h -t 2.251000000 -s 0 -d 3 -p raw -e 106 -c 2 -a 0 -i 7 -k MAC
+r -t 2.251088800 -s 3 -d 3 -p raw -e 92 -c 2 -a 0 -i 7 -k MAC
+r -t 2.252088800 -s 3 -d 3 -p raw -e 92 -c 2 -a 0 -i 7 -k AGT
++ -t 2.500000000 -s 0 -d -1 -p raw -e 92 -c 2 -a 0 -i 8 -k AGT 
+- -t 2.500000000 -s 0 -d -1 -p raw -e 92 -c 2 -a 0 -i 8 -k AGT
+h -t 2.500000000 -s 0 -d -1 -p raw -e 92 -c 2 -a 0 -i 8 -k AGT
++ -t 2.501000000 -s 0 -d 3 -p raw -e 106 -c 2 -a 0 -i 8 -k MAC 
+- -t 2.501000000 -s 0 -d 3 -p raw -e 106 -c 2 -a 0 -i 8 -k MAC
+h -t 2.501000000 -s 0 -d 3 -p raw -e 106 -c 2 -a 0 -i 8 -k MAC
+r -t 2.501088800 -s 3 -d 3 -p raw -e 92 -c 2 -a 0 -i 8 -k MAC
+r -t 2.502088800 -s 3 -d 3 -p raw -e 92 -c 2 -a 0 -i 8 -k AGT
++ -t 2.750000000 -s 0 -d -1 -p raw -e 92 -c 2 -a 0 -i 9 -k AGT 
+- -t 2.750000000 -s 0 -d -1 -p raw -e 92 -c 2 -a 0 -i 9 -k AGT
+h -t 2.750000000 -s 0 -d -1 -p raw -e 92 -c 2 -a 0 -i 9 -k AGT
++ -t 2.751000000 -s 0 -d 3 -p raw -e 106 -c 2 -a 0 -i 9 -k MAC 
+- -t 2.751000000 -s 0 -d 3 -p raw -e 106 -c 2 -a 0 -i 9 -k MAC
+h -t 2.751000000 -s 0 -d 3 -p raw -e 106 -c 2 -a 0 -i 9 -k MAC
+r -t 2.751088800 -s 3 -d 3 -p raw -e 92 -c 2 -a 0 -i 9 -k MAC
+r -t 2.752088800 -s 3 -d 3 -p raw -e 92 -c 2 -a 0 -i 9 -k AGT
++ -t 3.000000000 -s 0 -d -1 -p raw -e 92 -c 2 -a 0 -i 10 -k AGT 
+- -t 3.000000000 -s 0 -d -1 -p raw -e 92 -c 2 -a 0 -i 10 -k AGT
+h -t 3.000000000 -s 0 -d -1 -p raw -e 92 -c 2 -a 0 -i 10 -k AGT
++ -t 3.001000000 -s 0 -d 3 -p raw -e 106 -c 2 -a 0 -i 10 -k MAC 
+- -t 3.001000000 -s 0 -d 3 -p raw -e 106 -c 2 -a 0 -i 10 -k MAC
+h -t 3.001000000 -s 0 -d 3 -p raw -e 106 -c 2 -a 0 -i 10 -k MAC
+r -t 3.001088800 -s 3 -d 3 -p raw -e 92 -c 2 -a 0 -i 10 -k MAC
+r -t 3.002088800 -s 3 -d 3 -p raw -e 92 -c 2 -a 0 -i 10 -k AGT
++ -t 3.250000000 -s 0 -d -1 -p raw -e 92 -c 2 -a 0 -i 11 -k AGT 
+- -t 3.250000000 -s 0 -d -1 -p raw -e 92 -c 2 -a 0 -i 11 -k AGT
+h -t 3.250000000 -s 0 -d -1 -p raw -e 92 -c 2 -a 0 -i 11 -k AGT
++ -t 3.251000000 -s 0 -d 3 -p raw -e 106 -c 2 -a 0 -i 11 -k MAC 
+- -t 3.251000000 -s 0 -d 3 -p raw -e 106 -c 2 -a 0 -i 11 -k MAC
+h -t 3.251000000 -s 0 -d 3 -p raw -e 106 -c 2 -a 0 -i 11 -k MAC
+r -t 3.251088800 -s 3 -d 3 -p raw -e 92 -c 2 -a 0 -i 11 -k MAC
+r -t 3.252088800 -s 3 -d 3 -p raw -e 92 -c 2 -a 0 -i 11 -k AGT
++ -t 3.500000000 -s 0 -d -1 -p raw -e 92 -c 2 -a 0 -i 12 -k AGT 
+- -t 3.500000000 -s 0 -d -1 -p raw -e 92 -c 2 -a 0 -i 12 -k AGT
+h -t 3.500000000 -s 0 -d -1 -p raw -e 92 -c 2 -a 0 -i 12 -k AGT
++ -t 3.501000000 -s 0 -d 3 -p raw -e 106 -c 2 -a 0 -i 12 -k MAC 
+- -t 3.501000000 -s 0 -d 3 -p raw -e 106 -c 2 -a 0 -i 12 -k MAC
+h -t 3.501000000 -s 0 -d 3 -p raw -e 106 -c 2 -a 0 -i 12 -k MAC
+r -t 3.501088800 -s 3 -d 3 -p raw -e 92 -c 2 -a 0 -i 12 -k MAC
+r -t 3.502088800 -s 3 -d 3 -p raw -e 92 -c 2 -a 0 -i 12 -k AGT
++ -t 3.750000000 -s 0 -d -1 -p raw -e 92 -c 2 -a 0 -i 13 -k AGT 
+- -t 3.750000000 -s 0 -d -1 -p raw -e 92 -c 2 -a 0 -i 13 -k AGT
+h -t 3.750000000 -s 0 -d -1 -p raw -e 92 -c 2 -a 0 -i 13 -k AGT
++ -t 3.751000000 -s 0 -d 3 -p raw -e 106 -c 2 -a 0 -i 13 -k MAC 
+- -t 3.751000000 -s 0 -d 3 -p raw -e 106 -c 2 -a 0 -i 13 -k MAC
+h -t 3.751000000 -s 0 -d 3 -p raw -e 106 -c 2 -a 0 -i 13 -k MAC
+r -t 3.751088800 -s 3 -d 3 -p raw -e 92 -c 2 -a 0 -i 13 -k MAC
+r -t 3.752088800 -s 3 -d 3 -p raw -e 92 -c 2 -a 0 -i 13 -k AGT
++ -t 4.000000000 -s 0 -d -1 -p raw -e 92 -c 2 -a 0 -i 14 -k AGT 
+- -t 4.000000000 -s 0 -d -1 -p raw -e 92 -c 2 -a 0 -i 14 -k AGT
+h -t 4.000000000 -s 0 -d -1 -p raw -e 92 -c 2 -a 0 -i 14 -k AGT
++ -t 4.001000000 -s 0 -d 3 -p raw -e 106 -c 2 -a 0 -i 14 -k MAC 
+- -t 4.001000000 -s 0 -d 3 -p raw -e 106 -c 2 -a 0 -i 14 -k MAC
+h -t 4.001000000 -s 0 -d 3 -p raw -e 106 -c 2 -a 0 -i 14 -k MAC
+r -t 4.001088800 -s 3 -d 3 -p raw -e 92 -c 2 -a 0 -i 14 -k MAC
+r -t 4.002088800 -s 3 -d 3 -p raw -e 92 -c 2 -a 0 -i 14 -k AGT
++ -t 4.250000000 -s 0 -d -1 -p raw -e 92 -c 2 -a 0 -i 15 -k AGT 
+- -t 4.250000000 -s 0 -d -1 -p raw -e 92 -c 2 -a 0 -i 15 -k AGT
+h -t 4.250000000 -s 0 -d -1 -p raw -e 92 -c 2 -a 0 -i 15 -k AGT
++ -t 4.251000000 -s 0 -d 3 -p raw -e 106 -c 2 -a 0 -i 15 -k MAC 
+- -t 4.251000000 -s 0 -d 3 -p raw -e 106 -c 2 -a 0 -i 15 -k MAC
+h -t 4.251000000 -s 0 -d 3 -p raw -e 106 -c 2 -a 0 -i 15 -k MAC
+r -t 4.251088800 -s 3 -d 3 -p raw -e 92 -c 2 -a 0 -i 15 -k MAC
+r -t 4.252088800 -s 3 -d 3 -p raw -e 92 -c 2 -a 0 -i 15 -k AGT
++ -t 4.500000000 -s 0 -d -1 -p raw -e 92 -c 2 -a 0 -i 16 -k AGT 
+- -t 4.500000000 -s 0 -d -1 -p raw -e 92 -c 2 -a 0 -i 16 -k AGT
+h -t 4.500000000 -s 0 -d -1 -p raw -e 92 -c 2 -a 0 -i 16 -k AGT
++ -t 4.501000000 -s 0 -d 3 -p raw -e 106 -c 2 -a 0 -i 16 -k MAC 
+- -t 4.501000000 -s 0 -d 3 -p raw -e 106 -c 2 -a 0 -i 16 -k MAC
+h -t 4.501000000 -s 0 -d 3 -p raw -e 106 -c 2 -a 0 -i 16 -k MAC
+r -t 4.501088800 -s 3 -d 3 -p raw -e 92 -c 2 -a 0 -i 16 -k MAC
+r -t 4.502088800 -s 3 -d 3 -p raw -e 92 -c 2 -a 0 -i 16 -k AGT
++ -t 4.750000000 -s 0 -d -1 -p raw -e 92 -c 2 -a 0 -i 17 -k AGT 
+- -t 4.750000000 -s 0 -d -1 -p raw -e 92 -c 2 -a 0 -i 17 -k AGT
+h -t 4.750000000 -s 0 -d -1 -p raw -e 92 -c 2 -a 0 -i 17 -k AGT
++ -t 4.751000000 -s 0 -d 3 -p raw -e 106 -c 2 -a 0 -i 17 -k MAC 
+- -t 4.751000000 -s 0 -d 3 -p raw -e 106 -c 2 -a 0 -i 17 -k MAC
+h -t 4.751000000 -s 0 -d 3 -p raw -e 106 -c 2 -a 0 -i 17 -k MAC
+r -t 4.751088800 -s 3 -d 3 -p raw -e 92 -c 2 -a 0 -i 17 -k MAC
+r -t 4.752088800 -s 3 -d 3 -p raw -e 92 -c 2 -a 0 -i 17 -k AGT
++ -t 5.000000000 -s 0 -d -1 -p raw -e 92 -c 2 -a 0 -i 18 -k AGT 
+- -t 5.000000000 -s 0 -d -1 -p raw -e 92 -c 2 -a 0 -i 18 -k AGT
+h -t 5.000000000 -s 0 -d -1 -p raw -e 92 -c 2 -a 0 -i 18 -k AGT
++ -t 5.001000000 -s 0 -d 3 -p raw -e 106 -c 2 -a 0 -i 18 -k MAC 
+- -t 5.001000000 -s 0 -d 3 -p raw -e 106 -c 2 -a 0 -i 18 -k MAC
+h -t 5.001000000 -s 0 -d 3 -p raw -e 106 -c 2 -a 0 -i 18 -k MAC
+r -t 5.001088800 -s 3 -d 3 -p raw -e 92 -c 2 -a 0 -i 18 -k MAC
+r -t 5.002088800 -s 3 -d 3 -p raw -e 92 -c 2 -a 0 -i 18 -k AGT
++ -t 5.250000000 -s 0 -d -1 -p raw -e 92 -c 2 -a 0 -i 19 -k AGT 
+- -t 5.250000000 -s 0 -d -1 -p raw -e 92 -c 2 -a 0 -i 19 -k AGT
+h -t 5.250000000 -s 0 -d -1 -p raw -e 92 -c 2 -a 0 -i 19 -k AGT
++ -t 5.251000000 -s 0 -d 3 -p raw -e 106 -c 2 -a 0 -i 19 -k MAC 
+- -t 5.251000000 -s 0 -d 3 -p raw -e 106 -c 2 -a 0 -i 19 -k MAC
+h -t 5.251000000 -s 0 -d 3 -p raw -e 106 -c 2 -a 0 -i 19 -k MAC
+r -t 5.251088800 -s 3 -d 3 -p raw -e 92 -c 2 -a 0 -i 19 -k MAC
+r -t 5.252088800 -s 3 -d 3 -p raw -e 92 -c 2 -a 0 -i 19 -k AGT
++ -t 5.500000000 -s 0 -d -1 -p raw -e 92 -c 2 -a 0 -i 20 -k AGT 
+- -t 5.500000000 -s 0 -d -1 -p raw -e 92 -c 2 -a 0 -i 20 -k AGT
+h -t 5.500000000 -s 0 -d -1 -p raw -e 92 -c 2 -a 0 -i 20 -k AGT
++ -t 5.501000000 -s 0 -d 3 -p raw -e 106 -c 2 -a 0 -i 20 -k MAC 
+- -t 5.501000000 -s 0 -d 3 -p raw -e 106 -c 2 -a 0 -i 20 -k MAC
+h -t 5.501000000 -s 0 -d 3 -p raw -e 106 -c 2 -a 0 -i 20 -k MAC
+r -t 5.501088800 -s 3 -d 3 -p raw -e 92 -c 2 -a 0 -i 20 -k MAC
+r -t 5.502088800 -s 3 -d 3 -p raw -e 92 -c 2 -a 0 -i 20 -k AGT
++ -t 5.750000000 -s 0 -d -1 -p raw -e 92 -c 2 -a 0 -i 21 -k AGT 
+- -t 5.750000000 -s 0 -d -1 -p raw -e 92 -c 2 -a 0 -i 21 -k AGT
+h -t 5.750000000 -s 0 -d -1 -p raw -e 92 -c 2 -a 0 -i 21 -k AGT
++ -t 5.751000000 -s 0 -d 3 -p raw -e 106 -c 2 -a 0 -i 21 -k MAC 
+- -t 5.751000000 -s 0 -d 3 -p raw -e 106 -c 2 -a 0 -i 21 -k MAC
+h -t 5.751000000 -s 0 -d 3 -p raw -e 106 -c 2 -a 0 -i 21 -k MAC
+r -t 5.751088800 -s 3 -d 3 -p raw -e 92 -c 2 -a 0 -i 21 -k MAC
+r -t 5.752088800 -s 3 -d 3 -p raw -e 92 -c 2 -a 0 -i 21 -k AGT
++ -t 6.000000000 -s 0 -d -1 -p raw -e 92 -c 2 -a 0 -i 22 -k AGT 
+- -t 6.000000000 -s 0 -d -1 -p raw -e 92 -c 2 -a 0 -i 22 -k AGT
+h -t 6.000000000 -s 0 -d -1 -p raw -e 92 -c 2 -a 0 -i 22 -k AGT
++ -t 6.001000000 -s 0 -d 3 -p raw -e 106 -c 2 -a 0 -i 22 -k MAC 
+- -t 6.001000000 -s 0 -d 3 -p raw -e 106 -c 2 -a 0 -i 22 -k MAC
+h -t 6.001000000 -s 0 -d 3 -p raw -e 106 -c 2 -a 0 -i 22 -k MAC
+r -t 6.001088800 -s 3 -d 3 -p raw -e 92 -c 2 -a 0 -i 22 -k MAC
+r -t 6.002088800 -s 3 -d 3 -p raw -e 92 -c 2 -a 0 -i 22 -k AGT
++ -t 6.250000000 -s 0 -d -1 -p raw -e 92 -c 2 -a 0 -i 23 -k AGT 
+- -t 6.250000000 -s 0 -d -1 -p raw -e 92 -c 2 -a 0 -i 23 -k AGT
+h -t 6.250000000 -s 0 -d -1 -p raw -e 92 -c 2 -a 0 -i 23 -k AGT
++ -t 6.251000000 -s 0 -d 3 -p raw -e 106 -c 2 -a 0 -i 23 -k MAC 
+- -t 6.251000000 -s 0 -d 3 -p raw -e 106 -c 2 -a 0 -i 23 -k MAC
+h -t 6.251000000 -s 0 -d 3 -p raw -e 106 -c 2 -a 0 -i 23 -k MAC
+r -t 6.251088800 -s 3 -d 3 -p raw -e 92 -c 2 -a 0 -i 23 -k MAC
+r -t 6.252088800 -s 3 -d 3 -p raw -e 92 -c 2 -a 0 -i 23 -k AGT
++ -t 6.500000000 -s 0 -d -1 -p raw -e 92 -c 2 -a 0 -i 24 -k AGT 
+- -t 6.500000000 -s 0 -d -1 -p raw -e 92 -c 2 -a 0 -i 24 -k AGT
+h -t 6.500000000 -s 0 -d -1 -p raw -e 92 -c 2 -a 0 -i 24 -k AGT
++ -t 6.501000000 -s 0 -d 3 -p raw -e 106 -c 2 -a 0 -i 24 -k MAC 
+- -t 6.501000000 -s 0 -d 3 -p raw -e 106 -c 2 -a 0 -i 24 -k MAC
+h -t 6.501000000 -s 0 -d 3 -p raw -e 106 -c 2 -a 0 -i 24 -k MAC
+r -t 6.501088800 -s 3 -d 3 -p raw -e 92 -c 2 -a 0 -i 24 -k MAC
+r -t 6.502088800 -s 3 -d 3 -p raw -e 92 -c 2 -a 0 -i 24 -k AGT
++ -t 6.750000000 -s 0 -d -1 -p raw -e 92 -c 2 -a 0 -i 25 -k AGT 
+- -t 6.750000000 -s 0 -d -1 -p raw -e 92 -c 2 -a 0 -i 25 -k AGT
+h -t 6.750000000 -s 0 -d -1 -p raw -e 92 -c 2 -a 0 -i 25 -k AGT
++ -t 6.751000000 -s 0 -d 3 -p raw -e 106 -c 2 -a 0 -i 25 -k MAC 
+- -t 6.751000000 -s 0 -d 3 -p raw -e 106 -c 2 -a 0 -i 25 -k MAC
+h -t 6.751000000 -s 0 -d 3 -p raw -e 106 -c 2 -a 0 -i 25 -k MAC
+r -t 6.751088800 -s 3 -d 3 -p raw -e 92 -c 2 -a 0 -i 25 -k MAC
+r -t 6.752088800 -s 3 -d 3 -p raw -e 92 -c 2 -a 0 -i 25 -k AGT
++ -t 7.000000000 -s 0 -d -1 -p raw -e 92 -c 2 -a 0 -i 26 -k AGT 
+- -t 7.000000000 -s 0 -d -1 -p raw -e 92 -c 2 -a 0 -i 26 -k AGT
+h -t 7.000000000 -s 0 -d -1 -p raw -e 92 -c 2 -a 0 -i 26 -k AGT
++ -t 7.001000000 -s 0 -d 3 -p raw -e 106 -c 2 -a 0 -i 26 -k MAC 
+- -t 7.001000000 -s 0 -d 3 -p raw -e 106 -c 2 -a 0 -i 26 -k MAC
+h -t 7.001000000 -s 0 -d 3 -p raw -e 106 -c 2 -a 0 -i 26 -k MAC
+r -t 7.001088800 -s 3 -d 3 -p raw -e 92 -c 2 -a 0 -i 26 -k MAC
+r -t 7.002088800 -s 3 -d 3 -p raw -e 92 -c 2 -a 0 -i 26 -k AGT
++ -t 7.250000000 -s 0 -d -1 -p raw -e 92 -c 2 -a 0 -i 27 -k AGT 
+- -t 7.250000000 -s 0 -d -1 -p raw -e 92 -c 2 -a 0 -i 27 -k AGT
+h -t 7.250000000 -s 0 -d -1 -p raw -e 92 -c 2 -a 0 -i 27 -k AGT
++ -t 7.251000000 -s 0 -d 3 -p raw -e 106 -c 2 -a 0 -i 27 -k MAC 
+- -t 7.251000000 -s 0 -d 3 -p raw -e 106 -c 2 -a 0 -i 27 -k MAC
+h -t 7.251000000 -s 0 -d 3 -p raw -e 106 -c 2 -a 0 -i 27 -k MAC
+r -t 7.251088800 -s 3 -d 3 -p raw -e 92 -c 2 -a 0 -i 27 -k MAC
+r -t 7.252088800 -s 3 -d 3 -p raw -e 92 -c 2 -a 0 -i 27 -k AGT
++ -t 7.500000000 -s 0 -d -1 -p raw -e 92 -c 2 -a 0 -i 28 -k AGT 
+- -t 7.500000000 -s 0 -d -1 -p raw -e 92 -c 2 -a 0 -i 28 -k AGT
+h -t 7.500000000 -s 0 -d -1 -p raw -e 92 -c 2 -a 0 -i 28 -k AGT
++ -t 7.501000000 -s 0 -d 3 -p raw -e 106 -c 2 -a 0 -i 28 -k MAC 
+- -t 7.501000000 -s 0 -d 3 -p raw -e 106 -c 2 -a 0 -i 28 -k MAC
+h -t 7.501000000 -s 0 -d 3 -p raw -e 106 -c 2 -a 0 -i 28 -k MAC
+r -t 7.501088800 -s 3 -d 3 -p raw -e 92 -c 2 -a 0 -i 28 -k MAC
+r -t 7.502088800 -s 3 -d 3 -p raw -e 92 -c 2 -a 0 -i 28 -k AGT
++ -t 7.750000000 -s 0 -d -1 -p raw -e 92 -c 2 -a 0 -i 29 -k AGT 
+- -t 7.750000000 -s 0 -d -1 -p raw -e 92 -c 2 -a 0 -i 29 -k AGT
+h -t 7.750000000 -s 0 -d -1 -p raw -e 92 -c 2 -a 0 -i 29 -k AGT
++ -t 7.751000000 -s 0 -d 3 -p raw -e 106 -c 2 -a 0 -i 29 -k MAC 
+- -t 7.751000000 -s 0 -d 3 -p raw -e 106 -c 2 -a 0 -i 29 -k MAC
+h -t 7.751000000 -s 0 -d 3 -p raw -e 106 -c 2 -a 0 -i 29 -k MAC
+r -t 7.751088800 -s 3 -d 3 -p raw -e 92 -c 2 -a 0 -i 29 -k MAC
+r -t 7.752088800 -s 3 -d 3 -p raw -e 92 -c 2 -a 0 -i 29 -k AGT
++ -t 8.000000000 -s 0 -d -1 -p raw -e 92 -c 2 -a 0 -i 30 -k AGT 
+- -t 8.000000000 -s 0 -d -1 -p raw -e 92 -c 2 -a 0 -i 30 -k AGT
+h -t 8.000000000 -s 0 -d -1 -p raw -e 92 -c 2 -a 0 -i 30 -k AGT
++ -t 8.001000000 -s 0 -d 3 -p raw -e 106 -c 2 -a 0 -i 30 -k MAC 
+- -t 8.001000000 -s 0 -d 3 -p raw -e 106 -c 2 -a 0 -i 30 -k MAC
+h -t 8.001000000 -s 0 -d 3 -p raw -e 106 -c 2 -a 0 -i 30 -k MAC
+r -t 8.001088800 -s 3 -d 3 -p raw -e 92 -c 2 -a 0 -i 30 -k MAC
+r -t 8.002088800 -s 3 -d 3 -p raw -e 92 -c 2 -a 0 -i 30 -k AGT
++ -t 8.250000000 -s 0 -d -1 -p raw -e 92 -c 2 -a 0 -i 31 -k AGT 
+- -t 8.250000000 -s 0 -d -1 -p raw -e 92 -c 2 -a 0 -i 31 -k AGT
+h -t 8.250000000 -s 0 -d -1 -p raw -e 92 -c 2 -a 0 -i 31 -k AGT
++ -t 8.251000000 -s 0 -d 3 -p raw -e 106 -c 2 -a 0 -i 31 -k MAC 
+- -t 8.251000000 -s 0 -d 3 -p raw -e 106 -c 2 -a 0 -i 31 -k MAC
+h -t 8.251000000 -s 0 -d 3 -p raw -e 106 -c 2 -a 0 -i 31 -k MAC
+r -t 8.251088800 -s 3 -d 3 -p raw -e 92 -c 2 -a 0 -i 31 -k MAC
+r -t 8.252088800 -s 3 -d 3 -p raw -e 92 -c 2 -a 0 -i 31 -k AGT
++ -t 8.500000000 -s 0 -d -1 -p raw -e 92 -c 2 -a 0 -i 32 -k AGT 
+- -t 8.500000000 -s 0 -d -1 -p raw -e 92 -c 2 -a 0 -i 32 -k AGT
+h -t 8.500000000 -s 0 -d -1 -p raw -e 92 -c 2 -a 0 -i 32 -k AGT
++ -t 8.501000000 -s 0 -d 3 -p raw -e 106 -c 2 -a 0 -i 32 -k MAC 
+- -t 8.501000000 -s 0 -d 3 -p raw -e 106 -c 2 -a 0 -i 32 -k MAC
+h -t 8.501000000 -s 0 -d 3 -p raw -e 106 -c 2 -a 0 -i 32 -k MAC
+r -t 8.501088800 -s 3 -d 3 -p raw -e 92 -c 2 -a 0 -i 32 -k MAC
+r -t 8.502088800 -s 3 -d 3 -p raw -e 92 -c 2 -a 0 -i 32 -k AGT
++ -t 8.750000000 -s 0 -d -1 -p raw -e 92 -c 2 -a 0 -i 33 -k AGT 
+- -t 8.750000000 -s 0 -d -1 -p raw -e 92 -c 2 -a 0 -i 33 -k AGT
+h -t 8.750000000 -s 0 -d -1 -p raw -e 92 -c 2 -a 0 -i 33 -k AGT
++ -t 8.751000000 -s 0 -d 3 -p raw -e 106 -c 2 -a 0 -i 33 -k MAC 
+- -t 8.751000000 -s 0 -d 3 -p raw -e 106 -c 2 -a 0 -i 33 -k MAC
+h -t 8.751000000 -s 0 -d 3 -p raw -e 106 -c 2 -a 0 -i 33 -k MAC
+r -t 8.751088800 -s 3 -d 3 -p raw -e 92 -c 2 -a 0 -i 33 -k MAC
+r -t 8.752088800 -s 3 -d 3 -p raw -e 92 -c 2 -a 0 -i 33 -k AGT
++ -t 9.000000000 -s 0 -d -1 -p raw -e 92 -c 2 -a 0 -i 34 -k AGT 
+- -t 9.000000000 -s 0 -d -1 -p raw -e 92 -c 2 -a 0 -i 34 -k AGT
+h -t 9.000000000 -s 0 -d -1 -p raw -e 92 -c 2 -a 0 -i 34 -k AGT
++ -t 9.001000000 -s 0 -d 3 -p raw -e 106 -c 2 -a 0 -i 34 -k MAC 
+- -t 9.001000000 -s 0 -d 3 -p raw -e 106 -c 2 -a 0 -i 34 -k MAC
+h -t 9.001000000 -s 0 -d 3 -p raw -e 106 -c 2 -a 0 -i 34 -k MAC
+r -t 9.001088800 -s 3 -d 3 -p raw -e 92 -c 2 -a 0 -i 34 -k MAC
+r -t 9.002088800 -s 3 -d 3 -p raw -e 92 -c 2 -a 0 -i 34 -k AGT
++ -t 9.250000000 -s 0 -d -1 -p raw -e 92 -c 2 -a 0 -i 35 -k AGT 
+- -t 9.250000000 -s 0 -d -1 -p raw -e 92 -c 2 -a 0 -i 35 -k AGT
+h -t 9.250000000 -s 0 -d -1 -p raw -e 92 -c 2 -a 0 -i 35 -k AGT
++ -t 9.251000000 -s 0 -d 3 -p raw -e 106 -c 2 -a 0 -i 35 -k MAC 
+- -t 9.251000000 -s 0 -d 3 -p raw -e 106 -c 2 -a 0 -i 35 -k MAC
+h -t 9.251000000 -s 0 -d 3 -p raw -e 106 -c 2 -a 0 -i 35 -k MAC
+r -t 9.251088800 -s 3 -d 3 -p raw -e 92 -c 2 -a 0 -i 35 -k MAC
+r -t 9.252088800 -s 3 -d 3 -p raw -e 92 -c 2 -a 0 -i 35 -k AGT
++ -t 9.500000000 -s 0 -d -1 -p raw -e 92 -c 2 -a 0 -i 36 -k AGT 
+- -t 9.500000000 -s 0 -d -1 -p raw -e 92 -c 2 -a 0 -i 36 -k AGT
+h -t 9.500000000 -s 0 -d -1 -p raw -e 92 -c 2 -a 0 -i 36 -k AGT
++ -t 9.501000000 -s 0 -d 3 -p raw -e 106 -c 2 -a 0 -i 36 -k MAC 
+- -t 9.501000000 -s 0 -d 3 -p raw -e 106 -c 2 -a 0 -i 36 -k MAC
+h -t 9.501000000 -s 0 -d 3 -p raw -e 106 -c 2 -a 0 -i 36 -k MAC
+r -t 9.501088800 -s 3 -d 3 -p raw -e 92 -c 2 -a 0 -i 36 -k MAC
+r -t 9.502088800 -s 3 -d 3 -p raw -e 92 -c 2 -a 0 -i 36 -k AGT
++ -t 9.750000000 -s 0 -d -1 -p raw -e 92 -c 2 -a 0 -i 37 -k AGT 
+- -t 9.750000000 -s 0 -d -1 -p raw -e 92 -c 2 -a 0 -i 37 -k AGT
+h -t 9.750000000 -s 0 -d -1 -p raw -e 92 -c 2 -a 0 -i 37 -k AGT
++ -t 9.751000000 -s 0 -d 3 -p raw -e 106 -c 2 -a 0 -i 37 -k MAC 
+- -t 9.751000000 -s 0 -d 3 -p raw -e 106 -c 2 -a 0 -i 37 -k MAC
+h -t 9.751000000 -s 0 -d 3 -p raw -e 106 -c 2 -a 0 -i 37 -k MAC
+r -t 9.751088800 -s 3 -d 3 -p raw -e 92 -c 2 -a 0 -i 37 -k MAC
+r -t 9.752088800 -s 3 -d 3 -p raw -e 92 -c 2 -a 0 -i 37 -k AGT
diff -ruN --exclude='*.o' --exclude='autom4*' ns-2.34-pure/tcl/ex/nsclick-simple-lan.tcl ns-2.34/tcl/ex/nsclick-simple-lan.tcl
--- ns-2.34-pure/tcl/ex/nsclick-simple-lan.tcl	1969-12-31 16:00:00.000000000 -0800
+++ ns-2.34/tcl/ex/nsclick-simple-lan.tcl	2010-02-28 09:31:39.000000000 -0800
@@ -0,0 +1,271 @@
+#
+#  Copyright 2002, Univerity of Colorado at Boulder.                        
+#                                                                            
+#                         All Rights Reserved                                
+#                                                                            
+#  Permission to use, copy, modify, and distribute this software and its    
+#  documentation for any purpose other than its incorporation into a        
+#  commercial product is hereby granted without fee, provided that the      
+#  above copyright notice appear in all copies and that both that           
+#  copyright notice and this permission notice appear in supporting         
+#  documentation, and that the name of the University not be used in        
+#  advertising or publicity pertaining to distribution of the software      
+#  without specific, written prior permission.                              
+#                                                                            
+#  UNIVERSITY OF COLORADO DISCLAIMS ALL WARRANTIES WITH REGARD TO THIS      
+#  SOFTWARE, INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY AND        
+#  FITNESS FOR ANY PARTICULAR PURPOSE.  IN NO EVENT SHALL THE UNIVERSITY    
+#  OF COLORADO BE LIABLE FOR ANY SPECIAL, INDIRECT OR CONSEQUENTIAL         
+#  DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM LOSS OF USE, DATA      
+#  OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR OTHER       
+#  TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR         
+#  PERFORMANCE OF THIS SOFTWARE.                                            
+#
+# nsclick-simple-lan.tcl
+#
+# A sample nsclick script simulating a small LAN
+#
+
+#
+# Set some general simulation parameters
+#
+
+# 
+# Even though this is a wired simulation with non-moving nodes, nsclick
+# uses the mobile node type. This means we have to set the size of the
+# playing field and the topography even though it won't matter.
+#
+set xsize 100
+set ysize 100
+set wtopo	[new Topography]
+$wtopo load_flatgrid $xsize $ysize
+
+#
+# The network channel, physical layer, and MAC are all standard ns-2.
+#  
+set netchan	Channel
+set netphy	Phy/WiredPhy
+set netmac	Mac/802_3
+
+#
+# We have to use a special queue and link layer. This is so that
+# Click can have control over the network interface packet queue,
+# which is vital if we want to play with, e.g. QoS algorithms.
+#
+set netifq	Queue/ClickQueue
+set netll	LL/Ext
+LL set delay_			1ms
+
+#
+# These are pretty self-explanatory, just the number of nodes
+# and when we'll stop.
+#
+set nodecount   4
+set stoptime	10.0
+
+#
+# With nsclick, we have to worry about details like which network
+# port to use for communication. This sets the default ports to 5000.
+#
+Agent/Null set sport_		5000
+Agent/Null set dport_		5001
+
+Agent/CBR set sport_		5002
+Agent/CBR set dport_		5003
+
+#
+# Standard ns-2 stuff here - create the simulator object.
+#
+Simulator set MacTrace_ ON
+set ns_		[new Simulator]
+
+#
+# Create and activate trace files.
+#
+set tracefd	[open "nsclick-simple-lan.tr" w]
+set namtrace    [open "nsclick-simple-lan.nam" w]
+$ns_ trace-all $tracefd
+$ns_ namtrace-all-wireless $namtrace $xsize $ysize
+$ns_ use-newtrace
+
+
+#
+# Create the "god" object. This is another artifact of using
+# the mobile node type. We have to have this even though
+# we never use it.
+#
+set god_ [create-god $nodecount]
+
+#
+# Tell the simulator to create Click nodes.
+#
+Simulator set node_factory_ Node/MobileNode/ClickNode
+
+#
+# Create a network Channel for the nodes to use. One channel
+# per LAN.
+#
+set chan_1_ [new $netchan]
+
+#
+# In nsclick we have to worry about assigning IP and MAC addresses
+# to out network interfaces. Here we generate a list of IP and MAC
+# addresses, one per node since we've only got one network interface
+# per node in this case. Also note that this scheme only works for
+# fewer than 255 nodes, and we aren't worrying about subnet masks.
+#
+set iptemplate "192.168.1.%d"
+set mactemplate "00:03:47:70:89:%0x"
+for {set i 0} {$i < $nodecount} {incr i} {
+    set node_ip($i) [format $iptemplate [expr $i+1]]
+    set node_mac($i) [format $mactemplate [expr $i+1]]
+}
+
+#
+# We set the routing protocol to "Empty" so that ns-2 doesn't do
+# any packet routing. All of the routing will be done by the
+# Click script.
+#
+$ns_ rtproto Empty
+
+#
+# Here is where we actually create all of the nodes.
+#
+for {set i 0} {$i < $nodecount } {incr i} {
+    set node_($i) [$ns_ node]
+
+    #
+    # After creating the node, we add one wired network interface to
+    # it. By default, this interface will be named "eth0". If we
+    # added a second interface it would be named "eth1", a third
+    # "eth2" and so on.
+    #
+    $node_($i) add-wired-interface $chan_1_ $netll $netmac \
+	$netifq 1 $netphy
+
+    #
+    # Now configure the interface eth0
+    #
+    $node_($i) setip "eth0" $node_ip($i)
+    $node_($i) setmac "eth0" $node_mac($i)
+
+    #
+    # Set some node properties
+    #
+    $node_($i) random-motion 0
+    $node_($i) topography $wtopo
+    $node_($i) nodetrace $tracefd
+
+    #
+    # The node name is used by Click to distinguish information
+    # coming from different nodes. For example, a "Print" element
+    # prepends this to the printed string so it's clear exactly
+    # which node is doing the printing.
+    #
+    [$node_($i) set classifier_] setnodename "node$i-simplelan"
+    
+    #
+    # Load the appropriate Click router script for the node.
+    # All nodes in this simulation are using the same script,
+    # but there's no reason why each node couldn't use a different
+    # script.
+    #
+    [$node_($i) entry] loadclick "nsclick-simple-lan.click"
+}
+
+
+# 
+# Define node network traffic. There isn't a whole lot going on
+# in this simple test case, we're just going to have the first node
+# send packets to the last node, starting at 1 second, and ending at 10.
+# There are Perl scripts available to automatically generate network
+# traffic.
+#
+
+
+#
+# Start transmitting at $startxmittime, $xmitrate packets per second.
+#
+set startxmittime 1
+set xmitrate 4
+set xmitinterval 0.25
+set packetsize 64
+
+#
+# We use the "raw" packet type, which sends real packet data
+# down the pipe.
+#
+set raw_(0) [new Agent/Raw]
+$ns_ attach-agent $node_(0) $raw_(0)
+
+set lastnode [expr $nodecount-1]
+set null_(0) [new Agent/Null]
+$ns_ attach-agent $node_($lastnode) $null_(0)
+
+#
+# The CBR object is just the default ns-2 CBR object, so
+# no change in the meaning of the parameters.
+#
+set cbr_(0) [new Application/Traffic/CBR]
+$cbr_(0) set packetSize_ $packetsize
+$cbr_(0) set interval_ $xmitinterval
+$cbr_(0) set random_ 0
+$cbr_(0) set maxpkts_ [expr ($stoptime - $startxmittime)*$xmitrate]
+$cbr_(0) attach-agent $raw_(0)
+
+#
+# The Raw agent creates real UDP packets, so it has to know
+# the source and destination IP addresses and port numberes.
+#
+$raw_(0) set-srcip [$node_(0) getip eth0]
+$raw_(0) set-srcport 5000
+$raw_(0) set-destport 5001
+$raw_(0) set-destip [$node_($lastnode) getip eth0]
+
+$ns_ at $startxmittime "$cbr_(0) start"
+
+#
+# Set node positions. For wired networks, these are only used
+# when looking at nam traces.
+#
+$node_(0) set X_ 10
+$node_(0) set Y_ 50
+$node_(0) set Z_ 0
+
+$node_(1) set X_ 50
+$node_(1) set Y_ 50
+$node_(1) set Z_ 0
+
+$node_(2) set X_ 90
+$node_(2) set Y_ 50
+$node_(2) set Z_ 0
+
+$node_(3) set X_ 50
+$node_(3) set Y_ 10
+$node_(3) set Z_ 0
+
+#
+# This sizes the nodes for use in nam.
+#
+for {set i 0} {$i < $nodecount} {incr i} {
+    $ns_ initial_node_pos $node_($i) 20
+    [$node_($i) entry] runclick
+}
+
+#
+# Stop the simulation
+#
+$ns_ at  $stoptime.000000001 "puts \"NS EXITING...\" ; $ns_ halt"
+
+#
+# Let nam know that the simulation is done.
+#
+$ns_ at  $stoptime	"$ns_ nam-end-wireless $stoptime"
+
+
+puts "Starting Simulation..."
+$ns_ run
+
+
+
+
diff -ruN --exclude='*.o' --exclude='autom4*' ns-2.34-pure/tcl/ex/nsclick-simple-lan.tr ns-2.34/tcl/ex/nsclick-simple-lan.tr
--- ns-2.34-pure/tcl/ex/nsclick-simple-lan.tr	1969-12-31 16:00:00.000000000 -0800
+++ ns-2.34/tcl/ex/nsclick-simple-lan.tr	2010-02-28 12:24:49.000000000 -0800
@@ -0,0 +1,150 @@
+s 1.000000000 _0_ AGT  --- 0 raw 92 [0 0 0 0] ------- [0:0 -1:-1 32 0] raw 
+s 1.001000000 _0_ MAC  --- 1 raw 64 [0 0 ffff0008 0] ------- [0:0 0:0 0 0] raw 
+r 1.001055200 _3_ MAC  --- 1 raw 28 [0 0 ffff0008 0] ------- [0:0 0:0 0 0] raw 
+r 1.001055200 _2_ MAC  --- 1 raw 28 [0 0 ffff0008 0] ------- [0:0 0:0 0 0] raw 
+r 1.001055200 _1_ MAC  --- 1 raw 28 [0 0 ffff0008 0] ------- [0:0 0:0 0 0] raw 
+s 1.003055200 _3_ MAC  --- 2 raw 64 [0 3000000 8 0] ------- [0:0 0:0 0 0] raw 
+r 1.003110400 _0_ MAC  --- 2 raw 28 [0 3000000 8 0] ------- [0:0 0:0 0 0] raw 
+s 1.005110400 _0_ MAC  --- 0 raw 106 [0 0 8 0] ------- [0:0 0:0 0 3] raw 
+r 1.005199200 _3_ MAC  --- 0 raw 92 [0 0 8 0] ------- [0:0 0:0 0 3] raw 
+r 1.006199200 _3_ AGT  --- 0 raw 92 [0 0 ffff0000 0] ------- [0:0 0:0 0 3] raw 
+s 1.250000000 _0_ AGT  --- 3 raw 92 [0 0 0 0] ------- [0:0 -1:-1 32 0] raw 
+s 1.251000000 _0_ MAC  --- 3 raw 106 [0 0 8 0] ------- [0:0 0:0 0 3] raw 
+r 1.251088800 _3_ MAC  --- 3 raw 92 [0 0 8 0] ------- [0:0 0:0 0 3] raw 
+r 1.252088800 _3_ AGT  --- 3 raw 92 [0 0 ffff0000 0] ------- [0:0 0:0 0 3] raw 
+s 1.500000000 _0_ AGT  --- 4 raw 92 [0 0 0 0] ------- [0:0 -1:-1 32 0] raw 
+s 1.501000000 _0_ MAC  --- 4 raw 106 [0 0 8 0] ------- [0:0 0:0 0 3] raw 
+r 1.501088800 _3_ MAC  --- 4 raw 92 [0 0 8 0] ------- [0:0 0:0 0 3] raw 
+r 1.502088800 _3_ AGT  --- 4 raw 92 [0 0 ffff0000 0] ------- [0:0 0:0 0 3] raw 
+s 1.750000000 _0_ AGT  --- 5 raw 92 [0 0 0 0] ------- [0:0 -1:-1 32 0] raw 
+s 1.751000000 _0_ MAC  --- 5 raw 106 [0 0 8 0] ------- [0:0 0:0 0 3] raw 
+r 1.751088800 _3_ MAC  --- 5 raw 92 [0 0 8 0] ------- [0:0 0:0 0 3] raw 
+r 1.752088800 _3_ AGT  --- 5 raw 92 [0 0 ffff0000 0] ------- [0:0 0:0 0 3] raw 
+s 2.000000000 _0_ AGT  --- 6 raw 92 [0 0 0 0] ------- [0:0 -1:-1 32 0] raw 
+s 2.001000000 _0_ MAC  --- 6 raw 106 [0 0 8 0] ------- [0:0 0:0 0 3] raw 
+r 2.001088800 _3_ MAC  --- 6 raw 92 [0 0 8 0] ------- [0:0 0:0 0 3] raw 
+r 2.002088800 _3_ AGT  --- 6 raw 92 [0 0 ffff0000 0] ------- [0:0 0:0 0 3] raw 
+s 2.250000000 _0_ AGT  --- 7 raw 92 [0 0 0 0] ------- [0:0 -1:-1 32 0] raw 
+s 2.251000000 _0_ MAC  --- 7 raw 106 [0 0 8 0] ------- [0:0 0:0 0 3] raw 
+r 2.251088800 _3_ MAC  --- 7 raw 92 [0 0 8 0] ------- [0:0 0:0 0 3] raw 
+r 2.252088800 _3_ AGT  --- 7 raw 92 [0 0 ffff0000 0] ------- [0:0 0:0 0 3] raw 
+s 2.500000000 _0_ AGT  --- 8 raw 92 [0 0 0 0] ------- [0:0 -1:-1 32 0] raw 
+s 2.501000000 _0_ MAC  --- 8 raw 106 [0 0 8 0] ------- [0:0 0:0 0 3] raw 
+r 2.501088800 _3_ MAC  --- 8 raw 92 [0 0 8 0] ------- [0:0 0:0 0 3] raw 
+r 2.502088800 _3_ AGT  --- 8 raw 92 [0 0 ffff0000 0] ------- [0:0 0:0 0 3] raw 
+s 2.750000000 _0_ AGT  --- 9 raw 92 [0 0 0 0] ------- [0:0 -1:-1 32 0] raw 
+s 2.751000000 _0_ MAC  --- 9 raw 106 [0 0 8 0] ------- [0:0 0:0 0 3] raw 
+r 2.751088800 _3_ MAC  --- 9 raw 92 [0 0 8 0] ------- [0:0 0:0 0 3] raw 
+r 2.752088800 _3_ AGT  --- 9 raw 92 [0 0 ffff0000 0] ------- [0:0 0:0 0 3] raw 
+s 3.000000000 _0_ AGT  --- 10 raw 92 [0 0 0 0] ------- [0:0 -1:-1 32 0] raw 
+s 3.001000000 _0_ MAC  --- 10 raw 106 [0 0 8 0] ------- [0:0 0:0 0 3] raw 
+r 3.001088800 _3_ MAC  --- 10 raw 92 [0 0 8 0] ------- [0:0 0:0 0 3] raw 
+r 3.002088800 _3_ AGT  --- 10 raw 92 [0 0 ffff0000 0] ------- [0:0 0:0 0 3] raw 
+s 3.250000000 _0_ AGT  --- 11 raw 92 [0 0 0 0] ------- [0:0 -1:-1 32 0] raw 
+s 3.251000000 _0_ MAC  --- 11 raw 106 [0 0 8 0] ------- [0:0 0:0 0 3] raw 
+r 3.251088800 _3_ MAC  --- 11 raw 92 [0 0 8 0] ------- [0:0 0:0 0 3] raw 
+r 3.252088800 _3_ AGT  --- 11 raw 92 [0 0 ffff0000 0] ------- [0:0 0:0 0 3] raw 
+s 3.500000000 _0_ AGT  --- 12 raw 92 [0 0 0 0] ------- [0:0 -1:-1 32 0] raw 
+s 3.501000000 _0_ MAC  --- 12 raw 106 [0 0 8 0] ------- [0:0 0:0 0 3] raw 
+r 3.501088800 _3_ MAC  --- 12 raw 92 [0 0 8 0] ------- [0:0 0:0 0 3] raw 
+r 3.502088800 _3_ AGT  --- 12 raw 92 [0 0 ffff0000 0] ------- [0:0 0:0 0 3] raw 
+s 3.750000000 _0_ AGT  --- 13 raw 92 [0 0 0 0] ------- [0:0 -1:-1 32 0] raw 
+s 3.751000000 _0_ MAC  --- 13 raw 106 [0 0 8 0] ------- [0:0 0:0 0 3] raw 
+r 3.751088800 _3_ MAC  --- 13 raw 92 [0 0 8 0] ------- [0:0 0:0 0 3] raw 
+r 3.752088800 _3_ AGT  --- 13 raw 92 [0 0 ffff0000 0] ------- [0:0 0:0 0 3] raw 
+s 4.000000000 _0_ AGT  --- 14 raw 92 [0 0 0 0] ------- [0:0 -1:-1 32 0] raw 
+s 4.001000000 _0_ MAC  --- 14 raw 106 [0 0 8 0] ------- [0:0 0:0 0 3] raw 
+r 4.001088800 _3_ MAC  --- 14 raw 92 [0 0 8 0] ------- [0:0 0:0 0 3] raw 
+r 4.002088800 _3_ AGT  --- 14 raw 92 [0 0 ffff0000 0] ------- [0:0 0:0 0 3] raw 
+s 4.250000000 _0_ AGT  --- 15 raw 92 [0 0 0 0] ------- [0:0 -1:-1 32 0] raw 
+s 4.251000000 _0_ MAC  --- 15 raw 106 [0 0 8 0] ------- [0:0 0:0 0 3] raw 
+r 4.251088800 _3_ MAC  --- 15 raw 92 [0 0 8 0] ------- [0:0 0:0 0 3] raw 
+r 4.252088800 _3_ AGT  --- 15 raw 92 [0 0 ffff0000 0] ------- [0:0 0:0 0 3] raw 
+s 4.500000000 _0_ AGT  --- 16 raw 92 [0 0 0 0] ------- [0:0 -1:-1 32 0] raw 
+s 4.501000000 _0_ MAC  --- 16 raw 106 [0 0 8 0] ------- [0:0 0:0 0 3] raw 
+r 4.501088800 _3_ MAC  --- 16 raw 92 [0 0 8 0] ------- [0:0 0:0 0 3] raw 
+r 4.502088800 _3_ AGT  --- 16 raw 92 [0 0 ffff0000 0] ------- [0:0 0:0 0 3] raw 
+s 4.750000000 _0_ AGT  --- 17 raw 92 [0 0 0 0] ------- [0:0 -1:-1 32 0] raw 
+s 4.751000000 _0_ MAC  --- 17 raw 106 [0 0 8 0] ------- [0:0 0:0 0 3] raw 
+r 4.751088800 _3_ MAC  --- 17 raw 92 [0 0 8 0] ------- [0:0 0:0 0 3] raw 
+r 4.752088800 _3_ AGT  --- 17 raw 92 [0 0 ffff0000 0] ------- [0:0 0:0 0 3] raw 
+s 5.000000000 _0_ AGT  --- 18 raw 92 [0 0 0 0] ------- [0:0 -1:-1 32 0] raw 
+s 5.001000000 _0_ MAC  --- 18 raw 106 [0 0 8 0] ------- [0:0 0:0 0 3] raw 
+r 5.001088800 _3_ MAC  --- 18 raw 92 [0 0 8 0] ------- [0:0 0:0 0 3] raw 
+r 5.002088800 _3_ AGT  --- 18 raw 92 [0 0 ffff0000 0] ------- [0:0 0:0 0 3] raw 
+s 5.250000000 _0_ AGT  --- 19 raw 92 [0 0 0 0] ------- [0:0 -1:-1 32 0] raw 
+s 5.251000000 _0_ MAC  --- 19 raw 106 [0 0 8 0] ------- [0:0 0:0 0 3] raw 
+r 5.251088800 _3_ MAC  --- 19 raw 92 [0 0 8 0] ------- [0:0 0:0 0 3] raw 
+r 5.252088800 _3_ AGT  --- 19 raw 92 [0 0 ffff0000 0] ------- [0:0 0:0 0 3] raw 
+s 5.500000000 _0_ AGT  --- 20 raw 92 [0 0 0 0] ------- [0:0 -1:-1 32 0] raw 
+s 5.501000000 _0_ MAC  --- 20 raw 106 [0 0 8 0] ------- [0:0 0:0 0 3] raw 
+r 5.501088800 _3_ MAC  --- 20 raw 92 [0 0 8 0] ------- [0:0 0:0 0 3] raw 
+r 5.502088800 _3_ AGT  --- 20 raw 92 [0 0 ffff0000 0] ------- [0:0 0:0 0 3] raw 
+s 5.750000000 _0_ AGT  --- 21 raw 92 [0 0 0 0] ------- [0:0 -1:-1 32 0] raw 
+s 5.751000000 _0_ MAC  --- 21 raw 106 [0 0 8 0] ------- [0:0 0:0 0 3] raw 
+r 5.751088800 _3_ MAC  --- 21 raw 92 [0 0 8 0] ------- [0:0 0:0 0 3] raw 
+r 5.752088800 _3_ AGT  --- 21 raw 92 [0 0 ffff0000 0] ------- [0:0 0:0 0 3] raw 
+s 6.000000000 _0_ AGT  --- 22 raw 92 [0 0 0 0] ------- [0:0 -1:-1 32 0] raw 
+s 6.001000000 _0_ MAC  --- 22 raw 106 [0 0 8 0] ------- [0:0 0:0 0 3] raw 
+r 6.001088800 _3_ MAC  --- 22 raw 92 [0 0 8 0] ------- [0:0 0:0 0 3] raw 
+r 6.002088800 _3_ AGT  --- 22 raw 92 [0 0 ffff0000 0] ------- [0:0 0:0 0 3] raw 
+s 6.250000000 _0_ AGT  --- 23 raw 92 [0 0 0 0] ------- [0:0 -1:-1 32 0] raw 
+s 6.251000000 _0_ MAC  --- 23 raw 106 [0 0 8 0] ------- [0:0 0:0 0 3] raw 
+r 6.251088800 _3_ MAC  --- 23 raw 92 [0 0 8 0] ------- [0:0 0:0 0 3] raw 
+r 6.252088800 _3_ AGT  --- 23 raw 92 [0 0 ffff0000 0] ------- [0:0 0:0 0 3] raw 
+s 6.500000000 _0_ AGT  --- 24 raw 92 [0 0 0 0] ------- [0:0 -1:-1 32 0] raw 
+s 6.501000000 _0_ MAC  --- 24 raw 106 [0 0 8 0] ------- [0:0 0:0 0 3] raw 
+r 6.501088800 _3_ MAC  --- 24 raw 92 [0 0 8 0] ------- [0:0 0:0 0 3] raw 
+r 6.502088800 _3_ AGT  --- 24 raw 92 [0 0 ffff0000 0] ------- [0:0 0:0 0 3] raw 
+s 6.750000000 _0_ AGT  --- 25 raw 92 [0 0 0 0] ------- [0:0 -1:-1 32 0] raw 
+s 6.751000000 _0_ MAC  --- 25 raw 106 [0 0 8 0] ------- [0:0 0:0 0 3] raw 
+r 6.751088800 _3_ MAC  --- 25 raw 92 [0 0 8 0] ------- [0:0 0:0 0 3] raw 
+r 6.752088800 _3_ AGT  --- 25 raw 92 [0 0 ffff0000 0] ------- [0:0 0:0 0 3] raw 
+s 7.000000000 _0_ AGT  --- 26 raw 92 [0 0 0 0] ------- [0:0 -1:-1 32 0] raw 
+s 7.001000000 _0_ MAC  --- 26 raw 106 [0 0 8 0] ------- [0:0 0:0 0 3] raw 
+r 7.001088800 _3_ MAC  --- 26 raw 92 [0 0 8 0] ------- [0:0 0:0 0 3] raw 
+r 7.002088800 _3_ AGT  --- 26 raw 92 [0 0 ffff0000 0] ------- [0:0 0:0 0 3] raw 
+s 7.250000000 _0_ AGT  --- 27 raw 92 [0 0 0 0] ------- [0:0 -1:-1 32 0] raw 
+s 7.251000000 _0_ MAC  --- 27 raw 106 [0 0 8 0] ------- [0:0 0:0 0 3] raw 
+r 7.251088800 _3_ MAC  --- 27 raw 92 [0 0 8 0] ------- [0:0 0:0 0 3] raw 
+r 7.252088800 _3_ AGT  --- 27 raw 92 [0 0 ffff0000 0] ------- [0:0 0:0 0 3] raw 
+s 7.500000000 _0_ AGT  --- 28 raw 92 [0 0 0 0] ------- [0:0 -1:-1 32 0] raw 
+s 7.501000000 _0_ MAC  --- 28 raw 106 [0 0 8 0] ------- [0:0 0:0 0 3] raw 
+r 7.501088800 _3_ MAC  --- 28 raw 92 [0 0 8 0] ------- [0:0 0:0 0 3] raw 
+r 7.502088800 _3_ AGT  --- 28 raw 92 [0 0 ffff0000 0] ------- [0:0 0:0 0 3] raw 
+s 7.750000000 _0_ AGT  --- 29 raw 92 [0 0 0 0] ------- [0:0 -1:-1 32 0] raw 
+s 7.751000000 _0_ MAC  --- 29 raw 106 [0 0 8 0] ------- [0:0 0:0 0 3] raw 
+r 7.751088800 _3_ MAC  --- 29 raw 92 [0 0 8 0] ------- [0:0 0:0 0 3] raw 
+r 7.752088800 _3_ AGT  --- 29 raw 92 [0 0 ffff0000 0] ------- [0:0 0:0 0 3] raw 
+s 8.000000000 _0_ AGT  --- 30 raw 92 [0 0 0 0] ------- [0:0 -1:-1 32 0] raw 
+s 8.001000000 _0_ MAC  --- 30 raw 106 [0 0 8 0] ------- [0:0 0:0 0 3] raw 
+r 8.001088800 _3_ MAC  --- 30 raw 92 [0 0 8 0] ------- [0:0 0:0 0 3] raw 
+r 8.002088800 _3_ AGT  --- 30 raw 92 [0 0 ffff0000 0] ------- [0:0 0:0 0 3] raw 
+s 8.250000000 _0_ AGT  --- 31 raw 92 [0 0 0 0] ------- [0:0 -1:-1 32 0] raw 
+s 8.251000000 _0_ MAC  --- 31 raw 106 [0 0 8 0] ------- [0:0 0:0 0 3] raw 
+r 8.251088800 _3_ MAC  --- 31 raw 92 [0 0 8 0] ------- [0:0 0:0 0 3] raw 
+r 8.252088800 _3_ AGT  --- 31 raw 92 [0 0 ffff0000 0] ------- [0:0 0:0 0 3] raw 
+s 8.500000000 _0_ AGT  --- 32 raw 92 [0 0 0 0] ------- [0:0 -1:-1 32 0] raw 
+s 8.501000000 _0_ MAC  --- 32 raw 106 [0 0 8 0] ------- [0:0 0:0 0 3] raw 
+r 8.501088800 _3_ MAC  --- 32 raw 92 [0 0 8 0] ------- [0:0 0:0 0 3] raw 
+r 8.502088800 _3_ AGT  --- 32 raw 92 [0 0 ffff0000 0] ------- [0:0 0:0 0 3] raw 
+s 8.750000000 _0_ AGT  --- 33 raw 92 [0 0 0 0] ------- [0:0 -1:-1 32 0] raw 
+s 8.751000000 _0_ MAC  --- 33 raw 106 [0 0 8 0] ------- [0:0 0:0 0 3] raw 
+r 8.751088800 _3_ MAC  --- 33 raw 92 [0 0 8 0] ------- [0:0 0:0 0 3] raw 
+r 8.752088800 _3_ AGT  --- 33 raw 92 [0 0 ffff0000 0] ------- [0:0 0:0 0 3] raw 
+s 9.000000000 _0_ AGT  --- 34 raw 92 [0 0 0 0] ------- [0:0 -1:-1 32 0] raw 
+s 9.001000000 _0_ MAC  --- 34 raw 106 [0 0 8 0] ------- [0:0 0:0 0 3] raw 
+r 9.001088800 _3_ MAC  --- 34 raw 92 [0 0 8 0] ------- [0:0 0:0 0 3] raw 
+r 9.002088800 _3_ AGT  --- 34 raw 92 [0 0 ffff0000 0] ------- [0:0 0:0 0 3] raw 
+s 9.250000000 _0_ AGT  --- 35 raw 92 [0 0 0 0] ------- [0:0 -1:-1 32 0] raw 
+s 9.251000000 _0_ MAC  --- 35 raw 106 [0 0 8 0] ------- [0:0 0:0 0 3] raw 
+r 9.251088800 _3_ MAC  --- 35 raw 92 [0 0 8 0] ------- [0:0 0:0 0 3] raw 
+r 9.252088800 _3_ AGT  --- 35 raw 92 [0 0 ffff0000 0] ------- [0:0 0:0 0 3] raw 
+s 9.500000000 _0_ AGT  --- 36 raw 92 [0 0 0 0] ------- [0:0 -1:-1 32 0] raw 
+s 9.501000000 _0_ MAC  --- 36 raw 106 [0 0 8 0] ------- [0:0 0:0 0 3] raw 
+r 9.501088800 _3_ MAC  --- 36 raw 92 [0 0 8 0] ------- [0:0 0:0 0 3] raw 
+r 9.502088800 _3_ AGT  --- 36 raw 92 [0 0 ffff0000 0] ------- [0:0 0:0 0 3] raw 
+s 9.750000000 _0_ AGT  --- 37 raw 92 [0 0 0 0] ------- [0:0 -1:-1 32 0] raw 
+s 9.751000000 _0_ MAC  --- 37 raw 106 [0 0 8 0] ------- [0:0 0:0 0 3] raw 
+r 9.751088800 _3_ MAC  --- 37 raw 92 [0 0 8 0] ------- [0:0 0:0 0 3] raw 
+r 9.752088800 _3_ AGT  --- 37 raw 92 [0 0 ffff0000 0] ------- [0:0 0:0 0 3] raw 
diff -ruN --exclude='*.o' --exclude='autom4*' ns-2.34-pure/tcl/ex/nsclick-simple-wlan.tcl ns-2.34/tcl/ex/nsclick-simple-wlan.tcl
--- ns-2.34-pure/tcl/ex/nsclick-simple-wlan.tcl	1969-12-31 16:00:00.000000000 -0800
+++ ns-2.34/tcl/ex/nsclick-simple-wlan.tcl	2010-02-28 09:31:39.000000000 -0800
@@ -0,0 +1,295 @@
+#
+#  Copyright 2002, Univerity of Colorado at Boulder.                        
+#                                                                            
+#                         All Rights Reserved                                
+#                                                                            
+#  Permission to use, copy, modify, and distribute this software and its    
+#  documentation for any purpose other than its incorporation into a        
+#  commercial product is hereby granted without fee, provided that the      
+#  above copyright notice appear in all copies and that both that           
+#  copyright notice and this permission notice appear in supporting         
+#  documentation, and that the name of the University not be used in        
+#  advertising or publicity pertaining to distribution of the software      
+#  without specific, written prior permission.                              
+#                                                                            
+#  UNIVERSITY OF COLORADO DISCLAIMS ALL WARRANTIES WITH REGARD TO THIS      
+#  SOFTWARE, INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY AND        
+#  FITNESS FOR ANY PARTICULAR PURPOSE.  IN NO EVENT SHALL THE UNIVERSITY    
+#  OF COLORADO BE LIABLE FOR ANY SPECIAL, INDIRECT OR CONSEQUENTIAL         
+#  DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM LOSS OF USE, DATA      
+#  OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR OTHER       
+#  TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR         
+#  PERFORMANCE OF THIS SOFTWARE.                                            
+#
+# nsclick-simple-lan.tcl
+#
+# A sample nsclick script simulating a small LAN
+#
+
+#
+# Set some general simulation parameters
+#
+
+#
+# Unity gain, omnidirectional antennas, centered 1.5m above each node.
+# These values are lifted from the ns-2 sample files.
+#
+Antenna/OmniAntenna set X_ 0
+Antenna/OmniAntenna set Y_ 0
+Antenna/OmniAntenna set Z_ 1.5
+Antenna/OmniAntenna set Gt_ 1.0
+Antenna/OmniAntenna set Gr_ 1.0
+
+#
+# Initialize the SharedMedia interface with parameters to make
+# it work like the 914MHz Lucent WaveLAN DSSS radio interface
+# These are taken directly from the ns-2 sample files.
+#
+Phy/WirelessPhy set CPThresh_ 10.0
+Phy/WirelessPhy set CSThresh_ 1.559e-11
+Phy/WirelessPhy set RXThresh_ 3.652e-10
+Phy/WirelessPhy set Rb_ 2*1e6
+Phy/WirelessPhy set Pt_ 0.2818
+Phy/WirelessPhy set freq_ 914e+6 
+Phy/WirelessPhy set L_ 1.0
+
+# 
+# Set the size of the playing field and the topography.
+#
+set xsize 100
+set ysize 100
+set wtopo	[new Topography]
+$wtopo load_flatgrid $xsize $ysize
+
+#
+# The network channel, physical layer, MAC, propagation model,
+# and antenna model are all standard ns-2.
+#  
+set netchan	Channel/WirelessChannel
+set netphy	Phy/WirelessPhy
+set netmac	Mac/802_11
+set netprop     Propagation/TwoRayGround
+set antenna     Antenna/OmniAntenna
+
+#
+# We have to use a special queue and link layer. This is so that
+# Click can have control over the network interface packet queue,
+# which is vital if we want to play with, e.g. QoS algorithms.
+#
+set netifq	Queue/ClickQueue
+set netll	LL/Ext
+LL set delay_			1ms
+
+#
+# These are pretty self-explanatory, just the number of nodes
+# and when we'll stop.
+#
+set nodecount   4
+set stoptime	10.0
+
+#
+# With nsclick, we have to worry about details like which network
+# port to use for communication. This sets the default ports to 5000.
+#
+Agent/Null set sport_		5000
+Agent/Null set dport_		5000
+
+Agent/CBR set sport_		5000
+Agent/CBR set dport_		5000
+
+#
+# Standard ns-2 stuff here - create the simulator object.
+#
+Simulator set MacTrace_ ON
+set ns_		[new Simulator]
+
+#
+# Create and activate trace files.
+#
+set tracefd	[open "nsclick-simple-wlan.tr" w]
+set namtrace    [open "nsclick-simple-wlan.nam" w]
+$ns_ trace-all $tracefd
+$ns_ namtrace-all-wireless $namtrace $xsize $ysize
+$ns_ use-newtrace
+
+
+#
+# Create the "god" object. This is another artifact of using
+# the mobile node type. We have to have this even though
+# we never use it.
+#
+set god_ [create-god $nodecount]
+
+#
+# Tell the simulator to create Click nodes.
+#
+Simulator set node_factory_ Node/MobileNode/ClickNode
+
+#
+# Create a network Channel for the nodes to use. One channel
+# per LAN. Also set the propagation model to be used.
+#
+set chan_1_ [new $netchan]
+set prop_ [new $netprop]
+
+#
+# In nsclick we have to worry about assigning IP and MAC addresses
+# to out network interfaces. Here we generate a list of IP and MAC
+# addresses, one per node since we've only got one network interface
+# per node in this case. Also note that this scheme only works for
+# fewer than 255 nodes, and we aren't worrying about subnet masks.
+#
+set iptemplate "192.168.1.%d"
+set mactemplate "00:03:47:70:89:%0x"
+for {set i 0} {$i < $nodecount} {incr i} {
+    set node_ip($i) [format $iptemplate [expr $i+1]]
+    set node_mac($i) [format $mactemplate [expr $i+1]]
+}
+
+#
+# We set the routing protocol to "Empty" so that ns-2 doesn't do
+# any packet routing. All of the routing will be done by the
+# Click script.
+#
+$ns_ rtproto Empty
+
+#
+# Here is where we actually create all of the nodes.
+#
+for {set i 0} {$i < $nodecount } {incr i} {
+    set node_($i) [$ns_ node]
+
+    #
+    # After creating the node, we add one wireless network interface to
+    # it. By default, this interface will be named "eth0". If we
+    # added a second interface it would be named "eth1", a third
+    # "eth2" and so on.
+    #
+    $node_($i) add-interface $chan_1_ $prop_ $netll $netmac \
+	$netifq 1 $netphy $antenna $wtopo
+
+    #
+    # Now configure the interface eth0
+    #
+    $node_($i) setip "eth0" $node_ip($i)
+    $node_($i) setmac "eth0" $node_mac($i)
+
+    #
+    # Set some node properties
+    #
+    $node_($i) random-motion 0
+    $node_($i) topography $wtopo
+    $node_($i) nodetrace $tracefd
+
+    #
+    # The node name is used by Click to distinguish information
+    # coming from different nodes. For example, a "Print" element
+    # prepends this to the printed string so it's clear exactly
+    # which node is doing the printing.
+    #
+    [$node_($i) set classifier_] setnodename "node$i-simplelan"
+    
+    #
+    # Load the appropriate Click router script for the node.
+    # All nodes in this simulation are using the same script,
+    # but there's no reason why each node couldn't use a different
+    # script.
+    #
+    [$node_($i) entry] loadclick "nsclick-simple-lan.click"
+}
+
+
+# 
+# Define node network traffic. There isn't a whole lot going on
+# in this simple test case, we're just going to have the first node
+# send packets to the last node, starting at 1 second, and ending at 10.
+# There are Perl scripts available to automatically generate network
+# traffic.
+#
+
+
+#
+# Start transmitting at $startxmittime, $xmitrate packets per second.
+#
+set startxmittime 1
+set xmitrate 4
+set xmitinterval 0.25
+set packetsize 64
+
+#
+# We use the "raw" packet type, which sends real packet data
+# down the pipe.
+#
+set raw_(0) [new Agent/Raw]
+$ns_ attach-agent $node_(0) $raw_(0)
+
+set lastnode [expr $nodecount-1]
+set null_(0) [new Agent/Null]
+$ns_ attach-agent $node_($lastnode) $null_(0)
+
+#
+# The CBR object is just the default ns-2 CBR object, so
+# no change in the meaning of the parameters.
+#
+set cbr_(0) [new Application/Traffic/CBR]
+$cbr_(0) set packetSize_ $packetsize
+$cbr_(0) set interval_ $xmitinterval
+$cbr_(0) set random_ 0
+$cbr_(0) set maxpkts_ [expr ($stoptime - $startxmittime)*$xmitrate]
+$cbr_(0) attach-agent $raw_(0)
+
+#
+# The Raw agent creates real UDP packets, so it has to know
+# the source and destination IP addresses and port numberes.
+#
+$raw_(0) set-srcip [$node_(0) getip eth0]
+$raw_(0) set-srcport 5000
+$raw_(0) set-destport 5000
+$raw_(0) set-destip [$node_($lastnode) getip eth0]
+
+$ns_ at $startxmittime "$cbr_(0) start"
+
+
+$node_(0) set X_ 10
+$node_(0) set Y_ 50
+$node_(0) set Z_ 0
+
+$node_(1) set X_ 50
+$node_(1) set Y_ 50
+$node_(1) set Z_ 0
+
+$node_(2) set X_ 90
+$node_(2) set Y_ 50
+$node_(2) set Z_ 0
+
+$node_(3) set X_ 50
+$node_(3) set Y_ 10
+$node_(3) set Z_ 0
+
+
+#
+# This sizes the nodes for use in nam. Currently, the trace files
+# produced by nsclick don't really work in nam.
+#
+for {set i 0} {$i < $nodecount} {incr i} {
+    $ns_ initial_node_pos $node_($i) 20
+    [$node_($i) entry] runclick
+}
+
+#
+# Stop the simulation
+#
+$ns_ at  $stoptime.000000001 "puts \"NS EXITING...\" ; $ns_ halt"
+
+#
+# Let nam know that the simulation is done.
+#
+$ns_ at  $stoptime	"$ns_ nam-end-wireless $stoptime"
+
+
+puts "Starting Simulation..."
+$ns_ run
+
+
+
+
diff -ruN --exclude='*.o' --exclude='autom4*' ns-2.34-pure/tcl/lib/ns-autoconf.tcl ns-2.34/tcl/lib/ns-autoconf.tcl
--- ns-2.34-pure/tcl/lib/ns-autoconf.tcl	1969-12-31 16:00:00.000000000 -0800
+++ ns-2.34/tcl/lib/ns-autoconf.tcl	2010-02-28 11:48:16.000000000 -0800
@@ -0,0 +1,50 @@
+# -*-	Mode:tcl -*-
+#
+# Copyright (c) 1997 University of Southern California.
+# All rights reserved.                                            
+#                                                                
+# Redistribution and use in source and binary forms are permitted
+# provided that the above copyright notice and this paragraph are
+# duplicated in all such forms and that any documentation, advertising
+# materials, and other materials related to such distribution and use
+# acknowledge that the software was developed by the University of
+# Southern California, Information Sciences Institute.  The name of the
+# University may not be used to endorse or promote products derived from
+# this software without specific prior written permission.
+# 
+# THIS SOFTWARE IS PROVIDED "AS IS" AND WITHOUT ANY EXPRESS OR IMPLIED
+# WARRANTIES, INCLUDING, WITHOUT LIMITATION, THE IMPLIED WARRANTIES OF
+# MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.
+#
+#
+
+# This file should contain variables changed only by autoconf.
+
+proc checkout_executable {exe_var best alternate text} {
+	global $exe_var
+	set $exe_var $best
+	if {"$best" == "" || ![file executable $best]} {
+		puts stderr $text
+		set $exe_var $alternate
+	}
+}
+
+#
+# Keep track of where the good perl is.
+#
+checkout_executable PERL "/usr/bin/perl" perl "\
+	When configured, ns found the right version of perl in\
+	/usr/bin/perl
+	but it doesn't seem to be there anymore, so\
+	ns will fall back on running the first perl in your path.\
+	The wrong version of perl may break the test suites.\
+	Reconfigure and rebuild ns if this is a problem.\
+"
+checkout_executable TCLSH "/usr/bin/tclsh8.4" tclsh "\
+	When configured, ns found the right version of tclsh in\
+	/usr/bin/tclsh8.4
+	but it doesn't seem to be there anymore, so\
+	ns will fall back on running the first tclsh in your path.\
+	The wrong version of tclsh may break the test suites.\
+	Reconfigure and rebuild ns if this is a problem.\
+"
diff -ruN --exclude='*.o' --exclude='autom4*' ns-2.34-pure/tcl/lib/ns-clicknode.tcl ns-2.34/tcl/lib/ns-clicknode.tcl
--- ns-2.34-pure/tcl/lib/ns-clicknode.tcl	1969-12-31 16:00:00.000000000 -0800
+++ ns-2.34/tcl/lib/ns-clicknode.tcl	2010-02-28 09:31:39.000000000 -0800
@@ -0,0 +1,352 @@
+#
+#  Copyright 2002, Univerity of Colorado at Boulder.                        
+#                                                                            
+#                         All Rights Reserved                                
+#                                                                            
+#  Permission to use, copy, modify, and distribute this software and its    
+#  documentation for any purpose other than its incorporation into a        
+#  commercial product is hereby granted without fee, provided that the      
+#  above copyright notice appear in all copies and that both that           
+#  copyright notice and this permission notice appear in supporting         
+#  documentation, and that the name of the University not be used in        
+#  advertising or publicity pertaining to distribution of the software      
+#  without specific, written prior permission.                              
+#                                                                            
+#  UNIVERSITY OF COLORADO DISCLAIMS ALL WARRANTIES WITH REGARD TO THIS      
+#  SOFTWARE, INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY AND        
+#  FITNESS FOR ANY PARTICULAR PURPOSE.  IN NO EVENT SHALL THE UNIVERSITY    
+#  OF COLORADO BE LIABLE FOR ANY SPECIAL, INDIRECT OR CONSEQUENTIAL         
+#  DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM LOSS OF USE, DATA      
+#  OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR OTHER       
+#  TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR         
+#  PERFORMANCE OF THIS SOFTWARE.                                            
+#
+#
+
+Class ClickNode -superclass Node/MobileNode
+
+Node/MobileNode/ClickNode instproc init args {
+    $self instvar nifs_ netif_ mac_ ifq_ ll_ dmux_
+    set ns [Simulator instance]
+    eval $self next $args
+    set nifs_ 0
+    $self register-module [new RtModule/Click]
+
+    #
+    # This Trace Target is used to log changes in direction
+    # and velocity for the mobile node.
+    #
+    set tracefd [$ns get-ns-traceall]
+    if {$tracefd != "" } {
+	$self nodetrace $tracefd
+	#$self agenttrace $tracefd
+    }
+
+    set namtracefd [$ns get-nam-traceall]
+    if {$namtracefd != "" } {
+	$self namattach $namtracefd
+    }
+
+}
+
+Node/MobileNode/ClickNode instproc getip { ifname } {
+    [$self entry] getip $ifname
+}
+
+Node/MobileNode/ClickNode instproc getmac { ifname } {
+    [$self entry] getmac $ifname
+}
+
+Node/MobileNode/ClickNode instproc setip { ifname ipaddr } {
+    [$self entry] setip $ifname $ipaddr
+}
+
+Node/MobileNode/ClickNode instproc setmac { ifname macaddr } {
+    [$self entry] setmac $ifname $macaddr
+}
+
+Node/MobileNode/ClickNode instproc add-route { dst target } {
+    #puts "ClickNode does routing via Click - not ns."
+}
+
+Node/MobileNode/ClickNode instproc delete-route args {
+    #puts "ClickNode does routing via Click - not ns."
+}
+
+Node/MobileNode/ClickNode instproc route-notify { module } {
+    #puts "ClickNode does routing via Click - not ns."
+}
+
+#
+# The following setups up link layer, mac layer, network interface
+# and physical layer structures for the click node. Stolen from
+# the MobileNode code, and then modified a bit, e.g. the ARP
+# stuff got removed.
+#
+Node/MobileNode/ClickNode instproc add-interface { channel pmodel lltype mactype \
+					    qtype qlen iftype anttype topo} {
+
+    $self instvar nifs_ netif_ mac_ ifq_ ll_
+    set ns [Simulator instance]
+    set t $nifs_
+    incr nifs_
+
+    set netif_($t)	[new $iftype]		;# interface
+    set mac_($t)	[new $mactype]		;# mac layer
+    set ifq_($t)	[new $qtype]		;# interface queue
+    set ll_($t)	[new $lltype]		;# link layer
+    set ant_($t)    [new $anttype]
+
+    set namfp [$ns get-nam-traceall]
+
+    #
+    # Local Variables
+    #
+    set nullAgent_ [$ns set nullAgent_]
+    set netif $netif_($t)
+    set mac $mac_($t)
+    set ifq $ifq_($t)
+    set ll $ll_($t)
+
+    #
+    # Link Layer
+    #
+    $ll mac $mac
+    $ll down-target $ifq
+    $ll up-target [$self entry]
+    # Stuff the link layer into the next available classifier slot, and
+    # use that slot number as the network id
+    $ll setid [[$self entry] installNext $ll]
+    # Set the associated MAC layer address
+    $ll set macDA_ [$mac id]
+
+    #
+    # Interface Queue
+    #
+    $ifq target $mac
+    $ifq set limit_ $qlen
+    set drpT [cmu-trace Drop "IFQ" $self]
+    $ifq drop-target $drpT
+    if { $namfp != "" } {
+	$drpT namattach $namfp
+    }
+    if {$qtype == "Queue/ClickQueue"} {
+	$ifq setclickclassifier [$self entry]
+	$ll ifq $ifq
+    }
+
+    #
+    # Mac Layer
+    #
+    $mac netif $netif
+    $mac up-target $ll
+    $mac down-target $netif
+    set god_ [God instance]
+    if {$mactype == "Mac/802_11"} {
+	# XXX this is a hack to handle multiple interfaces per node.
+	$mac nodes [expr 4*[$god_ num_nodes]]
+    }
+    #
+    # Network Interface
+    #
+    $netif channel $channel
+    $netif up-target $mac
+    $netif propagation $pmodel	;# Propagation Model
+    $netif node $self		;# Bind node <---> interface
+    $netif antenna $ant_($t)
+    #
+    # Physical Channel
+    #
+    $channel addif $netif
+
+        # List-based improvement
+	# For nodes talking to multiple channels this should
+	# be called multiple times for each channel
+	$channel add-node $self		
+
+	# let topo keep handle of channel
+	$topo channel $channel	
+
+    
+    # ============================================================
+    
+    if { [Simulator set MacTrace_] == "ON" } {
+	#
+	# Trace RTS/CTS/ACK Packets
+	#
+	set rcvT [cmu-trace Recv "MAC" $self]
+	$mac log-target $rcvT
+	if { $namfp != "" } {
+	    $rcvT namattach $namfp
+	}
+	#
+	# Trace Sent Packets
+	#
+	set sndT [cmu-trace Send "MAC" $self]
+	$sndT target [$mac down-target]
+	$mac down-target $sndT
+	if { $namfp != "" } {
+	    $sndT namattach $namfp
+	}
+	#
+	# Trace Received Packets
+	#
+	set rcvT [cmu-trace Recv "MAC" $self]
+	$rcvT target [$mac up-target]
+	$mac up-target $rcvT
+	if { $namfp != "" } {
+	    $rcvT namattach $namfp
+	}
+	#
+	# Trace Dropped Packets
+	#
+	set drpT [cmu-trace Drop "MAC" $self]
+	$mac drop-target $drpT
+	if { $namfp != "" } {
+	    $drpT namattach $namfp
+	}
+    } else {
+	$mac log-target [$ns set nullAgent_]
+	$mac drop-target [$ns set nullAgent_]
+    }
+    
+    # ============================================================
+    
+    $self addif $netif
+}
+
+
+#
+# The following setups up link layer, mac layer, network interface
+# and physical layer structures for the click node. Stolen from
+# the MobileNode code, and then modified a bit, e.g. the ARP
+# stuff got removed.
+#
+Node/MobileNode/ClickNode instproc add-wired-interface { channel lltype mactype qtype qlen iftype} {
+
+    $self instvar nifs_ netif_ mac_ ifq_ ll_
+    set ns [Simulator instance]
+    set t $nifs_
+    incr nifs_
+
+    set netif_($t)	[new $iftype]		;# interface
+    set mac_($t)	[new $mactype]		;# mac layer
+    set ifq_($t)	[new $qtype]		;# interface queue
+    set ll_($t)	[new $lltype]		;# link layer
+
+
+    set namfp [$ns get-nam-traceall]
+
+    #
+    # Local Variables
+    #
+    set nullAgent_ [$ns set nullAgent_]
+    set netif $netif_($t)
+    set mac $mac_($t)
+    set ifq $ifq_($t)
+    set ll $ll_($t)
+
+    #
+    # Link Layer
+    #
+    $ll mac $mac
+    $ll down-target $ifq
+     $ll up-target [$self entry]
+    # Stuff the link layer into the next available classifier slot, and
+    # use that slot number as the network id
+    $ll setid [[$self entry] installNext $ll]
+    # Set the associated MAC layer address
+    $ll set macDA_ [$mac id]
+
+    #
+    # Interface Queue
+    #
+    $ifq target $mac
+    $ifq set limit_ $qlen
+    set drpT [cmu-trace Drop "IFQ" $self]
+    $ifq drop-target $drpT
+    if { $namfp != "" } {
+	$drpT namattach $namfp
+    }
+    if {$qtype == "Queue/ClickQueue"} {
+	$ifq setclickclassifier [$self entry]
+	$ll ifq $ifq
+    }
+
+    #
+    # Mac Layer
+    #
+    $mac netif $netif
+    $mac up-target $ll
+    $mac down-target $netif
+    set god_ [God instance]
+    if {$mactype == "Mac/802_11"} {
+	$mac nodes [$god_ num_nodes]
+    }
+    #
+    # Network Interface
+    #
+    $netif channel $channel
+    $netif up-target $mac
+    $netif node $self		;# Bind node <---> interface
+    #
+    # Physical Channel
+    #
+    $channel addif $netif
+    
+    # ============================================================
+    
+    if { [Simulator set MacTrace_] == "ON" } {
+	#
+	# Trace RTS/CTS/ACK Packets
+	#
+	set rcvT [cmu-trace Recv "MAC" $self]
+	$mac log-target $rcvT
+	if { $namfp != "" } {
+	    $rcvT namattach $namfp
+	}
+	#
+	# Trace Sent Packets
+	#
+	set sndT [cmu-trace Send "MAC" $self]
+	$sndT target [$mac down-target]
+	$mac down-target $sndT
+	if { $namfp != "" } {
+	    $sndT namattach $namfp
+	}
+	#
+	# Trace Received Packets
+	#
+	set rcvT [cmu-trace Recv "MAC" $self]
+	$rcvT target [$mac up-target]
+	$mac up-target $rcvT
+	if { $namfp != "" } {
+	    $rcvT namattach $namfp
+	}
+	#
+	# Trace Dropped Packets
+	#
+	set drpT [cmu-trace Drop "MAC" $self]
+	$mac drop-target $drpT
+	if { $namfp != "" } {
+	    $drpT namattach $namfp
+	}
+    } else {
+	$mac log-target [$ns set nullAgent_]
+	$mac drop-target [$ns set nullAgent_]
+    }
+    
+    # ============================================================
+    
+    $self addif $netif
+}
+
+Node/MobileNode/ClickNode instproc setpromiscuous { whichif ispromisc } {
+    $self instvar ll_
+    set thell $ll_($whichif)
+    $thell setpromiscuous $ispromisc
+}
+
+Node/MobileNode/ClickNode instproc dump-namconfig {} {
+# Do nothing
+}
\ No newline at end of file
diff -ruN --exclude='*.o' --exclude='autom4*' ns-2.34-pure/tcl/lib/ns-default.tcl ns-2.34/tcl/lib/ns-default.tcl
--- ns-2.34-pure/tcl/lib/ns-default.tcl	2009-06-14 10:35:41.000000000 -0700
+++ ns-2.34/tcl/lib/ns-default.tcl	2010-02-28 09:31:39.000000000 -0800
@@ -761,6 +761,19 @@
 Phy/WirelessPhy set Pt_ 0.28183815
 Phy/WirelessPhy set freq_ 914e+6
 Phy/WirelessPhy set L_ 1.0  
+# Madwifi multirate support
+# Number of rates
+# Set 0 to disable multirate
+Phy/WirelessPhy set RateCount_ 0
+
+# Placeholder SwitchChannel function
+# This allows the WirelessInfo element in the Click router
+# to trigger a channel change.
+# Override this in your simulation script to effectively 
+# change the channel of wireless interface.
+proc SwitchChannel { i whichif whichnewchannel } {
+
+}
 
 Phy/WirelessPhyExt set CSThresh_ 6.30957e-12           ;# -82 dBm
 Phy/WirelessPhyExt set noise_floor_ 7.96159e-14        ;# -101 dBm
diff -ruN --exclude='*.o' --exclude='autom4*' ns-2.34-pure/tcl/lib/ns-lib.tcl ns-2.34/tcl/lib/ns-lib.tcl
--- ns-2.34-pure/tcl/lib/ns-lib.tcl	2009-06-14 10:35:41.000000000 -0700
+++ ns-2.34/tcl/lib/ns-lib.tcl	2010-02-28 09:31:39.000000000 -0800
@@ -208,6 +208,8 @@
 source ns-default.tcl
 source ../emulate/ns-emulate.tcl
 
+source ns-clicknode.tcl
+
 #pushback
 source ns-pushback.tcl
 
diff -ruN --exclude='*.o' --exclude='autom4*' ns-2.34-pure/tcl/lib/ns-mobilenode.tcl ns-2.34/tcl/lib/ns-mobilenode.tcl
--- ns-2.34-pure/tcl/lib/ns-mobilenode.tcl	2009-06-14 10:35:41.000000000 -0700
+++ ns-2.34/tcl/lib/ns-mobilenode.tcl	2010-02-28 09:31:39.000000000 -0800
@@ -706,6 +706,7 @@
 
 
 
+
 Node/MobileNode instproc mobility-trace { ttype atype } {
 	set ns [Simulator instance]
         set tracefd [$ns get-ns-traceall]
@@ -834,6 +835,21 @@
 }
 # </zheng: add>
 
+# change interface channel
+Node/MobileNode instproc changechannel { whichif newchan } {
+	$self instvar netif_
+	[$netif_($whichif) getchannel] delif $netif_($whichif)
+	$netif_($whichif) channel $newchan
+	$newchan addif $netif_($whichif)
+}
+
+# aim a steerable antenna
+Node/MobileNode instproc aimantenna { whichif newdir } {
+	$self instvar netif_
+	set theant [$netif_($whichif) getantenna]
+	$theant set Dir_ $newdir
+}
+
 Class SRNodeNew -superclass Node/MobileNode
 
 SRNodeNew instproc init args {
diff -ruN --exclude='*.o' --exclude='autom4*' ns-2.34-pure/tcl/lib/ns-packet.tcl ns-2.34/tcl/lib/ns-packet.tcl
--- ns-2.34-pure/tcl/lib/ns-packet.tcl	2009-06-14 10:35:41.000000000 -0700
+++ ns-2.34/tcl/lib/ns-packet.tcl	2010-02-28 09:31:39.000000000 -0800
@@ -115,6 +115,7 @@
 	Common 
 	Flags
 	IP 	# IP
+	Raw	# nsclick: raw packet type
 # Routing Protocols:
 	NV 	# NixVector classifier for stateless routing 
 	rtProtoDV 	# distance vector routing protocol
diff -ruN --exclude='*.o' --exclude='autom4*' ns-2.34-pure/tcl/lib/ns-rtmodule.tcl ns-2.34/tcl/lib/ns-rtmodule.tcl
--- ns-2.34-pure/tcl/lib/ns-rtmodule.tcl	2009-06-14 10:35:41.000000000 -0700
+++ ns-2.34/tcl/lib/ns-rtmodule.tcl	2010-02-28 09:31:39.000000000 -0800
@@ -340,6 +340,43 @@
 RtModule/VC instproc add-route { dst target } {
 }
 
+
+#
+# Click routing module. Intended to subvert the normal routing process
+# and defer to Click.
+#
+RtModule/Click instproc init {} {
+        $self next
+}
+
+RtModule/Click instproc register { node } {
+        $self next $node
+        $self make-classifier
+}
+
+RtModule/Click instproc make-classifier {} {
+        $self instvar classifier_
+        set classifier_ [new Classifier/Ext/Click]
+        [$self node] install-entry $self $classifier_
+        $classifier_ setnodename [format "node%d" [[$self node] set id_]]
+        $classifier_ setnodeaddr [[$self node] set address_]
+        [$self node] set dmux_ [new Classifier/Port]
+
+        # Always stick the kernel tap interface into slot 0
+        $classifier_ install 0 [[$self node] set dmux_]
+}
+
+RtModule/Click instproc attach { agent port } {
+        # Send target
+        $agent target [[$self node] entry]
+        # Recv target
+        [[$self node] demux] install $port $agent
+}
+
+RtModule/Click instproc detach { agent nullagent } {
+        # Empty method
+}
+
 Classifier/Virtual instproc find dst {
 	$self instvar node_
 	if {[$node_ id] == $dst} {
diff -ruN --exclude='*.o' --exclude='autom4*' ns-2.34-pure/tcl/rtglib/route-proto.tcl ns-2.34/tcl/rtglib/route-proto.tcl
--- ns-2.34-pure/tcl/rtglib/route-proto.tcl	2009-06-14 10:35:40.000000000 -0700
+++ ns-2.34/tcl/rtglib/route-proto.tcl	2010-02-28 09:31:39.000000000 -0800
@@ -739,6 +739,15 @@
 Agent/rtProto/Manual proc init-all args {
     # The user will do all routing.
 }
+#
+# Empty. Does NOTHING - even less than the Manual routing.
+#
+Class Agent/rtProto/Empty -superclass Agent/rtProto
+
+Agent/rtProto/Empty proc init-all args {
+    # Do nothing
+}
+
 
 ### Local Variables:
 ### mode: tcl
diff -ruN --exclude='*.o' --exclude='autom4*' ns-2.34-pure/tools/random.cc ns-2.34/tools/random.cc
--- ns-2.34-pure/tools/random.cc	2009-06-14 10:35:44.000000000 -0700
+++ ns-2.34/tools/random.cc	2010-02-28 09:31:39.000000000 -0800
@@ -34,7 +34,7 @@
  * "@(#) $Header: /cvsroot/nsnam/ns-2/tools/random.cc,v 1.21 2006/12/17 15:12:37 mweigle Exp $ (LBL)";
  */
 
-#ifndef WIN32
+#if !defined(WIN32) && !defined(ALLOW_RANDOM)
 
 #include <sys/time.h>
 #include "config.h"
diff -ruN --exclude='*.o' --exclude='autom4*' ns-2.34-pure/trace/cmu-trace.cc ns-2.34/trace/cmu-trace.cc
--- ns-2.34-pure/trace/cmu-trace.cc	2009-06-14 10:35:07.000000000 -0700
+++ ns-2.34/trace/cmu-trace.cc	2010-02-28 09:31:39.000000000 -0800
@@ -55,6 +55,7 @@
 #include <aomdv/aomdv_packet.h>
 #include <cmu-trace.h>
 #include <mobilenode.h>
+#include <rawpacket.h>
 #include <simulator.h>
 //<zheng: add for 802.15.4>
 #include "wpan/p802_15_4pkt.h"
@@ -1061,6 +1062,20 @@
 	}
 }
 
+// XXX Fix this
+void
+CMUTrace::format_raw(Packet *p, int offset)
+{
+        //struct hdr_cmn *ch = HDR_CMN(p);
+        //struct hdr_tcp *th = HDR_TCP(p);
+        
+        if( newtrace_ ) {
+                sprintf(pt_->buffer() + offset,"raw ");
+        } else {
+                sprintf(pt_->buffer() + offset,"raw ");
+        }
+}
+
 void
 CMUTrace::nam_format(Packet *p, int offset)
 {
@@ -1305,6 +1320,12 @@
 	hdr_cmn *ch = HDR_CMN(p);
 	int offset = 0;
 
+	int israw = (PT_RAW == ch->ptype());
+ 	hdr_raw* rhdr = hdr_raw::access(p);	
+	if (israw) {
+	    ch->ptype() = (packet_t) rhdr->ns_type;
+	}
+
 	/*
 	 * Log the MAC Header
 	 */
@@ -1313,6 +1334,8 @@
 	if (pt_->namchannel()) 
 		nam_format(p, offset);
 	offset = strlen(pt_->buffer());
+
+
 	switch(ch->ptype()) {
 	case PT_MAC:
 	case PT_SMAC:
@@ -1324,6 +1347,9 @@
 		format_ip(p, offset);
 		offset = strlen(pt_->buffer());
 		switch(ch->ptype()) {
+		case PT_RAW:
+			format_raw(p, offset);
+			break;
 		case PT_AODV:
 			format_aodv(p, offset);
 			break;
@@ -1374,6 +1400,9 @@
 			break;		//zheng: add
 		}
 	}
+	if (israw) {
+	    ch->ptype() = PT_RAW;
+	}
 }
 
 int
diff -ruN --exclude='*.o' --exclude='autom4*' ns-2.34-pure/trace/cmu-trace.h ns-2.34/trace/cmu-trace.h
--- ns-2.34-pure/trace/cmu-trace.h	2009-06-14 10:35:07.000000000 -0700
+++ ns-2.34/trace/cmu-trace.h	2010-02-28 09:31:39.000000000 -0800
@@ -159,6 +159,7 @@
 	void	format_tora(Packet *p, int offset);
         void    format_imep(Packet *p, int offset);
         void    format_aodv(Packet *p, int offset);
+	void    format_raw(Packet *p, int offset);
 	void    format_aomdv(Packet *p, int offset);
 
 	// This holds all the tracers added at run-time
