%info
Tests if the router dies in MT context

%require
click-buildtool provides umultithread

%script
for i in $(seq 1 100); do
    $VALGRIND click -j 16 -e '
	t :: MTDieTest()
	DriverManager(wait,wait,wait,wait,wait,wait,wait,wait,wait,wait,wait,wait,wait,wait,wait,wait,
		print "stopping",
		stop)
    '
    echo done
done

%expect stdout
stopping
done
stopping
done
stopping
done
stopping
done
stopping
done
stopping
done
stopping
done
stopping
done
stopping
done
stopping
done
stopping
done
stopping
done
stopping
done
stopping
done
stopping
done
stopping
done
stopping
done
stopping
done
stopping
done
stopping
done
stopping
done
stopping
done
stopping
done
stopping
done
stopping
done
stopping
done
stopping
done
stopping
done
stopping
done
stopping
done
stopping
done
stopping
done
stopping
done
stopping
done
stopping
done
stopping
done
stopping
done
stopping
done
stopping
done
stopping
done
stopping
done
stopping
done
stopping
done
stopping
done
stopping
done
stopping
done
stopping
done
stopping
done
stopping
done
stopping
done
stopping
done
stopping
done
stopping
done
stopping
done
stopping
done
stopping
done
stopping
done
stopping
done
stopping
done
stopping
done
stopping
done
stopping
done
stopping
done
stopping
done
stopping
done
stopping
done
stopping
done
stopping
done
stopping
done
stopping
done
stopping
done
stopping
done
stopping
done
stopping
done
stopping
done
stopping
done
stopping
done
stopping
done
stopping
done
stopping
done
stopping
done
stopping
done
stopping
done
stopping
done
stopping
done
stopping
done
stopping
done
stopping
done
stopping
done
stopping
done
stopping
done
stopping
done
stopping
done
stopping
done
stopping
done
stopping
done
stopping
done
stopping
done
stopping
done
stopping
done
