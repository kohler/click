%info
Test double-brace regexes.

%script
clicktest TEST1 TEST2 TEST3 TEST4 TEST5 TEST6 || true

%file -d TEST1
 %info
 Test that -w only trims whitespace outside double braces.
 This is actually quirky and unexpected.
 %file FOO
 w1 w2
 w1 w2
 %expect -w FOO
 {{w1w2}}
 {{w1 w2}}

%file -d TEST2
 %file FOO
 10
 11
 12
 %expect FOO
 {{~ 10-11}}
 {{~ 10-11}}
 {{~ 10-11}}

%file -d TEST3
 %file FOO
 9
 10
 011
 12
 %expect FOO
 {{~ 10+-1}}
 {{~ 10+-1}}
 {{~ 10+-1}}
 {{~ 10+-1}}

%file -d TEST4
 %info
 5% of 10 is 0.5, which is rounded down to 0
 %file FOO
 10
 11
 %expect FOO
 {{~ 10+-5%}}
 {{~ 10+-5%}}

%file -d TEST5
 %info
 range embedded inside regex. also %expectx
 %file FOO1
 1 is een
 %file FOO2
 en 00002 is twee
 %expect FOO1
 {{{{~1-2}} is (een|twee)}}
 %expectx FOO2
 en {{~1-2}} is (een|twee)

%file -d TEST6
 %info
 test %ignore and %ignorex
 %file FOO
 1 is een
 en 02 is twee
 %expect FOO
 %ignore
 {{{{~1-2}} is (een|twee)}}
 %ignorex
 en {{~1-2}} is (een|twee)

%expect stderr
TEST1:{{\d+}}: file FOO has unexpected value starting at line {{\d+}}
TEST1:{{\d+}}: FOO:2: expected {{.*}}
TEST1:{{\d+}}: FOO:{{\d+}}: but got  'w1 w2'
TEST2:{{\d+}}: file FOO has unexpected value starting at line {{\d+}}
TEST2:{{\d+}}: FOO:{{\d+}}: expected '{{.*}}'
TEST2:{{\d+}}: FOO:{{\d+}}: but got  '12'
TEST3:{{\d+}}: file FOO has unexpected value starting at line {{\d+}}
TEST3:{{\d+}}: FOO:{{\d+}}: expected '{{.*}}'
TEST3:{{\d+}}: FOO:{{\d+}}: but got  '12'
TEST4:{{\d+}}: file FOO has unexpected value starting at line {{\d+}}
TEST4:{{\d+}}: FOO:{{\d+}}: expected '{{.*}}'
TEST4:{{\d+}}: FOO:{{\d+}}: but got  '11'
clicktest: 2 successes, 4 failures, 0 skipped
